var TE=Object.defineProperty;var EE=(t,e,n)=>e in t?TE(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var M=(t,e,n)=>EE(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var ZU=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vy(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var wy={exports:{}},Iu={},by={exports:{}},at={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ol=Symbol.for("react.element"),SE=Symbol.for("react.portal"),CE=Symbol.for("react.fragment"),PE=Symbol.for("react.strict_mode"),kE=Symbol.for("react.profiler"),RE=Symbol.for("react.provider"),IE=Symbol.for("react.context"),ME=Symbol.for("react.forward_ref"),NE=Symbol.for("react.suspense"),OE=Symbol.for("react.memo"),DE=Symbol.for("react.lazy"),vm=Symbol.iterator;function BE(t){return t===null||typeof t!="object"?null:(t=vm&&t[vm]||t["@@iterator"],typeof t=="function"?t:null)}var xy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ty=Object.assign,Ey={};function qo(t,e,n){this.props=t,this.context=e,this.refs=Ey,this.updater=n||xy}qo.prototype.isReactComponent={};qo.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};qo.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Sy(){}Sy.prototype=qo.prototype;function qd(t,e,n){this.props=t,this.context=e,this.refs=Ey,this.updater=n||xy}var Gd=qd.prototype=new Sy;Gd.constructor=qd;Ty(Gd,qo.prototype);Gd.isPureReactComponent=!0;var wm=Array.isArray,Cy=Object.prototype.hasOwnProperty,Jd={current:null},Py={key:!0,ref:!0,__self:!0,__source:!0};function ky(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)Cy.call(e,r)&&!Py.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var f=Array(a),p=0;p<a;p++)f[p]=arguments[p+2];i.children=f}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:Ol,type:t,key:s,ref:o,props:i,_owner:Jd.current}}function FE(t,e){return{$$typeof:Ol,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function ep(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ol}function LE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var bm=/\/+/g;function Kf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?LE(""+t.key):e.toString(36)}function HA(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Ol:case SE:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+Kf(o,0):r,wm(i)?(n="",t!=null&&(n=t.replace(bm,"$&/")+"/"),HA(i,e,n,"",function(p){return p})):i!=null&&(ep(i)&&(i=FE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(bm,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",wm(t))for(var a=0;a<t.length;a++){s=t[a];var f=r+Kf(s,a);o+=HA(s,e,n,f,i)}else if(f=BE(t),typeof f=="function")for(t=f.call(t),a=0;!(s=t.next()).done;)s=s.value,f=r+Kf(s,a++),o+=HA(s,e,n,f,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function lA(t,e,n){if(t==null)return t;var r=[],i=0;return HA(t,r,"","",function(s){return e.call(n,s,i++)}),r}function UE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Mn={current:null},XA={transition:null},VE={ReactCurrentDispatcher:Mn,ReactCurrentBatchConfig:XA,ReactCurrentOwner:Jd};function Ry(){throw Error("act(...) is not supported in production builds of React.")}at.Children={map:lA,forEach:function(t,e,n){lA(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return lA(t,function(){e++}),e},toArray:function(t){return lA(t,function(e){return e})||[]},only:function(t){if(!ep(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};at.Component=qo;at.Fragment=CE;at.Profiler=kE;at.PureComponent=qd;at.StrictMode=PE;at.Suspense=NE;at.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=VE;at.act=Ry;at.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Ty({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Jd.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(f in e)Cy.call(e,f)&&!Py.hasOwnProperty(f)&&(r[f]=e[f]===void 0&&a!==void 0?a[f]:e[f])}var f=arguments.length-2;if(f===1)r.children=n;else if(1<f){a=Array(f);for(var p=0;p<f;p++)a[p]=arguments[p+2];r.children=a}return{$$typeof:Ol,type:t.type,key:i,ref:s,props:r,_owner:o}};at.createContext=function(t){return t={$$typeof:IE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:RE,_context:t},t.Consumer=t};at.createElement=ky;at.createFactory=function(t){var e=ky.bind(null,t);return e.type=t,e};at.createRef=function(){return{current:null}};at.forwardRef=function(t){return{$$typeof:ME,render:t}};at.isValidElement=ep;at.lazy=function(t){return{$$typeof:DE,_payload:{_status:-1,_result:t},_init:UE}};at.memo=function(t,e){return{$$typeof:OE,type:t,compare:e===void 0?null:e}};at.startTransition=function(t){var e=XA.transition;XA.transition={};try{t()}finally{XA.transition=e}};at.unstable_act=Ry;at.useCallback=function(t,e){return Mn.current.useCallback(t,e)};at.useContext=function(t){return Mn.current.useContext(t)};at.useDebugValue=function(){};at.useDeferredValue=function(t){return Mn.current.useDeferredValue(t)};at.useEffect=function(t,e){return Mn.current.useEffect(t,e)};at.useId=function(){return Mn.current.useId()};at.useImperativeHandle=function(t,e,n){return Mn.current.useImperativeHandle(t,e,n)};at.useInsertionEffect=function(t,e){return Mn.current.useInsertionEffect(t,e)};at.useLayoutEffect=function(t,e){return Mn.current.useLayoutEffect(t,e)};at.useMemo=function(t,e){return Mn.current.useMemo(t,e)};at.useReducer=function(t,e,n){return Mn.current.useReducer(t,e,n)};at.useRef=function(t){return Mn.current.useRef(t)};at.useState=function(t){return Mn.current.useState(t)};at.useSyncExternalStore=function(t,e,n){return Mn.current.useSyncExternalStore(t,e,n)};at.useTransition=function(){return Mn.current.useTransition()};at.version="18.3.1";by.exports=at;var le=by.exports;const zE=vy(le);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jE=le,WE=Symbol.for("react.element"),$E=Symbol.for("react.fragment"),HE=Object.prototype.hasOwnProperty,XE=jE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,QE={key:!0,ref:!0,__self:!0,__source:!0};function Iy(t,e,n){var r,i={},s=null,o=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)HE.call(e,r)&&!QE.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:WE,type:t,key:s,ref:o,props:i,_owner:XE.current}}Iu.Fragment=$E;Iu.jsx=Iy;Iu.jsxs=Iy;wy.exports=Iu;var W=wy.exports,My={exports:{}},Zn={},Ny={exports:{}},Oy={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(Te,Fe){var be=Te.length;Te.push(Fe);e:for(;0<be;){var rt=be-1>>>1,qe=Te[rt];if(0<i(qe,Fe))Te[rt]=Fe,Te[be]=qe,be=rt;else break e}}function n(Te){return Te.length===0?null:Te[0]}function r(Te){if(Te.length===0)return null;var Fe=Te[0],be=Te.pop();if(be!==Fe){Te[0]=be;e:for(var rt=0,qe=Te.length,hn=qe>>>1;rt<hn;){var Sr=2*(rt+1)-1,Us=Te[Sr],kt=Sr+1,sn=Te[kt];if(0>i(Us,be))kt<qe&&0>i(sn,Us)?(Te[rt]=sn,Te[kt]=be,rt=kt):(Te[rt]=Us,Te[Sr]=be,rt=Sr);else if(kt<qe&&0>i(sn,be))Te[rt]=sn,Te[kt]=be,rt=kt;else break e}}return Fe}function i(Te,Fe){var be=Te.sortIndex-Fe.sortIndex;return be!==0?be:Te.id-Fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var f=[],p=[],m=1,v=null,w=3,T=!1,E=!1,I=!1,U=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(Te){for(var Fe=n(p);Fe!==null;){if(Fe.callback===null)r(p);else if(Fe.startTime<=Te)r(p),Fe.sortIndex=Fe.expirationTime,e(f,Fe);else break;Fe=n(p)}}function D(Te){if(I=!1,C(Te),!E)if(n(f)!==null)E=!0,At($);else{var Fe=n(p);Fe!==null&&it(D,Fe.startTime-Te)}}function $(Te,Fe){E=!1,I&&(I=!1,R(ae),ae=-1),T=!0;var be=w;try{for(C(Fe),v=n(f);v!==null&&(!(v.expirationTime>Fe)||Te&&!ke());){var rt=v.callback;if(typeof rt=="function"){v.callback=null,w=v.priorityLevel;var qe=rt(v.expirationTime<=Fe);Fe=t.unstable_now(),typeof qe=="function"?v.callback=qe:v===n(f)&&r(f),C(Fe)}else r(f);v=n(f)}if(v!==null)var hn=!0;else{var Sr=n(p);Sr!==null&&it(D,Sr.startTime-Fe),hn=!1}return hn}finally{v=null,w=be,T=!1}}var q=!1,fe=null,ae=-1,he=5,ye=-1;function ke(){return!(t.unstable_now()-ye<he)}function Le(){if(fe!==null){var Te=t.unstable_now();ye=Te;var Fe=!0;try{Fe=fe(!0,Te)}finally{Fe?Ve():(q=!1,fe=null)}}else q=!1}var Ve;if(typeof P=="function")Ve=function(){P(Le)};else if(typeof MessageChannel<"u"){var Ae=new MessageChannel,Re=Ae.port2;Ae.port1.onmessage=Le,Ve=function(){Re.postMessage(null)}}else Ve=function(){U(Le,0)};function At(Te){fe=Te,q||(q=!0,Ve())}function it(Te,Fe){ae=U(function(){Te(t.unstable_now())},Fe)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(Te){Te.callback=null},t.unstable_continueExecution=function(){E||T||(E=!0,At($))},t.unstable_forceFrameRate=function(Te){0>Te||125<Te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):he=0<Te?Math.floor(1e3/Te):5},t.unstable_getCurrentPriorityLevel=function(){return w},t.unstable_getFirstCallbackNode=function(){return n(f)},t.unstable_next=function(Te){switch(w){case 1:case 2:case 3:var Fe=3;break;default:Fe=w}var be=w;w=Fe;try{return Te()}finally{w=be}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(Te,Fe){switch(Te){case 1:case 2:case 3:case 4:case 5:break;default:Te=3}var be=w;w=Te;try{return Fe()}finally{w=be}},t.unstable_scheduleCallback=function(Te,Fe,be){var rt=t.unstable_now();switch(typeof be=="object"&&be!==null?(be=be.delay,be=typeof be=="number"&&0<be?rt+be:rt):be=rt,Te){case 1:var qe=-1;break;case 2:qe=250;break;case 5:qe=1073741823;break;case 4:qe=1e4;break;default:qe=5e3}return qe=be+qe,Te={id:m++,callback:Fe,priorityLevel:Te,startTime:be,expirationTime:qe,sortIndex:-1},be>rt?(Te.sortIndex=be,e(p,Te),n(f)===null&&Te===n(p)&&(I?(R(ae),ae=-1):I=!0,it(D,be-rt))):(Te.sortIndex=qe,e(f,Te),E||T||(E=!0,At($))),Te},t.unstable_shouldYield=ke,t.unstable_wrapCallback=function(Te){var Fe=w;return function(){var be=w;w=Fe;try{return Te.apply(this,arguments)}finally{w=be}}}})(Oy);Ny.exports=Oy;var YE=Ny.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KE=le,Kn=YE;function me(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Dy=new Set,ll={};function Ns(t,e){Io(t,e),Io(t+"Capture",e)}function Io(t,e){for(ll[t]=e,t=0;t<e.length;t++)Dy.add(e[t])}var si=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),A0=Object.prototype.hasOwnProperty,ZE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,xm={},Tm={};function qE(t){return A0.call(Tm,t)?!0:A0.call(xm,t)?!1:ZE.test(t)?Tm[t]=!0:(xm[t]=!0,!1)}function GE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function JE(t,e,n,r){if(e===null||typeof e>"u"||GE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Nn(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var un={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){un[t]=new Nn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];un[e]=new Nn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){un[t]=new Nn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){un[t]=new Nn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){un[t]=new Nn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){un[t]=new Nn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){un[t]=new Nn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){un[t]=new Nn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){un[t]=new Nn(t,5,!1,t.toLowerCase(),null,!1,!1)});var tp=/[\-:]([a-z])/g;function np(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(tp,np);un[e]=new Nn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(tp,np);un[e]=new Nn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(tp,np);un[e]=new Nn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){un[t]=new Nn(t,1,!1,t.toLowerCase(),null,!1,!1)});un.xlinkHref=new Nn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){un[t]=new Nn(t,1,!1,t.toLowerCase(),null,!0,!0)});function rp(t,e,n,r){var i=un.hasOwnProperty(e)?un[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(JE(e,n,i,r)&&(n=null),r||i===null?qE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ui=KE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,AA=Symbol.for("react.element"),eo=Symbol.for("react.portal"),to=Symbol.for("react.fragment"),ip=Symbol.for("react.strict_mode"),c0=Symbol.for("react.profiler"),By=Symbol.for("react.provider"),Fy=Symbol.for("react.context"),sp=Symbol.for("react.forward_ref"),u0=Symbol.for("react.suspense"),f0=Symbol.for("react.suspense_list"),op=Symbol.for("react.memo"),bi=Symbol.for("react.lazy"),Ly=Symbol.for("react.offscreen"),Em=Symbol.iterator;function ya(t){return t===null||typeof t!="object"?null:(t=Em&&t[Em]||t["@@iterator"],typeof t=="function"?t:null)}var Ft=Object.assign,Zf;function Na(t){if(Zf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Zf=e&&e[1]||""}return`
`+Zf+t}var qf=!1;function Gf(t,e){if(!t||qf)return"";qf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(p){var r=p}Reflect.construct(t,[],e)}else{try{e.call()}catch(p){r=p}t.call(e.prototype)}else{try{throw Error()}catch(p){r=p}t()}}catch(p){if(p&&r&&typeof p.stack=="string"){for(var i=p.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var f=`
`+i[o].replace(" at new "," at ");return t.displayName&&f.includes("<anonymous>")&&(f=f.replace("<anonymous>",t.displayName)),f}while(1<=o&&0<=a);break}}}finally{qf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Na(t):""}function eS(t){switch(t.tag){case 5:return Na(t.type);case 16:return Na("Lazy");case 13:return Na("Suspense");case 19:return Na("SuspenseList");case 0:case 2:case 15:return t=Gf(t.type,!1),t;case 11:return t=Gf(t.type.render,!1),t;case 1:return t=Gf(t.type,!0),t;default:return""}}function h0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case to:return"Fragment";case eo:return"Portal";case c0:return"Profiler";case ip:return"StrictMode";case u0:return"Suspense";case f0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Fy:return(t.displayName||"Context")+".Consumer";case By:return(t._context.displayName||"Context")+".Provider";case sp:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case op:return e=t.displayName||null,e!==null?e:h0(t.type)||"Memo";case bi:e=t._payload,t=t._init;try{return h0(t(e))}catch{}}return null}function tS(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return h0(e);case 8:return e===ip?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Xi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Uy(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function nS(t){var e=Uy(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function cA(t){t._valueTracker||(t._valueTracker=nS(t))}function Vy(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=Uy(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function hc(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function d0(t,e){var n=e.checked;return Ft({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Sm(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Xi(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function zy(t,e){e=e.checked,e!=null&&rp(t,"checked",e,!1)}function p0(t,e){zy(t,e);var n=Xi(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?g0(t,e.type,n):e.hasOwnProperty("defaultValue")&&g0(t,e.type,Xi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Cm(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function g0(t,e,n){(e!=="number"||hc(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Oa=Array.isArray;function wo(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Xi(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function m0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(me(91));return Ft({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Pm(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(me(92));if(Oa(n)){if(1<n.length)throw Error(me(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Xi(n)}}function jy(t,e){var n=Xi(e.value),r=Xi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function km(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Wy(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Wy(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var uA,$y=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(uA=uA||document.createElement("div"),uA.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=uA.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Al(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Wa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},rS=["Webkit","ms","Moz","O"];Object.keys(Wa).forEach(function(t){rS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Wa[e]=Wa[t]})});function Hy(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Wa.hasOwnProperty(t)&&Wa[t]?(""+e).trim():e+"px"}function Xy(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Hy(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var iS=Ft({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function y0(t,e){if(e){if(iS[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(me(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(me(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(me(61))}if(e.style!=null&&typeof e.style!="object")throw Error(me(62))}}function v0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var w0=null;function ap(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var b0=null,bo=null,xo=null;function Rm(t){if(t=Fl(t)){if(typeof b0!="function")throw Error(me(280));var e=t.stateNode;e&&(e=Bu(e),b0(t.stateNode,t.type,e))}}function Qy(t){bo?xo?xo.push(t):xo=[t]:bo=t}function Yy(){if(bo){var t=bo,e=xo;if(xo=bo=null,Rm(t),e)for(t=0;t<e.length;t++)Rm(e[t])}}function Ky(t,e){return t(e)}function Zy(){}var Jf=!1;function qy(t,e,n){if(Jf)return t(e,n);Jf=!0;try{return Ky(t,e,n)}finally{Jf=!1,(bo!==null||xo!==null)&&(Zy(),Yy())}}function cl(t,e){var n=t.stateNode;if(n===null)return null;var r=Bu(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(me(231,e,typeof n));return n}var x0=!1;if(si)try{var va={};Object.defineProperty(va,"passive",{get:function(){x0=!0}}),window.addEventListener("test",va,va),window.removeEventListener("test",va,va)}catch{x0=!1}function sS(t,e,n,r,i,s,o,a,f){var p=Array.prototype.slice.call(arguments,3);try{e.apply(n,p)}catch(m){this.onError(m)}}var $a=!1,dc=null,pc=!1,T0=null,oS={onError:function(t){$a=!0,dc=t}};function aS(t,e,n,r,i,s,o,a,f){$a=!1,dc=null,sS.apply(oS,arguments)}function lS(t,e,n,r,i,s,o,a,f){if(aS.apply(this,arguments),$a){if($a){var p=dc;$a=!1,dc=null}else throw Error(me(198));pc||(pc=!0,T0=p)}}function Os(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Gy(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Im(t){if(Os(t)!==t)throw Error(me(188))}function AS(t){var e=t.alternate;if(!e){if(e=Os(t),e===null)throw Error(me(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Im(i),t;if(s===r)return Im(i),e;s=s.sibling}throw Error(me(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(me(189))}}if(n.alternate!==r)throw Error(me(190))}if(n.tag!==3)throw Error(me(188));return n.stateNode.current===n?t:e}function Jy(t){return t=AS(t),t!==null?ev(t):null}function ev(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=ev(t);if(e!==null)return e;t=t.sibling}return null}var tv=Kn.unstable_scheduleCallback,Mm=Kn.unstable_cancelCallback,cS=Kn.unstable_shouldYield,uS=Kn.unstable_requestPaint,Wt=Kn.unstable_now,fS=Kn.unstable_getCurrentPriorityLevel,lp=Kn.unstable_ImmediatePriority,nv=Kn.unstable_UserBlockingPriority,gc=Kn.unstable_NormalPriority,hS=Kn.unstable_LowPriority,rv=Kn.unstable_IdlePriority,Mu=null,Ur=null;function dS(t){if(Ur&&typeof Ur.onCommitFiberRoot=="function")try{Ur.onCommitFiberRoot(Mu,t,void 0,(t.current.flags&128)===128)}catch{}}var xr=Math.clz32?Math.clz32:mS,pS=Math.log,gS=Math.LN2;function mS(t){return t>>>=0,t===0?32:31-(pS(t)/gS|0)|0}var fA=64,hA=4194304;function Da(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function mc(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=Da(a):(s&=o,s!==0&&(r=Da(s)))}else o=n&~i,o!==0?r=Da(o):s!==0&&(r=Da(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-xr(e),i=1<<n,r|=t[n],e&=~i;return r}function _S(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yS(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-xr(s),a=1<<o,f=i[o];f===-1?(!(a&n)||a&r)&&(i[o]=_S(a,e)):f<=e&&(t.expiredLanes|=a),s&=~a}}function E0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function iv(){var t=fA;return fA<<=1,!(fA&4194240)&&(fA=64),t}function eh(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Dl(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-xr(e),t[e]=n}function vS(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-xr(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Ap(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-xr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var mt=0;function sv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ov,cp,av,lv,Av,S0=!1,dA=[],Di=null,Bi=null,Fi=null,ul=new Map,fl=new Map,Ci=[],wS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Nm(t,e){switch(t){case"focusin":case"focusout":Di=null;break;case"dragenter":case"dragleave":Bi=null;break;case"mouseover":case"mouseout":Fi=null;break;case"pointerover":case"pointerout":ul.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":fl.delete(e.pointerId)}}function wa(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Fl(e),e!==null&&cp(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function bS(t,e,n,r,i){switch(e){case"focusin":return Di=wa(Di,t,e,n,r,i),!0;case"dragenter":return Bi=wa(Bi,t,e,n,r,i),!0;case"mouseover":return Fi=wa(Fi,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return ul.set(s,wa(ul.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,fl.set(s,wa(fl.get(s)||null,t,e,n,r,i)),!0}return!1}function cv(t){var e=us(t.target);if(e!==null){var n=Os(e);if(n!==null){if(e=n.tag,e===13){if(e=Gy(n),e!==null){t.blockedOn=e,Av(t.priority,function(){av(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function QA(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=C0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);w0=r,n.target.dispatchEvent(r),w0=null}else return e=Fl(n),e!==null&&cp(e),t.blockedOn=n,!1;e.shift()}return!0}function Om(t,e,n){QA(t)&&n.delete(e)}function xS(){S0=!1,Di!==null&&QA(Di)&&(Di=null),Bi!==null&&QA(Bi)&&(Bi=null),Fi!==null&&QA(Fi)&&(Fi=null),ul.forEach(Om),fl.forEach(Om)}function ba(t,e){t.blockedOn===e&&(t.blockedOn=null,S0||(S0=!0,Kn.unstable_scheduleCallback(Kn.unstable_NormalPriority,xS)))}function hl(t){function e(i){return ba(i,t)}if(0<dA.length){ba(dA[0],t);for(var n=1;n<dA.length;n++){var r=dA[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Di!==null&&ba(Di,t),Bi!==null&&ba(Bi,t),Fi!==null&&ba(Fi,t),ul.forEach(e),fl.forEach(e),n=0;n<Ci.length;n++)r=Ci[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ci.length&&(n=Ci[0],n.blockedOn===null);)cv(n),n.blockedOn===null&&Ci.shift()}var To=ui.ReactCurrentBatchConfig,_c=!0;function TS(t,e,n,r){var i=mt,s=To.transition;To.transition=null;try{mt=1,up(t,e,n,r)}finally{mt=i,To.transition=s}}function ES(t,e,n,r){var i=mt,s=To.transition;To.transition=null;try{mt=4,up(t,e,n,r)}finally{mt=i,To.transition=s}}function up(t,e,n,r){if(_c){var i=C0(t,e,n,r);if(i===null)ch(t,e,r,yc,n),Nm(t,r);else if(bS(i,t,e,n,r))r.stopPropagation();else if(Nm(t,r),e&4&&-1<wS.indexOf(t)){for(;i!==null;){var s=Fl(i);if(s!==null&&ov(s),s=C0(t,e,n,r),s===null&&ch(t,e,r,yc,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else ch(t,e,r,null,n)}}var yc=null;function C0(t,e,n,r){if(yc=null,t=ap(r),t=us(t),t!==null)if(e=Os(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Gy(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return yc=t,null}function uv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fS()){case lp:return 1;case nv:return 4;case gc:case hS:return 16;case rv:return 536870912;default:return 16}default:return 16}}var ki=null,fp=null,YA=null;function fv(){if(YA)return YA;var t,e=fp,n=e.length,r,i="value"in ki?ki.value:ki.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return YA=i.slice(t,1<r?1-r:void 0)}function KA(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function pA(){return!0}function Dm(){return!1}function qn(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?pA:Dm,this.isPropagationStopped=Dm,this}return Ft(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=pA)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=pA)},persist:function(){},isPersistent:pA}),e}var Go={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hp=qn(Go),Bl=Ft({},Go,{view:0,detail:0}),SS=qn(Bl),th,nh,xa,Nu=Ft({},Bl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:dp,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==xa&&(xa&&t.type==="mousemove"?(th=t.screenX-xa.screenX,nh=t.screenY-xa.screenY):nh=th=0,xa=t),th)},movementY:function(t){return"movementY"in t?t.movementY:nh}}),Bm=qn(Nu),CS=Ft({},Nu,{dataTransfer:0}),PS=qn(CS),kS=Ft({},Bl,{relatedTarget:0}),rh=qn(kS),RS=Ft({},Go,{animationName:0,elapsedTime:0,pseudoElement:0}),IS=qn(RS),MS=Ft({},Go,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),NS=qn(MS),OS=Ft({},Go,{data:0}),Fm=qn(OS),DS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},BS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function LS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=FS[t])?!!e[t]:!1}function dp(){return LS}var US=Ft({},Bl,{key:function(t){if(t.key){var e=DS[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=KA(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?BS[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:dp,charCode:function(t){return t.type==="keypress"?KA(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?KA(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),VS=qn(US),zS=Ft({},Nu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lm=qn(zS),jS=Ft({},Bl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:dp}),WS=qn(jS),$S=Ft({},Go,{propertyName:0,elapsedTime:0,pseudoElement:0}),HS=qn($S),XS=Ft({},Nu,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),QS=qn(XS),YS=[9,13,27,32],pp=si&&"CompositionEvent"in window,Ha=null;si&&"documentMode"in document&&(Ha=document.documentMode);var KS=si&&"TextEvent"in window&&!Ha,hv=si&&(!pp||Ha&&8<Ha&&11>=Ha),Um=" ",Vm=!1;function dv(t,e){switch(t){case"keyup":return YS.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var no=!1;function ZS(t,e){switch(t){case"compositionend":return pv(e);case"keypress":return e.which!==32?null:(Vm=!0,Um);case"textInput":return t=e.data,t===Um&&Vm?null:t;default:return null}}function qS(t,e){if(no)return t==="compositionend"||!pp&&dv(t,e)?(t=fv(),YA=fp=ki=null,no=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return hv&&e.locale!=="ko"?null:e.data;default:return null}}var GS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zm(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!GS[t.type]:e==="textarea"}function gv(t,e,n,r){Qy(r),e=vc(e,"onChange"),0<e.length&&(n=new hp("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Xa=null,dl=null;function JS(t){Cv(t,0)}function Ou(t){var e=so(t);if(Vy(e))return t}function e4(t,e){if(t==="change")return e}var mv=!1;if(si){var ih;if(si){var sh="oninput"in document;if(!sh){var jm=document.createElement("div");jm.setAttribute("oninput","return;"),sh=typeof jm.oninput=="function"}ih=sh}else ih=!1;mv=ih&&(!document.documentMode||9<document.documentMode)}function Wm(){Xa&&(Xa.detachEvent("onpropertychange",_v),dl=Xa=null)}function _v(t){if(t.propertyName==="value"&&Ou(dl)){var e=[];gv(e,dl,t,ap(t)),qy(JS,e)}}function t4(t,e,n){t==="focusin"?(Wm(),Xa=e,dl=n,Xa.attachEvent("onpropertychange",_v)):t==="focusout"&&Wm()}function n4(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ou(dl)}function r4(t,e){if(t==="click")return Ou(e)}function i4(t,e){if(t==="input"||t==="change")return Ou(e)}function s4(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Er=typeof Object.is=="function"?Object.is:s4;function pl(t,e){if(Er(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!A0.call(e,i)||!Er(t[i],e[i]))return!1}return!0}function $m(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Hm(t,e){var n=$m(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=$m(n)}}function yv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?yv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function vv(){for(var t=window,e=hc();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=hc(t.document)}return e}function gp(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function o4(t){var e=vv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&yv(n.ownerDocument.documentElement,n)){if(r!==null&&gp(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=Hm(n,s);var o=Hm(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var a4=si&&"documentMode"in document&&11>=document.documentMode,ro=null,P0=null,Qa=null,k0=!1;function Xm(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;k0||ro==null||ro!==hc(r)||(r=ro,"selectionStart"in r&&gp(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Qa&&pl(Qa,r)||(Qa=r,r=vc(P0,"onSelect"),0<r.length&&(e=new hp("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ro)))}function gA(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var io={animationend:gA("Animation","AnimationEnd"),animationiteration:gA("Animation","AnimationIteration"),animationstart:gA("Animation","AnimationStart"),transitionend:gA("Transition","TransitionEnd")},oh={},wv={};si&&(wv=document.createElement("div").style,"AnimationEvent"in window||(delete io.animationend.animation,delete io.animationiteration.animation,delete io.animationstart.animation),"TransitionEvent"in window||delete io.transitionend.transition);function Du(t){if(oh[t])return oh[t];if(!io[t])return t;var e=io[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in wv)return oh[t]=e[n];return t}var bv=Du("animationend"),xv=Du("animationiteration"),Tv=Du("animationstart"),Ev=Du("transitionend"),Sv=new Map,Qm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ki(t,e){Sv.set(t,e),Ns(e,[t])}for(var ah=0;ah<Qm.length;ah++){var lh=Qm[ah],l4=lh.toLowerCase(),A4=lh[0].toUpperCase()+lh.slice(1);Ki(l4,"on"+A4)}Ki(bv,"onAnimationEnd");Ki(xv,"onAnimationIteration");Ki(Tv,"onAnimationStart");Ki("dblclick","onDoubleClick");Ki("focusin","onFocus");Ki("focusout","onBlur");Ki(Ev,"onTransitionEnd");Io("onMouseEnter",["mouseout","mouseover"]);Io("onMouseLeave",["mouseout","mouseover"]);Io("onPointerEnter",["pointerout","pointerover"]);Io("onPointerLeave",["pointerout","pointerover"]);Ns("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ns("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ns("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ns("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ns("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ns("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ba="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),c4=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ba));function Ym(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,lS(r,e,void 0,t),t.currentTarget=null}function Cv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],f=a.instance,p=a.currentTarget;if(a=a.listener,f!==s&&i.isPropagationStopped())break e;Ym(i,a,p),s=f}else for(o=0;o<r.length;o++){if(a=r[o],f=a.instance,p=a.currentTarget,a=a.listener,f!==s&&i.isPropagationStopped())break e;Ym(i,a,p),s=f}}}if(pc)throw t=T0,pc=!1,T0=null,t}function St(t,e){var n=e[O0];n===void 0&&(n=e[O0]=new Set);var r=t+"__bubble";n.has(r)||(Pv(e,t,2,!1),n.add(r))}function Ah(t,e,n){var r=0;e&&(r|=4),Pv(n,t,r,e)}var mA="_reactListening"+Math.random().toString(36).slice(2);function gl(t){if(!t[mA]){t[mA]=!0,Dy.forEach(function(n){n!=="selectionchange"&&(c4.has(n)||Ah(n,!1,t),Ah(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[mA]||(e[mA]=!0,Ah("selectionchange",!1,e))}}function Pv(t,e,n,r){switch(uv(e)){case 1:var i=TS;break;case 4:i=ES;break;default:i=up}n=i.bind(null,e,n,t),i=void 0,!x0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function ch(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var f=o.tag;if((f===3||f===4)&&(f=o.stateNode.containerInfo,f===i||f.nodeType===8&&f.parentNode===i))return;o=o.return}for(;a!==null;){if(o=us(a),o===null)return;if(f=o.tag,f===5||f===6){r=s=o;continue e}a=a.parentNode}}r=r.return}qy(function(){var p=s,m=ap(n),v=[];e:{var w=Sv.get(t);if(w!==void 0){var T=hp,E=t;switch(t){case"keypress":if(KA(n)===0)break e;case"keydown":case"keyup":T=VS;break;case"focusin":E="focus",T=rh;break;case"focusout":E="blur",T=rh;break;case"beforeblur":case"afterblur":T=rh;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":T=Bm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":T=PS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":T=WS;break;case bv:case xv:case Tv:T=IS;break;case Ev:T=HS;break;case"scroll":T=SS;break;case"wheel":T=QS;break;case"copy":case"cut":case"paste":T=NS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":T=Lm}var I=(e&4)!==0,U=!I&&t==="scroll",R=I?w!==null?w+"Capture":null:w;I=[];for(var P=p,C;P!==null;){C=P;var D=C.stateNode;if(C.tag===5&&D!==null&&(C=D,R!==null&&(D=cl(P,R),D!=null&&I.push(ml(P,D,C)))),U)break;P=P.return}0<I.length&&(w=new T(w,E,null,n,m),v.push({event:w,listeners:I}))}}if(!(e&7)){e:{if(w=t==="mouseover"||t==="pointerover",T=t==="mouseout"||t==="pointerout",w&&n!==w0&&(E=n.relatedTarget||n.fromElement)&&(us(E)||E[oi]))break e;if((T||w)&&(w=m.window===m?m:(w=m.ownerDocument)?w.defaultView||w.parentWindow:window,T?(E=n.relatedTarget||n.toElement,T=p,E=E?us(E):null,E!==null&&(U=Os(E),E!==U||E.tag!==5&&E.tag!==6)&&(E=null)):(T=null,E=p),T!==E)){if(I=Bm,D="onMouseLeave",R="onMouseEnter",P="mouse",(t==="pointerout"||t==="pointerover")&&(I=Lm,D="onPointerLeave",R="onPointerEnter",P="pointer"),U=T==null?w:so(T),C=E==null?w:so(E),w=new I(D,P+"leave",T,n,m),w.target=U,w.relatedTarget=C,D=null,us(m)===p&&(I=new I(R,P+"enter",E,n,m),I.target=C,I.relatedTarget=U,D=I),U=D,T&&E)t:{for(I=T,R=E,P=0,C=I;C;C=Hs(C))P++;for(C=0,D=R;D;D=Hs(D))C++;for(;0<P-C;)I=Hs(I),P--;for(;0<C-P;)R=Hs(R),C--;for(;P--;){if(I===R||R!==null&&I===R.alternate)break t;I=Hs(I),R=Hs(R)}I=null}else I=null;T!==null&&Km(v,w,T,I,!1),E!==null&&U!==null&&Km(v,U,E,I,!0)}}e:{if(w=p?so(p):window,T=w.nodeName&&w.nodeName.toLowerCase(),T==="select"||T==="input"&&w.type==="file")var $=e4;else if(zm(w))if(mv)$=i4;else{$=n4;var q=t4}else(T=w.nodeName)&&T.toLowerCase()==="input"&&(w.type==="checkbox"||w.type==="radio")&&($=r4);if($&&($=$(t,p))){gv(v,$,n,m);break e}q&&q(t,w,p),t==="focusout"&&(q=w._wrapperState)&&q.controlled&&w.type==="number"&&g0(w,"number",w.value)}switch(q=p?so(p):window,t){case"focusin":(zm(q)||q.contentEditable==="true")&&(ro=q,P0=p,Qa=null);break;case"focusout":Qa=P0=ro=null;break;case"mousedown":k0=!0;break;case"contextmenu":case"mouseup":case"dragend":k0=!1,Xm(v,n,m);break;case"selectionchange":if(a4)break;case"keydown":case"keyup":Xm(v,n,m)}var fe;if(pp)e:{switch(t){case"compositionstart":var ae="onCompositionStart";break e;case"compositionend":ae="onCompositionEnd";break e;case"compositionupdate":ae="onCompositionUpdate";break e}ae=void 0}else no?dv(t,n)&&(ae="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(ae="onCompositionStart");ae&&(hv&&n.locale!=="ko"&&(no||ae!=="onCompositionStart"?ae==="onCompositionEnd"&&no&&(fe=fv()):(ki=m,fp="value"in ki?ki.value:ki.textContent,no=!0)),q=vc(p,ae),0<q.length&&(ae=new Fm(ae,t,null,n,m),v.push({event:ae,listeners:q}),fe?ae.data=fe:(fe=pv(n),fe!==null&&(ae.data=fe)))),(fe=KS?ZS(t,n):qS(t,n))&&(p=vc(p,"onBeforeInput"),0<p.length&&(m=new Fm("onBeforeInput","beforeinput",null,n,m),v.push({event:m,listeners:p}),m.data=fe))}Cv(v,e)})}function ml(t,e,n){return{instance:t,listener:e,currentTarget:n}}function vc(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=cl(t,n),s!=null&&r.unshift(ml(t,s,i)),s=cl(t,e),s!=null&&r.push(ml(t,s,i))),t=t.return}return r}function Hs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Km(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,f=a.alternate,p=a.stateNode;if(f!==null&&f===r)break;a.tag===5&&p!==null&&(a=p,i?(f=cl(n,s),f!=null&&o.unshift(ml(n,f,a))):i||(f=cl(n,s),f!=null&&o.push(ml(n,f,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var u4=/\r\n?/g,f4=/\u0000|\uFFFD/g;function Zm(t){return(typeof t=="string"?t:""+t).replace(u4,`
`).replace(f4,"")}function _A(t,e,n){if(e=Zm(e),Zm(t)!==e&&n)throw Error(me(425))}function wc(){}var R0=null,I0=null;function M0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var N0=typeof setTimeout=="function"?setTimeout:void 0,h4=typeof clearTimeout=="function"?clearTimeout:void 0,qm=typeof Promise=="function"?Promise:void 0,d4=typeof queueMicrotask=="function"?queueMicrotask:typeof qm<"u"?function(t){return qm.resolve(null).then(t).catch(p4)}:N0;function p4(t){setTimeout(function(){throw t})}function uh(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),hl(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);hl(e)}function Li(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Gm(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Jo=Math.random().toString(36).slice(2),Dr="__reactFiber$"+Jo,_l="__reactProps$"+Jo,oi="__reactContainer$"+Jo,O0="__reactEvents$"+Jo,g4="__reactListeners$"+Jo,m4="__reactHandles$"+Jo;function us(t){var e=t[Dr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[oi]||n[Dr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Gm(t);t!==null;){if(n=t[Dr])return n;t=Gm(t)}return e}t=n,n=t.parentNode}return null}function Fl(t){return t=t[Dr]||t[oi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function so(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(me(33))}function Bu(t){return t[_l]||null}var D0=[],oo=-1;function Zi(t){return{current:t}}function Ct(t){0>oo||(t.current=D0[oo],D0[oo]=null,oo--)}function Et(t,e){oo++,D0[oo]=t.current,t.current=e}var Qi={},En=Zi(Qi),Ln=Zi(!1),ws=Qi;function Mo(t,e){var n=t.type.contextTypes;if(!n)return Qi;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Un(t){return t=t.childContextTypes,t!=null}function bc(){Ct(Ln),Ct(En)}function Jm(t,e,n){if(En.current!==Qi)throw Error(me(168));Et(En,e),Et(Ln,n)}function kv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(me(108,tS(t)||"Unknown",i));return Ft({},n,r)}function xc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Qi,ws=En.current,Et(En,t),Et(Ln,Ln.current),!0}function e2(t,e,n){var r=t.stateNode;if(!r)throw Error(me(169));n?(t=kv(t,e,ws),r.__reactInternalMemoizedMergedChildContext=t,Ct(Ln),Ct(En),Et(En,t)):Ct(Ln),Et(Ln,n)}var qr=null,Fu=!1,fh=!1;function Rv(t){qr===null?qr=[t]:qr.push(t)}function _4(t){Fu=!0,Rv(t)}function qi(){if(!fh&&qr!==null){fh=!0;var t=0,e=mt;try{var n=qr;for(mt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}qr=null,Fu=!1}catch(i){throw qr!==null&&(qr=qr.slice(t+1)),tv(lp,qi),i}finally{mt=e,fh=!1}}return null}var ao=[],lo=0,Tc=null,Ec=0,tr=[],nr=0,bs=null,ni=1,ri="";function ls(t,e){ao[lo++]=Ec,ao[lo++]=Tc,Tc=t,Ec=e}function Iv(t,e,n){tr[nr++]=ni,tr[nr++]=ri,tr[nr++]=bs,bs=t;var r=ni;t=ri;var i=32-xr(r)-1;r&=~(1<<i),n+=1;var s=32-xr(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,ni=1<<32-xr(e)+i|n<<i|r,ri=s+t}else ni=1<<s|n<<i|r,ri=t}function mp(t){t.return!==null&&(ls(t,1),Iv(t,1,0))}function _p(t){for(;t===Tc;)Tc=ao[--lo],ao[lo]=null,Ec=ao[--lo],ao[lo]=null;for(;t===bs;)bs=tr[--nr],tr[nr]=null,ri=tr[--nr],tr[nr]=null,ni=tr[--nr],tr[nr]=null}var Qn=null,Xn=null,Rt=!1,yr=null;function Mv(t,e){var n=rr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function t2(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Qn=t,Xn=Li(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Qn=t,Xn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=bs!==null?{id:ni,overflow:ri}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=rr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Qn=t,Xn=null,!0):!1;default:return!1}}function B0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function F0(t){if(Rt){var e=Xn;if(e){var n=e;if(!t2(t,e)){if(B0(t))throw Error(me(418));e=Li(n.nextSibling);var r=Qn;e&&t2(t,e)?Mv(r,n):(t.flags=t.flags&-4097|2,Rt=!1,Qn=t)}}else{if(B0(t))throw Error(me(418));t.flags=t.flags&-4097|2,Rt=!1,Qn=t}}}function n2(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Qn=t}function yA(t){if(t!==Qn)return!1;if(!Rt)return n2(t),Rt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!M0(t.type,t.memoizedProps)),e&&(e=Xn)){if(B0(t))throw Nv(),Error(me(418));for(;e;)Mv(t,e),e=Li(e.nextSibling)}if(n2(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(me(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Xn=Li(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Xn=null}}else Xn=Qn?Li(t.stateNode.nextSibling):null;return!0}function Nv(){for(var t=Xn;t;)t=Li(t.nextSibling)}function No(){Xn=Qn=null,Rt=!1}function yp(t){yr===null?yr=[t]:yr.push(t)}var y4=ui.ReactCurrentBatchConfig;function Ta(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(me(309));var r=n.stateNode}if(!r)throw Error(me(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(me(284));if(!n._owner)throw Error(me(290,t))}return t}function vA(t,e){throw t=Object.prototype.toString.call(e),Error(me(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function r2(t){var e=t._init;return e(t._payload)}function Ov(t){function e(R,P){if(t){var C=R.deletions;C===null?(R.deletions=[P],R.flags|=16):C.push(P)}}function n(R,P){if(!t)return null;for(;P!==null;)e(R,P),P=P.sibling;return null}function r(R,P){for(R=new Map;P!==null;)P.key!==null?R.set(P.key,P):R.set(P.index,P),P=P.sibling;return R}function i(R,P){return R=ji(R,P),R.index=0,R.sibling=null,R}function s(R,P,C){return R.index=C,t?(C=R.alternate,C!==null?(C=C.index,C<P?(R.flags|=2,P):C):(R.flags|=2,P)):(R.flags|=1048576,P)}function o(R){return t&&R.alternate===null&&(R.flags|=2),R}function a(R,P,C,D){return P===null||P.tag!==6?(P=yh(C,R.mode,D),P.return=R,P):(P=i(P,C),P.return=R,P)}function f(R,P,C,D){var $=C.type;return $===to?m(R,P,C.props.children,D,C.key):P!==null&&(P.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===bi&&r2($)===P.type)?(D=i(P,C.props),D.ref=Ta(R,P,C),D.return=R,D):(D=nc(C.type,C.key,C.props,null,R.mode,D),D.ref=Ta(R,P,C),D.return=R,D)}function p(R,P,C,D){return P===null||P.tag!==4||P.stateNode.containerInfo!==C.containerInfo||P.stateNode.implementation!==C.implementation?(P=vh(C,R.mode,D),P.return=R,P):(P=i(P,C.children||[]),P.return=R,P)}function m(R,P,C,D,$){return P===null||P.tag!==7?(P=gs(C,R.mode,D,$),P.return=R,P):(P=i(P,C),P.return=R,P)}function v(R,P,C){if(typeof P=="string"&&P!==""||typeof P=="number")return P=yh(""+P,R.mode,C),P.return=R,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case AA:return C=nc(P.type,P.key,P.props,null,R.mode,C),C.ref=Ta(R,null,P),C.return=R,C;case eo:return P=vh(P,R.mode,C),P.return=R,P;case bi:var D=P._init;return v(R,D(P._payload),C)}if(Oa(P)||ya(P))return P=gs(P,R.mode,C,null),P.return=R,P;vA(R,P)}return null}function w(R,P,C,D){var $=P!==null?P.key:null;if(typeof C=="string"&&C!==""||typeof C=="number")return $!==null?null:a(R,P,""+C,D);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case AA:return C.key===$?f(R,P,C,D):null;case eo:return C.key===$?p(R,P,C,D):null;case bi:return $=C._init,w(R,P,$(C._payload),D)}if(Oa(C)||ya(C))return $!==null?null:m(R,P,C,D,null);vA(R,C)}return null}function T(R,P,C,D,$){if(typeof D=="string"&&D!==""||typeof D=="number")return R=R.get(C)||null,a(P,R,""+D,$);if(typeof D=="object"&&D!==null){switch(D.$$typeof){case AA:return R=R.get(D.key===null?C:D.key)||null,f(P,R,D,$);case eo:return R=R.get(D.key===null?C:D.key)||null,p(P,R,D,$);case bi:var q=D._init;return T(R,P,C,q(D._payload),$)}if(Oa(D)||ya(D))return R=R.get(C)||null,m(P,R,D,$,null);vA(P,D)}return null}function E(R,P,C,D){for(var $=null,q=null,fe=P,ae=P=0,he=null;fe!==null&&ae<C.length;ae++){fe.index>ae?(he=fe,fe=null):he=fe.sibling;var ye=w(R,fe,C[ae],D);if(ye===null){fe===null&&(fe=he);break}t&&fe&&ye.alternate===null&&e(R,fe),P=s(ye,P,ae),q===null?$=ye:q.sibling=ye,q=ye,fe=he}if(ae===C.length)return n(R,fe),Rt&&ls(R,ae),$;if(fe===null){for(;ae<C.length;ae++)fe=v(R,C[ae],D),fe!==null&&(P=s(fe,P,ae),q===null?$=fe:q.sibling=fe,q=fe);return Rt&&ls(R,ae),$}for(fe=r(R,fe);ae<C.length;ae++)he=T(fe,R,ae,C[ae],D),he!==null&&(t&&he.alternate!==null&&fe.delete(he.key===null?ae:he.key),P=s(he,P,ae),q===null?$=he:q.sibling=he,q=he);return t&&fe.forEach(function(ke){return e(R,ke)}),Rt&&ls(R,ae),$}function I(R,P,C,D){var $=ya(C);if(typeof $!="function")throw Error(me(150));if(C=$.call(C),C==null)throw Error(me(151));for(var q=$=null,fe=P,ae=P=0,he=null,ye=C.next();fe!==null&&!ye.done;ae++,ye=C.next()){fe.index>ae?(he=fe,fe=null):he=fe.sibling;var ke=w(R,fe,ye.value,D);if(ke===null){fe===null&&(fe=he);break}t&&fe&&ke.alternate===null&&e(R,fe),P=s(ke,P,ae),q===null?$=ke:q.sibling=ke,q=ke,fe=he}if(ye.done)return n(R,fe),Rt&&ls(R,ae),$;if(fe===null){for(;!ye.done;ae++,ye=C.next())ye=v(R,ye.value,D),ye!==null&&(P=s(ye,P,ae),q===null?$=ye:q.sibling=ye,q=ye);return Rt&&ls(R,ae),$}for(fe=r(R,fe);!ye.done;ae++,ye=C.next())ye=T(fe,R,ae,ye.value,D),ye!==null&&(t&&ye.alternate!==null&&fe.delete(ye.key===null?ae:ye.key),P=s(ye,P,ae),q===null?$=ye:q.sibling=ye,q=ye);return t&&fe.forEach(function(Le){return e(R,Le)}),Rt&&ls(R,ae),$}function U(R,P,C,D){if(typeof C=="object"&&C!==null&&C.type===to&&C.key===null&&(C=C.props.children),typeof C=="object"&&C!==null){switch(C.$$typeof){case AA:e:{for(var $=C.key,q=P;q!==null;){if(q.key===$){if($=C.type,$===to){if(q.tag===7){n(R,q.sibling),P=i(q,C.props.children),P.return=R,R=P;break e}}else if(q.elementType===$||typeof $=="object"&&$!==null&&$.$$typeof===bi&&r2($)===q.type){n(R,q.sibling),P=i(q,C.props),P.ref=Ta(R,q,C),P.return=R,R=P;break e}n(R,q);break}else e(R,q);q=q.sibling}C.type===to?(P=gs(C.props.children,R.mode,D,C.key),P.return=R,R=P):(D=nc(C.type,C.key,C.props,null,R.mode,D),D.ref=Ta(R,P,C),D.return=R,R=D)}return o(R);case eo:e:{for(q=C.key;P!==null;){if(P.key===q)if(P.tag===4&&P.stateNode.containerInfo===C.containerInfo&&P.stateNode.implementation===C.implementation){n(R,P.sibling),P=i(P,C.children||[]),P.return=R,R=P;break e}else{n(R,P);break}else e(R,P);P=P.sibling}P=vh(C,R.mode,D),P.return=R,R=P}return o(R);case bi:return q=C._init,U(R,P,q(C._payload),D)}if(Oa(C))return E(R,P,C,D);if(ya(C))return I(R,P,C,D);vA(R,C)}return typeof C=="string"&&C!==""||typeof C=="number"?(C=""+C,P!==null&&P.tag===6?(n(R,P.sibling),P=i(P,C),P.return=R,R=P):(n(R,P),P=yh(C,R.mode,D),P.return=R,R=P),o(R)):n(R,P)}return U}var Oo=Ov(!0),Dv=Ov(!1),Sc=Zi(null),Cc=null,Ao=null,vp=null;function wp(){vp=Ao=Cc=null}function bp(t){var e=Sc.current;Ct(Sc),t._currentValue=e}function L0(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Eo(t,e){Cc=t,vp=Ao=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Fn=!0),t.firstContext=null)}function lr(t){var e=t._currentValue;if(vp!==t)if(t={context:t,memoizedValue:e,next:null},Ao===null){if(Cc===null)throw Error(me(308));Ao=t,Cc.dependencies={lanes:0,firstContext:t}}else Ao=Ao.next=t;return e}var fs=null;function xp(t){fs===null?fs=[t]:fs.push(t)}function Bv(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,xp(e)):(n.next=i.next,i.next=n),e.interleaved=n,ai(t,r)}function ai(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var xi=!1;function Tp(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ii(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ui(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ut&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,ai(t,n)}return i=r.interleaved,i===null?(e.next=e,xp(r)):(e.next=i.next,i.next=e),r.interleaved=e,ai(t,n)}function ZA(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ap(t,n)}}function i2(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Pc(t,e,n,r){var i=t.updateQueue;xi=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var f=a,p=f.next;f.next=null,o===null?s=p:o.next=p,o=f;var m=t.alternate;m!==null&&(m=m.updateQueue,a=m.lastBaseUpdate,a!==o&&(a===null?m.firstBaseUpdate=p:a.next=p,m.lastBaseUpdate=f))}if(s!==null){var v=i.baseState;o=0,m=p=f=null,a=s;do{var w=a.lane,T=a.eventTime;if((r&w)===w){m!==null&&(m=m.next={eventTime:T,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var E=t,I=a;switch(w=e,T=n,I.tag){case 1:if(E=I.payload,typeof E=="function"){v=E.call(T,v,w);break e}v=E;break e;case 3:E.flags=E.flags&-65537|128;case 0:if(E=I.payload,w=typeof E=="function"?E.call(T,v,w):E,w==null)break e;v=Ft({},v,w);break e;case 2:xi=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,w=i.effects,w===null?i.effects=[a]:w.push(a))}else T={eventTime:T,lane:w,tag:a.tag,payload:a.payload,callback:a.callback,next:null},m===null?(p=m=T,f=v):m=m.next=T,o|=w;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;w=a,a=w.next,w.next=null,i.lastBaseUpdate=w,i.shared.pending=null}}while(!0);if(m===null&&(f=v),i.baseState=f,i.firstBaseUpdate=p,i.lastBaseUpdate=m,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Ts|=o,t.lanes=o,t.memoizedState=v}}function s2(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(me(191,i));i.call(r)}}}var Ll={},Vr=Zi(Ll),yl=Zi(Ll),vl=Zi(Ll);function hs(t){if(t===Ll)throw Error(me(174));return t}function Ep(t,e){switch(Et(vl,e),Et(yl,t),Et(Vr,Ll),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:_0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=_0(e,t)}Ct(Vr),Et(Vr,e)}function Do(){Ct(Vr),Ct(yl),Ct(vl)}function Lv(t){hs(vl.current);var e=hs(Vr.current),n=_0(e,t.type);e!==n&&(Et(yl,t),Et(Vr,n))}function Sp(t){yl.current===t&&(Ct(Vr),Ct(yl))}var Ot=Zi(0);function kc(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var hh=[];function Cp(){for(var t=0;t<hh.length;t++)hh[t]._workInProgressVersionPrimary=null;hh.length=0}var qA=ui.ReactCurrentDispatcher,dh=ui.ReactCurrentBatchConfig,xs=0,Bt=null,qt=null,nn=null,Rc=!1,Ya=!1,wl=0,v4=0;function mn(){throw Error(me(321))}function Pp(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Er(t[n],e[n]))return!1;return!0}function kp(t,e,n,r,i,s){if(xs=s,Bt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,qA.current=t===null||t.memoizedState===null?T4:E4,t=n(r,i),Ya){s=0;do{if(Ya=!1,wl=0,25<=s)throw Error(me(301));s+=1,nn=qt=null,e.updateQueue=null,qA.current=S4,t=n(r,i)}while(Ya)}if(qA.current=Ic,e=qt!==null&&qt.next!==null,xs=0,nn=qt=Bt=null,Rc=!1,e)throw Error(me(300));return t}function Rp(){var t=wl!==0;return wl=0,t}function Nr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return nn===null?Bt.memoizedState=nn=t:nn=nn.next=t,nn}function Ar(){if(qt===null){var t=Bt.alternate;t=t!==null?t.memoizedState:null}else t=qt.next;var e=nn===null?Bt.memoizedState:nn.next;if(e!==null)nn=e,qt=t;else{if(t===null)throw Error(me(310));qt=t,t={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},nn===null?Bt.memoizedState=nn=t:nn=nn.next=t}return nn}function bl(t,e){return typeof e=="function"?e(t):e}function ph(t){var e=Ar(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var r=qt,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,f=null,p=s;do{var m=p.lane;if((xs&m)===m)f!==null&&(f=f.next={lane:0,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null}),r=p.hasEagerState?p.eagerState:t(r,p.action);else{var v={lane:m,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null};f===null?(a=f=v,o=r):f=f.next=v,Bt.lanes|=m,Ts|=m}p=p.next}while(p!==null&&p!==s);f===null?o=r:f.next=a,Er(r,e.memoizedState)||(Fn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=f,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,Bt.lanes|=s,Ts|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function gh(t){var e=Ar(),n=e.queue;if(n===null)throw Error(me(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Er(s,e.memoizedState)||(Fn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function Uv(){}function Vv(t,e){var n=Bt,r=Ar(),i=e(),s=!Er(r.memoizedState,i);if(s&&(r.memoizedState=i,Fn=!0),r=r.queue,Ip(Wv.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||nn!==null&&nn.memoizedState.tag&1){if(n.flags|=2048,xl(9,jv.bind(null,n,r,i,e),void 0,null),rn===null)throw Error(me(349));xs&30||zv(n,e,i)}return i}function zv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Bt.updateQueue,e===null?(e={lastEffect:null,stores:null},Bt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function jv(t,e,n,r){e.value=n,e.getSnapshot=r,$v(e)&&Hv(t)}function Wv(t,e,n){return n(function(){$v(e)&&Hv(t)})}function $v(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Er(t,n)}catch{return!0}}function Hv(t){var e=ai(t,1);e!==null&&Tr(e,t,1,-1)}function o2(t){var e=Nr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bl,lastRenderedState:t},e.queue=t,t=t.dispatch=x4.bind(null,Bt,t),[e.memoizedState,t]}function xl(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Bt.updateQueue,e===null?(e={lastEffect:null,stores:null},Bt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Xv(){return Ar().memoizedState}function GA(t,e,n,r){var i=Nr();Bt.flags|=t,i.memoizedState=xl(1|e,n,void 0,r===void 0?null:r)}function Lu(t,e,n,r){var i=Ar();r=r===void 0?null:r;var s=void 0;if(qt!==null){var o=qt.memoizedState;if(s=o.destroy,r!==null&&Pp(r,o.deps)){i.memoizedState=xl(e,n,s,r);return}}Bt.flags|=t,i.memoizedState=xl(1|e,n,s,r)}function a2(t,e){return GA(8390656,8,t,e)}function Ip(t,e){return Lu(2048,8,t,e)}function Qv(t,e){return Lu(4,2,t,e)}function Yv(t,e){return Lu(4,4,t,e)}function Kv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Zv(t,e,n){return n=n!=null?n.concat([t]):null,Lu(4,4,Kv.bind(null,e,t),n)}function Mp(){}function qv(t,e){var n=Ar();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Pp(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Gv(t,e){var n=Ar();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Pp(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Jv(t,e,n){return xs&21?(Er(n,e)||(n=iv(),Bt.lanes|=n,Ts|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Fn=!0),t.memoizedState=n)}function w4(t,e){var n=mt;mt=n!==0&&4>n?n:4,t(!0);var r=dh.transition;dh.transition={};try{t(!1),e()}finally{mt=n,dh.transition=r}}function e3(){return Ar().memoizedState}function b4(t,e,n){var r=zi(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},t3(t))n3(e,n);else if(n=Bv(t,e,n,r),n!==null){var i=In();Tr(n,t,r,i),r3(n,e,r)}}function x4(t,e,n){var r=zi(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(t3(t))n3(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Er(a,o)){var f=e.interleaved;f===null?(i.next=i,xp(e)):(i.next=f.next,f.next=i),e.interleaved=i;return}}catch{}finally{}n=Bv(t,e,i,r),n!==null&&(i=In(),Tr(n,t,r,i),r3(n,e,r))}}function t3(t){var e=t.alternate;return t===Bt||e!==null&&e===Bt}function n3(t,e){Ya=Rc=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function r3(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ap(t,n)}}var Ic={readContext:lr,useCallback:mn,useContext:mn,useEffect:mn,useImperativeHandle:mn,useInsertionEffect:mn,useLayoutEffect:mn,useMemo:mn,useReducer:mn,useRef:mn,useState:mn,useDebugValue:mn,useDeferredValue:mn,useTransition:mn,useMutableSource:mn,useSyncExternalStore:mn,useId:mn,unstable_isNewReconciler:!1},T4={readContext:lr,useCallback:function(t,e){return Nr().memoizedState=[t,e===void 0?null:e],t},useContext:lr,useEffect:a2,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,GA(4194308,4,Kv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return GA(4194308,4,t,e)},useInsertionEffect:function(t,e){return GA(4,2,t,e)},useMemo:function(t,e){var n=Nr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Nr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=b4.bind(null,Bt,t),[r.memoizedState,t]},useRef:function(t){var e=Nr();return t={current:t},e.memoizedState=t},useState:o2,useDebugValue:Mp,useDeferredValue:function(t){return Nr().memoizedState=t},useTransition:function(){var t=o2(!1),e=t[0];return t=w4.bind(null,t[1]),Nr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Bt,i=Nr();if(Rt){if(n===void 0)throw Error(me(407));n=n()}else{if(n=e(),rn===null)throw Error(me(349));xs&30||zv(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,a2(Wv.bind(null,r,s,t),[t]),r.flags|=2048,xl(9,jv.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Nr(),e=rn.identifierPrefix;if(Rt){var n=ri,r=ni;n=(r&~(1<<32-xr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=wl++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=v4++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},E4={readContext:lr,useCallback:qv,useContext:lr,useEffect:Ip,useImperativeHandle:Zv,useInsertionEffect:Qv,useLayoutEffect:Yv,useMemo:Gv,useReducer:ph,useRef:Xv,useState:function(){return ph(bl)},useDebugValue:Mp,useDeferredValue:function(t){var e=Ar();return Jv(e,qt.memoizedState,t)},useTransition:function(){var t=ph(bl)[0],e=Ar().memoizedState;return[t,e]},useMutableSource:Uv,useSyncExternalStore:Vv,useId:e3,unstable_isNewReconciler:!1},S4={readContext:lr,useCallback:qv,useContext:lr,useEffect:Ip,useImperativeHandle:Zv,useInsertionEffect:Qv,useLayoutEffect:Yv,useMemo:Gv,useReducer:gh,useRef:Xv,useState:function(){return gh(bl)},useDebugValue:Mp,useDeferredValue:function(t){var e=Ar();return qt===null?e.memoizedState=t:Jv(e,qt.memoizedState,t)},useTransition:function(){var t=gh(bl)[0],e=Ar().memoizedState;return[t,e]},useMutableSource:Uv,useSyncExternalStore:Vv,useId:e3,unstable_isNewReconciler:!1};function mr(t,e){if(t&&t.defaultProps){e=Ft({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function U0(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ft({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Uu={isMounted:function(t){return(t=t._reactInternals)?Os(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=In(),i=zi(t),s=ii(r,i);s.payload=e,n!=null&&(s.callback=n),e=Ui(t,s,i),e!==null&&(Tr(e,t,i,r),ZA(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=In(),i=zi(t),s=ii(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Ui(t,s,i),e!==null&&(Tr(e,t,i,r),ZA(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=In(),r=zi(t),i=ii(n,r);i.tag=2,e!=null&&(i.callback=e),e=Ui(t,i,r),e!==null&&(Tr(e,t,r,n),ZA(e,t,r))}};function l2(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!pl(n,r)||!pl(i,s):!0}function i3(t,e,n){var r=!1,i=Qi,s=e.contextType;return typeof s=="object"&&s!==null?s=lr(s):(i=Un(e)?ws:En.current,r=e.contextTypes,s=(r=r!=null)?Mo(t,i):Qi),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Uu,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function A2(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Uu.enqueueReplaceState(e,e.state,null)}function V0(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Tp(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=lr(s):(s=Un(e)?ws:En.current,i.context=Mo(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(U0(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Uu.enqueueReplaceState(i,i.state,null),Pc(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Bo(t,e){try{var n="",r=e;do n+=eS(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function mh(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function z0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var C4=typeof WeakMap=="function"?WeakMap:Map;function s3(t,e,n){n=ii(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Nc||(Nc=!0,q0=r),z0(t,e)},n}function o3(t,e,n){n=ii(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){z0(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){z0(t,e),typeof r!="function"&&(Vi===null?Vi=new Set([this]):Vi.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function c2(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new C4;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=z4.bind(null,t,e,n),e.then(t,t))}function u2(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function f2(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ii(-1,1),e.tag=2,Ui(n,e,1))),n.lanes|=1),t)}var P4=ui.ReactCurrentOwner,Fn=!1;function Rn(t,e,n,r){e.child=t===null?Dv(e,null,n,r):Oo(e,t.child,n,r)}function h2(t,e,n,r,i){n=n.render;var s=e.ref;return Eo(e,i),r=kp(t,e,n,r,s,i),n=Rp(),t!==null&&!Fn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,li(t,e,i)):(Rt&&n&&mp(e),e.flags|=1,Rn(t,e,r,i),e.child)}function d2(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!Vp(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,a3(t,e,s,r,i)):(t=nc(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:pl,n(o,r)&&t.ref===e.ref)return li(t,e,i)}return e.flags|=1,t=ji(s,r),t.ref=e.ref,t.return=e,e.child=t}function a3(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(pl(s,r)&&t.ref===e.ref)if(Fn=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(Fn=!0);else return e.lanes=t.lanes,li(t,e,i)}return j0(t,e,n,r,i)}function l3(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Et(uo,Wn),Wn|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Et(uo,Wn),Wn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,Et(uo,Wn),Wn|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,Et(uo,Wn),Wn|=r;return Rn(t,e,i,n),e.child}function A3(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function j0(t,e,n,r,i){var s=Un(n)?ws:En.current;return s=Mo(e,s),Eo(e,i),n=kp(t,e,n,r,s,i),r=Rp(),t!==null&&!Fn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,li(t,e,i)):(Rt&&r&&mp(e),e.flags|=1,Rn(t,e,n,i),e.child)}function p2(t,e,n,r,i){if(Un(n)){var s=!0;xc(e)}else s=!1;if(Eo(e,i),e.stateNode===null)JA(t,e),i3(e,n,r),V0(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var f=o.context,p=n.contextType;typeof p=="object"&&p!==null?p=lr(p):(p=Un(n)?ws:En.current,p=Mo(e,p));var m=n.getDerivedStateFromProps,v=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function";v||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||f!==p)&&A2(e,o,r,p),xi=!1;var w=e.memoizedState;o.state=w,Pc(e,r,o,i),f=e.memoizedState,a!==r||w!==f||Ln.current||xi?(typeof m=="function"&&(U0(e,n,m,r),f=e.memoizedState),(a=xi||l2(e,n,a,r,w,f,p))?(v||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=f),o.props=r,o.state=f,o.context=p,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Fv(t,e),a=e.memoizedProps,p=e.type===e.elementType?a:mr(e.type,a),o.props=p,v=e.pendingProps,w=o.context,f=n.contextType,typeof f=="object"&&f!==null?f=lr(f):(f=Un(n)?ws:En.current,f=Mo(e,f));var T=n.getDerivedStateFromProps;(m=typeof T=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==v||w!==f)&&A2(e,o,r,f),xi=!1,w=e.memoizedState,o.state=w,Pc(e,r,o,i);var E=e.memoizedState;a!==v||w!==E||Ln.current||xi?(typeof T=="function"&&(U0(e,n,T,r),E=e.memoizedState),(p=xi||l2(e,n,p,r,w,E,f)||!1)?(m||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,E,f),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,E,f)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&w===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&w===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=E),o.props=r,o.state=E,o.context=f,r=p):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&w===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&w===t.memoizedState||(e.flags|=1024),r=!1)}return W0(t,e,n,r,s,i)}function W0(t,e,n,r,i,s){A3(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&e2(e,n,!1),li(t,e,s);r=e.stateNode,P4.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Oo(e,t.child,null,s),e.child=Oo(e,null,a,s)):Rn(t,e,a,s),e.memoizedState=r.state,i&&e2(e,n,!0),e.child}function c3(t){var e=t.stateNode;e.pendingContext?Jm(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Jm(t,e.context,!1),Ep(t,e.containerInfo)}function g2(t,e,n,r,i){return No(),yp(i),e.flags|=256,Rn(t,e,n,r),e.child}var $0={dehydrated:null,treeContext:null,retryLane:0};function H0(t){return{baseLanes:t,cachePool:null,transitions:null}}function u3(t,e,n){var r=e.pendingProps,i=Ot.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Et(Ot,i&1),t===null)return F0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=ju(o,r,0,null),t=gs(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=H0(n),e.memoizedState=$0,t):Np(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return k4(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var f={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=f,e.deletions=null):(r=ji(i,f),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=ji(a,s):(s=gs(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?H0(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=$0,r}return s=t.child,t=s.sibling,r=ji(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Np(t,e){return e=ju({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function wA(t,e,n,r){return r!==null&&yp(r),Oo(e,t.child,null,n),t=Np(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function k4(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=mh(Error(me(422))),wA(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=ju({mode:"visible",children:r.children},i,0,null),s=gs(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Oo(e,t.child,null,o),e.child.memoizedState=H0(o),e.memoizedState=$0,s);if(!(e.mode&1))return wA(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(me(419)),r=mh(s,r,void 0),wA(t,e,o,r)}if(a=(o&t.childLanes)!==0,Fn||a){if(r=rn,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,ai(t,i),Tr(r,t,i,-1))}return Up(),r=mh(Error(me(421))),wA(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=j4.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,Xn=Li(i.nextSibling),Qn=e,Rt=!0,yr=null,t!==null&&(tr[nr++]=ni,tr[nr++]=ri,tr[nr++]=bs,ni=t.id,ri=t.overflow,bs=e),e=Np(e,r.children),e.flags|=4096,e)}function m2(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),L0(t.return,e,n)}function _h(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function f3(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Rn(t,e,r.children,n),r=Ot.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&m2(t,n,e);else if(t.tag===19)m2(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Et(Ot,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&kc(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),_h(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&kc(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}_h(e,!0,n,null,s);break;case"together":_h(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function JA(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function li(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ts|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(me(153));if(e.child!==null){for(t=e.child,n=ji(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ji(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function R4(t,e,n){switch(e.tag){case 3:c3(e),No();break;case 5:Lv(e);break;case 1:Un(e.type)&&xc(e);break;case 4:Ep(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Et(Sc,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Et(Ot,Ot.current&1),e.flags|=128,null):n&e.child.childLanes?u3(t,e,n):(Et(Ot,Ot.current&1),t=li(t,e,n),t!==null?t.sibling:null);Et(Ot,Ot.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return f3(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Et(Ot,Ot.current),r)break;return null;case 22:case 23:return e.lanes=0,l3(t,e,n)}return li(t,e,n)}var h3,X0,d3,p3;h3=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};X0=function(){};d3=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,hs(Vr.current);var s=null;switch(n){case"input":i=d0(t,i),r=d0(t,r),s=[];break;case"select":i=Ft({},i,{value:void 0}),r=Ft({},r,{value:void 0}),s=[];break;case"textarea":i=m0(t,i),r=m0(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=wc)}y0(n,r);var o;n=null;for(p in i)if(!r.hasOwnProperty(p)&&i.hasOwnProperty(p)&&i[p]!=null)if(p==="style"){var a=i[p];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else p!=="dangerouslySetInnerHTML"&&p!=="children"&&p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(ll.hasOwnProperty(p)?s||(s=[]):(s=s||[]).push(p,null));for(p in r){var f=r[p];if(a=i!=null?i[p]:void 0,r.hasOwnProperty(p)&&f!==a&&(f!=null||a!=null))if(p==="style")if(a){for(o in a)!a.hasOwnProperty(o)||f&&f.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in f)f.hasOwnProperty(o)&&a[o]!==f[o]&&(n||(n={}),n[o]=f[o])}else n||(s||(s=[]),s.push(p,n)),n=f;else p==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,a=a?a.__html:void 0,f!=null&&a!==f&&(s=s||[]).push(p,f)):p==="children"?typeof f!="string"&&typeof f!="number"||(s=s||[]).push(p,""+f):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&(ll.hasOwnProperty(p)?(f!=null&&p==="onScroll"&&St("scroll",t),s||a===f||(s=[])):(s=s||[]).push(p,f))}n&&(s=s||[]).push("style",n);var p=s;(e.updateQueue=p)&&(e.flags|=4)}};p3=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ea(t,e){if(!Rt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function _n(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function I4(t,e,n){var r=e.pendingProps;switch(_p(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _n(e),null;case 1:return Un(e.type)&&bc(),_n(e),null;case 3:return r=e.stateNode,Do(),Ct(Ln),Ct(En),Cp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(yA(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,yr!==null&&(ed(yr),yr=null))),X0(t,e),_n(e),null;case 5:Sp(e);var i=hs(vl.current);if(n=e.type,t!==null&&e.stateNode!=null)d3(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(me(166));return _n(e),null}if(t=hs(Vr.current),yA(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Dr]=e,r[_l]=s,t=(e.mode&1)!==0,n){case"dialog":St("cancel",r),St("close",r);break;case"iframe":case"object":case"embed":St("load",r);break;case"video":case"audio":for(i=0;i<Ba.length;i++)St(Ba[i],r);break;case"source":St("error",r);break;case"img":case"image":case"link":St("error",r),St("load",r);break;case"details":St("toggle",r);break;case"input":Sm(r,s),St("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},St("invalid",r);break;case"textarea":Pm(r,s),St("invalid",r)}y0(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&_A(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&_A(r.textContent,a,t),i=["children",""+a]):ll.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&St("scroll",r)}switch(n){case"input":cA(r),Cm(r,s,!0);break;case"textarea":cA(r),km(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=wc)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Wy(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Dr]=e,t[_l]=r,h3(t,e,!1,!1),e.stateNode=t;e:{switch(o=v0(n,r),n){case"dialog":St("cancel",t),St("close",t),i=r;break;case"iframe":case"object":case"embed":St("load",t),i=r;break;case"video":case"audio":for(i=0;i<Ba.length;i++)St(Ba[i],t);i=r;break;case"source":St("error",t),i=r;break;case"img":case"image":case"link":St("error",t),St("load",t),i=r;break;case"details":St("toggle",t),i=r;break;case"input":Sm(t,r),i=d0(t,r),St("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Ft({},r,{value:void 0}),St("invalid",t);break;case"textarea":Pm(t,r),i=m0(t,r),St("invalid",t);break;default:i=r}y0(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var f=a[s];s==="style"?Xy(t,f):s==="dangerouslySetInnerHTML"?(f=f?f.__html:void 0,f!=null&&$y(t,f)):s==="children"?typeof f=="string"?(n!=="textarea"||f!=="")&&Al(t,f):typeof f=="number"&&Al(t,""+f):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(ll.hasOwnProperty(s)?f!=null&&s==="onScroll"&&St("scroll",t):f!=null&&rp(t,s,f,o))}switch(n){case"input":cA(t),Cm(t,r,!1);break;case"textarea":cA(t),km(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Xi(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?wo(t,!!r.multiple,s,!1):r.defaultValue!=null&&wo(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=wc)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return _n(e),null;case 6:if(t&&e.stateNode!=null)p3(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(me(166));if(n=hs(vl.current),hs(Vr.current),yA(e)){if(r=e.stateNode,n=e.memoizedProps,r[Dr]=e,(s=r.nodeValue!==n)&&(t=Qn,t!==null))switch(t.tag){case 3:_A(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&_A(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Dr]=e,e.stateNode=r}return _n(e),null;case 13:if(Ct(Ot),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Rt&&Xn!==null&&e.mode&1&&!(e.flags&128))Nv(),No(),e.flags|=98560,s=!1;else if(s=yA(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(me(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(me(317));s[Dr]=e}else No(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;_n(e),s=!1}else yr!==null&&(ed(yr),yr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Ot.current&1?Gt===0&&(Gt=3):Up())),e.updateQueue!==null&&(e.flags|=4),_n(e),null);case 4:return Do(),X0(t,e),t===null&&gl(e.stateNode.containerInfo),_n(e),null;case 10:return bp(e.type._context),_n(e),null;case 17:return Un(e.type)&&bc(),_n(e),null;case 19:if(Ct(Ot),s=e.memoizedState,s===null)return _n(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)Ea(s,!1);else{if(Gt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=kc(t),o!==null){for(e.flags|=128,Ea(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Et(Ot,Ot.current&1|2),e.child}t=t.sibling}s.tail!==null&&Wt()>Fo&&(e.flags|=128,r=!0,Ea(s,!1),e.lanes=4194304)}else{if(!r)if(t=kc(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ea(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Rt)return _n(e),null}else 2*Wt()-s.renderingStartTime>Fo&&n!==1073741824&&(e.flags|=128,r=!0,Ea(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Wt(),e.sibling=null,n=Ot.current,Et(Ot,r?n&1|2:n&1),e):(_n(e),null);case 22:case 23:return Lp(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Wn&1073741824&&(_n(e),e.subtreeFlags&6&&(e.flags|=8192)):_n(e),null;case 24:return null;case 25:return null}throw Error(me(156,e.tag))}function M4(t,e){switch(_p(e),e.tag){case 1:return Un(e.type)&&bc(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Do(),Ct(Ln),Ct(En),Cp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Sp(e),null;case 13:if(Ct(Ot),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(me(340));No()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ct(Ot),null;case 4:return Do(),null;case 10:return bp(e.type._context),null;case 22:case 23:return Lp(),null;case 24:return null;default:return null}}var bA=!1,Tn=!1,N4=typeof WeakSet=="function"?WeakSet:Set,De=null;function co(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){zt(t,e,r)}else n.current=null}function Q0(t,e,n){try{n()}catch(r){zt(t,e,r)}}var _2=!1;function O4(t,e){if(R0=_c,t=vv(),gp(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,f=-1,p=0,m=0,v=t,w=null;t:for(;;){for(var T;v!==n||i!==0&&v.nodeType!==3||(a=o+i),v!==s||r!==0&&v.nodeType!==3||(f=o+r),v.nodeType===3&&(o+=v.nodeValue.length),(T=v.firstChild)!==null;)w=v,v=T;for(;;){if(v===t)break t;if(w===n&&++p===i&&(a=o),w===s&&++m===r&&(f=o),(T=v.nextSibling)!==null)break;v=w,w=v.parentNode}v=T}n=a===-1||f===-1?null:{start:a,end:f}}else n=null}n=n||{start:0,end:0}}else n=null;for(I0={focusedElem:t,selectionRange:n},_c=!1,De=e;De!==null;)if(e=De,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,De=t;else for(;De!==null;){e=De;try{var E=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(E!==null){var I=E.memoizedProps,U=E.memoizedState,R=e.stateNode,P=R.getSnapshotBeforeUpdate(e.elementType===e.type?I:mr(e.type,I),U);R.__reactInternalSnapshotBeforeUpdate=P}break;case 3:var C=e.stateNode.containerInfo;C.nodeType===1?C.textContent="":C.nodeType===9&&C.documentElement&&C.removeChild(C.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(me(163))}}catch(D){zt(e,e.return,D)}if(t=e.sibling,t!==null){t.return=e.return,De=t;break}De=e.return}return E=_2,_2=!1,E}function Ka(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Q0(e,n,s)}i=i.next}while(i!==r)}}function Vu(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Y0(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function g3(t){var e=t.alternate;e!==null&&(t.alternate=null,g3(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Dr],delete e[_l],delete e[O0],delete e[g4],delete e[m4])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function m3(t){return t.tag===5||t.tag===3||t.tag===4}function y2(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||m3(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function K0(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=wc));else if(r!==4&&(t=t.child,t!==null))for(K0(t,e,n),t=t.sibling;t!==null;)K0(t,e,n),t=t.sibling}function Z0(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Z0(t,e,n),t=t.sibling;t!==null;)Z0(t,e,n),t=t.sibling}var ln=null,_r=!1;function mi(t,e,n){for(n=n.child;n!==null;)_3(t,e,n),n=n.sibling}function _3(t,e,n){if(Ur&&typeof Ur.onCommitFiberUnmount=="function")try{Ur.onCommitFiberUnmount(Mu,n)}catch{}switch(n.tag){case 5:Tn||co(n,e);case 6:var r=ln,i=_r;ln=null,mi(t,e,n),ln=r,_r=i,ln!==null&&(_r?(t=ln,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):ln.removeChild(n.stateNode));break;case 18:ln!==null&&(_r?(t=ln,n=n.stateNode,t.nodeType===8?uh(t.parentNode,n):t.nodeType===1&&uh(t,n),hl(t)):uh(ln,n.stateNode));break;case 4:r=ln,i=_r,ln=n.stateNode.containerInfo,_r=!0,mi(t,e,n),ln=r,_r=i;break;case 0:case 11:case 14:case 15:if(!Tn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Q0(n,e,o),i=i.next}while(i!==r)}mi(t,e,n);break;case 1:if(!Tn&&(co(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){zt(n,e,a)}mi(t,e,n);break;case 21:mi(t,e,n);break;case 22:n.mode&1?(Tn=(r=Tn)||n.memoizedState!==null,mi(t,e,n),Tn=r):mi(t,e,n);break;default:mi(t,e,n)}}function v2(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new N4),e.forEach(function(r){var i=W4.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function hr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:ln=a.stateNode,_r=!1;break e;case 3:ln=a.stateNode.containerInfo,_r=!0;break e;case 4:ln=a.stateNode.containerInfo,_r=!0;break e}a=a.return}if(ln===null)throw Error(me(160));_3(s,o,i),ln=null,_r=!1;var f=i.alternate;f!==null&&(f.return=null),i.return=null}catch(p){zt(i,e,p)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)y3(e,t),e=e.sibling}function y3(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(hr(e,t),Rr(t),r&4){try{Ka(3,t,t.return),Vu(3,t)}catch(I){zt(t,t.return,I)}try{Ka(5,t,t.return)}catch(I){zt(t,t.return,I)}}break;case 1:hr(e,t),Rr(t),r&512&&n!==null&&co(n,n.return);break;case 5:if(hr(e,t),Rr(t),r&512&&n!==null&&co(n,n.return),t.flags&32){var i=t.stateNode;try{Al(i,"")}catch(I){zt(t,t.return,I)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,f=t.updateQueue;if(t.updateQueue=null,f!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&zy(i,s),v0(a,o);var p=v0(a,s);for(o=0;o<f.length;o+=2){var m=f[o],v=f[o+1];m==="style"?Xy(i,v):m==="dangerouslySetInnerHTML"?$y(i,v):m==="children"?Al(i,v):rp(i,m,v,p)}switch(a){case"input":p0(i,s);break;case"textarea":jy(i,s);break;case"select":var w=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var T=s.value;T!=null?wo(i,!!s.multiple,T,!1):w!==!!s.multiple&&(s.defaultValue!=null?wo(i,!!s.multiple,s.defaultValue,!0):wo(i,!!s.multiple,s.multiple?[]:"",!1))}i[_l]=s}catch(I){zt(t,t.return,I)}}break;case 6:if(hr(e,t),Rr(t),r&4){if(t.stateNode===null)throw Error(me(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(I){zt(t,t.return,I)}}break;case 3:if(hr(e,t),Rr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{hl(e.containerInfo)}catch(I){zt(t,t.return,I)}break;case 4:hr(e,t),Rr(t);break;case 13:hr(e,t),Rr(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Bp=Wt())),r&4&&v2(t);break;case 22:if(m=n!==null&&n.memoizedState!==null,t.mode&1?(Tn=(p=Tn)||m,hr(e,t),Tn=p):hr(e,t),Rr(t),r&8192){if(p=t.memoizedState!==null,(t.stateNode.isHidden=p)&&!m&&t.mode&1)for(De=t,m=t.child;m!==null;){for(v=De=m;De!==null;){switch(w=De,T=w.child,w.tag){case 0:case 11:case 14:case 15:Ka(4,w,w.return);break;case 1:co(w,w.return);var E=w.stateNode;if(typeof E.componentWillUnmount=="function"){r=w,n=w.return;try{e=r,E.props=e.memoizedProps,E.state=e.memoizedState,E.componentWillUnmount()}catch(I){zt(r,n,I)}}break;case 5:co(w,w.return);break;case 22:if(w.memoizedState!==null){b2(v);continue}}T!==null?(T.return=w,De=T):b2(v)}m=m.sibling}e:for(m=null,v=t;;){if(v.tag===5){if(m===null){m=v;try{i=v.stateNode,p?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=v.stateNode,f=v.memoizedProps.style,o=f!=null&&f.hasOwnProperty("display")?f.display:null,a.style.display=Hy("display",o))}catch(I){zt(t,t.return,I)}}}else if(v.tag===6){if(m===null)try{v.stateNode.nodeValue=p?"":v.memoizedProps}catch(I){zt(t,t.return,I)}}else if((v.tag!==22&&v.tag!==23||v.memoizedState===null||v===t)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===t)break e;for(;v.sibling===null;){if(v.return===null||v.return===t)break e;m===v&&(m=null),v=v.return}m===v&&(m=null),v.sibling.return=v.return,v=v.sibling}}break;case 19:hr(e,t),Rr(t),r&4&&v2(t);break;case 21:break;default:hr(e,t),Rr(t)}}function Rr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(m3(n)){var r=n;break e}n=n.return}throw Error(me(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Al(i,""),r.flags&=-33);var s=y2(t);Z0(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=y2(t);K0(t,a,o);break;default:throw Error(me(161))}}catch(f){zt(t,t.return,f)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function D4(t,e,n){De=t,v3(t)}function v3(t,e,n){for(var r=(t.mode&1)!==0;De!==null;){var i=De,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||bA;if(!o){var a=i.alternate,f=a!==null&&a.memoizedState!==null||Tn;a=bA;var p=Tn;if(bA=o,(Tn=f)&&!p)for(De=i;De!==null;)o=De,f=o.child,o.tag===22&&o.memoizedState!==null?x2(i):f!==null?(f.return=o,De=f):x2(i);for(;s!==null;)De=s,v3(s),s=s.sibling;De=i,bA=a,Tn=p}w2(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,De=s):w2(t)}}function w2(t){for(;De!==null;){var e=De;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Tn||Vu(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Tn)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:mr(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&s2(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}s2(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var f=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":f.autoFocus&&n.focus();break;case"img":f.src&&(n.src=f.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var p=e.alternate;if(p!==null){var m=p.memoizedState;if(m!==null){var v=m.dehydrated;v!==null&&hl(v)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(me(163))}Tn||e.flags&512&&Y0(e)}catch(w){zt(e,e.return,w)}}if(e===t){De=null;break}if(n=e.sibling,n!==null){n.return=e.return,De=n;break}De=e.return}}function b2(t){for(;De!==null;){var e=De;if(e===t){De=null;break}var n=e.sibling;if(n!==null){n.return=e.return,De=n;break}De=e.return}}function x2(t){for(;De!==null;){var e=De;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Vu(4,e)}catch(f){zt(e,n,f)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(f){zt(e,i,f)}}var s=e.return;try{Y0(e)}catch(f){zt(e,s,f)}break;case 5:var o=e.return;try{Y0(e)}catch(f){zt(e,o,f)}}}catch(f){zt(e,e.return,f)}if(e===t){De=null;break}var a=e.sibling;if(a!==null){a.return=e.return,De=a;break}De=e.return}}var B4=Math.ceil,Mc=ui.ReactCurrentDispatcher,Op=ui.ReactCurrentOwner,ir=ui.ReactCurrentBatchConfig,ut=0,rn=null,Qt=null,cn=0,Wn=0,uo=Zi(0),Gt=0,Tl=null,Ts=0,zu=0,Dp=0,Za=null,Bn=null,Bp=0,Fo=1/0,Zr=null,Nc=!1,q0=null,Vi=null,xA=!1,Ri=null,Oc=0,qa=0,G0=null,ec=-1,tc=0;function In(){return ut&6?Wt():ec!==-1?ec:ec=Wt()}function zi(t){return t.mode&1?ut&2&&cn!==0?cn&-cn:y4.transition!==null?(tc===0&&(tc=iv()),tc):(t=mt,t!==0||(t=window.event,t=t===void 0?16:uv(t.type)),t):1}function Tr(t,e,n,r){if(50<qa)throw qa=0,G0=null,Error(me(185));Dl(t,n,r),(!(ut&2)||t!==rn)&&(t===rn&&(!(ut&2)&&(zu|=n),Gt===4&&Pi(t,cn)),Vn(t,r),n===1&&ut===0&&!(e.mode&1)&&(Fo=Wt()+500,Fu&&qi()))}function Vn(t,e){var n=t.callbackNode;yS(t,e);var r=mc(t,t===rn?cn:0);if(r===0)n!==null&&Mm(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Mm(n),e===1)t.tag===0?_4(T2.bind(null,t)):Rv(T2.bind(null,t)),d4(function(){!(ut&6)&&qi()}),n=null;else{switch(sv(r)){case 1:n=lp;break;case 4:n=nv;break;case 16:n=gc;break;case 536870912:n=rv;break;default:n=gc}n=P3(n,w3.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function w3(t,e){if(ec=-1,tc=0,ut&6)throw Error(me(327));var n=t.callbackNode;if(So()&&t.callbackNode!==n)return null;var r=mc(t,t===rn?cn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Dc(t,r);else{e=r;var i=ut;ut|=2;var s=x3();(rn!==t||cn!==e)&&(Zr=null,Fo=Wt()+500,ps(t,e));do try{U4();break}catch(a){b3(t,a)}while(!0);wp(),Mc.current=s,ut=i,Qt!==null?e=0:(rn=null,cn=0,e=Gt)}if(e!==0){if(e===2&&(i=E0(t),i!==0&&(r=i,e=J0(t,i))),e===1)throw n=Tl,ps(t,0),Pi(t,r),Vn(t,Wt()),n;if(e===6)Pi(t,r);else{if(i=t.current.alternate,!(r&30)&&!F4(i)&&(e=Dc(t,r),e===2&&(s=E0(t),s!==0&&(r=s,e=J0(t,s))),e===1))throw n=Tl,ps(t,0),Pi(t,r),Vn(t,Wt()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(me(345));case 2:As(t,Bn,Zr);break;case 3:if(Pi(t,r),(r&130023424)===r&&(e=Bp+500-Wt(),10<e)){if(mc(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){In(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=N0(As.bind(null,t,Bn,Zr),e);break}As(t,Bn,Zr);break;case 4:if(Pi(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-xr(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Wt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*B4(r/1960))-r,10<r){t.timeoutHandle=N0(As.bind(null,t,Bn,Zr),r);break}As(t,Bn,Zr);break;case 5:As(t,Bn,Zr);break;default:throw Error(me(329))}}}return Vn(t,Wt()),t.callbackNode===n?w3.bind(null,t):null}function J0(t,e){var n=Za;return t.current.memoizedState.isDehydrated&&(ps(t,e).flags|=256),t=Dc(t,e),t!==2&&(e=Bn,Bn=n,e!==null&&ed(e)),t}function ed(t){Bn===null?Bn=t:Bn.push.apply(Bn,t)}function F4(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Er(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Pi(t,e){for(e&=~Dp,e&=~zu,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-xr(e),r=1<<n;t[n]=-1,e&=~r}}function T2(t){if(ut&6)throw Error(me(327));So();var e=mc(t,0);if(!(e&1))return Vn(t,Wt()),null;var n=Dc(t,e);if(t.tag!==0&&n===2){var r=E0(t);r!==0&&(e=r,n=J0(t,r))}if(n===1)throw n=Tl,ps(t,0),Pi(t,e),Vn(t,Wt()),n;if(n===6)throw Error(me(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,As(t,Bn,Zr),Vn(t,Wt()),null}function Fp(t,e){var n=ut;ut|=1;try{return t(e)}finally{ut=n,ut===0&&(Fo=Wt()+500,Fu&&qi())}}function Es(t){Ri!==null&&Ri.tag===0&&!(ut&6)&&So();var e=ut;ut|=1;var n=ir.transition,r=mt;try{if(ir.transition=null,mt=1,t)return t()}finally{mt=r,ir.transition=n,ut=e,!(ut&6)&&qi()}}function Lp(){Wn=uo.current,Ct(uo)}function ps(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,h4(n)),Qt!==null)for(n=Qt.return;n!==null;){var r=n;switch(_p(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&bc();break;case 3:Do(),Ct(Ln),Ct(En),Cp();break;case 5:Sp(r);break;case 4:Do();break;case 13:Ct(Ot);break;case 19:Ct(Ot);break;case 10:bp(r.type._context);break;case 22:case 23:Lp()}n=n.return}if(rn=t,Qt=t=ji(t.current,null),cn=Wn=e,Gt=0,Tl=null,Dp=zu=Ts=0,Bn=Za=null,fs!==null){for(e=0;e<fs.length;e++)if(n=fs[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}fs=null}return t}function b3(t,e){do{var n=Qt;try{if(wp(),qA.current=Ic,Rc){for(var r=Bt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Rc=!1}if(xs=0,nn=qt=Bt=null,Ya=!1,wl=0,Op.current=null,n===null||n.return===null){Gt=1,Tl=e,Qt=null;break}e:{var s=t,o=n.return,a=n,f=e;if(e=cn,a.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){var p=f,m=a,v=m.tag;if(!(m.mode&1)&&(v===0||v===11||v===15)){var w=m.alternate;w?(m.updateQueue=w.updateQueue,m.memoizedState=w.memoizedState,m.lanes=w.lanes):(m.updateQueue=null,m.memoizedState=null)}var T=u2(o);if(T!==null){T.flags&=-257,f2(T,o,a,s,e),T.mode&1&&c2(s,p,e),e=T,f=p;var E=e.updateQueue;if(E===null){var I=new Set;I.add(f),e.updateQueue=I}else E.add(f);break e}else{if(!(e&1)){c2(s,p,e),Up();break e}f=Error(me(426))}}else if(Rt&&a.mode&1){var U=u2(o);if(U!==null){!(U.flags&65536)&&(U.flags|=256),f2(U,o,a,s,e),yp(Bo(f,a));break e}}s=f=Bo(f,a),Gt!==4&&(Gt=2),Za===null?Za=[s]:Za.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var R=s3(s,f,e);i2(s,R);break e;case 1:a=f;var P=s.type,C=s.stateNode;if(!(s.flags&128)&&(typeof P.getDerivedStateFromError=="function"||C!==null&&typeof C.componentDidCatch=="function"&&(Vi===null||!Vi.has(C)))){s.flags|=65536,e&=-e,s.lanes|=e;var D=o3(s,a,e);i2(s,D);break e}}s=s.return}while(s!==null)}E3(n)}catch($){e=$,Qt===n&&n!==null&&(Qt=n=n.return);continue}break}while(!0)}function x3(){var t=Mc.current;return Mc.current=Ic,t===null?Ic:t}function Up(){(Gt===0||Gt===3||Gt===2)&&(Gt=4),rn===null||!(Ts&268435455)&&!(zu&268435455)||Pi(rn,cn)}function Dc(t,e){var n=ut;ut|=2;var r=x3();(rn!==t||cn!==e)&&(Zr=null,ps(t,e));do try{L4();break}catch(i){b3(t,i)}while(!0);if(wp(),ut=n,Mc.current=r,Qt!==null)throw Error(me(261));return rn=null,cn=0,Gt}function L4(){for(;Qt!==null;)T3(Qt)}function U4(){for(;Qt!==null&&!cS();)T3(Qt)}function T3(t){var e=C3(t.alternate,t,Wn);t.memoizedProps=t.pendingProps,e===null?E3(t):Qt=e,Op.current=null}function E3(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=M4(n,e),n!==null){n.flags&=32767,Qt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Gt=6,Qt=null;return}}else if(n=I4(n,e,Wn),n!==null){Qt=n;return}if(e=e.sibling,e!==null){Qt=e;return}Qt=e=t}while(e!==null);Gt===0&&(Gt=5)}function As(t,e,n){var r=mt,i=ir.transition;try{ir.transition=null,mt=1,V4(t,e,n,r)}finally{ir.transition=i,mt=r}return null}function V4(t,e,n,r){do So();while(Ri!==null);if(ut&6)throw Error(me(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(me(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(vS(t,s),t===rn&&(Qt=rn=null,cn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||xA||(xA=!0,P3(gc,function(){return So(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=ir.transition,ir.transition=null;var o=mt;mt=1;var a=ut;ut|=4,Op.current=null,O4(t,n),y3(n,t),o4(I0),_c=!!R0,I0=R0=null,t.current=n,D4(n),uS(),ut=a,mt=o,ir.transition=s}else t.current=n;if(xA&&(xA=!1,Ri=t,Oc=i),s=t.pendingLanes,s===0&&(Vi=null),dS(n.stateNode),Vn(t,Wt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Nc)throw Nc=!1,t=q0,q0=null,t;return Oc&1&&t.tag!==0&&So(),s=t.pendingLanes,s&1?t===G0?qa++:(qa=0,G0=t):qa=0,qi(),null}function So(){if(Ri!==null){var t=sv(Oc),e=ir.transition,n=mt;try{if(ir.transition=null,mt=16>t?16:t,Ri===null)var r=!1;else{if(t=Ri,Ri=null,Oc=0,ut&6)throw Error(me(331));var i=ut;for(ut|=4,De=t.current;De!==null;){var s=De,o=s.child;if(De.flags&16){var a=s.deletions;if(a!==null){for(var f=0;f<a.length;f++){var p=a[f];for(De=p;De!==null;){var m=De;switch(m.tag){case 0:case 11:case 15:Ka(8,m,s)}var v=m.child;if(v!==null)v.return=m,De=v;else for(;De!==null;){m=De;var w=m.sibling,T=m.return;if(g3(m),m===p){De=null;break}if(w!==null){w.return=T,De=w;break}De=T}}}var E=s.alternate;if(E!==null){var I=E.child;if(I!==null){E.child=null;do{var U=I.sibling;I.sibling=null,I=U}while(I!==null)}}De=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,De=o;else e:for(;De!==null;){if(s=De,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Ka(9,s,s.return)}var R=s.sibling;if(R!==null){R.return=s.return,De=R;break e}De=s.return}}var P=t.current;for(De=P;De!==null;){o=De;var C=o.child;if(o.subtreeFlags&2064&&C!==null)C.return=o,De=C;else e:for(o=P;De!==null;){if(a=De,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Vu(9,a)}}catch($){zt(a,a.return,$)}if(a===o){De=null;break e}var D=a.sibling;if(D!==null){D.return=a.return,De=D;break e}De=a.return}}if(ut=i,qi(),Ur&&typeof Ur.onPostCommitFiberRoot=="function")try{Ur.onPostCommitFiberRoot(Mu,t)}catch{}r=!0}return r}finally{mt=n,ir.transition=e}}return!1}function E2(t,e,n){e=Bo(n,e),e=s3(t,e,1),t=Ui(t,e,1),e=In(),t!==null&&(Dl(t,1,e),Vn(t,e))}function zt(t,e,n){if(t.tag===3)E2(t,t,n);else for(;e!==null;){if(e.tag===3){E2(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Vi===null||!Vi.has(r))){t=Bo(n,t),t=o3(e,t,1),e=Ui(e,t,1),t=In(),e!==null&&(Dl(e,1,t),Vn(e,t));break}}e=e.return}}function z4(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=In(),t.pingedLanes|=t.suspendedLanes&n,rn===t&&(cn&n)===n&&(Gt===4||Gt===3&&(cn&130023424)===cn&&500>Wt()-Bp?ps(t,0):Dp|=n),Vn(t,e)}function S3(t,e){e===0&&(t.mode&1?(e=hA,hA<<=1,!(hA&130023424)&&(hA=4194304)):e=1);var n=In();t=ai(t,e),t!==null&&(Dl(t,e,n),Vn(t,n))}function j4(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),S3(t,n)}function W4(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(me(314))}r!==null&&r.delete(e),S3(t,n)}var C3;C3=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ln.current)Fn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Fn=!1,R4(t,e,n);Fn=!!(t.flags&131072)}else Fn=!1,Rt&&e.flags&1048576&&Iv(e,Ec,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;JA(t,e),t=e.pendingProps;var i=Mo(e,En.current);Eo(e,n),i=kp(null,e,r,t,i,n);var s=Rp();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Un(r)?(s=!0,xc(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Tp(e),i.updater=Uu,e.stateNode=i,i._reactInternals=e,V0(e,r,t,n),e=W0(null,e,r,!0,s,n)):(e.tag=0,Rt&&s&&mp(e),Rn(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(JA(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=H4(r),t=mr(r,t),i){case 0:e=j0(null,e,r,t,n);break e;case 1:e=p2(null,e,r,t,n);break e;case 11:e=h2(null,e,r,t,n);break e;case 14:e=d2(null,e,r,mr(r.type,t),n);break e}throw Error(me(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:mr(r,i),j0(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:mr(r,i),p2(t,e,r,i,n);case 3:e:{if(c3(e),t===null)throw Error(me(387));r=e.pendingProps,s=e.memoizedState,i=s.element,Fv(t,e),Pc(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Bo(Error(me(423)),e),e=g2(t,e,r,n,i);break e}else if(r!==i){i=Bo(Error(me(424)),e),e=g2(t,e,r,n,i);break e}else for(Xn=Li(e.stateNode.containerInfo.firstChild),Qn=e,Rt=!0,yr=null,n=Dv(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(No(),r===i){e=li(t,e,n);break e}Rn(t,e,r,n)}e=e.child}return e;case 5:return Lv(e),t===null&&F0(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,M0(r,i)?o=null:s!==null&&M0(r,s)&&(e.flags|=32),A3(t,e),Rn(t,e,o,n),e.child;case 6:return t===null&&F0(e),null;case 13:return u3(t,e,n);case 4:return Ep(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Oo(e,null,r,n):Rn(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:mr(r,i),h2(t,e,r,i,n);case 7:return Rn(t,e,e.pendingProps,n),e.child;case 8:return Rn(t,e,e.pendingProps.children,n),e.child;case 12:return Rn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,Et(Sc,r._currentValue),r._currentValue=o,s!==null)if(Er(s.value,o)){if(s.children===i.children&&!Ln.current){e=li(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var f=a.firstContext;f!==null;){if(f.context===r){if(s.tag===1){f=ii(-1,n&-n),f.tag=2;var p=s.updateQueue;if(p!==null){p=p.shared;var m=p.pending;m===null?f.next=f:(f.next=m.next,m.next=f),p.pending=f}}s.lanes|=n,f=s.alternate,f!==null&&(f.lanes|=n),L0(s.return,n,e),a.lanes|=n;break}f=f.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(me(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),L0(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Rn(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Eo(e,n),i=lr(i),r=r(i),e.flags|=1,Rn(t,e,r,n),e.child;case 14:return r=e.type,i=mr(r,e.pendingProps),i=mr(r.type,i),d2(t,e,r,i,n);case 15:return a3(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:mr(r,i),JA(t,e),e.tag=1,Un(r)?(t=!0,xc(e)):t=!1,Eo(e,n),i3(e,r,i),V0(e,r,i,n),W0(null,e,r,!0,t,n);case 19:return f3(t,e,n);case 22:return l3(t,e,n)}throw Error(me(156,e.tag))};function P3(t,e){return tv(t,e)}function $4(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rr(t,e,n,r){return new $4(t,e,n,r)}function Vp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function H4(t){if(typeof t=="function")return Vp(t)?1:0;if(t!=null){if(t=t.$$typeof,t===sp)return 11;if(t===op)return 14}return 2}function ji(t,e){var n=t.alternate;return n===null?(n=rr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function nc(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")Vp(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case to:return gs(n.children,i,s,e);case ip:o=8,i|=8;break;case c0:return t=rr(12,n,e,i|2),t.elementType=c0,t.lanes=s,t;case u0:return t=rr(13,n,e,i),t.elementType=u0,t.lanes=s,t;case f0:return t=rr(19,n,e,i),t.elementType=f0,t.lanes=s,t;case Ly:return ju(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case By:o=10;break e;case Fy:o=9;break e;case sp:o=11;break e;case op:o=14;break e;case bi:o=16,r=null;break e}throw Error(me(130,t==null?t:typeof t,""))}return e=rr(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function gs(t,e,n,r){return t=rr(7,t,r,e),t.lanes=n,t}function ju(t,e,n,r){return t=rr(22,t,r,e),t.elementType=Ly,t.lanes=n,t.stateNode={isHidden:!1},t}function yh(t,e,n){return t=rr(6,t,null,e),t.lanes=n,t}function vh(t,e,n){return e=rr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function X4(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eh(0),this.expirationTimes=eh(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eh(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function zp(t,e,n,r,i,s,o,a,f){return t=new X4(t,e,n,a,f),e===1?(e=1,s===!0&&(e|=8)):e=0,s=rr(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Tp(s),t}function Q4(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:eo,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function k3(t){if(!t)return Qi;t=t._reactInternals;e:{if(Os(t)!==t||t.tag!==1)throw Error(me(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Un(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(me(171))}if(t.tag===1){var n=t.type;if(Un(n))return kv(t,n,e)}return e}function R3(t,e,n,r,i,s,o,a,f){return t=zp(n,r,!0,t,i,s,o,a,f),t.context=k3(null),n=t.current,r=In(),i=zi(n),s=ii(r,i),s.callback=e??null,Ui(n,s,i),t.current.lanes=i,Dl(t,i,r),Vn(t,r),t}function Wu(t,e,n,r){var i=e.current,s=In(),o=zi(i);return n=k3(n),e.context===null?e.context=n:e.pendingContext=n,e=ii(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Ui(i,e,o),t!==null&&(Tr(t,i,o,s),ZA(t,i,o)),o}function Bc(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function S2(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function jp(t,e){S2(t,e),(t=t.alternate)&&S2(t,e)}function Y4(){return null}var I3=typeof reportError=="function"?reportError:function(t){console.error(t)};function Wp(t){this._internalRoot=t}$u.prototype.render=Wp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(me(409));Wu(t,e,null,null)};$u.prototype.unmount=Wp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Es(function(){Wu(null,t,null,null)}),e[oi]=null}};function $u(t){this._internalRoot=t}$u.prototype.unstable_scheduleHydration=function(t){if(t){var e=lv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ci.length&&e!==0&&e<Ci[n].priority;n++);Ci.splice(n,0,t),n===0&&cv(t)}};function $p(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Hu(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function C2(){}function K4(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var p=Bc(o);s.call(p)}}var o=R3(e,r,t,0,null,!1,!1,"",C2);return t._reactRootContainer=o,t[oi]=o.current,gl(t.nodeType===8?t.parentNode:t),Es(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var p=Bc(f);a.call(p)}}var f=zp(t,0,!1,null,null,!1,!1,"",C2);return t._reactRootContainer=f,t[oi]=f.current,gl(t.nodeType===8?t.parentNode:t),Es(function(){Wu(e,f,n,r)}),f}function Xu(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var f=Bc(o);a.call(f)}}Wu(e,o,t,i)}else o=K4(n,e,t,i,r);return Bc(o)}ov=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Da(e.pendingLanes);n!==0&&(Ap(e,n|1),Vn(e,Wt()),!(ut&6)&&(Fo=Wt()+500,qi()))}break;case 13:Es(function(){var r=ai(t,1);if(r!==null){var i=In();Tr(r,t,1,i)}}),jp(t,1)}};cp=function(t){if(t.tag===13){var e=ai(t,134217728);if(e!==null){var n=In();Tr(e,t,134217728,n)}jp(t,134217728)}};av=function(t){if(t.tag===13){var e=zi(t),n=ai(t,e);if(n!==null){var r=In();Tr(n,t,e,r)}jp(t,e)}};lv=function(){return mt};Av=function(t,e){var n=mt;try{return mt=t,e()}finally{mt=n}};b0=function(t,e,n){switch(e){case"input":if(p0(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Bu(r);if(!i)throw Error(me(90));Vy(r),p0(r,i)}}}break;case"textarea":jy(t,n);break;case"select":e=n.value,e!=null&&wo(t,!!n.multiple,e,!1)}};Ky=Fp;Zy=Es;var Z4={usingClientEntryPoint:!1,Events:[Fl,so,Bu,Qy,Yy,Fp]},Sa={findFiberByHostInstance:us,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},q4={bundleType:Sa.bundleType,version:Sa.version,rendererPackageName:Sa.rendererPackageName,rendererConfig:Sa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ui.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Jy(t),t===null?null:t.stateNode},findFiberByHostInstance:Sa.findFiberByHostInstance||Y4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var TA=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!TA.isDisabled&&TA.supportsFiber)try{Mu=TA.inject(q4),Ur=TA}catch{}}Zn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z4;Zn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!$p(e))throw Error(me(200));return Q4(t,e,null,n)};Zn.createRoot=function(t,e){if(!$p(t))throw Error(me(299));var n=!1,r="",i=I3;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=zp(t,1,!1,null,null,n,!1,r,i),t[oi]=e.current,gl(t.nodeType===8?t.parentNode:t),new Wp(e)};Zn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(me(188)):(t=Object.keys(t).join(","),Error(me(268,t)));return t=Jy(e),t=t===null?null:t.stateNode,t};Zn.flushSync=function(t){return Es(t)};Zn.hydrate=function(t,e,n){if(!Hu(e))throw Error(me(200));return Xu(null,t,e,!0,n)};Zn.hydrateRoot=function(t,e,n){if(!$p(t))throw Error(me(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=I3;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=R3(e,null,t,1,n??null,i,!1,s,o),t[oi]=e.current,gl(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new $u(e)};Zn.render=function(t,e,n){if(!Hu(e))throw Error(me(200));return Xu(null,t,e,!1,n)};Zn.unmountComponentAtNode=function(t){if(!Hu(t))throw Error(me(40));return t._reactRootContainer?(Es(function(){Xu(null,null,t,!1,function(){t._reactRootContainer=null,t[oi]=null})}),!0):!1};Zn.unstable_batchedUpdates=Fp;Zn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Hu(n))throw Error(me(200));if(t==null||t._reactInternals===void 0)throw Error(me(38));return Xu(t,e,n,!1,r)};Zn.version="18.3.1-next-f1338f8080-20240426";function M3(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(M3)}catch(t){console.error(t)}}M3(),My.exports=Zn;var Hp=My.exports,N3,P2=Hp;N3=P2.createRoot,P2.hydrateRoot;function Fc(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Xp=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),k2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);k2&&parseFloat(k2[1]);const EA=globalThis,Xs=globalThis.process||{},G4=globalThis.navigator||{};function O3(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const n=typeof navigator<"u"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function Ds(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||O3()}function J4(t){return Ds()?O3()?"Electron":(G4.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const D3="4.1.0";function eC(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class tC{constructor(e,n,r="sessionStorage"){this.storage=eC(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function nC(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function rC(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Lc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Lc||(Lc={}));const iC=10;function R2(t){return typeof t!="string"?t:(t=t.toUpperCase(),Lc[t]||Lc.WHITE)}function sC(t,e,n){return!Ds&&typeof t=="string"&&(e&&(t=`\x1B[${R2(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${R2(n)+iC}m${t}\x1B[49m`)),t}function oC(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function Qp(t,e){if(!t)throw new Error("Assertion failed")}function Qs(){var e,n,r;let t;if(Ds()&&EA.performance)t=(n=(e=EA==null?void 0:EA.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Xs){const i=(r=Xs==null?void 0:Xs.hrtime)==null?void 0:r.call(Xs);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Ys={debug:Ds()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},aC={enabled:!0,level:0};function Ks(){}const I2={},M2={once:!0};class Ul{constructor({id:e}={id:""}){this.VERSION=D3,this._startTs=Qs(),this._deltaTs=Qs(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new tC(`__probe-${this.id}__`,aC),this.timeStamp(`${this.id} started`),oC(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Qs()-this._startTs).toPrecision(10))}getDelta(){return Number((Qs()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Ys.warn,arguments,M2)}error(e){return this._getLogFunction(0,e,Ys.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Ys.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Ys.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Ys.debug||Ys.info,arguments,M2)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Ks,r&&[r],{tag:AC(n)}):Ks}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Ks)}group(e,n,r={collapsed:!1}){const i=N2({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ks)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=B3(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=N2({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,Qp(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Qs();const o=s.tag||s.message;if(s.once&&o)if(!I2[o])I2[o]=Qs();else return Ks;return n=lC(this.id,s.message,s),r.bind(console,n,...s.args)}return Ks}}Ul.VERSION=D3;function B3(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Qp(Number.isFinite(e)&&e>=0),e}function N2(t){const{logLevel:e,message:n}=t;t.logLevel=B3(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Qp(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function lC(t,e,n){if(typeof e=="string"){const r=n.time?rC(nC(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=sC(e,n.color,n.background)}return e}function AC(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const wh="4.3.2",cC=wh[0]>="0"&&wh[0]<="9"?`v${wh}`:"";function uC(){const t=new Ul({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=cC,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const fC=uC();function hC(t,e){return F3(t||{},e)}function F3(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=F3(r[i]||{},e[i],n+1):r[i]=e[i];return r}const dC="latest";function pC(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const gC=pC();function Yi(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const ms=typeof process!="object"||String(process)!=="[object process]"||process.browser,mC=typeof window<"u"&&typeof window.orientation<"u",O2=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);O2&&parseFloat(O2[1]);class _C{constructor(e,n){M(this,"name");M(this,"workerThread");M(this,"isRunning",!0);M(this,"result");M(this,"_resolve",()=>{});M(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Yi(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Yi(this.isRunning),this.isRunning=!1,this._reject(e)}}class bh{terminate(){}}const xh=new Map;function yC(t){Yi(t.source&&!t.url||!t.source&&t.url);let e=xh.get(t.source||t.url);return e||(t.url&&(e=vC(t.url),xh.set(t.url,e)),t.source&&(e=L3(t.source),xh.set(t.source,e))),Yi(e),e}function vC(t){if(!t.startsWith("http"))return t;const e=wC(t);return L3(e)}function L3(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function wC(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function U3(t,e=!0,n){const r=n||new Set;if(t){if(D2(t))r.add(t);else if(D2(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)U3(t[i],e,r)}}return n===void 0?Array.from(r):[]}function D2(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Th=()=>{};class td{constructor(e){M(this,"name");M(this,"source");M(this,"url");M(this,"terminated",!1);M(this,"worker");M(this,"onMessage");M(this,"onError");M(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Yi(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Th,this.onError=s=>console.log(s),this.worker=ms?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&ms||typeof bh<"u"&&!ms}destroy(){this.onMessage=Th,this.onError=Th,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||U3(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=yC({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new bh(r,{eval:!1})}else if(this.source)e=new bh(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class bC{constructor(e){M(this,"name","unnamed");M(this,"source");M(this,"url");M(this,"maxConcurrency",1);M(this,"maxMobileConcurrency",1);M(this,"onDebug",()=>{});M(this,"reuseWorkers",!0);M(this,"props",{});M(this,"jobQueue",[]);M(this,"idleQueue",[]);M(this,"count",0);M(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return td.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new _C(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!ms||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new td({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return mC?this.maxMobileConcurrency:this.maxConcurrency}}const xC={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Ei=class Ei{constructor(e){M(this,"props");M(this,"workerPools",new Map);this.props={...xC},this.setProps(e),this.workerPools=new Map}static isSupported(){return td.isSupported()}static getWorkerFarm(e={}){return Ei._workerFarm=Ei._workerFarm||new Ei({}),Ei._workerFarm.setProps(e),Ei._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new bC({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};M(Ei,"_workerFarm");let Uc=Ei;function TC(t,e={}){const n=e[t.id]||{},r=ms?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(ms?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=dC);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return Yi(i),i}function EC(t,e=gC){Yi(t,"no worker provided");const n=t.version;return!(!e||!n)}function SC(t,e){return!Uc.isSupported()||!ms&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function CC(t,e,n,r,i){const s=t.id,o=TC(t,n),f=Uc.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const p=await f.startJob("process-on-worker",PC.bind(null,i));return p.postMessage("process",{input:e,options:n,context:r}),await(await p.result).result}async function PC(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const f=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:f})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function kC(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function RC(...t){return IC(t)}function IC(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function MC(t){const e=[];for await(const n of t)e.push(n);return RC(...e)}function B2(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class F2{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=B2(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(B2()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Qu{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof F2?i=e:i=new F2(n,r),this.stats[n]=i),i}}let NC="";const L2={};function OC(t){for(const e in L2)if(t.startsWith(e)){const n=L2[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${NC}${t}`),t}function DC(t){return t&&typeof t=="object"&&t.isBuffer}function V3(t){if(DC(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function z3(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function BC(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const FC=t=>typeof t=="boolean",Ga=t=>typeof t=="function",Vl=t=>t!==null&&typeof t=="object",U2=t=>Vl(t)&&t.constructor==={}.constructor,LC=t=>!!t&&typeof t[Symbol.iterator]=="function",UC=t=>t&&typeof t[Symbol.asyncIterator]=="function",Bs=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Fs=t=>typeof Blob<"u"&&t instanceof Blob,VC=t=>t&&typeof t=="object"&&t.isBuffer,zC=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Vl(t)&&Ga(t.tee)&&Ga(t.cancel)&&Ga(t.getReader),jC=t=>Vl(t)&&Ga(t.read)&&Ga(t.pipe)&&FC(t.readable),j3=t=>zC(t)||jC(t);class WC extends Error{constructor(n,r){super(n);M(this,"reason");M(this,"url");M(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const $C=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,HC=/^([-\w.]+\/[-\w.+]+)/;function V2(t,e){return t.toLowerCase()===e.toLowerCase()}function XC(t){const e=HC.exec(t);return e?e[1]:t}function z2(t){const e=$C.exec(t);return e?e[1]:""}const W3=/\?.*/;function QC(t){const e=t.match(W3);return e&&e[0]}function Yp(t){return t.replace(W3,"")}function YC(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Yu(t){return Bs(t)?t.url:Fs(t)?t.name||"":typeof t=="string"?t:""}function Kp(t){if(Bs(t)){const e=t,n=e.headers.get("content-type")||"",r=Yp(e.url);return XC(n)||z2(r)}return Fs(t)?t.type||"":typeof t=="string"?z2(t):""}function KC(t){return Bs(t)?t.headers["content-length"]||-1:Fs(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function $3(t){if(Bs(t))return t;const e={},n=KC(t);n>=0&&(e["content-length"]=String(n));const r=Yu(t),i=Kp(t);i&&(e["content-type"]=i);const s=await GC(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function ZC(t){if(!t.ok)throw await qC(t)}async function qC(t){const e=YC(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new WC(n,r)}async function GC(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${JC(n)}`}return null}function JC(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function eP(t){return!tP(t)&&!nP(t)}function tP(t){return t.startsWith("http:")||t.startsWith("https:")}function nP(t){return t.startsWith("data:")}async function j2(t,e){var n,r;if(typeof t=="string"){const i=OC(t);return eP(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await $3(t)}const W2=new Ul({id:"loaders.gl"});class rP{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class iP{constructor(){M(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const H3={fetch:null,mimeType:void 0,nothrow:!1,log:new iP,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Xp,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},sP={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function X3(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function Q3(){const t=X3();return t.globalOptions=t.globalOptions||{...H3},t.globalOptions}function oP(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],aP(t,n),AP(e,t,r)}function aP(t,e){$2(t,null,H3,sP,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};$2(r,n.id,i,s,e)}}function $2(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const f=!e&&Vl(t[a]),p=a==="baseUri"&&!e,m=a==="workerUrl"&&e;if(!(a in n)&&!p&&!m){if(a in r)W2.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!f){const v=lP(a,i);W2.warn(`${s} loader option '${o}${a}' not recognized. ${v}`)()}}}}function lP(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function AP(t,e,n){const i={...t.options||{}};return cP(i,n),i.log===null&&(i.log=new rP),H2(i,Q3()),H2(i,e),i}function H2(t,e){for(const n in e)if(n in e){const r=e[n];U2(r)&&U2(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function cP(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Zp(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function qp(t){Fc(t,"null loader"),Fc(Zp(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Y3=()=>{const t=X3();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function uP(t){const e=Y3();t=Array.isArray(t)?t:[t];for(const n of t){const r=qp(n);e.find(i=>r===i)||e.unshift(r)}}function fP(){return Y3()}const hP=/\.([^.]+)$/;async function dP(t,e=[],n,r){if(!K3(t))return null;let i=X2(t,e,{...n,nothrow:!0},r);if(i)return i;if(Fs(t)&&(t=await t.slice(0,10).arrayBuffer(),i=X2(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(Z3(t));return i}function X2(t,e=[],n,r){if(!K3(t))return null;if(e&&!Array.isArray(e))return qp(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...fP()),gP(i);const s=pP(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(Z3(t));return s}function pP(t,e,n,r){const i=Yu(t),s=Kp(t),o=Yp(i)||(r==null?void 0:r.url);let a=null,f="";return n!=null&&n.mimeType&&(a=Eh(e,n==null?void 0:n.mimeType),f=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||mP(e,o),f=f||(a?`matched url ${o}`:""),a=a||Eh(e,s),f=f||(a?`matched MIME type ${s}`:""),a=a||yP(e,t),f=f||(a?`matched initial data ${q3(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||Eh(e,n==null?void 0:n.fallbackMimeType),f=f||(a?`matched fallback MIME type ${s}`:"")),f&&fC.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${f}.`),a}function K3(t){return!(t instanceof Response&&t.status===204)}function Z3(t){const e=Yu(t),n=Kp(t);let r="No valid loader found (";r+=e?`${z3(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?q3(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function gP(t){for(const e of t)qp(e)}function mP(t,e){const n=e&&hP.exec(e),r=n&&n[1];return r?_P(t,r):null}function _P(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Eh(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>V2(e,i))||V2(e,`application/x.${r.id}`))return r;return null}function yP(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(vP(e,n))return n}else if(ArrayBuffer.isView(e)){if(Q2(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Q2(e,0,n))return n;return null}function vP(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function Q2(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>wP(t,e,n,i))}function wP(t,e,n,r){if(r instanceof ArrayBuffer)return kC(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=nd(t,e,r.length);return r===i;default:return!1}}function q3(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?nd(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?nd(t,0,e):""}function nd(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const bP=256*1024;function*xP(t,e){const n=(e==null?void 0:e.chunkSize)||bP;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const TP=256*1024;function*EP(t,e={}){const{chunkSize:n=TP}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const SP=1024*1024;async function*CP(t,e){const n=(e==null?void 0:e.chunkSize)||SP;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function Y2(t,e){return Xp?PP(t,e):kP(t)}async function*PP(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield V3(o)}}catch{n.releaseLock()}}async function*kP(t,e){for await(const n of t)yield V3(n)}function RP(t,e){if(typeof t=="string")return xP(t,e);if(t instanceof ArrayBuffer)return EP(t,e);if(Fs(t))return CP(t,e);if(j3(t))return Y2(t,e);if(Bs(t))return Y2(t.body,e);throw new Error("makeIterator")}const G3="Cannot convert supplied data type";function IP(t,e,n){if(e.text&&typeof t=="string")return t;if(VC(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(G3)}async function MP(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return IP(t,e);if(Fs(t)&&(t=await $3(t)),Bs(t)){const i=t;return await ZC(i),e.binary?await i.arrayBuffer():await i.text()}if(j3(t)&&(t=RP(t,n)),LC(t)||UC(t))return MC(t);throw new Error(G3)}function J3(t,e){const n=Q3(),r=t||n;return typeof r.fetch=="function"?r.fetch:Vl(r.fetch)?i=>j2(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:j2}function NP(t,e,n){if(n)return n;const r={fetch:J3(e,t),...t};if(r.url){const i=Yp(r.url);r.baseUrl=i,r.queryString=QC(r.url),r.filename=z3(i),r.baseUrl=BC(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function OP(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Vc(t,e,n,r){e&&!Array.isArray(e)&&!Zp(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=Yu(t),o=OP(e,r),a=await dP(t,o,n);return a?(n=oP(n,a,o,i),r=NP({url:i,_parse:Vc,loaders:o},n,r||null),await DP(a,t,n,r)):null}async function DP(t,e,n,r){if(EC(t),n=hC(t.options,n),Bs(e)){const s=e,{ok:o,redirected:a,status:f,statusText:p,type:m,url:v}=s,w=Object.fromEntries(s.headers.entries());r.response={headers:w,ok:o,redirected:a,status:f,statusText:p,type:m,url:v}}e=await MP(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(SC(t,n))return await CC(t,e,n,r,Vc);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw Yi(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function zc(t,e,n,r){let i,s;!Array.isArray(e)&&!Zp(e)?(i=[],s=e):(i=e,s=n);const o=J3(s);let a=t;return typeof t=="string"&&(a=await o(t)),Fs(t)&&(a=await o(t)),Array.isArray(i)?await Vc(a,i,s):await Vc(a,i,s)}const BP="4.3.2";var yy;const FP=(yy=globalThis.loaders)==null?void 0:yy.parseImageNode,rd=typeof Image<"u",id=typeof ImageBitmap<"u",LP=!!FP,sd=Xp?!0:LP;function UP(t){switch(t){case"auto":return id||rd||sd;case"imagebitmap":return id;case"image":return rd;case"data":return sd;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function VP(){if(id)return"imagebitmap";if(rd)return"image";if(sd)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function zP(t){const e=WP(t);if(!e)throw new Error("Not an image");return e}function jP(t){switch(zP(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function WP(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const $P=/^data:image\/svg\+xml/,HP=/\.svg((\?|#).*)?$/;function Gp(t){return t&&($P.test(t)||HP.test(t))}function XP(t,e){if(Gp(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return ew(t,e)}function ew(t,e){if(Gp(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function tw(t,e,n){const r=XP(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await QP(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function QP(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const YP={};let K2=!0;async function KP(t,e,n){let r;Gp(n)?r=await tw(t,e,n):r=ew(t,n);const i=e&&e.imagebitmap;return await ZP(r,i)}async function ZP(t,e=null){if((qP(e)||!K2)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),K2=!1}return await createImageBitmap(t)}function qP(t){for(const e in t||YP)return!1;return!0}function GP(t){return!nk(t,"ftyp",4)||!(t[8]&96)?null:JP(t)}function JP(t){switch(ek(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function ek(t,e,n){return String.fromCharCode(...t.slice(e,n))}function tk(t){return[...t].map(e=>e.charCodeAt(0))}function nk(t,e,n=0){const r=tk(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Br=!1,Ja=!0;function nw(t){const e=zl(t);return ik(e)||ak(e)||sk(e)||ok(e)||rk(e)}function rk(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=GP(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function ik(t){const e=zl(t);return e.byteLength>=24&&e.getUint32(0,Br)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Br),height:e.getUint32(20,Br)}:null}function sk(t){const e=zl(t);return e.byteLength>=10&&e.getUint32(0,Br)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ja),height:e.getUint16(8,Ja)}:null}function ok(t){const e=zl(t);return e.byteLength>=14&&e.getUint16(0,Br)===16973&&e.getUint32(2,Ja)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ja),height:e.getUint32(22,Ja)}:null}function ak(t){const e=zl(t);if(!(e.byteLength>=3&&e.getUint16(0,Br)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=lk();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Br);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Br),width:e.getUint16(s+7,Br)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Br)}return null}function lk(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function zl(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function Ak(t,e){var i;const{mimeType:n}=nw(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Fc(r),await r(t,n)}async function ck(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=uk(i);let a;switch(o){case"imagebitmap":a=await KP(t,e,s);break;case"image":a=await tw(t,e,s);break;case"data":a=await Ak(t);break;default:Fc(!1)}return i==="data"&&(a=jP(a)),a}function uk(t){switch(t){case"auto":case"data":return VP();default:return UP(t),t}}const fk=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],hk=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],dk={image:{type:"auto",decode:!0}},pk={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:BP,mimeTypes:hk,extensions:fk,parse:ck,tests:[t=>!!nw(new DataView(t))],options:dk},ot=new Ul({id:"deck"});let od={};function gk(t){od=t}function xn(t,e,n,r){ot.level>0&&od[t]&&od[t].call(null,e,n,r)}function mk(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const _k={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:mk,parseTextSync:JSON.parse};function yk(){const t="9.1.5",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ot.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ot,_registerLoggers:gk},uP([_k,[pk,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const vk=yk();function Jp(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Sh={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function wk(t){const e={};for(const[n,r]of Object.entries(t))e[n]=bk(r);return e}function bk(t){let e=Z2(t);if(e!=="object")return{value:t,...Sh[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Sh[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Z2(t.value),{...t,...Sh[e],type:e}):{type:"object",value:null};throw new Error("props")}function Z2(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const xk=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,Tk=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,Ek={vertex:xk,fragment:Tk},q2=/void\s+main\s*\([^)]*\)\s*\{\n?/,G2=/}\n?[^{}]*$/,Ch=[],rc="__LUMA_INJECT_DECLARATIONS__";function Sk(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=Ck(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function Ck(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function jc(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((f,p)=>f.order-p.order),Ch.length=o.length;for(let f=0,p=o.length;f<p;++f)Ch[f]=o[f].injection;const a=`${Ch.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(rc,a));break;case"vs:#main-start":i&&(t=t.replace(q2,f=>f+a));break;case"vs:#main-end":i&&(t=t.replace(G2,f=>a+f));break;case"fs:#decl":i||(t=t.replace(rc,a));break;case"fs:#main-start":i||(t=t.replace(q2,f=>f+a));break;case"fs:#main-end":i||(t=t.replace(G2,f=>a+f));break;default:t=t.replace(s,f=>f+a)}}return t=t.replace(rc,""),r&&(t=t.replace(/\}\s*$/,s=>s+Ek[e])),t}function Wc(t){t.map(e=>Pk(e))}function Pk(t){if(t.instance)return;Wc(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:r={}}=t,i={normalizedInjections:Sk(r),parsedDeprecations:kk(n)};e&&(i.propValidators=wk(e)),t.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[a,f])=>{const p=f==null?void 0:f.value;return p&&(o[a]=p),o},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function rw(t,e,n){var r;(r=t.deprecations)==null||r.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function kk(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function eg(t){Wc(t);const e={},n={};iw({modules:t,level:0,moduleMap:e,moduleDepth:n});const r=Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i]);return Wc(r),r}function iw(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&iw({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function Rk(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function Ik(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=J2(t,Mk),t;case"fragment":return t=J2(t,Nk),t;default:throw new Error(e)}}const sw=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Mk=[...sw,[ad("attribute"),"in $1"],[ad("varying"),"out $1"]],Nk=[...sw,[ad("varying"),"in $1"]];function J2(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function ad(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function ow(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function aw(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),f=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=f;break;case"fs":e.fragment[a]=f;break;default:throw new Error(s)}}return e}function Ok(t,e){return{name:Dk(t,e),language:"glsl",version:Bk(t)}}function Dk(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function Bk(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const lw=`

${rc}
`,Fk=`precision highp float;
`;function Lk(t){const e=eg(t.modules||[]);return{source:Vk(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:Aw(e)}}function Uk(t){const{vs:e,fs:n}=t,r=eg(t.modules||[]);return{vs:e_(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:e_(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:Aw(r)}}function Vk(t,e){var I;const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;Jp(typeof n=="string","shader source must be a string");const f=n;let p="";const m=aw(s),v={},w={},T={};for(const U in o){const R=typeof o[U]=="string"?{injection:o[U],order:0}:o[U],P=/^(v|f)s:(#)?([\w-]+)$/.exec(U);if(P){const C=P[2],D=P[3];C?D==="decl"?w[U]=[R]:T[U]=[R]:v[U]=[R]}else T[U]=[R]}const E=i;for(const U of E){a&&rw(U,f,a);const R=cw(U,"wgsl");p+=R;const P=((I=U.injections)==null?void 0:I[r])||{};for(const C in P){const D=/^(v|f)s:#([\w-]+)$/.exec(C);if(D){const q=D[2]==="decl"?w:T;q[C]=q[C]||[],q[C].push(P[C])}else v[C]=v[C]||[],v[C].push(P[C])}}return p+=lw,p=jc(p,r,w),p+=ow(m[r],v),p+=f,p=jc(p,r,T),p}function e_(t,e){var fe;const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:f=[],inject:p={},prologue:m=!0,log:v}=e;Jp(typeof r=="string","shader source must be a string");const w=s==="glsl"?Ok(r).version:-1,T=t.shaderLanguageVersion,E=w===100?"#version 100":"#version 300 es",U=r.split(`
`).slice(1).join(`
`),R={};o.forEach(ae=>{Object.assign(R,ae.defines)}),Object.assign(R,a);let P="";switch(s){case"wgsl":break;case"glsl":P=m?`${E}

// ----- PROLOGUE -------------------------
${zk({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${Rk(t)}
${i==="fragment"?Fk:""}

// ----- APPLICATION DEFINES -------------------------

${jk(R)}

`:`${E}
`;break}const C=aw(f),D={},$={},q={};for(const ae in p){const he=typeof p[ae]=="string"?{injection:p[ae],order:0}:p[ae],ye=/^(v|f)s:(#)?([\w-]+)$/.exec(ae);if(ye){const ke=ye[2],Le=ye[3];ke?Le==="decl"?$[ae]=[he]:q[ae]=[he]:D[ae]=[he]}else q[ae]=[he]}for(const ae of o){v&&rw(ae,U,v);const he=cw(ae,i);P+=he;const ye=((fe=ae.instance)==null?void 0:fe.normalizedInjections[i])||{};for(const ke in ye){const Le=/^(v|f)s:#([\w-]+)$/.exec(ke);if(Le){const Ae=Le[2]==="decl"?$:q;Ae[ke]=Ae[ke]||[],Ae[ke].push(ye[ke])}else D[ke]=D[ke]||[],D[ke].push(ye[ke])}}return P+="// ----- MAIN SHADER SOURCE -------------------------",P+=lw,P=jc(P,i,$),P+=ow(C[i],D),P+=U,P=jc(P,i,q),s==="glsl"&&w!==T&&(P=Ik(P,i)),P.trim()}function Aw(t){return function(n){var i;const r={};for(const s of t){const o=(i=s.getUniforms)==null?void 0:i.call(s,n,r);Object.assign(r,o)}return r}}function zk(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function jk(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function cw(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:Jp(!1)}if(!t.name)throw new Error("Shader module must have a name");const r=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${n}
`,i}const Wk=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,$k=/^\s*\#\s*endif\s*$/;function Hk(t,e){var o;const n=t.split(`
`),r=[];let i=!0,s=null;for(const a of n){const f=a.match(Wk),p=a.match($k);f?(s=f[1],i=!!((o=e==null?void 0:e.defines)!=null&&o[s])):p?i=!0:i&&r.push(a)}return r.join(`
`)}const cs=class cs{constructor(){M(this,"_hookFunctions",[]);M(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return cs.defaultShaderAssembler=cs.defaultShaderAssembler||new cs,cs.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=Lk({...e,source:e.source,modules:n,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?Hk(i):i,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),r=this._hookFunctions;return{...Uk({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:r}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],f=a.name;n[i++]=a,r[f]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],f=a.name;r[f]||(n[i++]=a,r[f]=!0)}return n.length=i,Wc(n),n}};M(cs,"defaultShaderAssembler");let $c=cs;const Xk=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,Qk=`#version 300 es
${Xk}`;function Yk(t){const{input:e,inputChannels:n,output:r}={};if(!e)return Qk;if(!n)throw new Error("inputChannels");const i=Kk(n),s=Zk(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function Kk(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function Zk(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class qk{constructor(){M(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Qu({id:e})),this.stats.get(e)}}const uw=new qk,_e=new Ul({id:"luma.gl"}),Ph={};function Ku(t="id"){Ph[t]=Ph[t]||1;const e=Ph[t]++;return`${t}-${e}`}var l0;let yt=(l0=class{constructor(e,n,r){M(this,"id");M(this,"props");M(this,"userData",{});M(this,"_device");M(this,"destroyed",!1);M(this,"allocatedBytes",0);M(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=Gk(n,r);const i=this.props.id!=="undefined"?this.props.id:Ku(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},M(l0,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),l0);function Gk(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const on=class on extends yt{constructor(n,r){const i={...r};(r.usage||0)&on.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(n,i,on.defaultProps);M(this,"usage");M(this,"indexType");M(this,"updateTimestamp");M(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(n){return this.device.createBuffer({...this.props,...n})}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,on.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):r===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};M(on,"defaultProps",{...yt.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),M(on,"MAP_READ",1),M(on,"MAP_WRITE",2),M(on,"COPY_SRC",4),M(on,"COPY_DST",8),M(on,"INDEX",16),M(on,"VERTEX",32),M(on,"UNIFORM",64),M(on,"STORAGE",128),M(on,"INDIRECT",256),M(on,"QUERY_RESOLVE",512),M(on,"DEBUG_DATA_MAX_LENGTH",32);let Pt=on;function fw(t){const e=t_[t],n=Jk(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:t_[t],byteLength:n,integer:i,signed:s,normalized:r}}function Jk(t){return eR[t]}const t_={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},eR={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},yn="texture-compression-bc",_t="texture-compression-astc",Ir="texture-compression-etc2",tR="texture-compression-etc1-webgl",SA="texture-compression-pvrtc-webgl",kh="texture-compression-atc-webgl",CA="float32-renderable-webgl",Rh="float16-renderable-webgl",nR="rgb9e5ufloat-renderable-webgl",Ih="snorm8-renderable-webgl",Ca="norm16-renderable-webgl",Mh="snorm16-renderable-webgl",PA="float32-filterable",n_="float16-filterable-webgl";function hw(t){const e=rR[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const rR={r8unorm:{},r8snorm:{render:Ih},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Ih},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Rh,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Ca},"r16snorm-webgl":{f:Mh},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Ih},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Rh,filter:n_},"rg16unorm-webgl":{render:Ca},"rg16snorm-webgl":{render:Mh},r32uint:{},r32sint:{},r32float:{render:CA,filter:PA},rgb9e5ufloat:{channels:"rgb",packed:!0,render:nR},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:CA},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Ca},"rgb16snorm-webgl":{f:Ca},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:PA},rgba16uint:{},rgba16sint:{},rgba16float:{render:Rh,filter:n_},"rgba16unorm-webgl":{render:Ca},"rgba16snorm-webgl":{render:Mh},"rgb32float-webgl":{render:CA,filter:PA},rgba32uint:{},rgba32sint:{},rgba32float:{render:CA,filter:PA},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:yn},"bc1-rgb-unorm-srgb-webgl":{f:yn},"bc1-rgba-unorm":{f:yn},"bc1-rgba-unorm-srgb":{f:yn},"bc2-rgba-unorm":{f:yn},"bc2-rgba-unorm-srgb":{f:yn},"bc3-rgba-unorm":{f:yn},"bc3-rgba-unorm-srgb":{f:yn},"bc4-r-unorm":{f:yn},"bc4-r-snorm":{f:yn},"bc5-rg-unorm":{f:yn},"bc5-rg-snorm":{f:yn},"bc6h-rgb-ufloat":{f:yn},"bc6h-rgb-float":{f:yn},"bc7-rgba-unorm":{f:yn},"bc7-rgba-unorm-srgb":{f:yn},"etc2-rgb8unorm":{f:Ir},"etc2-rgb8unorm-srgb":{f:Ir},"etc2-rgb8a1unorm":{f:Ir},"etc2-rgb8a1unorm-srgb":{f:Ir},"etc2-rgba8unorm":{f:Ir},"etc2-rgba8unorm-srgb":{f:Ir},"eac-r11unorm":{f:Ir},"eac-r11snorm":{f:Ir},"eac-rg11unorm":{f:Ir},"eac-rg11snorm":{f:Ir},"astc-4x4-unorm":{f:_t},"astc-4x4-unorm-srgb":{f:_t},"astc-5x4-unorm":{f:_t},"astc-5x4-unorm-srgb":{f:_t},"astc-5x5-unorm":{f:_t},"astc-5x5-unorm-srgb":{f:_t},"astc-6x5-unorm":{f:_t},"astc-6x5-unorm-srgb":{f:_t},"astc-6x6-unorm":{f:_t},"astc-6x6-unorm-srgb":{f:_t},"astc-8x5-unorm":{f:_t},"astc-8x5-unorm-srgb":{f:_t},"astc-8x6-unorm":{f:_t},"astc-8x6-unorm-srgb":{f:_t},"astc-8x8-unorm":{f:_t},"astc-8x8-unorm-srgb":{f:_t},"astc-10x5-unorm":{f:_t},"astc-10x5-unorm-srgb":{f:_t},"astc-10x6-unorm":{f:_t},"astc-10x6-unorm-srgb":{f:_t},"astc-10x8-unorm":{f:_t},"astc-10x8-unorm-srgb":{f:_t},"astc-10x10-unorm":{f:_t},"astc-10x10-unorm-srgb":{f:_t},"astc-12x10-unorm":{f:_t},"astc-12x10-unorm-srgb":{f:_t},"astc-12x12-unorm":{f:_t},"astc-12x12-unorm-srgb":{f:_t},"pvrtc-rgb4unorm-webgl":{f:SA},"pvrtc-rgba4unorm-webgl":{f:SA},"pvrtc-rbg2unorm-webgl":{f:SA},"pvrtc-rgba2unorm-webgl":{f:SA},"etc1-rbg-unorm-webgl":{f:tR},"atc-rgb-unorm-webgl":{f:kh},"atc-rgba-unorm-webgl":{f:kh},"atc-rgbai-unorm-webgl":{f:kh}},iR=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],sR=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function dw(t){return iR.some(e=>t.startsWith(e))}function tg(t){let e=oR(t);if(dw(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=aR(t);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const n=sR.exec(t);if(n){const[,r,i,s,o,a]=n,f=`${s}${i}`,p=fw(f),m=p.byteLength*8,v=r.length,w=[m,v>=2?m:0,v>=3?m:0,v>=4?m:0];e={format:t,attachment:e.attachment,dataType:p.dataType,components:v,channels:r,integer:p.integer,signed:p.signed,normalized:p.normalized,bitsPerChannel:w,bytesPerPixel:p.byteLength*r.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function oR(t){var s;const e=hw(t),n=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:n,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function aR(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,r,i]=n;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function lR(t){const e=hw(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=tg(t),i=t.startsWith("depth")||t.startsWith("stencil"),s=r==null?void 0:r.signed,o=r==null?void 0:r.integer,a=r==null?void 0:r.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!i&&!s&&!o&&!a),n}class AR{}class cR{constructor(e=[],n){M(this,"features");M(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){var n;return!((n=this.disabledFeatures)!=null&&n[e])&&this.features.has(e)}}const gu=class gu{constructor(e){M(this,"id");M(this,"props");M(this,"userData",{});M(this,"statsManager",uw);M(this,"timestamp",0);M(this,"_reused",!1);M(this,"_lumaData",{});this.props={...gu.defaultProps,...e},this.id=this.props.id||Ku(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const n=lR(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=r(n.create),s={format:e,create:i,render:i&&r(n.render),filter:i&&r(n.filter),blend:i&&r(n.blend),store:i&&r(n.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,n){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return dw(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&Pt.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":_e.warn("indices buffer content must be of integer type")()),n}};M(gu,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>_e.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:_e.get("debug")||void 0,debugShaders:_e.get("debug-shaders")||void 0,debugFramebuffers:!!_e.get("debug-framebuffers"),debugWebGL:!!_e.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Wi=gu;const uR=Ds()&&typeof document<"u",fR=()=>uR&&document.readyState==="complete",hR="set luma.log.level=1 (or higher) to trace rendering",r_="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Si=class Si{constructor(){M(this,"stats",uw);M(this,"log",_e);M(this,"VERSION","9.1.5");M(this,"spector");M(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw _e.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),_e.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");_e.error("This version of luma.gl has already been initialized")()}_e.log(1,`${this.VERSION} - ${hR}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,r])=>r).filter(r=>{var i;return(i=r.isSupported)==null?void 0:i.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,i,s,o;const n=this.getAdapterMap(e);return(i=(r=n.get("webgpu"))==null?void 0:r.isSupported)!=null&&i.call(r)?"webgpu":(o=(s=n.get("webgl"))==null?void 0:s.isSupported)!=null&&o.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Si.defaultProps,e)}async createDevice(e={}){var a;e={...Si.defaultProps,...e},e.waitForPageLoad&&await Si.pageLoaded;const n=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const s=(this.getAdapterMap(e.adapters)||n).get(r),o=await((a=s==null?void 0:s.create)==null?void 0:a.call(s,e));if(o)return o;throw new Error(r_)}async attachDevice(e){var o;const n=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await Si.pageLoaded,e.handle===null&&(r="unknown");const i=n.get(r),s=await((o=i==null?void 0:i.attach)==null?void 0:o.call(i,null));if(s)return s;throw new Error(r_)}enforceWebGL2(e=!0,n=[]){var s;const i=this.getAdapterMap(n).get("webgl");i||_e.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const r of e)n.set(r.type,r);return n}registerDevices(e){_e.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const r=n.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};M(Si,"defaultProps",{...Wi.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),M(Si,"pageLoaded",dR().then(()=>{_e.probe(2,"DOM is loaded")()}));let ld=Si;const Ad=new ld;function dR(){return fR()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class pR{}const mu=class mu{constructor(e){M(this,"id");M(this,"props");M(this,"canvas");M(this,"htmlCanvas");M(this,"offscreenCanvas");M(this,"type");M(this,"width",1);M(this,"height",1);M(this,"resizeObserver");M(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...mu.defaultProps,...e},e=this.props,!Ds()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=mR(e.canvas):this.canvas=e.canvas;else{const n=_R(e),r=gR((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){var e;try{const[n]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?n/r:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return yR(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(_e.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),f=Math.floor(i*o);if(this.htmlCanvas.width=a,this.htmlCanvas.height=f,this.device.gl){const[m,v]=this.getDrawingBufferSize();(m!==a||v!==f)&&(o=Math.min(m/r,v/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),_e.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};M(mu,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let cd=mu;function gR(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function mR(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function _R(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id=Ku("lumagl-auto-created-canvas"),r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function yR(t,e,n,r,i){const s=t,o=i_(s[0],e,n);let a=s_(s[1],e,r,i),f=i_(s[0]+1,e,n);const p=f===n-1?f:f-1;f=s_(s[1]+1,e,r,i);let m;return i?(f=f===0?f:f+1,m=a,a=f):m=f===r-1?f:f-1,{x:o,y:a,width:Math.max(p-o+1,1),height:Math.max(m-a+1,1)}}function i_(t,e,n){return Math.min(Math.round(t*e),n-1)}function s_(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const an=class an extends yt{constructor(n,r){r=an.normalizeProps(n,r);super(n,r,an.defaultProps);M(this,"dimension");M(this,"format");M(this,"width");M(this,"height");M(this,"depth");M(this,"mipLevels");M(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=an.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?an.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(n){return this.device.createTexture({...this.props,...n})}static isExternalImage(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}static getExternalImageSize(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(n){const r=n==null?void 0:n.data;return ArrayBuffer.isView(r)}static getTextureDataSize(n){if(!n||ArrayBuffer.isView(n))return null;if(Array.isArray(n))return an.getTextureDataSize(n[0]);if(an.isExternalImage(n))return an.getExternalImageSize(n);if(n&&typeof n=="object"&&n.constructor===Object){const i=Object.values(n)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(n,r){let i;return ArrayBuffer.isView(n)?i=[{data:n,width:r.width,height:r.height}]:Array.isArray(n)?i=n:i=[n],i}static getMipLevelCount(n,r){return Math.floor(Math.log2(Math.max(n,r)))+1}static getCubeFaceDepth(n){switch(n){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(n)}}static normalizeProps(n,r){var f,p;const i={...r},s=((p=(f=n==null?void 0:n.props)==null?void 0:f._resourceDefaults)==null?void 0:p.texture)||{};Object.assign(i,s);const{width:o,height:a}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof a=="number"&&(i.height=Math.max(1,Math.ceil(a))),i}};M(an,"COPY_SRC",1),M(an,"COPY_DST",2),M(an,"TEXTURE",4),M(an,"STORAGE",8),M(an,"RENDER_ATTACHMENT",16),M(an,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),M(an,"defaultProps",{...yt.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),M(an,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let Ut=an;const _u=class _u extends yt{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,_u.defaultProps)}};M(_u,"defaultProps",{...yt.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Hc=_u;function vR(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=pw(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const f=s[o++];r+=o_(f,i,f.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=o_(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function o_(t,e,n,r){if(r!=null&&r.inlineSource){const s=wR(e,n),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${o}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function wR(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=pw(s,e,n))}return r}function pw(t,e,n){const r=n!=null&&n.html?xR(t):t;return`${bR(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function bR(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function xR(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const yu=class yu extends yt{constructor(n,r){r={...r,debugShaders:r.debugShaders||n.props.debugShaders||"errors"};super(n,{id:TR(r),...r},yu.defaultProps);M(this,"stage");M(this,"source");M(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const n=this.props.debugShaders;switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();n==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var p;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=gw(this.source),i=`${this.stage} ${r}`;let s=vR(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),(p=document.getElementsByClassName("luma-compiler-log-error")[0])==null||p.scrollIntoView(),a.onclick=()=>{const m=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(m)}}};M(yu,"defaultProps",{...yt.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Xc=yu;function TR(t){return gw(t.source)||t.id||Ku(`unnamed ${t.stage}-shader`)}function gw(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}const ol=class ol extends yt{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=ol.normalizeProps(e,n),super(e,n,ol.defaultProps)}static normalizeProps(e,n){var s,o;const r=((o=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:o.sampler)||{};return{...n,...r}}};M(ol,"defaultProps",{...yt.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Qc=ol;const vu=class vu extends yt{constructor(n,r={}){super(n,r,vu.defaultProps);M(this,"width");M(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(n){const r=this.colorAttachments.map(s=>s.texture.clone(n)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(n);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(_e.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof Ut?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof Ut?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:Ut.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(n){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Ut.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};M(vu,"defaultProps",{...yt.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Yc=vu;const wu=class wu extends yt{constructor(n,r){super(n,r,wu.defaultProps);M(this,"shaderLayout");M(this,"bufferLayout");M(this,"linkStatus","pending");M(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};M(wu,"defaultProps",{...yt.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Lo=wu;const gr=class gr extends yt{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=gr.normalizeProps(e,n),super(e,n,gr.defaultProps)}static normalizeProps(e,n){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...n}}};M(gr,"defaultClearColor",[0,0,0,1]),M(gr,"defaultClearDepth",1),M(gr,"defaultClearStencil",0),M(gr,"defaultProps",{...yt.defaultProps,framebuffer:null,parameters:void 0,clearColor:gr.defaultClearColor,clearColors:void 0,clearDepth:gr.defaultClearDepth,clearStencil:gr.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let ud=gr;const bu=class bu extends yt{constructor(n,r){super(n,r,bu.defaultProps);M(this,"hash","");M(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};M(bu,"defaultProps",{...yt.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Kc=bu;const xu=class xu extends yt{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,xu.defaultProps)}};M(xu,"defaultProps",{...yt.defaultProps,measureExecutionTime:void 0});let fd=xu;const Tu=class Tu extends yt{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,Tu.defaultProps)}};M(Tu,"defaultProps",{...yt.defaultProps});let hd=Tu;function ER(t){const[e,n]=CR[t],r=e==="i32"||e==="u32",i=e!=="u32",s=PR[e]*n,o=SR(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function SR(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const CR={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},PR={f32:4,f16:2,i32:4,u32:4};function mw(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=fw(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function _w(t,e){const n={};for(const r of t.attributes){const i=RR(t,e,r.name);i&&(n[r.name]=i)}return n}function kR(t,e,n=16){const r=_w(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function RR(t,e,n){const r=IR(t,n),i=MR(e,n);if(!r)return null;const s=ER(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,a=mw(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function IR(t,e){const n=t.attributes.find(r=>r.name===e);return n||_e.warn(`shader layout attribute "${e}" not present in shader`),n||null}function MR(t,e){NR(t);let n=OR(t,e);return n||(n=DR(t,e),n)?n:(_e.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function NR(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&_e.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function OR(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function DR(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=mw(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const Eu=class Eu extends yt{constructor(n,r){super(n,r,Eu.defaultProps);M(this,"maxVertexAttributes");M(this,"attributeInfos");M(this,"indexBuffer",null);M(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=r.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=kR(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){this.device.reportError(new Error("constant attributes not supported"))}};M(Eu,"defaultProps",{...yt.defaultProps,renderPipeline:null});let dd=Eu;const Su=class Su extends yt{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Su.defaultProps)}};M(Su,"defaultProps",{...yt.defaultProps,layout:void 0,buffers:{}});let pd=Su;const Cu=class Cu extends yt{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Cu.defaultProps)}};M(Cu,"defaultProps",{...yt.defaultProps,type:void 0,count:void 0});let gd=Cu;const BR={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function FR(t){return BR[t]}function LR(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let kA;function yw(t){return(!kA||kA.byteLength<t)&&(kA=new ArrayBuffer(t)),kA}function UR(t,e){const n=yw(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function VR(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Zc(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":VR(t)}const a_=1024;class zR{constructor(e){M(this,"layout",{});M(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=FR(s),{type:a,components:f}=o;n=LR(n,f);const p=n;n+=f,this.layout[i]={type:a,size:f,offset:p}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,a_)}getData(e){const n=Math.max(this.byteLength,a_),r=yw(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){_e.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:f,size:p,offset:m}=a,v=i[f];if(p===1){if(typeof o!="number"&&typeof o!="boolean"){_e.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}v[m]=Number(o)}else{if(!Zc(o)){_e.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}v.set(o,m)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function jR(t,e,n=16){if(t!==e)return!1;const r=t,i=e;if(!Zc(r))return!1;if(Zc(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function WR(t){return Zc(t)?t.slice():t}class $R{constructor(e){M(this,"name");M(this,"uniforms",{});M(this,"modifiedUniforms",{});M(this,"modified",!0);M(this,"bindingLayout",{});M(this,"needsRedraw","initialized");var n;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){jR(this.uniforms[e],n)||(this.uniforms[e]=WR(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class HR{constructor(e){M(this,"uniformBlocks",new Map);M(this,"uniformBufferLayouts",new Map);M(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new zR(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new $R({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var n;for(const[r,i]of Object.entries(e))(n=this.uniformBlocks.get(r))==null||n.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var n;return((n=this.uniformBufferLayouts.get(e))==null?void 0:n.byteLength)||0}getUniformBufferData(e){var r,i;const n=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:Pt.UNIFORM|Pt.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:Pt.UNIFORM|Pt.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&_e.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&(n!=null&&n.needsRedraw)){i||(i=n.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const a=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();_e.log(4,`Writing to uniform buffer ${String(e)}`,o,a)()}return i}}function vw(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function ww(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function XR(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=vw(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class Nh{constructor(e){M(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){var n;return e.attributes?(n=e.attributes)==null?void 0:n.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,n){const r=[...e];for(const i of n){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}}class sr{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}getTypeName(){return this.name}}class l_{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ii extends sr{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class $i extends sr{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class Ss extends sr{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Ti;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Ti||(Ti={}));class RA{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class QR{constructor(e,n){this.name=e,this.type=n}}class YR{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class A_{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class KR{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class ZR{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r}}class qR{constructor(e,n=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n,this.attributes=r}}class GR{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const bw=new Float32Array(1),JR=new Int32Array(bw.buffer),vn=new Uint16Array(1);function eI(t){bw[0]=t;const e=JR[0],n=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return vn[0]=n<<15|31744|(i!==0?512:0),vn[0];if(r===0){if(i===0)return vn[0]=n<<15,vn[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),vn[0]=n<<15|r<<10|i>>13,vn[0]):(vn[0]=n<<15,vn[0])}return r=r-127+15,r>=31?(vn[0]=n<<15|31744,vn[0]):r<=0?r<-10?(vn[0]=n<<15,vn[0]):(i=(8388608|i)>>1-r,vn[0]=n<<15|i>>13,vn[0]):(i>>=13,vn[0]=n<<15|r<<10|i,vn[0])}const ng=new Uint32Array(1),xw=new Float32Array(ng.buffer,0,1);function c_(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return ng[0]=e,xw[0]}function tI(t,e,n,r,i,s,o,a,f){const p=r*(o>>=i)*(s>>=i)+n*o+e*a;switch(f){case"r8unorm":return[dt(t,p,"8unorm",1)[0]];case"r8snorm":return[dt(t,p,"8snorm",1)[0]];case"r8uint":return[dt(t,p,"8uint",1)[0]];case"r8sint":return[dt(t,p,"8sint",1)[0]];case"rg8unorm":{const m=dt(t,p,"8unorm",2);return[m[0],m[1]]}case"rg8snorm":{const m=dt(t,p,"8snorm",2);return[m[0],m[1]]}case"rg8uint":{const m=dt(t,p,"8uint",2);return[m[0],m[1]]}case"rg8sint":{const m=dt(t,p,"8sint",2);return[m[0],m[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const m=dt(t,p,"8unorm",4);return[m[0],m[1],m[2],m[3]]}case"rgba8snorm":{const m=dt(t,p,"8snorm",4);return[m[0],m[1],m[2],m[3]]}case"rgba8uint":{const m=dt(t,p,"8uint",4);return[m[0],m[1],m[2],m[3]]}case"rgba8sint":{const m=dt(t,p,"8sint",4);return[m[0],m[1],m[2],m[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const m=dt(t,p,"8unorm",4);return[m[2],m[1],m[0],m[3]]}case"r16uint":return[dt(t,p,"16uint",1)[0]];case"r16sint":return[dt(t,p,"16sint",1)[0]];case"r16float":return[dt(t,p,"16float",1)[0]];case"rg16uint":{const m=dt(t,p,"16uint",2);return[m[0],m[1]]}case"rg16sint":{const m=dt(t,p,"16sint",2);return[m[0],m[1]]}case"rg16float":{const m=dt(t,p,"16float",2);return[m[0],m[1]]}case"rgba16uint":{const m=dt(t,p,"16uint",4);return[m[0],m[1],m[2],m[3]]}case"rgba16sint":{const m=dt(t,p,"16sint",4);return[m[0],m[1],m[2],m[3]]}case"rgba16float":{const m=dt(t,p,"16float",4);return[m[0],m[1],m[2],m[3]]}case"r32uint":return[dt(t,p,"32uint",1)[0]];case"r32sint":return[dt(t,p,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[dt(t,p,"32float",1)[0]];case"rg32uint":{const m=dt(t,p,"32uint",2);return[m[0],m[1]]}case"rg32sint":{const m=dt(t,p,"32sint",2);return[m[0],m[1]]}case"rg32float":{const m=dt(t,p,"32float",2);return[m[0],m[1]]}case"rgba32uint":{const m=dt(t,p,"32uint",4);return[m[0],m[1],m[2],m[3]]}case"rgba32sint":{const m=dt(t,p,"32sint",4);return[m[0],m[1],m[2],m[3]]}case"rgba32float":{const m=dt(t,p,"32float",4);return[m[0],m[1],m[2],m[3]]}case"rg11b10ufloat":{const m=new Uint32Array(t.buffer,p,1)[0],v=(4192256&m)>>11,w=(4290772992&m)>>22;return[c_(2047&m),c_(v),function(T){const E=112+(T>>5&31)<<23|(31&T)<<18;return ng[0]=E,xw[0]}(w),1]}}return null}function dt(t,e,n,r){const i=[0,0,0,0];for(let p=0;p<r;++p)switch(n){case"8unorm":i[p]=t[e]/255,e++;break;case"8snorm":i[p]=t[e]/255*2-1,e++;break;case"8uint":i[p]=t[e],e++;break;case"8sint":i[p]=t[e]-127,e++;break;case"16uint":i[p]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[p]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[p]=(s=t[e]|t[e+1]<<8,o=void 0,a=void 0,f=void 0,o=(32768&s)>>15,f=1023&s,(a=(31744&s)>>10)==0?(o?-1:1)*Math.pow(2,-14)*(f/Math.pow(2,10)):a==31?f?NaN:1/0*(o?-1:1):(o?-1:1)*Math.pow(2,a-15)*(1+f/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[p]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[p]=new Float32Array(t.buffer,e,1)[0],e+=4}var s,o,a,f;return i}function pt(t,e,n,r,i){for(let s=0;s<r;++s)switch(n){case"8unorm":t[e]=255*i[s],e++;break;case"8snorm":t[e]=.5*(i[s]+1)*255,e++;break;case"8uint":t[e]=i[s],e++;break;case"8sint":t[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=eI(i[s]);new Uint16Array(t.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[s],e+=4}return i}const Oh={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class ur{constructor(){this.id=ur._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,n){if(e){n(qc.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(Gc.instance)}}constEvaluate(e,n){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}ur._id=0;class qc extends ur{}qc.instance=new qc;class Gc extends ur{}Gc.instance=new Gc;const Tw=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class It extends ur{constructor(){super()}}class El extends It{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const n of this.attributes)e(n);e(this);for(const n of this.args)e(n);this.searchBlock(this.body,e)}}class nI extends It{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Ew extends It{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class md extends It{constructor(e,n){super(),this.body=e,this.loopId=n}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Sw extends It{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class ei extends It{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class rg extends It{constructor(e,n,r){super(),this.attributes=null,this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class el extends It{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class ic extends It{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,n){return this.value.constEvaluate(e,n)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var fo,Fa,te,Y;(t=>{t.increment="++",t.decrement="--"})(fo||(fo={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}})(fo||(fo={}));class Cw extends It{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Fa||(Fa={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}})(Fa||(Fa={}));class Pw extends It{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class ig extends It{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}isBuiltin(){return Tw.has(this.name)}search(e){for(const n of this.args)n.search(e);e(this)}}class kw extends It{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class Rw extends It{constructor(e,n){super(),this.condition=e,this.cases=n}get astNodeType(){return"switch"}}class Iw extends It{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Mw extends It{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class rI extends It{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class iI extends It{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Nw extends It{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class sg extends It{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class sI extends It{constructor(){super()}get astNodeType(){return"discard"}}class Ow extends It{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class Dw extends It{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class ue extends It{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=ue._priority.get(n.name);ue._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?ue.i32:n}getTypeName(){return this.name}}ue.x32=new ue("x32"),ue.f32=new ue("f32"),ue.i32=new ue("i32"),ue.u32=new ue("u32"),ue.f16=new ue("f16"),ue.bool=new ue("bool"),ue.void=new ue("void"),ue._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class u_ extends ue{constructor(e){super(e)}}class Gr extends ue{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}search(e){for(const n of this.members)e(n)}}class J extends ue{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}J.vec2f=new J("vec2",ue.f32,null),J.vec3f=new J("vec3",ue.f32,null),J.vec4f=new J("vec4",ue.f32,null),J.vec2i=new J("vec2",ue.i32,null),J.vec3i=new J("vec3",ue.i32,null),J.vec4i=new J("vec4",ue.i32,null),J.vec2u=new J("vec2",ue.u32,null),J.vec3u=new J("vec3",ue.u32,null),J.vec4u=new J("vec4",ue.u32,null),J.vec2h=new J("vec2",ue.f16,null),J.vec3h=new J("vec3",ue.f16,null),J.vec4h=new J("vec4",ue.f16,null),J.vec2b=new J("vec2",ue.bool,null),J.vec3b=new J("vec3",ue.bool,null),J.vec4b=new J("vec4",ue.bool,null),J.mat2x2f=new J("mat2x2",ue.f32,null),J.mat2x3f=new J("mat2x3",ue.f32,null),J.mat2x4f=new J("mat2x4",ue.f32,null),J.mat3x2f=new J("mat3x2",ue.f32,null),J.mat3x3f=new J("mat3x3",ue.f32,null),J.mat3x4f=new J("mat3x4",ue.f32,null),J.mat4x2f=new J("mat4x2",ue.f32,null),J.mat4x3f=new J("mat4x3",ue.f32,null),J.mat4x4f=new J("mat4x4",ue.f32,null),J.mat2x2h=new J("mat2x2",ue.f16,null),J.mat2x3h=new J("mat2x3",ue.f16,null),J.mat2x4h=new J("mat2x4",ue.f16,null),J.mat3x2h=new J("mat3x2",ue.f16,null),J.mat3x3h=new J("mat3x3",ue.f16,null),J.mat3x4h=new J("mat3x4",ue.f16,null),J.mat4x2h=new J("mat4x2",ue.f16,null),J.mat4x3h=new J("mat4x3",ue.f16,null),J.mat4x4h=new J("mat4x4",ue.f16,null),J.mat2x2i=new J("mat2x2",ue.i32,null),J.mat2x3i=new J("mat2x3",ue.i32,null),J.mat2x4i=new J("mat2x4",ue.i32,null),J.mat3x2i=new J("mat3x2",ue.i32,null),J.mat3x3i=new J("mat3x3",ue.i32,null),J.mat3x4i=new J("mat3x4",ue.i32,null),J.mat4x2i=new J("mat4x2",ue.i32,null),J.mat4x3i=new J("mat4x3",ue.i32,null),J.mat4x4i=new J("mat4x4",ue.i32,null),J.mat2x2u=new J("mat2x2",ue.u32,null),J.mat2x3u=new J("mat2x3",ue.u32,null),J.mat2x4u=new J("mat2x4",ue.u32,null),J.mat3x2u=new J("mat3x2",ue.u32,null),J.mat3x3u=new J("mat3x3",ue.u32,null),J.mat3x4u=new J("mat3x4",ue.u32,null),J.mat4x2u=new J("mat4x2",ue.u32,null),J.mat4x3u=new J("mat4x3",ue.u32,null),J.mat4x4u=new J("mat4x4",ue.u32,null);class Dh extends ue{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class tl extends ue{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class La extends ue{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class Wr extends ur{constructor(){super(),this.postfix=null}}class Cs extends Wr{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Or extends Wr{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}constEvaluate(e,n){return n&&(n[0]=this.type),e.evalExpression(this,e.context)}}class og extends Wr{constructor(e,n){super(),this.cachedReturnValue=null,this.name=e,this.args=n}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Tw.has(this.name)}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){for(const n of this.args)n.search(e);e(this)}}class Hn extends Wr{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,n){return e.evalExpression(this,e.context)}}class Bw extends Wr{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}constEvaluate(e,n){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class Kt extends Wr{constructor(e,n){super(),this.value=e,this.type=n}get astNodeType(){return"literalExpr"}constEvaluate(e,n){return n!==void 0&&(n[0]=this.type),this.value}get isScalar(){return this.value instanceof Q}get isVector(){return this.value instanceof L||this.value instanceof $e}get scalarValue(){return this.value instanceof Q?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof L||this.value instanceof $e?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Fw extends Wr{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Uo extends Wr{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Lw extends Wr{constructor(){super()}}class Xt extends Lw{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class pr extends Lw{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,n){return e.name===n.name?e:e.name==="f32"||n.name==="f32"?ue.f32:e.name==="u32"||n.name==="u32"?ue.u32:ue.i32}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Uw extends ur{constructor(e){super(),this.body=e}}class sc extends Wr{constructor(){super()}get astNodeType(){return"default"}}class Vw extends Uw{constructor(e,n){super(n),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class zw extends Uw{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class f_ extends ur{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class oI extends ur{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class h_ extends ur{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}class jw extends ur{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}class cr{constructor(e,n){this.parent=null,this.typeInfo=e,this.parent=n,this.id=cr._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,n,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,n,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.name}>`}}cr._id=0;class _d extends cr{constructor(){super(new sr("void",null),null)}toString(){return"void"}}_d.void=new _d;class Zs extends cr{constructor(e){super(new sr("pointer",null),null),this.reference=e}clone(){return this}setDataValue(e,n,r,i){this.reference.setDataValue(e,n,r,i)}getSubData(e,n,r){return n?this.reference.getSubData(e,n,r):this}}class Q extends cr{constructor(e,n,r=null){super(n,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",n)}clone(){if(this.data instanceof Float32Array)return new Q(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Q(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Q(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,n,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(n instanceof Q))return void console.error("SetDataValue: Invalid value",n);let s=n.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,n,r){return n?(console.error("getSubData: Scalar data does not support postfix",n),null):this}toString(){return`${this.value}`}}function aI(t,e,n){const r=e.length;return r===2?n==="f32"?new L(new Float32Array(e),t.getTypeInfo("vec2f")):n==="i32"||n==="bool"?new L(new Int32Array(e),t.getTypeInfo("vec2i")):n==="u32"?new L(new Uint32Array(e),t.getTypeInfo("vec2u")):n==="f16"?new L(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):r===3?n==="f32"?new L(new Float32Array(e),t.getTypeInfo("vec3f")):n==="i32"||n==="bool"?new L(new Int32Array(e),t.getTypeInfo("vec3i")):n==="u32"?new L(new Uint32Array(e),t.getTypeInfo("vec3u")):n==="f16"?new L(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):r===4?n==="f32"?new L(new Float32Array(e),t.getTypeInfo("vec4f")):n==="i32"||n==="bool"?new L(new Int32Array(e),t.getTypeInfo("vec4i")):n==="u32"?new L(new Uint32Array(e),t.getTypeInfo("vec4u")):n==="f16"?new L(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class L extends cr{constructor(e,n,r=null){if(super(n,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new L(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new L(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new L(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,n,r,i){r instanceof Cs?console.error("TODO: Set vector postfix"):n instanceof L?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Ss)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;n!==null&&s!==null;){if(n instanceof Uo){const o=n.index;let a=-1;if(o instanceof Kt){if(!(o.value instanceof Q))return console.error(`GetSubData: Invalid array index ${o.value}`),null;a=o.value.value}else{const f=e.evalExpression(o,r);if(!(f instanceof Q))return console.error("GetSubData: Unknown index type",o),null;a=f.value}if(a<0||a>=s.data.length)return console.error("GetSubData: Index out of range",a),null;if(s.data instanceof Float32Array){const f=new Float32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new Q(f,i)}if(s.data instanceof Int32Array){const f=new Int32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new Q(f,i)}if(s.data instanceof Uint32Array){const f=new Uint32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new Q(f,i)}throw"GetSubData: Invalid data type"}if(!(n instanceof Cs))return console.error("GetSubData: Unknown postfix",n),null;{const o=n.value.toLowerCase();if(o.length===1){let f=0;if(o==="x"||o==="r")f=0;else if(o==="y"||o==="g")f=1;else if(o==="z"||o==="b")f=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;f=3}if(this.data instanceof Float32Array){let p=new Float32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new Q(p,i,this)}if(this.data instanceof Int32Array){let p=new Int32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new Q(p,i,this)}if(this.data instanceof Uint32Array){let p=new Uint32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new Q(p,i,this)}}const a=[];for(const f of o)f==="x"||f==="r"?a.push(this.data[0]):f==="y"||f==="g"?a.push(this.data[1]):f==="z"||f==="b"?a.push(this.data[2]):f==="w"||f==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${f}`);s=aI(e,a,i.name)}n=n.postfix}return s}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class $e extends cr{constructor(e,n,r=null){super(n,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new $e(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,n,r,i){r instanceof Cs?console.error("TODO: Set matrix postfix"):n instanceof $e?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Ss)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(n instanceof Uo){const s=n.index;let o=-1;if(s instanceof Kt){if(!(s.value instanceof Q))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const p=e.evalExpression(s,r);if(!(p instanceof Q))return console.error("GetDataValue: Unknown index type",s),null;o=p.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const a=i.endsWith("h")?"h":"f";let f;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")f=new L(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${a}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")f=new L(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${a}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;f=new L(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${a}`))}return n.postfix?f.getSubData(e,n.postfix,r):f}return console.error("GetDataValue: Invalid postfix",n),null}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Vt extends cr{constructor(e,n,r=0,i=null){super(n,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Vt(e.buffer,this.typeInfo,0,null)}setDataValue(e,n,r,i){if(n===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof Uo)if(o instanceof $i){const a=r.index;if(a instanceof Kt){if(!(a.value instanceof Q))return void console.error(`SetDataValue: Invalid index type ${a.value}`);s+=a.value.value*o.stride}else{const f=e.evalExpression(a,i);if(!(f instanceof Q))return void console.error("SetDataValue: Unknown index type",a);s+=f.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof Cs))return void console.error("SetDataValue: Unknown postfix type",r);{const a=r.value;if(o instanceof Ii){let f=!1;for(const p of o.members)if(p.name===a){s+=p.offset,o=p.type,f=!0;break}if(!f)return void console.error(`SetDataValue: Member ${a} not found`)}else if(o instanceof sr){const f=o.getTypeName();let p=0;if(a==="x"||a==="r")p=0;else if(a==="y"||a==="g")p=1;else if(a==="z"||a==="b")p=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);p=3}if(!(n instanceof Q))return void console.error("SetDataValue: Invalid value",n);const m=n.value;return f==="vec2f"?void(new Float32Array(this.buffer,s,2)[p]=m):f==="vec3f"?void(new Float32Array(this.buffer,s,3)[p]=m):f==="vec4f"?void(new Float32Array(this.buffer,s,4)[p]=m):f==="vec2i"?void(new Int32Array(this.buffer,s,2)[p]=m):f==="vec3i"?void(new Int32Array(this.buffer,s,3)[p]=m):f==="vec4i"?void(new Int32Array(this.buffer,s,4)[p]=m):f==="vec2u"?void(new Uint32Array(this.buffer,s,2)[p]=m):f==="vec3u"?void(new Uint32Array(this.buffer,s,3)[p]=m):f==="vec4u"?void(new Uint32Array(this.buffer,s,4)[p]=m):void console.error(`SetDataValue: Type ${f} is not a struct`)}}}r=r.postfix}this.setData(e,n,o,s,i)}setData(e,n,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool")if(o!=="vec2f"&&o!=="vec2h")if(o!=="vec3f"&&o!=="vec3h")if(o!=="vec4f"&&o!=="vec4h")if(o!=="vec2i")if(o!=="vec3i")if(o!=="vec4i")if(o!=="vec2u")if(o!=="vec3u")if(o!=="vec4u")if(o!=="vec2b")if(o!=="vec3b")if(o!=="vec4b")if(o!=="mat2x2f"&&o!=="mat2x2h")if(o!=="mat2x3f"&&o!=="mat2x3h")if(o!=="mat2x4f"&&o!=="mat2x4h")if(o!=="mat3x2f"&&o!=="mat3x2h")if(o!=="mat3x3f"&&o!=="mat3x3h")if(o!=="mat3x4f"&&o!=="mat3x4h")if(o!=="mat4x2f"&&o!=="mat4x2h")if(o!=="mat4x3f"&&o!=="mat4x3h")if(o!=="mat4x4f"&&o!=="mat4x4h")if(n instanceof Vt){if(r===n.typeInfo)return void new Uint8Array(this.buffer,i,n.buffer.byteLength).set(new Uint8Array(n.buffer));console.error("SetDataValue: Type mismatch",o,n.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`);else{const a=new Float32Array(this.buffer,i,16);n instanceof $e?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11],a[12]=n.data[12],a[13]=n.data[13],a[14]=n.data[14],a[15]=n.data[15]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15])}else{const a=new Float32Array(this.buffer,i,12);n instanceof $e?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11])}else{const a=new Float32Array(this.buffer,i,8);n instanceof $e?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7])}else{const a=new Float32Array(this.buffer,i,12);n instanceof $e?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11])}else{const a=new Float32Array(this.buffer,i,9);n instanceof $e?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8])}else{const a=new Float32Array(this.buffer,i,6);n instanceof $e?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5])}else{const a=new Float32Array(this.buffer,i,8);n instanceof $e?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7])}else{const a=new Float32Array(this.buffer,i,6);n instanceof $e?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5])}else{const a=new Float32Array(this.buffer,i,4);n instanceof $e?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3])}else{const a=new Uint32Array(this.buffer,i,4);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3])}else{const a=new Uint32Array(this.buffer,i,3);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2])}else{const a=new Uint32Array(this.buffer,i,2);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1])}else{const a=new Uint32Array(this.buffer,i,4);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3])}else{const a=new Uint32Array(this.buffer,i,3);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2])}else{const a=new Uint32Array(this.buffer,i,2);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1])}else{const a=new Int32Array(this.buffer,i,4);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3])}else{const a=new Int32Array(this.buffer,i,3);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2])}else{const a=new Int32Array(this.buffer,i,2);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1])}else{const a=new Float32Array(this.buffer,i,4);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3])}else{const a=new Float32Array(this.buffer,i,3);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2])}else{const a=new Float32Array(this.buffer,i,2);n instanceof L?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1])}else n instanceof Q&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof Q&&(new Uint32Array(this.buffer,i,1)[0]=n.value);else n instanceof Q&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof Q&&(new Float32Array(this.buffer,i,1)[0]=n.value)}getSubData(e,n,r){var i,s,o;if(n===null)return this;let a=this.offset,f=this.typeInfo;for(;n;){if(n instanceof Uo){const m=n.index,v=e.evalExpression(m,r);let w=0;if(v instanceof Q?w=v.value:console.error("GetDataValue: Invalid index type",m),f instanceof $i)a+=w*f.stride,f=f.format;else{const T=f.getTypeName();T==="mat4x4"||T==="mat4x4f"||T==="mat4x4h"?(a+=16*w,f=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${f.getTypeName()} is not an array`)}}else{if(!(n instanceof Cs))return console.error("GetDataValue: Unknown postfix type",n),null;{const m=n.value;if(f instanceof Ii){let v=!1;for(const w of f.members)if(w.name===m){a+=w.offset,f=w.type,v=!0;break}if(!v)return console.error(`GetDataValue: Member ${m} not found`),null}else if(f instanceof sr){const v=f.getTypeName();if(v==="vec2f"||v==="vec3f"||v==="vec4f"||v==="vec2i"||v==="vec3i"||v==="vec4i"||v==="vec2u"||v==="vec3u"||v==="vec4u"||v==="vec2b"||v==="vec3b"||v==="vec4b"||v==="vec2h"||v==="vec3h"||v==="vec4h"||v==="vec2"||v==="vec3"||v==="vec4"){if(m.length>0&&m.length<5){let w="f";const T=[];for(let E=0;E<m.length;++E){const I=m[E].toLowerCase();let U=0;if(I==="x"||I==="r")U=0;else if(I==="y"||I==="g")U=1;else if(I==="z"||I==="b")U=2;else{if(I!=="w"&&I!=="a")return console.error(`Unknown member ${m}`),null;U=3}if(m.length===1){if(v.endsWith("f"))return this.buffer.byteLength<a+4*U+4?(console.log("Insufficient buffer data"),null):new Q(new Float32Array(this.buffer,a+4*U,1),e.getTypeInfo("f32"),this);if(v.endsWith("h"))return new Q(new Float32Array(this.buffer,a+4*U,1),e.getTypeInfo("f16"),this);if(v.endsWith("i"))return new Q(new Int32Array(this.buffer,a+4*U,1),e.getTypeInfo("i32"),this);if(v.endsWith("b"))return new Q(new Int32Array(this.buffer,a+4*U,1),e.getTypeInfo("bool"),this);if(v.endsWith("u"))return new Q(new Uint32Array(this.buffer,a+4*U,1),e.getTypeInfo("i32"),this)}if(v==="vec2f")T.push(new Float32Array(this.buffer,a,2)[U]);else if(v==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const R=new Float32Array(this.buffer,a,3);T.push(R[U])}else if(v==="vec4f")T.push(new Float32Array(this.buffer,a,4)[U]);else if(v==="vec2i")w="i",T.push(new Int32Array(this.buffer,a,2)[U]);else if(v==="vec3i")w="i",T.push(new Int32Array(this.buffer,a,3)[U]);else if(v==="vec4i")w="i",T.push(new Int32Array(this.buffer,a,4)[U]);else if(v==="vec2u"){w="u";const R=new Uint32Array(this.buffer,a,2);T.push(R[U])}else v==="vec3u"?(w="u",T.push(new Uint32Array(this.buffer,a,3)[U])):v==="vec4u"&&(w="u",T.push(new Uint32Array(this.buffer,a,4)[U]))}return T.length===2?f=e.getTypeInfo(`vec2${w}`):T.length===3?f=e.getTypeInfo(`vec3${w}`):T.length===4?f=e.getTypeInfo(`vec4${w}`):console.error(`GetDataValue: Invalid vector length ${T.length}`),new L(T,f,null)}return console.error(`GetDataValue: Unknown member ${m}`),null}return console.error(`GetDataValue: Type ${v} is not a struct`),null}}}n=n.postfix}const p=f.getTypeName();return p==="f32"?new Q(new Float32Array(this.buffer,a,1),f,this):p==="i32"?new Q(new Int32Array(this.buffer,a,1),f,this):p==="u32"?new Q(new Uint32Array(this.buffer,a,1),f,this):p==="vec2f"?new L(new Float32Array(this.buffer,a,2),f,this):p==="vec3f"?new L(new Float32Array(this.buffer,a,3),f,this):p==="vec4f"?new L(new Float32Array(this.buffer,a,4),f,this):p==="vec2i"?new L(new Int32Array(this.buffer,a,2),f,this):p==="vec3i"?new L(new Int32Array(this.buffer,a,3),f,this):p==="vec4i"?new L(new Int32Array(this.buffer,a,4),f,this):p==="vec2u"?new L(new Uint32Array(this.buffer,a,2),f,this):p==="vec3u"?new L(new Uint32Array(this.buffer,a,3),f,this):p==="vec4u"?new L(new Uint32Array(this.buffer,a,4),f,this):f instanceof Ss&&f.name==="atomic"?((i=f.format)===null||i===void 0?void 0:i.name)==="u32"?new Q(new Uint32Array(this.buffer,a,1)[0],f.format,this):((s=f.format)===null||s===void 0?void 0:s.name)==="i32"?new Q(new Int32Array(this.buffer,a,1)[0],f.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=f.format)===null||o===void 0?void 0:o.name}`),null):new Vt(this.buffer,f,a,this)}toString(){let e="";if(this.typeInfo instanceof $i)if(this.typeInfo.format.name==="f32"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="i32"){const n=new Int32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="u32"){const n=new Uint32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="vec2f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}]`;for(let r=1;r<n.length/2;++r)e+=`, [${n[2*r]}, ${n[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}, ${n[3]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}, ${n[r+3]}]`}else e="[...]";else this.typeInfo instanceof Ii?e+="{...}":e="[...]";return e}}class Jr extends cr{constructor(e,n,r,i){super(n,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new Jr(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.width)!==null&&n!==void 0?n:0}get height(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.height)!==null&&n!==void 0?n:0}get depthOrArrayLayers(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.depthOrArrayLayers)!==null&&n!==void 0?n:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const n=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<n.length;++r)n[r]=Math.max(1,n[r]>>e);return n}get texelByteSize(){const e=this.format,n=Oh[e];return n?n.isDepthStencil?4:n.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,n=Oh[e];return!!n&&n.isDepthStencil}getGpuSize(){const e=this.format,n=Oh[e],r=this.width;if(!e||r<=0||!n)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/n.blockWidth*(o==="1d"?1:i/n.blockHeight)*n.bytesPerBlock*s}getPixel(e,n,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,a=this.height,f=this.data[i];return tI(new Uint8Array(f),e,n,r,i,a,o,s,this.format)}setPixel(e,n,r,i,s){const o=this.texelByteSize,a=this.bytesPerRow,f=this.height,p=this.data[i];(function(m,v,w,T,E,I,U,R,P,C){const D=T*(U>>=E)*(I>>=E)+w*U+v*R;switch(P){case"r8unorm":return void pt(m,D,"8unorm",1,C);case"r8snorm":return void pt(m,D,"8snorm",1,C);case"r8uint":return void pt(m,D,"8uint",1,C);case"r8sint":return void pt(m,D,"8sint",1,C);case"rg8unorm":return void pt(m,D,"8unorm",2,C);case"rg8snorm":return void pt(m,D,"8snorm",2,C);case"rg8uint":return void pt(m,D,"8uint",2,C);case"rg8sint":return void pt(m,D,"8sint",2,C);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void pt(m,D,"8unorm",4,C);case"rgba8snorm":return void pt(m,D,"8snorm",4,C);case"rgba8uint":return void pt(m,D,"8uint",4,C);case"rgba8sint":return void pt(m,D,"8sint",4,C);case"r16uint":return void pt(m,D,"16uint",1,C);case"r16sint":return void pt(m,D,"16sint",1,C);case"r16float":return void pt(m,D,"16float",1,C);case"rg16uint":return void pt(m,D,"16uint",2,C);case"rg16sint":return void pt(m,D,"16sint",2,C);case"rg16float":return void pt(m,D,"16float",2,C);case"rgba16uint":return void pt(m,D,"16uint",4,C);case"rgba16sint":return void pt(m,D,"16sint",4,C);case"rgba16float":return void pt(m,D,"16float",4,C);case"r32uint":return void pt(m,D,"32uint",1,C);case"r32sint":return void pt(m,D,"32sint",1,C);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void pt(m,D,"32float",1,C);case"rg32uint":return void pt(m,D,"32uint",2,C);case"rg32sint":return void pt(m,D,"32sint",2,C);case"rg32float":return void pt(m,D,"32float",2,C);case"rgba32uint":return void pt(m,D,"32uint",4,C);case"rgba32sint":return void pt(m,D,"32sint",4,C);case"rgba32float":return void pt(m,D,"32float",4,C);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(p),e,n,r,i,f,a,o,this.format,s)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(Y||(Y={}));class K{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class B{}te=B,B.none=new K("",Y.reserved,""),B.eof=new K("EOF",Y.token,""),B.reserved={asm:new K("asm",Y.reserved,"asm"),bf16:new K("bf16",Y.reserved,"bf16"),do:new K("do",Y.reserved,"do"),enum:new K("enum",Y.reserved,"enum"),f16:new K("f16",Y.reserved,"f16"),f64:new K("f64",Y.reserved,"f64"),handle:new K("handle",Y.reserved,"handle"),i8:new K("i8",Y.reserved,"i8"),i16:new K("i16",Y.reserved,"i16"),i64:new K("i64",Y.reserved,"i64"),mat:new K("mat",Y.reserved,"mat"),premerge:new K("premerge",Y.reserved,"premerge"),regardless:new K("regardless",Y.reserved,"regardless"),typedef:new K("typedef",Y.reserved,"typedef"),u8:new K("u8",Y.reserved,"u8"),u16:new K("u16",Y.reserved,"u16"),u64:new K("u64",Y.reserved,"u64"),unless:new K("unless",Y.reserved,"unless"),using:new K("using",Y.reserved,"using"),vec:new K("vec",Y.reserved,"vec"),void:new K("void",Y.reserved,"void")},B.keywords={array:new K("array",Y.keyword,"array"),atomic:new K("atomic",Y.keyword,"atomic"),bool:new K("bool",Y.keyword,"bool"),f32:new K("f32",Y.keyword,"f32"),i32:new K("i32",Y.keyword,"i32"),mat2x2:new K("mat2x2",Y.keyword,"mat2x2"),mat2x3:new K("mat2x3",Y.keyword,"mat2x3"),mat2x4:new K("mat2x4",Y.keyword,"mat2x4"),mat3x2:new K("mat3x2",Y.keyword,"mat3x2"),mat3x3:new K("mat3x3",Y.keyword,"mat3x3"),mat3x4:new K("mat3x4",Y.keyword,"mat3x4"),mat4x2:new K("mat4x2",Y.keyword,"mat4x2"),mat4x3:new K("mat4x3",Y.keyword,"mat4x3"),mat4x4:new K("mat4x4",Y.keyword,"mat4x4"),ptr:new K("ptr",Y.keyword,"ptr"),sampler:new K("sampler",Y.keyword,"sampler"),sampler_comparison:new K("sampler_comparison",Y.keyword,"sampler_comparison"),struct:new K("struct",Y.keyword,"struct"),texture_1d:new K("texture_1d",Y.keyword,"texture_1d"),texture_2d:new K("texture_2d",Y.keyword,"texture_2d"),texture_2d_array:new K("texture_2d_array",Y.keyword,"texture_2d_array"),texture_3d:new K("texture_3d",Y.keyword,"texture_3d"),texture_cube:new K("texture_cube",Y.keyword,"texture_cube"),texture_cube_array:new K("texture_cube_array",Y.keyword,"texture_cube_array"),texture_multisampled_2d:new K("texture_multisampled_2d",Y.keyword,"texture_multisampled_2d"),texture_storage_1d:new K("texture_storage_1d",Y.keyword,"texture_storage_1d"),texture_storage_2d:new K("texture_storage_2d",Y.keyword,"texture_storage_2d"),texture_storage_2d_array:new K("texture_storage_2d_array",Y.keyword,"texture_storage_2d_array"),texture_storage_3d:new K("texture_storage_3d",Y.keyword,"texture_storage_3d"),texture_depth_2d:new K("texture_depth_2d",Y.keyword,"texture_depth_2d"),texture_depth_2d_array:new K("texture_depth_2d_array",Y.keyword,"texture_depth_2d_array"),texture_depth_cube:new K("texture_depth_cube",Y.keyword,"texture_depth_cube"),texture_depth_cube_array:new K("texture_depth_cube_array",Y.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new K("texture_depth_multisampled_2d",Y.keyword,"texture_depth_multisampled_2d"),texture_external:new K("texture_external",Y.keyword,"texture_external"),u32:new K("u32",Y.keyword,"u32"),vec2:new K("vec2",Y.keyword,"vec2"),vec3:new K("vec3",Y.keyword,"vec3"),vec4:new K("vec4",Y.keyword,"vec4"),bitcast:new K("bitcast",Y.keyword,"bitcast"),block:new K("block",Y.keyword,"block"),break:new K("break",Y.keyword,"break"),case:new K("case",Y.keyword,"case"),continue:new K("continue",Y.keyword,"continue"),continuing:new K("continuing",Y.keyword,"continuing"),default:new K("default",Y.keyword,"default"),diagnostic:new K("diagnostic",Y.keyword,"diagnostic"),discard:new K("discard",Y.keyword,"discard"),else:new K("else",Y.keyword,"else"),enable:new K("enable",Y.keyword,"enable"),fallthrough:new K("fallthrough",Y.keyword,"fallthrough"),false:new K("false",Y.keyword,"false"),fn:new K("fn",Y.keyword,"fn"),for:new K("for",Y.keyword,"for"),function:new K("function",Y.keyword,"function"),if:new K("if",Y.keyword,"if"),let:new K("let",Y.keyword,"let"),const:new K("const",Y.keyword,"const"),loop:new K("loop",Y.keyword,"loop"),while:new K("while",Y.keyword,"while"),private:new K("private",Y.keyword,"private"),read:new K("read",Y.keyword,"read"),read_write:new K("read_write",Y.keyword,"read_write"),return:new K("return",Y.keyword,"return"),requires:new K("requires",Y.keyword,"requires"),storage:new K("storage",Y.keyword,"storage"),switch:new K("switch",Y.keyword,"switch"),true:new K("true",Y.keyword,"true"),alias:new K("alias",Y.keyword,"alias"),type:new K("type",Y.keyword,"type"),uniform:new K("uniform",Y.keyword,"uniform"),var:new K("var",Y.keyword,"var"),override:new K("override",Y.keyword,"override"),workgroup:new K("workgroup",Y.keyword,"workgroup"),write:new K("write",Y.keyword,"write"),r8unorm:new K("r8unorm",Y.keyword,"r8unorm"),r8snorm:new K("r8snorm",Y.keyword,"r8snorm"),r8uint:new K("r8uint",Y.keyword,"r8uint"),r8sint:new K("r8sint",Y.keyword,"r8sint"),r16uint:new K("r16uint",Y.keyword,"r16uint"),r16sint:new K("r16sint",Y.keyword,"r16sint"),r16float:new K("r16float",Y.keyword,"r16float"),rg8unorm:new K("rg8unorm",Y.keyword,"rg8unorm"),rg8snorm:new K("rg8snorm",Y.keyword,"rg8snorm"),rg8uint:new K("rg8uint",Y.keyword,"rg8uint"),rg8sint:new K("rg8sint",Y.keyword,"rg8sint"),r32uint:new K("r32uint",Y.keyword,"r32uint"),r32sint:new K("r32sint",Y.keyword,"r32sint"),r32float:new K("r32float",Y.keyword,"r32float"),rg16uint:new K("rg16uint",Y.keyword,"rg16uint"),rg16sint:new K("rg16sint",Y.keyword,"rg16sint"),rg16float:new K("rg16float",Y.keyword,"rg16float"),rgba8unorm:new K("rgba8unorm",Y.keyword,"rgba8unorm"),rgba8unorm_srgb:new K("rgba8unorm_srgb",Y.keyword,"rgba8unorm_srgb"),rgba8snorm:new K("rgba8snorm",Y.keyword,"rgba8snorm"),rgba8uint:new K("rgba8uint",Y.keyword,"rgba8uint"),rgba8sint:new K("rgba8sint",Y.keyword,"rgba8sint"),bgra8unorm:new K("bgra8unorm",Y.keyword,"bgra8unorm"),bgra8unorm_srgb:new K("bgra8unorm_srgb",Y.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new K("rgb10a2unorm",Y.keyword,"rgb10a2unorm"),rg11b10float:new K("rg11b10float",Y.keyword,"rg11b10float"),rg32uint:new K("rg32uint",Y.keyword,"rg32uint"),rg32sint:new K("rg32sint",Y.keyword,"rg32sint"),rg32float:new K("rg32float",Y.keyword,"rg32float"),rgba16uint:new K("rgba16uint",Y.keyword,"rgba16uint"),rgba16sint:new K("rgba16sint",Y.keyword,"rgba16sint"),rgba16float:new K("rgba16float",Y.keyword,"rgba16float"),rgba32uint:new K("rgba32uint",Y.keyword,"rgba32uint"),rgba32sint:new K("rgba32sint",Y.keyword,"rgba32sint"),rgba32float:new K("rgba32float",Y.keyword,"rgba32float"),static_assert:new K("static_assert",Y.keyword,"static_assert")},B.tokens={decimal_float_literal:new K("decimal_float_literal",Y.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new K("hex_float_literal",Y.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new K("int_literal",Y.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new K("uint_literal",Y.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new K("name",Y.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new K("ident",Y.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new K("and",Y.token,"&"),and_and:new K("and_and",Y.token,"&&"),arrow:new K("arrow ",Y.token,"->"),attr:new K("attr",Y.token,"@"),forward_slash:new K("forward_slash",Y.token,"/"),bang:new K("bang",Y.token,"!"),bracket_left:new K("bracket_left",Y.token,"["),bracket_right:new K("bracket_right",Y.token,"]"),brace_left:new K("brace_left",Y.token,"{"),brace_right:new K("brace_right",Y.token,"}"),colon:new K("colon",Y.token,":"),comma:new K("comma",Y.token,","),equal:new K("equal",Y.token,"="),equal_equal:new K("equal_equal",Y.token,"=="),not_equal:new K("not_equal",Y.token,"!="),greater_than:new K("greater_than",Y.token,">"),greater_than_equal:new K("greater_than_equal",Y.token,">="),shift_right:new K("shift_right",Y.token,">>"),less_than:new K("less_than",Y.token,"<"),less_than_equal:new K("less_than_equal",Y.token,"<="),shift_left:new K("shift_left",Y.token,"<<"),modulo:new K("modulo",Y.token,"%"),minus:new K("minus",Y.token,"-"),minus_minus:new K("minus_minus",Y.token,"--"),period:new K("period",Y.token,"."),plus:new K("plus",Y.token,"+"),plus_plus:new K("plus_plus",Y.token,"++"),or:new K("or",Y.token,"|"),or_or:new K("or_or",Y.token,"||"),paren_left:new K("paren_left",Y.token,"("),paren_right:new K("paren_right",Y.token,")"),semicolon:new K("semicolon",Y.token,";"),star:new K("star",Y.token,"*"),tilde:new K("tilde",Y.token,"~"),underscore:new K("underscore",Y.token,"_"),xor:new K("xor",Y.token,"^"),plus_equal:new K("plus_equal",Y.token,"+="),minus_equal:new K("minus_equal",Y.token,"-="),times_equal:new K("times_equal",Y.token,"*="),division_equal:new K("division_equal",Y.token,"/="),modulo_equal:new K("modulo_equal",Y.token,"%="),and_equal:new K("and_equal",Y.token,"&="),or_equal:new K("or_equal",Y.token,"|="),xor_equal:new K("xor_equal",Y.token,"^="),shift_right_equal:new K("shift_right_equal",Y.token,">>="),shift_left_equal:new K("shift_left_equal",Y.token,"<<=")},B.simpleTokens={"@":te.tokens.attr,"{":te.tokens.brace_left,"}":te.tokens.brace_right,":":te.tokens.colon,",":te.tokens.comma,"(":te.tokens.paren_left,")":te.tokens.paren_right,";":te.tokens.semicolon},B.literalTokens={"&":te.tokens.and,"&&":te.tokens.and_and,"->":te.tokens.arrow,"/":te.tokens.forward_slash,"!":te.tokens.bang,"[":te.tokens.bracket_left,"]":te.tokens.bracket_right,"=":te.tokens.equal,"==":te.tokens.equal_equal,"!=":te.tokens.not_equal,">":te.tokens.greater_than,">=":te.tokens.greater_than_equal,">>":te.tokens.shift_right,"<":te.tokens.less_than,"<=":te.tokens.less_than_equal,"<<":te.tokens.shift_left,"%":te.tokens.modulo,"-":te.tokens.minus,"--":te.tokens.minus_minus,".":te.tokens.period,"+":te.tokens.plus,"++":te.tokens.plus_plus,"|":te.tokens.or,"||":te.tokens.or_or,"*":te.tokens.star,"~":te.tokens.tilde,_:te.tokens.underscore,"^":te.tokens.xor,"+=":te.tokens.plus_equal,"-=":te.tokens.minus_equal,"*=":te.tokens.times_equal,"/=":te.tokens.division_equal,"%=":te.tokens.modulo_equal,"&=":te.tokens.and_equal,"|=":te.tokens.or_equal,"^=":te.tokens.xor_equal,">>=":te.tokens.shift_right_equal,"<<=":te.tokens.shift_left_equal},B.regexTokens={decimal_float_literal:te.tokens.decimal_float_literal,hex_float_literal:te.tokens.hex_float_literal,int_literal:te.tokens.int_literal,uint_literal:te.tokens.uint_literal,ident:te.tokens.ident},B.storage_class=[te.keywords.function,te.keywords.private,te.keywords.workgroup,te.keywords.uniform,te.keywords.storage],B.access_mode=[te.keywords.read,te.keywords.write,te.keywords.read_write],B.sampler_type=[te.keywords.sampler,te.keywords.sampler_comparison],B.sampled_texture_type=[te.keywords.texture_1d,te.keywords.texture_2d,te.keywords.texture_2d_array,te.keywords.texture_3d,te.keywords.texture_cube,te.keywords.texture_cube_array],B.multisampled_texture_type=[te.keywords.texture_multisampled_2d],B.storage_texture_type=[te.keywords.texture_storage_1d,te.keywords.texture_storage_2d,te.keywords.texture_storage_2d_array,te.keywords.texture_storage_3d],B.depth_texture_type=[te.keywords.texture_depth_2d,te.keywords.texture_depth_2d_array,te.keywords.texture_depth_cube,te.keywords.texture_depth_cube_array,te.keywords.texture_depth_multisampled_2d],B.texture_external_type=[te.keywords.texture_external],B.any_texture_type=[...te.sampled_texture_type,...te.multisampled_texture_type,...te.storage_texture_type,...te.depth_texture_type,...te.texture_external_type],B.texel_format=[te.keywords.r8unorm,te.keywords.r8snorm,te.keywords.r8uint,te.keywords.r8sint,te.keywords.r16uint,te.keywords.r16sint,te.keywords.r16float,te.keywords.rg8unorm,te.keywords.rg8snorm,te.keywords.rg8uint,te.keywords.rg8sint,te.keywords.r32uint,te.keywords.r32sint,te.keywords.r32float,te.keywords.rg16uint,te.keywords.rg16sint,te.keywords.rg16float,te.keywords.rgba8unorm,te.keywords.rgba8unorm_srgb,te.keywords.rgba8snorm,te.keywords.rgba8uint,te.keywords.rgba8sint,te.keywords.bgra8unorm,te.keywords.bgra8unorm_srgb,te.keywords.rgb10a2unorm,te.keywords.rg11b10float,te.keywords.rg32uint,te.keywords.rg32sint,te.keywords.rg32float,te.keywords.rgba16uint,te.keywords.rgba16sint,te.keywords.rgba16float,te.keywords.rgba32uint,te.keywords.rgba32sint,te.keywords.rgba32float],B.const_literal=[te.tokens.int_literal,te.tokens.uint_literal,te.tokens.decimal_float_literal,te.tokens.hex_float_literal,te.keywords.true,te.keywords.false],B.literal_or_ident=[te.tokens.ident,te.tokens.int_literal,te.tokens.uint_literal,te.tokens.decimal_float_literal,te.tokens.hex_float_literal,te.tokens.name],B.element_count_expression=[te.tokens.int_literal,te.tokens.uint_literal,te.tokens.ident],B.template_types=[te.keywords.vec2,te.keywords.vec3,te.keywords.vec4,te.keywords.mat2x2,te.keywords.mat2x3,te.keywords.mat2x4,te.keywords.mat3x2,te.keywords.mat3x3,te.keywords.mat3x4,te.keywords.mat4x2,te.keywords.mat4x3,te.keywords.mat4x4,te.keywords.atomic,te.keywords.bitcast,...te.any_texture_type],B.attribute_name=[te.tokens.ident,te.keywords.block,te.keywords.diagnostic],B.assignment_operators=[te.tokens.equal,te.tokens.plus_equal,te.tokens.minus_equal,te.tokens.times_equal,te.tokens.division_equal,te.tokens.modulo_equal,te.tokens.and_equal,te.tokens.or_equal,te.tokens.xor_equal,te.tokens.shift_right_equal,te.tokens.shift_left_equal],B.increment_operators=[te.tokens.plus_plus,te.tokens.minus_minus];class d_{constructor(e,n,r,i,s){this.type=e,this.lexeme=n,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return B.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==B.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class lI{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new d_(B.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=B.simpleTokens[e];if(n)return this._addToken(n),!0;let r=B.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=B.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(B.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(B.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(B.tokens.minus_minus),!0;const f=this._tokens.length-1;if((B.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==B.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let f=!1,p=this._tokens.length-1;for(let m=0;m<5&&p>=0&&B.assignment_operators.indexOf(this._tokens[p].type)===-1;++m,--p)if(this._tokens[p].type===B.tokens.less_than){p>0&&this._tokens[p-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(o),!0}if(o===B.none){let f=e,p=0;const m=2;for(let v=0;v<m;++v)if(f+=this._peekAhead(v),o=this._findType(f),o!==B.none){p=v;break}if(o===B.none)return r!==B.none&&(this._current--,this._addToken(r),!0);e=f,this._current+=p+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==B.none&&(this._addToken(r),!0)}_findType(e){for(const r in B.regexTokens){const i=B.regexTokens[r];if(this._match(e,i.rule))return i}return B.literalTokens[e]||B.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new d_(e,n,this._line,this._start,this._current))}}function Pe(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const Jc=new Float32Array(1),AI=new Uint32Array(Jc.buffer),cI=new Uint32Array(Jc.buffer),eu=new Int32Array(1),uI=new Float32Array(eu.buffer),fI=new Uint32Array(eu.buffer),tu=new Uint32Array(1),hI=new Float32Array(tu.buffer),dI=new Int32Array(tu.buffer);function p_(t,e,n){if(e===n)return t;if(e==="f32"){if(n==="i32"||n==="x32")return Jc[0]=t,AI[0];if(n==="u32")return Jc[0]=t,cI[0]}else if(e==="i32"||e==="x32"){if(n==="f32")return eu[0]=t,uI[0];if(n==="u32")return eu[0]=t,fI[0]}else if(e==="u32"){if(n==="f32")return tu[0]=t,hI[0];if(n==="i32"||n==="x32")return tu[0]=t,dI[0]}return console.error(`Unsupported cast from ${e} to ${n}`),t}class pI{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class IA{constructor(e,n){this.align=e,this.size=n}}class Fr{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new GR,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const n of e)n instanceof El&&this._functions.set(n.name,new pI(n));for(const n of e)if(n instanceof Gr){const r=this.getTypeInfo(n,null);r instanceof Ii&&this.structs.push(r)}for(const n of e)if(n instanceof sg)this.aliases.push(this._getAliasInfo(n));else if(n instanceof rg){const r=n,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new KR(r.name,s,r.attributes,i))}else if(this._isUniformVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new RA(r.name,o,i,s,r.attributes,Ti.Uniform,r.access);a.access||(a.access="read"),this.uniforms.push(a)}else if(this._isStorageVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),f=new RA(r.name,o,i,s,r.attributes,a?Ti.StorageTexture:Ti.Storage,r.access);f.access||(f.access="read"),this.storage.push(f)}else if(this._isTextureVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),f=new RA(r.name,o,i,s,r.attributes,a?Ti.StorageTexture:Ti.Texture,r.access);f.access||(f.access="read"),a?this.storage.push(f):this.textures.push(f)}else if(this._isSamplerVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new RA(r.name,o,i,s,r.attributes,Ti.Sampler,r.access);this.samplers.push(a)}else if(n instanceof El){const r=this._getAttribute(n,"vertex"),i=this._getAttribute(n,"fragment"),s=this._getAttribute(n,"compute"),o=r||i||s,a=new qR(n.name,o==null?void 0:o.name,n.attributes);a.attributes=n.attributes,a.startLine=n.startLine,a.endLine=n.endLine,this.functions.push(a),this._functions.get(n.name).info=a,o&&(this._functions.get(n.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(n,!!o),a.inputs=this._getInputs(n.args),a.outputs=this._getOutputs(n.returnType),this.entry[o.name].push(a)),a.arguments=n.args.map(f=>new ZR(f.name,this.getTypeInfo(f.type,f.attributes),f.attributes)),a.returnType=n.returnType?this.getTypeInfo(n.returnType,n.attributes):null}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(r=>{var i,s,o;if(r instanceof jw){if(r.value)if(Pe(r.value))for(const a of r.value)for(const f of this.overrides)a===f.name&&((i=n.info)===null||i===void 0||i.overrides.push(f));else for(const a of this.overrides)r.value===a.name&&((s=n.info)===null||s===void 0||s.overrides.push(a))}else if(r instanceof Hn)for(const a of this.overrides)r.name===a.name&&((o=n.info)===null||o===void 0||o.overrides.push(a))});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}getStructInfo(e){for(const n of this.structs)if(n.name==e)return n;return null}getOverrideInfo(e){for(const n of this.overrides)if(n.name==e)return n;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==n)return i;for(const i of this.storage)if(i.group==e&&i.binding==n)return i;for(const i of this.textures)if(i.group==e&&i.binding==n)return i;for(const i of this.samplers)if(i.group==e&&i.binding==n)return i;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this.getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof qc)s.push({});else if(o instanceof Gc)s.pop();else if(o instanceof ei){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Or){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof el){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Hn){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const f=i._findResource(a.name);f&&r.push(f)}else if(o instanceof og){const a=o,f=i._functions.get(a.name);f&&(n&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=i._findResources(f.node,n)),r.push(...f.resources))}else if(o instanceof ig){const a=o,f=i._functions.get(a.name);f&&(n&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=i._findResources(f.node,n)),r.push(...f.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)n(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof Gr)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof Gr)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new A_(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new A_("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof Gr)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof Gr)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new YR(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new QR(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const n of this.structs)if(n.name==e)return n;for(const n of this.aliases)if(n.name==e)return n.type;return null}getTypeInfo(e,n=null){if(this._types.has(e))return this._types.get(e);if(e instanceof tl){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new $i(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof Gr){const i=e,s=new Ii(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this.getTypeInfo(o.type,o.attributes);s.members.push(new l_(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof La){const i=e,s=i.format instanceof ue,o=i.format?s?this.getTypeInfo(i.format,null):new sr(i.format,null):null,a=new Ss(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof J){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new Ss(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new sr(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r,i;const s=this._getTypeSize(e);if(e.size=(n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,e instanceof $i&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(i=o==null?void 0:o.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof Ii&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,f=e.members.length;a<f;++a){const p=e.members[a],m=this._getTypeSize(p);if(!m)continue;(n=this._getAlias(p.type.name))!==null&&n!==void 0||p.type;const v=m.align,w=m.size;r=this._roundUp(v,r+i),i=w,s=r,o=Math.max(o,v),p.offset=r,p.size=w,this._updateTypeInfo(p.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof l_&&(e=e.type),e instanceof sr){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Fr._typeInfo[e.name];if(o!==void 0){const a=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new IA(Math.max(s,o.align/a),Math.max(i,o.size/a))}}{const o=Fr._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new IA(Math.max(s,o.align/a),Math.max(i,o.size/a))}}if(e instanceof $i){let o=e,a=8,f=8;const p=this._getTypeSize(o.format);return p!==null&&(f=p.size,a=p.align),f=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,f)),i&&(f=i),new IA(Math.max(s,a),Math.max(i,f))}if(e instanceof Ii){let o=0,a=0,f=0,p=0,m=0;for(const v of e.members){const w=this._getTypeSize(v.type);w!==null&&(o=Math.max(w.align,o),f=this._roundUp(w.align,f+p),p=w.size,m=f)}return a=this._roundUp(o,m+p),new IA(Math.max(s,o),Math.max(i,a))}return null}_isUniformVar(e){return e instanceof ei&&e.storage=="uniform"}_isStorageVar(e){return e instanceof ei&&e.storage=="storage"}_isTextureVar(e){return e instanceof ei&&e.type!==null&&Fr._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof ei&&e.type!==null&&Fr._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}Fr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Fr._textureTypes=B.any_texture_type.map(t=>t.name),Fr._samplerTypes=B.sampler_type.map(t=>t.name);class ag{constructor(e,n,r){this.name=e,this.value=n,this.node=r}clone(){return new ag(this.name,this.value,this.node)}}class lg{constructor(e){this.name=e.name,this.node=e}clone(){return new lg(this.node)}}class Ag{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var n;return this.variables.has(e)?(n=this.variables.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var n;return this.functions.has(e)?(n=this.functions.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getFunction(e):null}createVariable(e,n,r){this.variables.set(e,new ag(e,n,r??null))}setVariable(e,n,r){const i=this.getVariable(e);i!==null?i.value=n:this.createVariable(e,n,r)}getVariableValue(e){var n;const r=this.getVariable(e);return(n=r==null?void 0:r.value)!==null&&n!==void 0?n:null}clone(){return new Ag(this)}}class gI{evalExpression(e,n){return null}getTypeInfo(e){return null}getVariableName(e,n){return""}}class mI{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,n){const r=this.exec.evalExpression(e.args[0],n);let i=!0;if(r instanceof L)return r.data.forEach(s=>{s||(i=!1)}),new Q(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L){const i=r.data.some(s=>s);return new Q(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,n){const r=this.exec.evalExpression(e.args[2],n);if(!(r instanceof Q))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],n):this.exec.evalExpression(e.args[0],n)}ArrayLength(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.evalExpression(r,n);if(i instanceof Vt&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new Q(o,this.getTypeInfo("u32"))}return new Q(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new Q(Math.abs(i.value),i.typeInfo)}Acos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new Q(Math.acos(i.value),r.typeInfo)}Acosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new Q(Math.acosh(i.value),r.typeInfo)}Asin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new Q(Math.asin(i.value),r.typeInfo)}Asinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new Q(Math.asinh(i.value),r.typeInfo)}Atan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new Q(Math.atan(i.value),r.typeInfo)}Atanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new Q(Math.atanh(i.value),r.typeInfo)}Atan2(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof L&&i instanceof L)return new L(r.data.map((a,f)=>Math.atan2(a,i.data[f])),r.typeInfo);const s=r,o=i;return new Q(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new Q(Math.ceil(i.value),r.typeInfo)}_clamp(e,n,r){return Math.min(Math.max(e,n),r)}Clamp(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof L&&i instanceof L&&s instanceof L)return new L(r.data.map((p,m)=>this._clamp(p,i.data[m],s.data[m])),r.typeInfo);const o=r,a=i,f=s;return new Q(this._clamp(o.value,a.value,f.value),r.typeInfo)}Cos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new Q(Math.cos(i.value),r.typeInfo)}Cosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new Q(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new Q(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let n=0;for(;e!==0;)1&e&&n++,e>>=1;return n}CountOneBits(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new Q(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let n=0;for(;!(1&e);)e>>=1,n++;return n}CountTrailingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new Q(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof L&&i instanceof L){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new L([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,n){const r=this.exec.evalExpression(e.args[0],n),i=180/Math.PI;return r instanceof L?new L(r.data.map(s=>s*i),r.typeInfo):new Q(r.value*i,this.getTypeInfo("f32"))}Determinant(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof $e){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new Q(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new Q(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new Q(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof L&&i instanceof L){let a=0;for(let f=0;f<r.data.length;++f)a+=(r.data[f]-i.data[f])*(r.data[f]-i.data[f]);return new Q(Math.sqrt(a),this.getTypeInfo("f32"))}const s=r,o=i;return new Q(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,n){let r=0;for(let i=0;i<e.length;++i)r+=n[i]*e[i];return r}Dot(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);return r instanceof L&&i instanceof L?new Q(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,n){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,n){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new Q(Math.exp(i.value),r.typeInfo)}Exp2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new Q(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,a=s.value;if(r instanceof L)return new L(r.data.map(p=>p>>o&(1<<a)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const f=r.value;return new Q(f>>o&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof L&&i instanceof L&&s instanceof L){const o=this._dot(i.data,s.data);return new L(o<0?Array.from(r.data):r.data.map(a=>-a),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new Q(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new Q(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new Q(Math.floor(i.value),r.typeInfo)}Fma(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof L&&i instanceof L&&s instanceof L)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new L(r.data.map((p,m)=>p*i.data[m]+s.data[m]),r.typeInfo);const o=r,a=i,f=s;return new Q(o.value*a.value+f.value,o.typeInfo)}Fract(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new Q(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,n){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n),o=this.exec.evalExpression(e.args[3],n);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=s.value,f=(1<<o.value)-1<<a,p=~f;if(r instanceof L&&i instanceof L)return new L(r.data.map((w,T)=>w&p|i.data[T]<<a&f),r.typeInfo);const m=r.value,v=i.value;return new Q(m&p|v<<a&f,r.typeInfo)}InverseSqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new Q(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,n){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L){let s=0;return r.data.forEach(o=>{s+=o*o}),new Q(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new Q(Math.abs(i.value),r.typeInfo)}Log(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new Q(Math.log(i.value),r.typeInfo)}Log2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new Q(Math.log2(i.value),r.typeInfo)}Max(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof L&&i instanceof L)return new L(r.data.map((a,f)=>Math.max(a,i.data[f])),r.typeInfo);const s=r,o=i;return new Q(Math.max(s.value,o.value),r.typeInfo)}Min(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof L&&i instanceof L)return new L(r.data.map((a,f)=>Math.min(a,i.data[f])),r.typeInfo);const s=r,o=i;return new Q(Math.min(s.value,o.value),r.typeInfo)}Mix(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof L&&i instanceof L&&s instanceof L)return new L(r.data.map((f,p)=>r.data[p]*(1-s.data[p])+i.data[p]*s.data[p]),r.typeInfo);const o=i,a=s;return new Q(r.value*(1-a.value)+o.value*a.value,r.typeInfo)}Modf(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof L&&i instanceof L)return new L(r.data.map((o,a)=>o%i.data[a]),r.typeInfo);const s=i;return new Q(r.value%s.value,r.typeInfo)}Normalize(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L){const i=this.Length(e,n).value;return new L(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof L&&i instanceof L)return new L(r.data.map((a,f)=>Math.pow(a,i.data[f])),r.typeInfo);const s=r,o=i;return new Q(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof L?new L(r.data.map(i=>i),r.typeInfo):new Q(r.value,r.typeInfo)}Radians(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof L?new L(r.data.map(i=>i*Math.PI/180),r.typeInfo):new Q(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof L&&i instanceof L){const s=this._dot(r.data,i.data);return new L(r.data.map((o,a)=>o-2*s*i.data[a]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof L&&i instanceof L&&s instanceof Q){const o=this._dot(i.data,r.data);return new L(r.data.map((a,f)=>{const p=1-s.value*s.value*(1-o*o);if(p<0)return 0;const m=Math.sqrt(p);return s.value*a-(s.value*o+m)*i.data[f]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,n){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new Q(Math.round(i.value),r.typeInfo)}Saturate(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new Q(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new Q(Math.sign(i.value),r.typeInfo)}Sin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new Q(Math.sin(i.value),r.typeInfo)}Sinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new Q(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,n,r){const i=Math.min(Math.max((r-e)/(n-e),0),1);return i*i*(3-2*i)}SmoothStep(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(s instanceof L&&r instanceof L&&i instanceof L)return new L(s.data.map((p,m)=>this._smoothstep(r.data[m],i.data[m],p)),s.typeInfo);const o=r,a=i,f=s;return new Q(this._smoothstep(o.value,a.value,f.value),s.typeInfo)}Sqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new Q(Math.sqrt(i.value),r.typeInfo)}Step(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(i instanceof L&&r instanceof L)return new L(i.data.map((o,a)=>o<r.data[a]?0:1),i.typeInfo);const s=r;return new Q(i.value<s.value?0:1,s.typeInfo)}Tan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new Q(Math.tan(i.value),r.typeInfo)}Tanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new Q(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const n=e.getTypeName();return n==="mat2x2f"||n==="mat2x2h"?e:n==="mat2x3f"?this.getTypeInfo("mat3x2f"):n==="mat2x3h"?this.getTypeInfo("mat3x2h"):n==="mat2x4f"?this.getTypeInfo("mat4x2f"):n==="mat2x4h"?this.getTypeInfo("mat4x2h"):n==="mat3x2f"?this.getTypeInfo("mat2x3f"):n==="mat3x2h"?this.getTypeInfo("mat2x3h"):n==="mat3x3f"||n==="mat3x3h"?e:n==="mat3x4f"?this.getTypeInfo("mat4x3f"):n==="mat3x4h"?this.getTypeInfo("mat4x3h"):n==="mat4x2f"?this.getTypeInfo("mat2x4f"):n==="mat4x2h"?this.getTypeInfo("mat2x4h"):n==="mat4x3f"?this.getTypeInfo("mat3x4f"):n==="mat4x3h"?this.getTypeInfo("mat3x4h"):(n==="mat4x4f"||n==="mat4x4h"||console.error(`Invalid matrix type ${n}`),e)}Transpose(e,n){const r=this.exec.evalExpression(e.args[0],n);if(!(r instanceof $e))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new $e([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new $e([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new $e([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new $e([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new $e([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new $e([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new $e([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new $e([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new $e([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof L)return new L(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new Q(Math.trunc(i.value),r.typeInfo)}Dpdx(e,n){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,n){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,n){return console.error("TODO: dpdxFine"),null}Dpdy(e,n){return console.error("TODO: dpdy"),null}DpdyCoarse(e,n){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,n){return console.error("TODO: dpdyFine"),null}Fwidth(e,n){return console.error("TODO: fwidth"),null}FwidthCoarse(e,n){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,n){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,n){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],n).value:0;if(r instanceof Hn){const s=r.name,o=n.getVariableValue(s);if(o instanceof Jr){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=o.getMipLevelSize(i),f=o.dimension;return f==="1d"?new Q(a[0],this.getTypeInfo("u32")):f==="3d"?new L(a,this.getTypeInfo("vec3u")):f==="2d"?new L(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${f} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,n){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,n){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length>2?this.exec.evalExpression(e.args[2],n).value:0;if(!(i instanceof L)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof Hn){const o=r.name,a=n.getVariableValue(o);if(a instanceof Jr){const f=Math.floor(i.data[0]),p=Math.floor(i.data[1]);if(f<0||f>=a.width||p<0||p>=a.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const m=a.getPixel(f,p,0,s);return m===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new L(m,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,n){const r=e.args[0];if(r instanceof Hn){const i=r.name,s=n.getVariableValue(i);return s instanceof Jr?new Q(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,n){const r=e.args[0];if(r instanceof Hn){const i=r.name,s=n.getVariableValue(i);return s instanceof Jr?new Q(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,n){const r=e.args[0];if(r instanceof Hn){const i=r.name,s=n.getVariableValue(i);return s instanceof Jr?new Q(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,n){return console.error("TODO: textureSample"),null}TextureSampleBias(e,n){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,n){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,n){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,n){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,n){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,n){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length===4?this.exec.evalExpression(e.args[2],n).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],n).data:this.exec.evalExpression(e.args[2],n).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof L)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof Hn){const a=r.name,f=n.getVariableValue(a);if(f instanceof Jr){const p=f.getMipLevelSize(0),m=Math.floor(i.data[0]),v=Math.floor(i.data[1]);return m<0||m>=p[0]||v<0||v>=p[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(f.setPixel(m,v,0,s,Array.from(o)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n);return n.getVariable(i).value.getSubData(this.exec,r.postfix,n)}AtomicStore(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),f=s.value.getSubData(this.exec,r.postfix,n);return f instanceof Q&&a instanceof Q&&(f.value=a.value),s.value instanceof Vt&&s.value.setDataValue(this.exec,f,r.postfix,n),null}AtomicAdd(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),f=s.value.getSubData(this.exec,r.postfix,n),p=new Q(f.value,f.typeInfo);return f instanceof Q&&a instanceof Q&&(f.value+=a.value),s.value instanceof Vt&&s.value.setDataValue(this.exec,f,r.postfix,n),p}AtomicSub(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),f=s.value.getSubData(this.exec,r.postfix,n),p=new Q(f.value,f.typeInfo);return f instanceof Q&&a instanceof Q&&(f.value-=a.value),s.value instanceof Vt&&s.value.setDataValue(this.exec,f,r.postfix,n),p}AtomicMax(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),f=s.value.getSubData(this.exec,r.postfix,n),p=new Q(f.value,f.typeInfo);return f instanceof Q&&a instanceof Q&&(f.value=Math.max(f.value,a.value)),s.value instanceof Vt&&s.value.setDataValue(this.exec,f,r.postfix,n),p}AtomicMin(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),f=s.value.getSubData(this.exec,r.postfix,n),p=new Q(f.value,f.typeInfo);return f instanceof Q&&a instanceof Q&&(f.value=Math.min(f.value,a.value)),s.value instanceof Vt&&s.value.setDataValue(this.exec,f,r.postfix,n),p}AtomicAnd(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),f=s.value.getSubData(this.exec,r.postfix,n),p=new Q(f.value,f.typeInfo);return f instanceof Q&&a instanceof Q&&(f.value=f.value&a.value),s.value instanceof Vt&&s.value.setDataValue(this.exec,f,r.postfix,n),p}AtomicOr(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),f=s.value.getSubData(this.exec,r.postfix,n),p=new Q(f.value,f.typeInfo);return f instanceof Q&&a instanceof Q&&(f.value=f.value|a.value),s.value instanceof Vt&&s.value.setDataValue(this.exec,f,r.postfix,n),p}AtomicXor(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),f=s.value.getSubData(this.exec,r.postfix,n),p=new Q(f.value,f.typeInfo);return f instanceof Q&&a instanceof Q&&(f.value=f.value^a.value),s.value instanceof Vt&&s.value.setDataValue(this.exec,f,r.postfix,n),p}AtomicExchange(e,n){let r=e.args[0];r instanceof Xt&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),f=s.value.getSubData(this.exec,r.postfix,n),p=new Q(f.value,f.typeInfo);return f instanceof Q&&a instanceof Q&&(f.value=a.value),s.value instanceof Vt&&s.value.setDataValue(this.exec,f,r.postfix,n),p}AtomicCompareExchangeWeak(e,n){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,n){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,n){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,n){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,n){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,n){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,n){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,n){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,n){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,n){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,n){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,n){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,n){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,n){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,n){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,n){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,n){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,n){return null}TextureBarrier(e,n){return null}WorkgroupBarrier(e,n){return null}WorkgroupUniformLoad(e,n){return null}SubgroupAdd(e,n){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,n){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,n){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,n){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,n){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,n){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,n){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,n){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,n){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,n){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,n){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,n){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,n){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,n){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,n){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,n){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,n){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,n){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,n){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,n){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,n){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,n){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,n){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,n){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,n){return console.error("TODO: quadSwapY"),null}}const Bh={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},kn={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class bn extends gI{constructor(e,n){var r;super(),this.ast=e??[],this.reflection=new Fr,this.reflection.updateAST(this.ast),this.context=(r=n==null?void 0:n.clone())!==null&&r!==void 0?r:new Ag,this.builtins=new mI(this),this.typeInfo={bool:this.getTypeInfo(ue.bool),i32:this.getTypeInfo(ue.i32),u32:this.getTypeInfo(ue.u32),f32:this.getTypeInfo(ue.f32),f16:this.getTypeInfo(ue.f16),vec2f:this.getTypeInfo(J.vec2f),vec2u:this.getTypeInfo(J.vec2u),vec2i:this.getTypeInfo(J.vec2i),vec2h:this.getTypeInfo(J.vec2h),vec3f:this.getTypeInfo(J.vec3f),vec3u:this.getTypeInfo(J.vec3u),vec3i:this.getTypeInfo(J.vec3i),vec3h:this.getTypeInfo(J.vec3h),vec4f:this.getTypeInfo(J.vec4f),vec4u:this.getTypeInfo(J.vec4u),vec4i:this.getTypeInfo(J.vec4i),vec4h:this.getTypeInfo(J.vec4h),mat2x2f:this.getTypeInfo(J.mat2x2f),mat2x3f:this.getTypeInfo(J.mat2x3f),mat2x4f:this.getTypeInfo(J.mat2x4f),mat3x2f:this.getTypeInfo(J.mat3x2f),mat3x3f:this.getTypeInfo(J.mat3x3f),mat3x4f:this.getTypeInfo(J.mat3x4f),mat4x2f:this.getTypeInfo(J.mat4x2f),mat4x3f:this.getTypeInfo(J.mat4x3f),mat4x4f:this.getTypeInfo(J.mat4x4f)}}getVariableValue(e){var n,r;const i=(r=(n=this.context.getVariable(e))===null||n===void 0?void 0:n.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof Q)return i.value;if(i instanceof L||i instanceof $e)return Array.from(i.data);if(i instanceof Vt&&i.typeInfo instanceof $i){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,n,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof n=="number")n=[n,1,1];else{if(n.length===0)return void console.error("Invalid dispatch count");n.length===1?n=[n[0],1,1]:n.length===2?n=[n[0],n[1],1]:n.length>3&&(n=[n[0],n[1],n[2]])}const a=n[0],f=n[1],p=n[2],m=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new L(n,m));for(const v in r)for(const w in r[v]){const T=r[v][w];s.variables.forEach(E=>{var I;const U=E.node;if(U!=null&&U.attributes){let R=null,P=null;for(const C of U.attributes)C.name==="binding"?R=C.value:C.name==="group"&&(P=C.value);if(w==R&&v==P)if(T.texture!==void 0&&T.descriptor!==void 0){const C=new Jr(T.texture,this.getTypeInfo(U.type),T.descriptor,(I=T.texture.view)!==null&&I!==void 0?I:null);E.value=C}else T.uniform!==void 0?E.value=new Vt(T.uniform,this.getTypeInfo(U.type)):E.value=new Vt(T,this.getTypeInfo(U.type))}})}for(let v=0;v<p;++v)for(let w=0;w<f;++w)for(let T=0;T<a;++T)s.setVariable("@workgroup_id",new L([T,w,v],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[T,w,v],s)}execStatement(e,n){if(e instanceof Mw)return this.evalExpression(e.value,n);if(e instanceof Ow){if(e.condition){const r=this.evalExpression(e.condition,n);if(!(r instanceof Q))throw new Error("Invalid break-if condition");if(!r.value)return null}return bn._breakObj}if(e instanceof Dw)return bn._continueObj;if(e instanceof el)this._let(e,n);else if(e instanceof ei)this._var(e,n);else if(e instanceof ic)this._const(e,n);else if(e instanceof El)this._function(e,n);else{if(e instanceof Iw)return this._if(e,n);if(e instanceof Rw)return this._switch(e,n);if(e instanceof Sw)return this._for(e,n);if(e instanceof Ew)return this._while(e,n);if(e instanceof kw)return this._loop(e,n);if(e instanceof md){const r=n.clone();return r.currentFunctionName=n.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof Pw)this._assign(e,n);else if(e instanceof Cw)this._increment(e,n);else{if(e instanceof Gr)return null;if(e instanceof rg){const r=e.name;n.getVariable(r)===null&&n.setVariable(r,new Q(0,this.getTypeInfo("u32")))}else if(e instanceof ig)this._call(e,n);else{if(e instanceof Nw||e instanceof sg)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,n){return e instanceof pr?this._evalBinaryOp(e,n):e instanceof Kt?this._evalLiteral(e,n):e instanceof Hn?this._evalVariable(e,n):e instanceof og?this._evalCall(e,n):e instanceof Or?this._evalCreate(e,n):e instanceof Bw?this._evalConst(e,n):e instanceof Fw?this._evalBitcast(e,n):e instanceof Xt?this._evalUnaryOp(e,n):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var n;if(e instanceof ue){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(n=this.typeInfo[e])!==null&&n!==void 0?n:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,n){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?n.setVariable(r,new Q(i,s.type)):s.type.name==="bool"?n.setVariable(r,new Q(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?n.setVariable(r,new L(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,n,r){const i=[1,1,1];for(const m of e.node.attributes)if(m.name==="workgroup_size"){if(m.value.length>0){const v=r.getVariableValue(m.value[0]);i[0]=v instanceof Q?v.value:parseInt(m.value[0])}if(m.value.length>1){const v=r.getVariableValue(m.value[1]);i[1]=v instanceof Q?v.value:parseInt(m.value[1])}if(m.value.length>2){const v=r.getVariableValue(m.value[2]);i[2]=v instanceof Q?v.value:parseInt(m.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new L(i,s));const a=i[0],f=i[1],p=i[2];for(let m=0,v=0;m<p;++m)for(let w=0;w<f;++w)for(let T=0;T<a;++T,++v){const E=[T,w,m],I=[T+n[0]*i[0],w+n[1]*i[1],m+n[2]*i[2]];r.setVariable("@local_invocation_id",new L(E,s)),r.setVariable("@global_invocation_id",new L(I,s)),r.setVariable("@local_invocation_index",new Q(v,o)),this._dispatchExec(e,r)}}_dispatchExec(e,n){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=n.getVariable(s);o!==void 0&&n.variables.set(r.name,o)}this._execStatements(e.node.body,n)}getVariableName(e,n){for(;e instanceof Xt;)e=e.right;return e instanceof Hn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,n){for(const r of e){if(r instanceof Array){const s=n.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,n);if(i)return i}return null}_call(e,n){const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],a=this.evalExpression(e.args[s],r);r.setVariable(o.name,a,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,n)}_increment(e,n){const r=this.getVariableName(e.variable,n),i=n.getVariable(r);i?e.operator==="++"?i.value instanceof Q?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof Q?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,n){if(e instanceof Hn){const r=this.getVariableName(e,n),i=n.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,n)}if(e instanceof Xt){if(e.operator==="*"){const r=this._getVariableData(e.right,n);return r instanceof Zs?r.reference.getSubData(this,e.postfix,n):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,n);return new Zs(r)}}return null}_assign(e,n){let r=null,i="<var>",s=null;if(e.variable instanceof Xt){const f=this._getVariableData(e.variable,n),p=this.evalExpression(e.value,n),m=e.operator;if(m==="="){if(f instanceof Q||f instanceof L||f instanceof $e){if(p instanceof Q||p instanceof L||p instanceof $e&&f.data.length===p.data.length)return void f.data.set(p.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(f instanceof Vt&&p instanceof Vt&&f.buffer.byteLength-f.offset>=p.buffer.byteLength-p.offset)return void(f.buffer.byteLength%4==0?new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4).set(new Uint32Array(p.buffer,p.offset,p.typeInfo.size/4)):new Uint8Array(f.buffer,f.offset,f.typeInfo.size).set(new Uint8Array(p.buffer,p.offset,p.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(m==="+=")return f instanceof Q||f instanceof L||f instanceof $e?p instanceof Q||p instanceof L||p instanceof $e?void f.data.set(p.data.map((v,w)=>f.data[w]+v)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(m==="-=")return(f instanceof Q||f instanceof L||f instanceof $e)&&(p instanceof Q||p instanceof L||p instanceof $e)?void f.data.set(p.data.map((v,w)=>f.data[w]-v)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Xt){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,n);const f=n.getVariable(i);if(!(f&&f.value instanceof Zs))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=f.value.reference;let p=e.variable.postfix;if(!p){let m=e.variable.right;for(;m instanceof Xt;){if(m.postfix){p=m.postfix;break}m=m.right}}p&&(r=r.getSubData(this,p,n))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,n);const f=n.getVariable(i);if(f===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=f.value}if(r instanceof Zs&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,n),a=e.operator;if(a==="=")if(r instanceof Vt)r.setDataValue(this,o,s,n);else if(s){if(!(r instanceof L||r instanceof $e))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof Uo){const f=this.evalExpression(s.index,n).value;if(r instanceof L){if(!(o instanceof Q))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[f]=o.value}else{if(!(r instanceof $e))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const p=this.evalExpression(s.index,n).value;if(p<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof L))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const m=r.typeInfo.getTypeName();if(m==="mat2x2"||m==="mat2x2f"||m==="mat2x2h"){if(!(p<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*p]=o.data[0],r.data[2*p+1]=o.data[1]}else if(m==="mat2x3"||m==="mat2x3f"||m==="mat2x3h"){if(!(p<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*p]=o.data[0],r.data[3*p+1]=o.data[1],r.data[3*p+2]=o.data[2]}else if(m==="mat2x4"||m==="mat2x4f"||m==="mat2x4h"){if(!(p<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*p]=o.data[0],r.data[4*p+1]=o.data[1],r.data[4*p+2]=o.data[2],r.data[4*p+3]=o.data[3]}else if(m==="mat3x2"||m==="mat3x2f"||m==="mat3x2h"){if(!(p<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*p]=o.data[0],r.data[2*p+1]=o.data[1]}else if(m==="mat3x3"||m==="mat3x3f"||m==="mat3x3h"){if(!(p<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*p]=o.data[0],r.data[3*p+1]=o.data[1],r.data[3*p+2]=o.data[2]}else if(m==="mat3x4"||m==="mat3x4f"||m==="mat3x4h"){if(!(p<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*p]=o.data[0],r.data[4*p+1]=o.data[1],r.data[4*p+2]=o.data[2],r.data[4*p+3]=o.data[3]}else if(m==="mat4x2"||m==="mat4x2f"||m==="mat4x2h"){if(!(p<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*p]=o.data[0],r.data[2*p+1]=o.data[1]}else if(m==="mat4x3"||m==="mat4x3f"||m==="mat4x3h"){if(!(p<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*p]=o.data[0],r.data[3*p+1]=o.data[1],r.data[3*p+2]=o.data[2]}else{if(m!=="mat4x4"&&m!=="mat4x4f"&&m!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(p<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*p]=o.data[0],r.data[4*p+1]=o.data[1],r.data[4*p+2]=o.data[2],r.data[4*p+3]=o.data[3]}}}}}else if(s instanceof Cs){const f=s.value;if(!(r instanceof L))return void console.error(`Invalid assignment to ${f}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof Q){if(f.length>1)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);if(f==="x")r.data[0]=o.value;else if(f==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(f==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(f==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof L))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(f.length!==o.data.length)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);for(let p=0;p<f.length;++p){const m=f[p];if(m==="x"||m==="r")r.data[0]=o.data[p];else if(m==="y"||m==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[p]}else if(m==="z"||m==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[p]}else{if(m!=="w"&&m!=="a")return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${m} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[p]}}}}}else r instanceof Q&&o instanceof Q?r.value=o.value:r instanceof L&&o instanceof L||r instanceof $e&&o instanceof $e?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const f=r.getSubData(this,s,n);if(f instanceof L&&o instanceof Q){const p=f.data,m=o.value;if(a==="+=")for(let v=0;v<p.length;++v)p[v]+=m;else if(a==="-=")for(let v=0;v<p.length;++v)p[v]-=m;else if(a==="*=")for(let v=0;v<p.length;++v)p[v]*=m;else if(a==="/=")for(let v=0;v<p.length;++v)p[v]/=m;else if(a==="%=")for(let v=0;v<p.length;++v)p[v]%=m;else if(a==="&=")for(let v=0;v<p.length;++v)p[v]&=m;else if(a==="|=")for(let v=0;v<p.length;++v)p[v]|=m;else if(a==="^=")for(let v=0;v<p.length;++v)p[v]^=m;else if(a==="<<=")for(let v=0;v<p.length;++v)p[v]<<=m;else if(a===">>=")for(let v=0;v<p.length;++v)p[v]>>=m;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(f instanceof L&&o instanceof L){const p=f.data,m=o.data;if(p.length!==m.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let v=0;v<p.length;++v)p[v]+=m[v];else if(a==="-=")for(let v=0;v<p.length;++v)p[v]-=m[v];else if(a==="*=")for(let v=0;v<p.length;++v)p[v]*=m[v];else if(a==="/=")for(let v=0;v<p.length;++v)p[v]/=m[v];else if(a==="%=")for(let v=0;v<p.length;++v)p[v]%=m[v];else if(a==="&=")for(let v=0;v<p.length;++v)p[v]&=m[v];else if(a==="|=")for(let v=0;v<p.length;++v)p[v]|=m[v];else if(a==="^=")for(let v=0;v<p.length;++v)p[v]^=m[v];else if(a==="<<=")for(let v=0;v<p.length;++v)p[v]<<=m[v];else if(a===">>=")for(let v=0;v<p.length;++v)p[v]>>=m[v];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(f instanceof Q&&o instanceof Q))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?f.value+=o.value:a==="-="?f.value-=o.value:a==="*="?f.value*=o.value:a==="/="?f.value/=o.value:a==="%="?f.value%=o.value:a==="&="?f.value&=o.value:a==="|="?f.value|=o.value:a==="^="?f.value^=o.value:a==="<<="?f.value<<=o.value:a===">>="?f.value>>=o.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}r instanceof Vt&&r.setDataValue(this,f,s,n)}}_function(e,n){const r=new lg(e);n.functions.set(e.name,r)}_const(e,n){let r=null;e.value!==null&&(r=this.evalExpression(e.value,n)),n.createVariable(e.name,r,e)}_let(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xt||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new Or(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_var(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Xt||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof tl||e.type instanceof Gr||e.type instanceof J){const s=new Or(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_switch(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof Q))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof Vw)for(const o of s.selectors){if(o instanceof sc){i=s;continue}const a=this.evalExpression(o,n);if(!(a instanceof Q))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(s.body,n)}else s instanceof zw&&(i=s);return i?this._execStatements(i.body,n):null}_if(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof Q))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,n);for(const i of e.elseif){const s=this.evalExpression(i.condition,n);if(!(s instanceof Q))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,n)}return e.else?this._execStatements(e.else,n):null}_getScalarValue(e){return e instanceof Q?e.value:(console.error("Expected scalar value.",e),0)}_for(e,n){for(n=n.clone(),this.execStatement(e.init,n);this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===bn._breakObj)break;if(r!==null&&r!==bn._continueObj)return r;this.execStatement(e.increment,n)}return null}_loop(e,n){for(n=n.clone();;){const r=this._execStatements(e.body,n);if(r===bn._breakObj)break;if(r===bn._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,n)===bn._breakObj)break}else if(r!==null)return r}return null}_while(e,n){for(n=n.clone();this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===bn._breakObj)break;if(r!==bn._continueObj&&r!==null)return r}return null}_evalBitcast(e,n){const r=this.evalExpression(e.value,n),i=e.type;if(r instanceof Q){const s=p_(r.value,r.typeInfo.name,i.name);return new Q(s,this.getTypeInfo(i))}if(r instanceof L){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const a=i.getTypeName();let f="";if(a.endsWith("f"))f="f32";else if(a.endsWith("i"))f="i32";else if(a.endsWith("u"))f="u32";else if(a.endsWith("b"))f="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${f}. Line ${e.line}`),null;f="f16"}const p=function(m,v,w){if(v===w)return m;const T=new Array(m.length);for(let E=0;E<m.length;E++)T[E]=p_(m[E],v,w);return T}(Array.from(r.data),o,f);return new L(p,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,n){return n.getVariableValue(e.name).clone().getSubData(this,e.postfix,n)}_evalCreate(e,n){var r;if(e instanceof Or){if(e.type===null)return _d.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,n);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,n);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,n)}}const i=e instanceof Or?e.type.name:e.name,s=e instanceof Or?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new Vt(new ArrayBuffer(s.size),s,0);if(s instanceof Ii){if(e.args)for(let a=0;a<e.args.length;++a){const f=s.members[a],p=e.args[a],m=this.evalExpression(p,n);o.setData(this,m,f.type,f.offset,n)}}else if(s instanceof $i){let a=0;if(e.args)for(let f=0;f<e.args.length;++f){const p=e.args[f],m=this.evalExpression(p,n);s.format===null&&(((r=m.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=m.typeInfo),o.setData(this,m,s.format,a,n),a+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Or?o.getSubData(this,e.postfix,n):o}_evalLiteral(e,n){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new Q(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,n):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,n):e.value}_evalVariable(e,n){const r=n.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,n)}_maxFormatTypeInfo(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=bn._priority.get(n.name);bn._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?this.getTypeInfo("i32"):n}_evalUnaryOp(e,n){const r=this.evalExpression(e.right,n);if(e.operator==="&")return new Zs(r);if(e.operator==="*")return r instanceof Zs?r.reference.getSubData(this,e.postfix,n):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof Q?r.value:r instanceof L?Array.from(r.data):null;switch(e.operator){case"+":{if(Pe(i)){const a=i.map((f,p)=>+f);return new L(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Q(+s,o)}case"-":{if(Pe(i)){const a=i.map((f,p)=>-f);return new L(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Q(-s,o)}case"!":{if(Pe(i)){const a=i.map((f,p)=>f?0:1);return new L(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Q(s?0:1,o)}case"~":{if(Pe(i)){const a=i.map((f,p)=>~f);return new L(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new Q(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,n){const r=this.evalExpression(e.left,n),i=this.evalExpression(e.right,n),s=r instanceof Q?r.value:r instanceof L||r instanceof $e?Array.from(r.data):null,o=i instanceof Q?i.value:i instanceof L||i instanceof $e?Array.from(i.data):null;switch(e.operator){case"+":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T+v[E]);return new L(w,r.typeInfo)}if(Pe(s)){const m=o,v=s.map((w,T)=>w+m);return new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m+w);return new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a+f,p)}case"-":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T-v[E]);return new L(w,r.typeInfo)}if(Pe(s)){const m=o,v=s.map((w,T)=>w-m);return new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m-w);return new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a-f,p)}case"*":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(r instanceof $e&&i instanceof $e){const w=function(U,R,P,C){if(kn[R.name]===void 0||kn[C.name]===void 0)return null;const D=kn[R.name][0],$=kn[R.name][1],q=kn[C.name][0];if(D!==kn[C.name][1])return null;const fe=new Array(q*$);for(let ae=0;ae<$;ae++)for(let he=0;he<q;he++){let ye=0;for(let ke=0;ke<D;ke++)ye+=U[ke*$+ae]*P[he*D+ke];fe[ae*q+he]=ye}return fe}(m,r.typeInfo,v,i.typeInfo);if(w===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const T=kn[i.typeInfo.name][0],E=kn[r.typeInfo.name][1],I=this.getTypeInfo(`mat${T}x${E}f`);return new $e(w,I)}if(r instanceof $e&&i instanceof L){const w=function(T,E,I,U){if(kn[E.name]===void 0||Bh[U.name]===void 0)return null;const R=kn[E.name][0],P=kn[E.name][1];if(R!==I.length)return null;const C=new Array(P);for(let D=0;D<P;D++){let $=0;for(let q=0;q<R;q++)$+=T[q*P+D]*I[q];C[D]=$}return C}(m,r.typeInfo,v,i.typeInfo);return w===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new L(w,i.typeInfo)}if(r instanceof L&&i instanceof $e){const w=function(T,E,I,U){if(Bh[E.name]===void 0||kn[U.name]===void 0)return null;const R=kn[U.name][0],P=kn[U.name][1];if(P!==T.length)return null;const C=[];for(let D=0;D<R;D++){let $=0;for(let q=0;q<P;q++)$+=T[q]*I[q*R+D];C[D]=$}return C}(m,r.typeInfo,v,i.typeInfo);return w===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new L(w,r.typeInfo)}{if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T*v[E]);return new L(w,r.typeInfo)}}if(Pe(s)){const m=o,v=s.map((w,T)=>w*m);return r instanceof $e?new $e(v,r.typeInfo):new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m*w);return i instanceof $e?new $e(v,i.typeInfo):new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a*f,p)}case"%":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T%v[E]);return new L(w,r.typeInfo)}if(Pe(s)){const m=o,v=s.map((w,T)=>w%m);return new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m%w);return new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a%f,p)}case"/":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T/v[E]);return new L(w,r.typeInfo)}if(Pe(s)){const m=o,v=s.map((w,T)=>w/m);return new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m/w);return new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a/f,p)}case"&":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T&v[E]);return new L(w,r.typeInfo)}if(Pe(s)){const m=o,v=s.map((w,T)=>w&m);return new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m&w);return new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a&f,p)}case"|":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T|v[E]);return new L(w,r.typeInfo)}if(Pe(s)){const m=o,v=s.map((w,T)=>w|m);return new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m|w);return new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a|f,p)}case"^":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T^v[E]);return new L(w,r.typeInfo)}if(Pe(s)){const m=o,v=s.map((w,T)=>w^m);return new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m^w);return new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a^f,p)}case"<<":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T<<v[E]);return new L(w,r.typeInfo)}if(Pe(s)){const m=o,v=s.map((w,T)=>w<<m);return new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m<<w);return new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a<<f,p)}case">>":{if(Pe(s)&&Pe(o)){const m=s,v=o;if(m.length!==v.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const w=m.map((T,E)=>T>>v[E]);return new L(w,r.typeInfo)}if(Pe(s)){const m=o,v=s.map((w,T)=>w>>m);return new L(v,r.typeInfo)}if(Pe(o)){const m=s,v=o.map((w,T)=>m>>w);return new L(v,i.typeInfo)}const a=s,f=o,p=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new Q(a>>f,p)}case">":if(Pe(s)&&Pe(o)){const a=s,f=o;if(a.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const p=a.map((m,v)=>m>f[v]?1:0);return new L(p,r.typeInfo)}if(Pe(s)){const a=o,f=s.map((p,m)=>p>a?1:0);return new L(f,r.typeInfo)}if(Pe(o)){const a=s,f=o.map((p,m)=>a>p?1:0);return new L(f,i.typeInfo)}return new Q(s>o?1:0,this.getTypeInfo("bool"));case"<":if(Pe(s)&&Pe(o)){const a=s,f=o;if(a.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const p=a.map((m,v)=>m<f[v]?1:0);return new L(p,r.typeInfo)}if(Pe(s)){const a=o,f=s.map((p,m)=>p<a?1:0);return new L(f,r.typeInfo)}if(Pe(o)){const a=s,f=o.map((p,m)=>a<p?1:0);return new L(f,i.typeInfo)}return new Q(s<o?1:0,this.getTypeInfo("bool"));case"==":if(Pe(s)&&Pe(o)){const a=s,f=o;if(a.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const p=a.map((m,v)=>m===f[v]?1:0);return new L(p,r.typeInfo)}if(Pe(s)){const a=o,f=s.map((p,m)=>p==a?1:0);return new L(f,r.typeInfo)}if(Pe(o)){const a=s,f=o.map((p,m)=>a==p?1:0);return new L(f,i.typeInfo)}return new Q(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(Pe(s)&&Pe(o)){const a=s,f=o;if(a.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const p=a.map((m,v)=>m!==f[v]?1:0);return new L(p,r.typeInfo)}if(Pe(s)){const a=o,f=s.map((p,m)=>p!==a?1:0);return new L(f,r.typeInfo)}if(Pe(o)){const a=s,f=o.map((p,m)=>a!==p?1:0);return new L(f,i.typeInfo)}return new Q(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(Pe(s)&&Pe(o)){const a=s,f=o;if(a.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const p=a.map((m,v)=>m>=f[v]?1:0);return new L(p,r.typeInfo)}if(Pe(s)){const a=o,f=s.map((p,m)=>p>=a?1:0);return new L(f,r.typeInfo)}if(Pe(o)){const a=s,f=o.map((p,m)=>a>=p?1:0);return new L(f,i.typeInfo)}return new Q(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(Pe(s)&&Pe(o)){const a=s,f=o;if(a.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const p=a.map((m,v)=>m<=f[v]?1:0);return new L(p,r.typeInfo)}if(Pe(s)){const a=o,f=s.map((p,m)=>p<=a?1:0);return new L(f,r.typeInfo)}if(Pe(o)){const a=s,f=o.map((p,m)=>a<=p?1:0);return new L(f,i.typeInfo)}return new Q(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(Pe(s)&&Pe(o)){const a=s,f=o;if(a.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const p=a.map((m,v)=>m&&f[v]?1:0);return new L(p,r.typeInfo)}if(Pe(s)){const a=o,f=s.map((p,m)=>p&&a?1:0);return new L(f,r.typeInfo)}if(Pe(o)){const a=s,f=o.map((p,m)=>a&&p?1:0);return new L(f,i.typeInfo)}return new Q(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(Pe(s)&&Pe(o)){const a=s,f=o;if(a.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const p=a.map((m,v)=>m||f[v]?1:0);return new L(p,r.typeInfo)}if(Pe(s)){const a=o,f=s.map((p,m)=>p||a?1:0);return new L(f,r.typeInfo)}if(Pe(o)){const a=s,f=o.map((p,m)=>a||p?1:0);return new L(f,i.typeInfo)}return new Q(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,n){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,n):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],a=this.evalExpression(e.args[s],r);r.createVariable(o.name,a,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,n){switch(e.name){case"all":return this.builtins.All(e,n);case"any":return this.builtins.Any(e,n);case"select":return this.builtins.Select(e,n);case"arrayLength":return this.builtins.ArrayLength(e,n);case"abs":return this.builtins.Abs(e,n);case"acos":return this.builtins.Acos(e,n);case"acosh":return this.builtins.Acosh(e,n);case"asin":return this.builtins.Asin(e,n);case"asinh":return this.builtins.Asinh(e,n);case"atan":return this.builtins.Atan(e,n);case"atanh":return this.builtins.Atanh(e,n);case"atan2":return this.builtins.Atan2(e,n);case"ceil":return this.builtins.Ceil(e,n);case"clamp":return this.builtins.Clamp(e,n);case"cos":return this.builtins.Cos(e,n);case"cosh":return this.builtins.Cosh(e,n);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,n);case"countOneBits":return this.builtins.CountOneBits(e,n);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,n);case"cross":return this.builtins.Cross(e,n);case"degrees":return this.builtins.Degrees(e,n);case"determinant":return this.builtins.Determinant(e,n);case"distance":return this.builtins.Distance(e,n);case"dot":return this.builtins.Dot(e,n);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,n);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,n);case"exp":return this.builtins.Exp(e,n);case"exp2":return this.builtins.Exp2(e,n);case"extractBits":return this.builtins.ExtractBits(e,n);case"faceForward":return this.builtins.FaceForward(e,n);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,n);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,n);case"floor":return this.builtins.Floor(e,n);case"fma":return this.builtins.Fma(e,n);case"fract":return this.builtins.Fract(e,n);case"frexp":return this.builtins.Frexp(e,n);case"insertBits":return this.builtins.InsertBits(e,n);case"inverseSqrt":return this.builtins.InverseSqrt(e,n);case"ldexp":return this.builtins.Ldexp(e,n);case"length":return this.builtins.Length(e,n);case"log":return this.builtins.Log(e,n);case"log2":return this.builtins.Log2(e,n);case"max":return this.builtins.Max(e,n);case"min":return this.builtins.Min(e,n);case"mix":return this.builtins.Mix(e,n);case"modf":return this.builtins.Modf(e,n);case"normalize":return this.builtins.Normalize(e,n);case"pow":return this.builtins.Pow(e,n);case"quantizeToF16":return this.builtins.QuantizeToF16(e,n);case"radians":return this.builtins.Radians(e,n);case"reflect":return this.builtins.Reflect(e,n);case"refract":return this.builtins.Refract(e,n);case"reverseBits":return this.builtins.ReverseBits(e,n);case"round":return this.builtins.Round(e,n);case"saturate":return this.builtins.Saturate(e,n);case"sign":return this.builtins.Sign(e,n);case"sin":return this.builtins.Sin(e,n);case"sinh":return this.builtins.Sinh(e,n);case"smoothStep":return this.builtins.SmoothStep(e,n);case"sqrt":return this.builtins.Sqrt(e,n);case"step":return this.builtins.Step(e,n);case"tan":return this.builtins.Tan(e,n);case"tanh":return this.builtins.Tanh(e,n);case"transpose":return this.builtins.Transpose(e,n);case"trunc":return this.builtins.Trunc(e,n);case"dpdx":return this.builtins.Dpdx(e,n);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,n);case"dpdxFine":return this.builtins.DpdxFine(e,n);case"dpdy":return this.builtins.Dpdy(e,n);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,n);case"dpdyFine":return this.builtins.DpdyFine(e,n);case"fwidth":return this.builtins.Fwidth(e,n);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,n);case"fwidthFine":return this.builtins.FwidthFine(e,n);case"textureDimensions":return this.builtins.TextureDimensions(e,n);case"textureGather":return this.builtins.TextureGather(e,n);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,n);case"textureLoad":return this.builtins.TextureLoad(e,n);case"textureNumLayers":return this.builtins.TextureNumLayers(e,n);case"textureNumLevels":return this.builtins.TextureNumLevels(e,n);case"textureNumSamples":return this.builtins.TextureNumSamples(e,n);case"textureSample":return this.builtins.TextureSample(e,n);case"textureSampleBias":return this.builtins.TextureSampleBias(e,n);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,n);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,n);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,n);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,n);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,n);case"textureStore":return this.builtins.TextureStore(e,n);case"atomicLoad":return this.builtins.AtomicLoad(e,n);case"atomicStore":return this.builtins.AtomicStore(e,n);case"atomicAdd":return this.builtins.AtomicAdd(e,n);case"atomicSub":return this.builtins.AtomicSub(e,n);case"atomicMax":return this.builtins.AtomicMax(e,n);case"atomicMin":return this.builtins.AtomicMin(e,n);case"atomicAnd":return this.builtins.AtomicAnd(e,n);case"atomicOr":return this.builtins.AtomicOr(e,n);case"atomicXor":return this.builtins.AtomicXor(e,n);case"atomicExchange":return this.builtins.AtomicExchange(e,n);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,n);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,n);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,n);case"pack4xI8":return this.builtins.Pack4xI8(e,n);case"pack4xU8":return this.builtins.Pack4xU8(e,n);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,n);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,n);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,n);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,n);case"pack2x16float":return this.builtins.Pack2x16float(e,n);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,n);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,n);case"unpack4xI8":return this.builtins.Unpack4xI8(e,n);case"unpack4xU8":return this.builtins.Unpack4xU8(e,n);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,n);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,n);case"unpack2x16float":return this.builtins.Unpack2x16float(e,n);case"storageBarrier":return this.builtins.StorageBarrier(e,n);case"textureBarrier":return this.builtins.TextureBarrier(e,n);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,n);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,n);case"subgroupAdd":return this.builtins.SubgroupAdd(e,n);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,n);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,n);case"subgroupAll":return this.builtins.SubgroupAll(e,n);case"subgroupAnd":return this.builtins.SubgroupAnd(e,n);case"subgroupAny":return this.builtins.SubgroupAny(e,n);case"subgroupBallot":return this.builtins.SubgroupBallot(e,n);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,n);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,n);case"subgroupElect":return this.builtins.SubgroupElect(e,n);case"subgroupMax":return this.builtins.SubgroupMax(e,n);case"subgroupMin":return this.builtins.SubgroupMin(e,n);case"subgroupMul":return this.builtins.SubgroupMul(e,n);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,n);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,n);case"subgroupOr":return this.builtins.SubgroupOr(e,n);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,n);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,n);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,n);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,n);case"subgroupXor":return this.builtins.SubgroupXor(e,n);case"quadBroadcast":return this.builtins.QuadBroadcast(e,n);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,n);case"quadSwapX":return this.builtins.QuadSwapX(e,n);case"quadSwapY":return this.builtins.QuadSwapY(e,n)}const r=n.getFunction(e.name);if(r){const i=n.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],a=this.evalExpression(e.args[s],i);i.setVariable(o.name,a,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,n){if(!e.args||e.args.length===0)return new Q(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],n);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,n).clone()}_callConstructorVec(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=Bh[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Kt)if(e.isVector){const a=e.vectorValue;for(const f of a)o.push(f)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const f=this.evalExpression(a,n);if(f instanceof L){const p=f.data;for(let m=0;m<p.length;++m){let v=p[m];o.push(v)}}else if(f instanceof Q){let p=f.value;o.push(p)}}if(e.type instanceof J&&e.type.format===null&&(e.type.format=J.f32),o.length===0){const a=new Array(s).fill(0);return new L(a,r).getSubData(this,e.postfix,n)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new L(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,n)}_callConstructorMatrix(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=kn[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof Kt)if(e.isVector){const a=e.vectorValue;for(const f of a)o.push(f)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const f=this.evalExpression(a,n);f instanceof L?o.push(...f.data):f instanceof Q?o.push(f.value):f instanceof $e&&o.push(...f.data)}if(r instanceof Ss&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const a=new Array(s[2]).fill(0);return new $e(a,r).getSubData(this,e.postfix,n)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new $e(o,r).getSubData(this,e.postfix,n)}}bn._breakObj=new cr(new sr("BREAK",null),null),bn._continueObj=new cr(new sr("CONTINUE",null),null),bn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class _I{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class yI{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new _I,this._exec=new bn,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Hn){const o=s.name,a=this._context.constants.get(o);if(a)try{const f=a.constEvaluate(this._exec);i.count=f}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of n)r.search(i=>{i instanceof h_||i instanceof Dh?i.type=this._forwardType(i.type):i instanceof tl?i.format=this._forwardType(i.format):i instanceof ei||i instanceof el||i instanceof ic?i.type=this._forwardType(i.type):i instanceof El?i.returnType=this._forwardType(i.returnType):i instanceof f_&&(i.type=this._forwardType(i.type))});return n}_forwardType(e){if(e instanceof u_){const n=this._getType(e.name);if(n)return n}else e instanceof Dh?e.type=this._forwardType(e.type):e instanceof tl&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const n=new lI(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,n){return e.line=n??this._currentLine,e}_error(e,n){return{token:e,message:n,toString:()=>`${n}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==B.eof}_match(e){if(e instanceof K)return!!this._check(e)&&(this._advance(),!0);for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),`${n}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;let i=!1;for(const s of e){if(r===s)return!0;s===B.tokens.name&&(i=!0)}if(i){const s=B.tokens.name.rule.exec(n.lexeme);if(s&&s.index==0&&s[0]==n.lexeme)return!0}return!1}if(n.type===e)return!0;if(e===B.tokens.name){const r=B.tokens.name.rule.exec(n.lexeme);return r&&r.index==0&&r[0]==n.lexeme}return!1}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(B.tokens.semicolon)&&!this._isAtEnd(););if(this._match(B.keywords.alias)){const n=this._type_alias();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(B.keywords.diagnostic)){const n=this._diagnostic();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(B.keywords.requires)){const n=this._requires_directive();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(B.keywords.enable)){const n=this._enable_directive();return this._consume(B.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}const e=this._attribute();if(this._check(B.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(B.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(B.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(B.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(B.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(B.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}if(this._check(B.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}return null}_function_decl(){if(!this._match(B.keywords.fn))return null;const e=this._currentLine,n=this._consume(B.tokens.ident,"Expected function name.").toString();this._consume(B.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(B.tokens.paren_right))do{if(this._check(B.tokens.paren_right))break;const a=this._attribute(),f=this._consume(B.tokens.name,"Expected argument name.").toString();this._consume(B.tokens.colon,"Expected ':' for argument type.");const p=this._attribute(),m=this._type_decl();m!=null&&(m.attributes=p,r.push(this._updateNode(new f_(f,m,a))))}while(this._match(B.tokens.comma));this._consume(B.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(B.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new El(n,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(B.tokens.brace_left,"Expected '{' for block.");!this._check(B.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(B.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(B.tokens.semicolon)&&!this._isAtEnd(););if(this._check(B.tokens.attr)&&this._attribute(),this._check(B.keywords.if))return this._if_statement();if(this._check(B.keywords.switch))return this._switch_statement();if(this._check(B.keywords.loop))return this._loop_statement();if(this._check(B.keywords.for))return this._for_statement();if(this._check(B.keywords.while))return this._while_statement();if(this._check(B.keywords.continuing))return this._continuing_statement();if(this._check(B.keywords.static_assert))return this._static_assert_statement();if(this._check(B.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(B.keywords.return))e=this._return_statement();else if(this._check([B.keywords.var,B.keywords.let,B.keywords.const]))e=this._variable_statement();else if(this._match(B.keywords.discard))e=this._updateNode(new sI);else if(this._match(B.keywords.break)){const n=this._updateNode(new Ow);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n,this._check(B.keywords.if)&&(this._advance(),n.condition=this._optional_paren_expression())}else if(this._match(B.keywords.continue)){const n=this._updateNode(new Dw);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${n.line}`);{const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(B.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(B.keywords.static_assert))return null;const e=this._currentLine,n=this._optional_paren_expression();return this._updateNode(new nI(n),e)}_while_statement(){if(!this._match(B.keywords.while))return null;const e=this._updateNode(new Ew(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(B.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(B.keywords.continuing))return null;const n=this._currentLine,r=this._compound_statement();return this._updateNode(new md(r,e),n)}_for_statement(){if(!this._match(B.keywords.for))return null;this._consume(B.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Sw(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(B.tokens.semicolon)?null:this._for_init(),this._consume(B.tokens.semicolon,"Expected ';'."),e.condition=this._check(B.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(B.tokens.semicolon,"Expected ';'."),e.increment=this._check(B.tokens.paren_right)?null:this._for_increment(),this._consume(B.tokens.paren_right,"Expected ')'."),this._check(B.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(B.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(B.tokens.equal)&&(n=this._short_circuit_or_expression()),this._updateNode(new ei(e.name,e.type,e.storage,e.access,n),e.line)}if(this._match(B.keywords.let)){const e=this._currentLine,n=this._consume(B.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(B.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(B.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new el(n,r,null,null,i),e)}if(this._match(B.keywords.const)){const e=this._currentLine,n=this._consume(B.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(B.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(B.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof Kt&&(r=i.type),this._updateNode(new ic(n,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(B.increment_operators))return this._current=e,null;const r=this._consume(B.increment_operators,"Expected increment operator");return this._updateNode(new Cw(r.type===B.tokens.plus_plus?fo.increment:fo.decrement,n))}_assignment_statement(){let e=null;const n=this._currentLine;if(this._check(B.tokens.brace_right))return null;let r=this._match(B.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(B.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new Pw(Fa.parse(i.lexeme),e,s),n)}_func_call_statement(){if(!this._check(B.tokens.ident))return null;const e=this._currentLine,n=this._current,r=this._consume(B.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=n,null):this._updateNode(new ig(r.lexeme,i),e)}_loop_statement(){if(!this._match(B.keywords.loop))return null;this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new kw([],null));this._currentLoop.push(e);let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.body.push(r);else e.body.push(n);if(n instanceof md){e.continuing=n;break}n=this._statement()}return this._currentLoop.pop(),this._consume(B.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(B.keywords.switch))return null;const e=this._updateNode(new Rw(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(B.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let n=!1;for(;this._check([B.keywords.default,B.keywords.case]);){if(this._match(B.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof sc){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");n=!0;break}this._match(B.tokens.colon),this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(B.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Vw(r,i)))}if(this._match(B.keywords.default)){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(B.tokens.colon),this._check(B.tokens.attr)&&this._attribute(),this._consume(B.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(B.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new zw(r)))}}return e}_case_selectors(){const e=[];for(this._match(B.keywords.default)?e.push(this._updateNode(new sc)):e.push(this._shift_expression());this._match(B.tokens.comma);)this._match(B.keywords.default)?e.push(this._updateNode(new sc)):e.push(this._shift_expression());return e}_case_body(){if(this._match(B.keywords.fallthrough))return this._consume(B.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(B.keywords.if))return null;const e=this._currentLine,n=this._optional_paren_expression();this._check(B.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(B.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(B.keywords.else)&&(this._check(B.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new Iw(n,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===B.keywords.else&&this._tokens[this._current+1].type===B.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new oI(n,r))),this._match_elseif()&&(this._check(B.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(B.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new Mw(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(B.tokens.or_or);)e=this._updateNode(new pr(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(B.tokens.and_and);)e=this._updateNode(new pr(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(B.tokens.or);)e=this._updateNode(new pr(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(B.tokens.xor);)e=this._updateNode(new pr(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(B.tokens.and);)e=this._updateNode(new pr(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([B.tokens.equal_equal,B.tokens.not_equal])?this._updateNode(new pr(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([B.tokens.less_than,B.tokens.greater_than,B.tokens.less_than_equal,B.tokens.greater_than_equal]);)e=this._updateNode(new pr(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([B.tokens.shift_left,B.tokens.shift_right]);)e=this._updateNode(new pr(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([B.tokens.plus,B.tokens.minus]);)e=this._updateNode(new pr(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([B.tokens.star,B.tokens.forward_slash,B.tokens.modulo]);)e=this._updateNode(new pr(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([B.tokens.minus,B.tokens.bang,B.tokens.tilde,B.tokens.star,B.tokens.and])?this._updateNode(new Xt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(B.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(B.tokens.bracket_right,"Expected ']'.");const n=this._updateNode(new Uo(e)),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(B.tokens.period)){const e=this._consume(B.tokens.name,"Expected member name."),n=this._postfix_expression(),r=this._updateNode(new Cs(e.lexeme));return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const n=this._getStruct(e);if(n!==null)return n;switch(e){case"void":return ue.void;case"bool":return ue.bool;case"i32":return ue.i32;case"u32":return ue.u32;case"f32":return ue.f32;case"f16":return ue.f16;case"vec2f":return J.vec2f;case"vec3f":return J.vec3f;case"vec4f":return J.vec4f;case"vec2i":return J.vec2i;case"vec3i":return J.vec3i;case"vec4i":return J.vec4i;case"vec2u":return J.vec2u;case"vec3u":return J.vec3u;case"vec4u":return J.vec4u;case"vec2h":return J.vec2h;case"vec3h":return J.vec3h;case"vec4h":return J.vec4h;case"mat2x2f":return J.mat2x2f;case"mat2x3f":return J.mat2x3f;case"mat2x4f":return J.mat2x4f;case"mat3x2f":return J.mat3x2f;case"mat3x3f":return J.mat3x3f;case"mat3x4f":return J.mat3x4f;case"mat4x2f":return J.mat4x2f;case"mat4x3f":return J.mat4x3f;case"mat4x4f":return J.mat4x4f;case"mat2x2h":return J.mat2x2h;case"mat2x3h":return J.mat2x3h;case"mat2x4h":return J.mat2x4h;case"mat3x2h":return J.mat3x2h;case"mat3x3h":return J.mat3x3h;case"mat3x4h":return J.mat3x4h;case"mat4x2h":return J.mat4x2h;case"mat4x3h":return J.mat4x3h;case"mat4x4h":return J.mat4x4h;case"mat2x2i":return J.mat2x2i;case"mat2x3i":return J.mat2x3i;case"mat2x4i":return J.mat2x4i;case"mat3x2i":return J.mat3x2i;case"mat3x3i":return J.mat3x3i;case"mat3x4i":return J.mat3x4i;case"mat4x2i":return J.mat4x2i;case"mat4x3i":return J.mat4x3i;case"mat4x4i":return J.mat4x4i;case"mat2x2u":return J.mat2x2u;case"mat2x3u":return J.mat2x3u;case"mat2x4u":return J.mat2x4u;case"mat3x2u":return J.mat3x2u;case"mat3x3u":return J.mat3x3u;case"mat3x4u":return J.mat3x4u;case"mat4x2u":return J.mat4x2u;case"mat4x3u":return J.mat4x3u;case"mat4x4u":return J.mat4x4u}return null}_validateTypeRange(e,n){if(n.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(n.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(B.tokens.ident)){const r=this._previous().toString();if(this._check(B.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new Or(s,i)):this._updateNode(new og(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new Bw(r,i.value))}return this._updateNode(new Hn(r))}if(this._match(B.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?ue.i32:r.endsWith("u")||r.endsWith("U")?ue.u32:ue.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new Kt(new Q(s,this._exec.getTypeInfo(i)),i))}if(this._match(B.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,ue.u32),this._updateNode(new Kt(new Q(r,this._exec.getTypeInfo(ue.u32)),ue.u32))}if(this._match([B.tokens.decimal_float_literal,B.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?ue.f16:ue.f32);const o=i?ue.f16:ue.f32;return this._updateNode(new Kt(new Q(s,this._exec.getTypeInfo(o)),o))}if(this._match([B.keywords.true,B.keywords.false])){let r=this._previous().toString()===B.keywords.true.rule;return this._updateNode(new Kt(new Q(r?1:0,this._exec.getTypeInfo(ue.bool)),ue.bool))}if(this._check(B.tokens.paren_left))return this._paren_expression();if(this._match(B.keywords.bitcast)){this._consume(B.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(B.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new Fw(r,i))}const e=this._type_decl(),n=this._argument_expression_list();return this._updateNode(new Or(e,n))}_argument_expression_list(){if(!this._match(B.tokens.paren_left))return null;const e=[];do{if(this._check(B.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(B.tokens.comma));return this._consume(B.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(B.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(B.tokens.paren_right),e}_paren_expression(){this._consume(B.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(B.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(B.keywords.struct))return null;const e=this._currentLine,n=this._consume(B.tokens.ident,"Expected name for struct.").toString();this._consume(B.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(B.tokens.brace_right);){const o=this._attribute(),a=this._consume(B.tokens.name,"Expected variable name.").toString();this._consume(B.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=f),this._check(B.tokens.brace_right)?this._match(B.tokens.comma):this._consume(B.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new h_(a,p,o)))}this._consume(B.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new Gr(n,r,e,i),e);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(B.tokens.equal)){const n=this._const_expression();e.value=n}if(e.type!==null&&e.value instanceof Kt){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Kt&&(e.type=e.value.type.name==="x32"?ue.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(B.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(B.keywords.const))return null;const n=this._consume(B.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(B.tokens.colon)){const f=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=f)}let s=null;this._consume(B.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let f=[ue.f32],p=o.constEvaluate(this._exec,f);p instanceof Q&&this._validateTypeRange(p.value,f[0]),f[0]instanceof J&&f[0].format===null&&p.typeInfo instanceof Ss&&p.typeInfo.format!==null&&(p.typeInfo.format.name==="f16"?f[0].format=ue.f16:p.typeInfo.format.name==="f32"?f[0].format=ue.f32:p.typeInfo.format.name==="i32"?f[0].format=ue.i32:p.typeInfo.format.name==="u32"?f[0].format=ue.u32:p.typeInfo.format.name==="bool"?f[0].format=ue.bool:console.error(`TODO: impelement template format type ${p.typeInfo.format.name}`)),s=this._updateNode(new Kt(p,f[0])),this._exec.context.setVariable(n.toString(),p)}catch{s=o}if(i!==null&&s instanceof Kt){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof Kt&&(i=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:ue.f32,i===ue.x32&&(i=ue.i32));const a=this._updateNode(new ic(n.toString(),i,"","",s),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(B.keywords.let))return null;const e=this._currentLine,n=this._consume(B.tokens.name,"Expected variable name");let r=null;if(this._match(B.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(B.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof Kt){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof Kt&&(r=i.type.name==="x32"?ue.i32:i.type);return i instanceof Kt&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new el(n.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(B.keywords.var))return null;const e=this._currentLine;let n="",r="";this._match(B.tokens.less_than)&&(n=this._consume(B.storage_class,"Expected storage_class.").toString(),this._match(B.tokens.comma)&&(r=this._consume(B.access_mode,"Expected access_mode.").toString()),this._consume(B.tokens.greater_than,"Expected '>'."));const i=this._consume(B.tokens.name,"Expected variable name");let s=null;if(this._match(B.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new ei(i.toString(),s,n,r,null),e)}_override_decl(){if(!this._match(B.keywords.override))return null;const e=this._consume(B.tokens.name,"Expected variable name");let n=null;if(this._match(B.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return this._updateNode(new rg(e.toString(),n,null))}_diagnostic(){this._consume(B.tokens.paren_left,"Expected '('");const e=this._consume(B.tokens.ident,"Expected severity control name.");this._consume(B.tokens.comma,"Expected ','");let n=this._consume(B.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(B.tokens.period)&&(n+=`.${this._consume(B.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(B.tokens.paren_right,"Expected ')'"),this._updateNode(new Nw(e.toString(),n))}_enable_directive(){const e=this._consume(B.tokens.ident,"identity expected.");return this._updateNode(new rI(e.toString()))}_requires_directive(){const e=[this._consume(B.tokens.ident,"identity expected.").toString()];for(;this._match(B.tokens.comma);){const n=this._consume(B.tokens.ident,"identity expected.");e.push(n.toString())}return this._updateNode(new iI(e))}_type_alias(){const e=this._consume(B.tokens.ident,"identity expected.");this._consume(B.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=this._updateNode(new sg(e.toString(),n));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([B.tokens.ident,...B.texel_format,B.keywords.bool,B.keywords.f32,B.keywords.i32,B.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new u_(r));return this._forwardTypeCount++,i}return this._updateNode(new ue(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(B.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(B.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(B.tokens.comma)&&(s=this._consume(B.access_mode,"Expected access_mode for pointer").toString()),this._consume(B.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new J(r,i,s))}if(this._match(B.keywords.ptr)){let r=this._previous().toString();this._consume(B.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(B.storage_class,"Expected storage_class for pointer");this._consume(B.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(B.tokens.comma)&&(o=this._consume(B.access_mode,"Expected access_mode for pointer").toString()),this._consume(B.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Dh(r,i.toString(),s,o))}const n=this._attribute();if(this._match(B.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(B.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let f="";if(this._match(B.tokens.comma)){o=this._shift_expression();try{f=o.constEvaluate(this._exec).toString(),o=null}catch{f="1"}}this._consume(B.tokens.greater_than,"Expected '>' for array."),i=f?parseInt(f):0}const a=this._updateNode(new tl(s.toString(),n,r,i));return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(B.sampler_type))return this._updateNode(new La(this._previous().toString(),null,null));if(this._match(B.depth_texture_type))return this._updateNode(new La(this._previous().toString(),null,null));if(this._match(B.sampled_texture_type)||this._match(B.multisampled_texture_type)){const e=this._previous();this._consume(B.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(B.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new La(e.toString(),n,null))}if(this._match(B.storage_texture_type)){const e=this._previous();this._consume(B.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(B.texel_format,"Invalid texel format.").toString();this._consume(B.tokens.comma,"Expected ',' after texel format.");const r=this._consume(B.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(B.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new La(e.toString(),n,r))}return null}_attribute(){let e=[];for(;this._match(B.tokens.attr);){const n=this._consume(B.attribute_name,"Expected attribute name"),r=this._updateNode(new jw(n.toString(),null));if(this._match(B.tokens.paren_left)){if(r.value=this._consume(B.literal_or_ident,"Expected attribute value").toString(),this._check(B.tokens.comma)){this._advance();do{const i=this._consume(B.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(B.tokens.comma))}this._consume(B.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class vI extends Fr{constructor(e){super(),e&&this.update(e)}update(e){const n=new yI().parse(e);this.updateAST(n)}}function wI(t){var s;const e={attributes:[],bindings:[]};let n;try{n=bI(t)}catch(o){return _e.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const f of((s=o.type)==null?void 0:s.members)||[])a.push({name:f.name,type:g_(f.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:a})}for(const o of n.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of n.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const a=r.inputs[o];if(a.locationType==="location"){const f=g_(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:f})}}return e}function g_(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function bI(t){try{return new vI(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const xI={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...xI}};const or=globalThis.mathgl.config;function TI(t,{precision:e=or.precision}={}){return t=EI(t),`${parseFloat(t.toPrecision(e))}`}function Vo(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Mi(t,e,n){return CI(t,r=>Math.max(e,Math.min(n,r)))}function zo(t,e,n){return Vo(t)?t.map((r,i)=>zo(r,e[i],n)):n*e+(1-n)*t}function Sl(t,e,n){const r=or.EPSILON;try{if(t===e)return!0;if(Vo(t)&&Vo(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Sl(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=or.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{or.EPSILON=r}}function EI(t){return Math.round(t/or.EPSILON)*or.EPSILON}function SI(t){return t.clone?t.clone():new Array(t.length)}function CI(t,e,n){if(Vo(t)){const r=t;n=n||SI(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class Ww extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Vo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(or)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+TI(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Sl(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(or.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function PI(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function $n(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Fh(t,e,n=""){if(or.debug&&!PI(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function m_(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class kI extends Ww{get x(){return this[0]}set x(e){this[0]=$n(e)}get y(){return this[1]}set y(e){this[1]=$n(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return $n(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return $n(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return m_(e>=0&&e<this.ELEMENTS,"index is out of range"),$n(this[e])}setComponent(e,n){return m_(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const oc=1e-6;let jo=typeof Float32Array<"u"?Float32Array:Array;function RI(){const t=new jo(2);return jo!=Float32Array&&(t[0]=0,t[1]=0),t}function __(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function II(t,e){return t[0]=-e[0],t[1]=-e[1],t}function $w(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function MI(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=RI();return function(e,n,r,i,s,o){let a,f;for(n||(n=2),r||(r=0),i?f=Math.min(i*n+r,e.length):f=e.length,a=r;a<f;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function NI(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function Hw(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function OI(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function DI(){const t=new jo(3);return jo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function BI(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function FI(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function LI(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function UI(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],f=n[2];return t[0]=i*f-s*a,t[1]=s*o-r*f,t[2]=r*a-i*o,t}function Xw(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function VI(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function zI(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],f=e[1],p=e[2];let m=i*p-s*f,v=s*a-r*p,w=r*f-i*a,T=i*w-s*v,E=s*m-r*w,I=r*v-i*m;const U=o*2;return m*=U,v*=U,w*=U,T*=2,E*=2,I*=2,t[0]=a+m+T,t[1]=f+v+E,t[2]=p+w+I,t}function jI(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function WI(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function $I(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function HI(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],f=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),p=f&&LI(t,e)/f;return Math.acos(Math.min(Math.max(p,-1),1))}const XI=BI;(function(){const t=DI();return function(e,n,r,i,s,o){let a,f;for(n||(n=3),r||(r=0),i?f=Math.min(i*n+r,e.length):f=e.length,a=r;a<f;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Lh=[0,0,0];let MA;class zr extends kI{static get ZERO(){return MA||(MA=new zr(0,0,0),Object.freeze(MA)),MA}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Vo(e)?this.copy(e):(or.debug&&($n(e),$n(n),$n(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return or.debug&&($n(e.x),$n(e.y),$n(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=$n(e)}angle(e){return HI(this,e)}cross(e){return UI(this,this,e),this.check()}rotateX({radians:e,origin:n=Lh}){return jI(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Lh}){return WI(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Lh}){return $I(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Xw(this,this,e),this.check()}transformAsVector(e){return Hw(this,this,e),this.check()}transformByMatrix3(e){return VI(this,this,e),this.check()}transformByMatrix2(e){return OI(this,this,e),this.check()}transformByQuaternion(e){return zI(this,this,e),this.check()}}class QI extends Ww{toString(){let e="[";if(or.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=$n(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function YI(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function KI(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function yd(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],f=e[6],p=e[7],m=e[8],v=e[9],w=e[10],T=e[11],E=e[12],I=e[13],U=e[14],R=e[15],P=n*a-r*o,C=n*f-i*o,D=n*p-s*o,$=r*f-i*a,q=r*p-s*a,fe=i*p-s*f,ae=m*I-v*E,he=m*U-w*E,ye=m*R-T*E,ke=v*U-w*I,Le=v*R-T*I,Ve=w*R-T*U;let Ae=P*Ve-C*Le+D*ke+$*ye-q*he+fe*ae;return Ae?(Ae=1/Ae,t[0]=(a*Ve-f*Le+p*ke)*Ae,t[1]=(i*Le-r*Ve-s*ke)*Ae,t[2]=(I*fe-U*q+R*$)*Ae,t[3]=(w*q-v*fe-T*$)*Ae,t[4]=(f*ye-o*Ve-p*he)*Ae,t[5]=(n*Ve-i*ye+s*he)*Ae,t[6]=(U*D-E*fe-R*C)*Ae,t[7]=(m*fe-w*D+T*C)*Ae,t[8]=(o*Le-a*ye+p*ae)*Ae,t[9]=(r*ye-n*Le-s*ae)*Ae,t[10]=(E*q-I*D+R*P)*Ae,t[11]=(v*D-m*q-T*P)*Ae,t[12]=(a*he-o*ke-f*ae)*Ae,t[13]=(n*ke-r*he+i*ae)*Ae,t[14]=(I*C-E*$-U*P)*Ae,t[15]=(m*$-v*C+w*P)*Ae,t):null}function ZI(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],f=t[7],p=t[8],m=t[9],v=t[10],w=t[11],T=t[12],E=t[13],I=t[14],U=t[15],R=e*o-n*s,P=e*a-r*s,C=n*a-r*o,D=p*E-m*T,$=p*I-v*T,q=m*I-v*E,fe=e*q-n*$+r*D,ae=s*q-o*$+a*D,he=p*C-m*P+v*R,ye=T*C-E*P+I*R;return f*fe-i*ae+U*he-w*ye}function _s(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],f=e[5],p=e[6],m=e[7],v=e[8],w=e[9],T=e[10],E=e[11],I=e[12],U=e[13],R=e[14],P=e[15];let C=n[0],D=n[1],$=n[2],q=n[3];return t[0]=C*r+D*a+$*v+q*I,t[1]=C*i+D*f+$*w+q*U,t[2]=C*s+D*p+$*T+q*R,t[3]=C*o+D*m+$*E+q*P,C=n[4],D=n[5],$=n[6],q=n[7],t[4]=C*r+D*a+$*v+q*I,t[5]=C*i+D*f+$*w+q*U,t[6]=C*s+D*p+$*T+q*R,t[7]=C*o+D*m+$*E+q*P,C=n[8],D=n[9],$=n[10],q=n[11],t[8]=C*r+D*a+$*v+q*I,t[9]=C*i+D*f+$*w+q*U,t[10]=C*s+D*p+$*T+q*R,t[11]=C*o+D*m+$*E+q*P,C=n[12],D=n[13],$=n[14],q=n[15],t[12]=C*r+D*a+$*v+q*I,t[13]=C*i+D*f+$*w+q*U,t[14]=C*s+D*p+$*T+q*R,t[15]=C*o+D*m+$*E+q*P,t}function nu(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,f,p,m,v,w,T,E,I,U,R;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],f=e[2],p=e[3],m=e[4],v=e[5],w=e[6],T=e[7],E=e[8],I=e[9],U=e[10],R=e[11],t[0]=o,t[1]=a,t[2]=f,t[3]=p,t[4]=m,t[5]=v,t[6]=w,t[7]=T,t[8]=E,t[9]=I,t[10]=U,t[11]=R,t[12]=o*r+m*i+E*s+e[12],t[13]=a*r+v*i+I*s+e[13],t[14]=f*r+w*i+U*s+e[14],t[15]=p*r+T*i+R*s+e[15]),t}function cg(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function qI(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),f,p,m,v,w,T,E,I,U,R,P,C,D,$,q,fe,ae,he,ye,ke,Le,Ve,Ae,Re;return a<oc?null:(a=1/a,i*=a,s*=a,o*=a,p=Math.sin(n),f=Math.cos(n),m=1-f,v=e[0],w=e[1],T=e[2],E=e[3],I=e[4],U=e[5],R=e[6],P=e[7],C=e[8],D=e[9],$=e[10],q=e[11],fe=i*i*m+f,ae=s*i*m+o*p,he=o*i*m-s*p,ye=i*s*m-o*p,ke=s*s*m+f,Le=o*s*m+i*p,Ve=i*o*m+s*p,Ae=s*o*m-i*p,Re=o*o*m+f,t[0]=v*fe+I*ae+C*he,t[1]=w*fe+U*ae+D*he,t[2]=T*fe+R*ae+$*he,t[3]=E*fe+P*ae+q*he,t[4]=v*ye+I*ke+C*Le,t[5]=w*ye+U*ke+D*Le,t[6]=T*ye+R*ke+$*Le,t[7]=E*ye+P*ke+q*Le,t[8]=v*Ve+I*Ae+C*Re,t[9]=w*Ve+U*Ae+D*Re,t[10]=T*Ve+R*Ae+$*Re,t[11]=E*Ve+P*Ae+q*Re,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Qw(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],f=e[7],p=e[8],m=e[9],v=e[10],w=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+p*r,t[5]=o*i+m*r,t[6]=a*i+v*r,t[7]=f*i+w*r,t[8]=p*i-s*r,t[9]=m*i-o*r,t[10]=v*i-a*r,t[11]=w*i-f*r,t}function GI(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],f=e[3],p=e[8],m=e[9],v=e[10],w=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-p*r,t[1]=o*i-m*r,t[2]=a*i-v*r,t[3]=f*i-w*r,t[8]=s*r+p*i,t[9]=o*r+m*i,t[10]=a*r+v*i,t[11]=f*r+w*i,t}function Yw(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],f=e[3],p=e[4],m=e[5],v=e[6],w=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+p*r,t[1]=o*i+m*r,t[2]=a*i+v*r,t[3]=f*i+w*r,t[4]=p*i-s*r,t[5]=m*i-o*r,t[6]=v*i-a*r,t[7]=w*i-f*r,t}function JI(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,f=i+i,p=n*o,m=r*o,v=r*a,w=i*o,T=i*a,E=i*f,I=s*o,U=s*a,R=s*f;return t[0]=1-v-E,t[1]=m+R,t[2]=w-U,t[3]=0,t[4]=m-R,t[5]=1-p-E,t[6]=T+I,t[7]=0,t[8]=w+U,t[9]=T-I,t[10]=1-p-v,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eM(t,e,n,r,i,s,o){const a=1/(n-e),f=1/(i-r),p=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*f,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*f,t[10]=(o+s)*p,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*p,t[15]=0,t}function tM(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const nM=tM;function rM(t,e,n,r,i,s,o){const a=1/(e-n),f=1/(r-i),p=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*f,t[14]=(o+s)*p,t[15]=1,t}const iM=rM;function sM(t,e,n,r){let i,s,o,a,f,p,m,v,w,T;const E=e[0],I=e[1],U=e[2],R=r[0],P=r[1],C=r[2],D=n[0],$=n[1],q=n[2];return Math.abs(E-D)<oc&&Math.abs(I-$)<oc&&Math.abs(U-q)<oc?YI(t):(v=E-D,w=I-$,T=U-q,i=1/Math.sqrt(v*v+w*w+T*T),v*=i,w*=i,T*=i,s=P*T-C*w,o=C*v-R*T,a=R*w-P*v,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),f=w*a-T*o,p=T*s-v*a,m=v*o-w*s,i=Math.sqrt(f*f+p*p+m*m),i?(i=1/i,f*=i,p*=i,m*=i):(f=0,p=0,m=0),t[0]=s,t[1]=f,t[2]=v,t[3]=0,t[4]=o,t[5]=p,t[6]=w,t[7]=0,t[8]=a,t[9]=m,t[10]=T,t[11]=0,t[12]=-(s*E+o*I+a*U),t[13]=-(f*E+p*I+m*U),t[14]=-(v*E+w*I+T*U),t[15]=1,t)}function oM(){const t=new jo(4);return jo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function aM(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function jl(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=oM();return function(e,n,r,i,s,o){let a,f;for(n||(n=4),r||(r=0),i?f=Math.min(i*n+r,e.length):f=e.length,a=r;a<f;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var vd;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(vd||(vd={}));const lM=45*Math.PI/180,AM=1,Uh=.1,Vh=500,cM=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class jr extends QI{static get IDENTITY(){return fM()}static get ZERO(){return uM()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return vd}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,f,p,m,v,w,T,E,I,U){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=f,this[8]=p,this[9]=m,this[10]=v,this[11]=w,this[12]=T,this[13]=E,this[14]=I,this[15]=U,this.check()}setRowMajor(e,n,r,i,s,o,a,f,p,m,v,w,T,E,I,U){return this[0]=e,this[1]=s,this[2]=p,this[3]=T,this[4]=n,this[5]=o,this[6]=m,this[7]=E,this[8]=r,this[9]=a,this[10]=v,this[11]=I,this[12]=i,this[13]=f,this[14]=w,this[15]=U,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(cM)}fromObject(e){return this.check()}fromQuaternion(e){return JI(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=Uh,far:a=Vh}=e;return a===1/0?hM(this,n,r,i,s,o):eM(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return sM(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=Uh,far:a=Vh}=e;return iM(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=lM,aspect:r=AM,focalDistance:i=1,near:s=Uh,far:o=Vh}=e;y_(n);const a=n/2,f=i*Math.tan(a),p=f*r;return this.ortho({left:-p,right:p,bottom:-f,top:f,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return y_(n),nM(this,n,r,i,s),this.check()}determinant(){return ZI(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return KI(this,this),this.check()}invert(){return yd(this,this),this.check()}multiplyLeft(e){return _s(this,e,this),this.check()}multiplyRight(e){return _s(this,this,e),this.check()}rotateX(e){return Qw(this,this,e),this.check()}rotateY(e){return GI(this,this,e),this.check()}rotateZ(e){return Yw(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return qI(this,this,e,n),this.check()}scale(e){return cg(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return nu(this,this,e),this.check()}transform(e,n){return e.length===4?(n=jl(n||[-0,-0,-0,-0],e,this),Fh(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=MI(n||[-0,-0],e,this);break;case 3:i=Xw(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Fh(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=NI(n||[-0,-0],e,this);break;case 3:r=Hw(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Fh(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let NA,OA;function uM(){return NA||(NA=new jr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(NA)),NA}function fM(){return OA||(OA=new jr,Object.freeze(OA)),OA}function y_(t){if(t>Math.PI*2)throw Error("expected radians")}function hM(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),f=(n+e)/(n-e),p=(i+r)/(i-r),m=-1,v=-1,w=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=f,t[9]=p,t[10]=m,t[11]=v,t[12]=0,t[13]=0,t[14]=w,t[15]=0,t}function Kw(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function dM(t){return t-Math.fround(t)}function pM(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;Kw(t[r*4+n],e,i*2)}return e}const gM=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,mM={name:"fp32",vs:gM},_M=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,yM={ONE:1},vM={name:"fp64arithmetic",vs:_M,defaultUniforms:yM,uniformTypes:{ONE:"f32"},fp64ify:Kw,fp64LowPart:dM,fp64ifyMatrix4:pM},wM=[0,1,1,1],bM=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,xM=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,v_={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:wM},vs:bM,fs:xM,getUniforms:TM};function TM(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const w_=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,EM=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,Zw=3,SM=255;var Cl;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(Cl||(Cl={}));const nl={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:Zw},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Cl.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:EM,vs:w_,fs:w_,getUniforms:CM};function CM(t,e={}){if(t=t&&{...t},!t)return{...nl.defaultUniforms};t.lights&&(t={...t,...kM(t.lights),lights:void 0});const{ambientLight:n,pointLights:r,directionalLights:i}=t||{};if(!(n||r&&r.length>0||i&&i.length>0))return{...nl.defaultUniforms,enabled:0};const o={...nl.defaultUniforms,...e,...PM({ambientLight:n,pointLights:r,directionalLights:i})};return t.enabled!==void 0&&(o.enabled=t.enabled?1:0),o}function PM({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const r={};r.ambientLightColor=zh(t);let i=0;for(const s of e){r.lightType=Cl.POINT;const o=i;r[`lightColor${o}`]=zh(s),r[`lightPosition${o}`]=s.position,r[`lightAttenuation${o}`]=s.attenuation||[1,0,0],i++}for(const s of n){r.lightType=Cl.DIRECTIONAL;const o=i;r[`lightColor${o}`]=zh(s),r[`lightDirection${o}`]=s.direction,i++}return i>Zw&&_e.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=n.length,r.pointLightCount=e.length,r}function kM(t){var n,r;const e={pointLights:[],directionalLights:[]};for(const i of t||[])switch(i.type){case"ambient":e.ambientLight=i;break;case"directional":(n=e.directionalLights)==null||n.push(i);break;case"point":(r=e.pointLights)==null||r.push(i);break}return e}function zh(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(r=>r*n/SM)}const qw=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,Gw=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,ug={props:{},name:"gouraudMaterial",vs:Gw.replace("phongMaterial","gouraudMaterial"),fs:qw.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[nl],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(n=>n/255)),{...ug.defaultUniforms,...e}}},RM=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Jw={name:"phongMaterial",dependencies:[nl],source:RM,vs:qw,fs:Gw,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(n=>n/255)),{...Jw.defaultUniforms,...e}}},b_=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,IM={name:"layer",vs:b_,fs:b_,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},eb="#define SMOOTH_EDGE_RADIUS 0.5",MM=`
${eb}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,NM=`
${eb}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,tb={name:"geometry",vs:MM,fs:NM},OM=25;var Yt;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(Yt||(Yt={}));var Zt;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(Zt||(Zt={}));var nt;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(nt||(nt={}));const DM="compute",BM="auto",wd="manipulation",ac="none",bd="pan-x",xd="pan-y";function FM(t){if(t.includes(ac))return ac;const e=t.includes(bd),n=t.includes(xd);return e&&n?ac:e||n?e?bd:xd:t.includes(wd)?wd:BM}class LM{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===DM&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return FM(e.join(" "))}}function ru(t){return t.trim().split(/\s+/g)}function jh(t,e,n){if(t)for(const r of ru(e))t.addEventListener(r,n,!1)}function Wh(t,e,n){if(t)for(const r of ru(e))t.removeEventListener(r,n,!1)}function x_(t){return(t.ownerDocument||t).defaultView}function UM(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function nb(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,r=0,i=0;for(;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:Math.round(n/e),y:Math.round(r/e)}}function T_(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:nb(e),deltaX:t.deltaX,deltaY:t.deltaY}}function rb(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function E_(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)}function VM(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)*180/Math.PI}function S_(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.atan2(r,n)*180/Math.PI}function ib(t,e){return t===e?Zt.None:Math.abs(t)>=Math.abs(e)?t<0?Zt.Left:Zt.Right:e<0?Zt.Up:Zt.Down}function zM(t,e){const n=e.center;let r=t.offsetDelta,i=t.prevDelta;const s=t.prevInput;return(e.eventType===Yt.Start||(s==null?void 0:s.eventType)===Yt.End)&&(i=t.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},r=t.offsetDelta={x:n.x,y:n.y}),{deltaX:i.x+(n.x-r.x),deltaY:i.y+(n.y-r.y)}}function sb(t,e,n){return{x:e/t||0,y:n/t||0}}function jM(t,e){return E_(e[0],e[1])/E_(t[0],t[1])}function WM(t,e){return S_(e[1],e[0])-S_(t[1],t[0])}function $M(t,e){const n=t.lastInterval||e,r=e.timeStamp-n.timeStamp;let i,s,o,a;if(e.eventType!==Yt.Cancel&&(r>OM||n.velocity===void 0)){const f=e.deltaX-n.deltaX,p=e.deltaY-n.deltaY,m=sb(r,f,p);s=m.x,o=m.y,i=Math.abs(m.x)>Math.abs(m.y)?m.x:m.y,a=ib(f,p),t.lastInterval=e}else i=n.velocity,s=n.velocityX,o=n.velocityY,a=n.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=a}function HM(t,e){const{session:n}=t,{pointers:r}=e,{length:i}=r;n.firstInput||(n.firstInput=T_(e)),i>1&&!n.firstMultiple?n.firstMultiple=T_(e):i===1&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=n,a=o?o.center:s.center,f=e.center=nb(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=VM(a,f),e.distance=rb(a,f);const{deltaX:p,deltaY:m}=zM(n,e);e.deltaX=p,e.deltaY=m,e.offsetDirection=ib(e.deltaX,e.deltaY);const v=sb(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=v.x,e.overallVelocityY=v.y,e.overallVelocity=Math.abs(v.x)>Math.abs(v.y)?v.x:v.y,e.scale=o?jM(o.pointers,r):1,e.rotation=o?WM(o.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let w=t.element;return UM(e.srcEvent.target,w)&&(w=e.srcEvent.target),e.target=w,$M(n,e),e}function XM(t,e,n){const r=n.pointers.length,i=n.changedPointers.length,s=e&Yt.Start&&r-i===0,o=e&(Yt.End|Yt.Cancel)&&r-i===0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e;const a=HM(t,n);t.emit("hammer.input",a),t.recognize(a),t.session.prevInput=a}let QM=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){XM(this.manager,e,n)}init(){jh(this.element,this.evEl,this.domHandler),jh(this.target,this.evTarget,this.domHandler),jh(x_(this.element),this.evWin,this.domHandler)}destroy(){Wh(this.element,this.evEl,this.domHandler),Wh(this.target,this.evTarget,this.domHandler),Wh(x_(this.element),this.evWin,this.domHandler)}};const YM={pointerdown:Yt.Start,pointermove:Yt.Move,pointerup:Yt.End,pointercancel:Yt.Cancel,pointerout:Yt.Cancel},KM="pointerdown",ZM="pointermove pointerup pointercancel";class qM extends QM{constructor(e){super(e),this.evEl=KM,this.evWin=ZM,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let r=!1;const i=YM[e.type],s=e.pointerType,o=s==="touch";let a=n.findIndex(f=>f.pointerId===e.pointerId);i&Yt.Start&&(e.buttons||o)?a<0&&(n.push(e),a=n.length-1):i&(Yt.End|Yt.Cancel)&&(r=!0),!(a<0)&&(n[a]=e,this.callback(i,{pointers:n,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&n.splice(a,1))}}const GM=["","webkit","Moz","MS","ms","o"];function JM(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const r of GM){const i=r?r+n:e;if(i in t)return i}}const e6=1,C_=2,P_={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class t6{constructor(e,n){this.options={...P_,...n,cssProps:{...P_.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new qM(this),this.touchAction=new LM(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?C_:e6}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=n;(!s||s&&s.state&nt.Recognized)&&(s=n.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],n.stopped!==C_&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(nt.Began|nt.Changed|nt.Ended)&&(s=n.curRecognizer=r),o++}get(e){const{recognizers:n}=this;for(let r=0;r<n.length;r++)if(n[r].options.event===e)return n[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:r}=this,i=r.indexOf(n);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:r}=this;for(const i of ru(e))r[i]=r[i]||[],r[i].push(n)}off(e,n){if(!e)return;const{handlers:r}=this;for(const i of ru(e))n?r[i]&&r[i].splice(r[i].indexOf(n),1):delete r[i]}emit(e,n){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=n;i.type=e,i.preventDefault=function(){n.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[r,i]of Object.entries(this.options.cssProps)){const s=JM(n.style,r);e?(this.oldCssProps[s]=n.style[s],n.style[s]=i):n.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let n6=1;function r6(){return n6++}function k_(t){return t&nt.Cancelled?"cancel":t&nt.Ended?"end":t&nt.Changed?"move":t&nt.Began?"start":""}class ob{constructor(e){this.options=e,this.id=r6(),this.state=nt.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:r}=this;return r[n.id]||(r[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:r}=this;return r.indexOf(n)===-1&&(r.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const r=this.requireFail.indexOf(n);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<nt.Ended&&this.manager.emit(this.options.event+k_(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=nt.Ended&&this.manager.emit(this.options.event+k_(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=nt.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(nt.Failed|nt.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=nt.Failed;return}this.state&(nt.Recognized|nt.Cancelled|nt.Failed)&&(this.state=nt.Possible),this.state=this.process(n),this.state&(nt.Began|nt.Changed|nt.Ended|nt.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class ab extends ob{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:r}=e,i=n&(nt.Began|nt.Changed),s=this.attrTest(e);return i&&(r&Yt.Cancel||!s)?n|nt.Cancelled:i||s?r&Yt.End?n|nt.Ended:n&nt.Began?n|nt.Changed:nt.Began:nt.Failed}}class R_ extends ob{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[wd]}process(e){const{options:n}=this,r=e.pointers.length===n.pointers,i=e.distance<n.threshold,s=e.deltaTime<n.time;if(this.reset(),e.eventType&Yt.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==Yt.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<n.interval:!0,a=!this.pCenter||rb(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!o?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=nt.Recognized,this.tryEmit(this._input)},n.interval),nt.Began):nt.Recognized}return nt.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=nt.Failed},this.options.interval),nt.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===nt.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const i6=["","start","move","end","cancel","up","down","left","right"];class I_ extends ab{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Zt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&Zt.Horizontal&&n.push(xd),e&Zt.Vertical&&n.push(bd),n}getEventNames(){return i6.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,a=e.deltaY;return s&n.direction||(n.direction&Zt.Horizontal?(s=o===0?Zt.None:o<0?Zt.Left:Zt.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=a===0?Zt.None:a<0?Zt.Up:Zt.Down,r=a!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>n.threshold&&!!(s&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&nt.Began)||!(this.state&nt.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=Zt[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const s6=["","start","move","end","cancel","in","out"];class o6 extends ab{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[ac]}getEventNames(){return s6.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&nt.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class Zu{constructor(e,n,r){this.element=e,this.callback=n,this.options=r}}const a6=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",l6=a6.indexOf("firefox")!==-1,M_=4.000244140625,A6=40,c6=.25;class u6 extends Zu{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(l6&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=A6)),s!==0&&s%M_===0&&(s=Math.floor(s/M_)),i.shiftKey&&s&&(s=s*c6),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const N_=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class f6 extends Zu{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,N_.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){N_.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const O_=["keydown","keyup"];class h6 extends Zu{constructor(e,n,r){super(e,n,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",O_.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){O_.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class d6 extends Zu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const D_=1,Td=2,B_=4,p6={pointerdown:D_,pointermove:Td,pointerup:B_,mousedown:D_,mousemove:Td,mouseup:B_},g6=0,m6=1,_6=2,y6=1,v6=2,w6=4;function b6(t){const e=p6[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===Td?(i=!!(n&y6),s=!!(n&w6),o=!!(n&v6)):(i=r===g6,s=r===m6,o=r===_6),{leftButton:i,middleButton:s,rightButton:o}}function x6(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const T6={srcElement:"root",priority:0};class E6{constructor(e,n){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this,f={...T6,...r};let p=a.get(f.srcElement);p||(p=[],a.set(f.srcElement,p));const m={type:e,handler:n,srcElement:f.srcElement,priority:f.priority};i&&(m.once=!0),s&&(m.passive=!0),o.push(m),this._active=this._active||!m.passive;let v=p.length-1;for(;v>=0&&!(p[v].priority>=m.priority);)v--;p.splice(v+1,0,m)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let f=0;f<r.length;f++){const{type:p,handler:m,once:v}=r[f];if(m({...e,type:p,stopPropagation:s,stopImmediatePropagation:o}),v&&a.push(r[f]),i)break}for(let f=0;f<a.length;f++){const{type:p,handler:m}=a[f];this.remove(p,m)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...b6(e),...x6(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function S6(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const r=n.shift(),i=n.shift()||{};e=new r(i)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class C6{constructor(e=null,n={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new t6(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=S6(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new u6(e,this._onOtherEvent,{enable:!1}),this.moveInput=new f6(e,this._onOtherEvent,{enable:!1}),this.keyInput=new h6(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new d6(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){var s,o,a,f;const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:n}),r.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,n),(o=this.moveInput)==null||o.enableEventType(e,n),(a=this.keyInput)==null||a.enableEventType(e,n),(f=this.contextmenuInput)==null||f.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const[p,m]of Object.entries(e))this._addEventHandler(p,m,r,i,s);return}const{manager:o,events:a}=this;if(!o)return;let f=a.get(e);if(!f){const p=this._getRecognizerName(e)||e;f=new E6(this,p),a.set(e,f),o&&o.on(e,f.handleEvent)}f.add(e,n,r,i,s),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,n),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const a of r.values())if(a.recognizerName===s&&!a.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var n;return(n=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:n.options.event}}const ft={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ft,"IDENTITY",{get:()=>(ot.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Lr={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ai={common:0,meters:1,pixels:2},Ed={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},F_={multipan:[I_,{threshold:10,direction:Zt.Vertical,pointers:2}],pinch:[o6,{},null,["multipan"]],pan:[I_,{threshold:1},["pinch"],["multipan"]],dblclick:[R_,{event:"dblclick",taps:2}],click:[R_,{event:"click"},null,["dblclick"]]};function P6(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Wl(t){let e={},n;return r=>{for(const i in r)if(!P6(r[i],e[i])){n=t(r),e=r;break}return n}}const L_=[0,0,0,0],k6=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],lb=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],R6=[0,0,0],Ab=[0,0,0],I6=Wl(O6);function cb(t,e,n=Ab){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===ft.LNGLAT_OFFSETS||e===ft.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Lr.WEB_MERCATOR:(e===ft.LNGLAT||e===ft.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Lr.WEB_MERCATOR_AUTO_OFFSET:e===ft.LNGLAT?r=i:e===ft.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Lr.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Lr.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function M6(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=L_,f=L_,p=t.cameraPosition;const{geospatialOrigin:m,shaderCoordinateOrigin:v,offsetMode:w}=cb(t,e,n);return w&&(f=t.projectPosition(m||v),p=[p[0]-f[0],p[1]-f[1],p[2]-f[2]],f[3]=1,a=jl([],f,o),s=r||s,o=_s([],i,s),o=_s([],o,k6)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:f,cameraPosCommon:p,shaderCoordinateOrigin:v,geospatialOrigin:m}}function N6({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=ft.DEFAULT,coordinateOrigin:i=Ab,autoWrapLongitude:s=!1}){r===ft.DEFAULT&&(r=t.isGeospatial?ft.LNGLAT:ft.CARTESIAN);const o=I6({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=n||lb,o}function O6({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:f,geospatialOrigin:p}=M6(t,n,r),m=t.getDistanceScales(),v=[t.width*e,t.height*e],w=jl([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,T={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:f,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:v,devicePixelRatio:e,focalDistance:w,commonUnitsPerMeter:m.unitsPerMeter,commonUnitsPerWorldUnit:m.unitsPerMeter,commonUnitsPerWorldUnit2:R6,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:lb,cameraPosition:a};if(p){const E=t.getDistanceScales(p);switch(n){case ft.METER_OFFSETS:T.commonUnitsPerWorldUnit=E.unitsPerMeter,T.commonUnitsPerWorldUnit2=E.unitsPerMeter2;break;case ft.LNGLAT:case ft.LNGLAT_OFFSETS:t._pseudoMeters||(T.commonUnitsPerMeter=E.unitsPerMeter),T.commonUnitsPerWorldUnit=E.unitsPerDegree,T.commonUnitsPerWorldUnit2=E.unitsPerDegree2;break;case ft.CARTESIAN:T.commonUnitsPerWorldUnit=[1,1,E.unitsPerMeter[2]],T.commonUnitsPerWorldUnit2=[0,0,E.unitsPerMeter2[2]];break}}return T}const D6=Object.keys(ft).map(t=>`const int COORDINATE_SYSTEM_${t} = ${ft[t]};`).join(""),B6=Object.keys(Lr).map(t=>`const int PROJECTION_MODE_${t} = ${Lr[t]};`).join(""),F6=Object.keys(Ai).map(t=>`const int UNIT_${t.toUpperCase()} = ${Ai[t]};`).join(""),L6=`${D6}
${B6}
${F6}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,U6={};function V6(t=U6){return"viewport"in t?N6(t):{}}const fg={name:"project",dependencies:[mM,tb],vs:L6,getUniforms:V6,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},z6=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,ea={name:"project32",dependencies:[fg],vs:z6};function j6(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Co(t,e){const n=jl([],e,t);return aM(n,n,1/n[3]),n}function U_(t,e){const n=t%e;return n<0?e+n:n}function Sd(t,e,n){return t<e?e:t>n?n:t}function W6(t){return Math.log(t)*Math.LOG2E}const hg=Math.log2||W6;function ci(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const vr=Math.PI,ub=vr/4,ar=vr/180,Cd=180/vr,Wo=512,iu=4003e4,V_=85.051129,$6=1.5;function H6(t){return hg(t)}function su(t){const[e,n]=t;ci(Number.isFinite(e)),ci(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*ar,i=n*ar,s=Wo*(r+vr)/(2*vr),o=Wo*(vr+Math.log(Math.tan(ub+i*.5)))/(2*vr);return[s,o]}function $o(t){const[e,n]=t,r=e/Wo*(2*vr)-vr,i=2*(Math.atan(Math.exp(n/Wo*(2*vr)-vr))-ub);return[r*Cd,i*Cd]}function X6(t){const{latitude:e}=t;ci(Number.isFinite(e));const n=Math.cos(e*ar);return H6(iu*n)-9}function $h(t){const e=Math.cos(t*ar);return Wo/iu/e}function Pd(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;ci(Number.isFinite(e)&&Number.isFinite(n));const i=Wo,s=Math.cos(e*ar),o=i/360,a=o/s,f=i/iu/s,p={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[o,a,f],degreesPerUnit:[1/o,1/a,1/f]};if(r){const m=ar*Math.tan(e*ar)/s,v=o*m/2,w=i/iu*m,T=w/a*f;p.unitsPerDegree2=[0,v,w],p.unitsPerMeter2=[T,0,T]}return p}function fb(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:f,unitsPerMeter2:p}=Pd({longitude:n,latitude:r,highPrecision:!0}),m=su(t);m[0]+=s*(f[0]+p[0]*o),m[1]+=o*(f[1]+p[1]*o);const v=$o(m),w=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[v[0],v[1],w]:v}function Q6(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=j6();nu(a,a,[0,0,-i]),Qw(a,a,-n*ar),Yw(a,a,r*ar);const f=s/e;return cg(a,a,[f,f,f]),o&&nu(a,a,FI([],o)),a}function Y6(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:f=1,farZMultiplier:p=1}=t;let{fovy:m=ou($6)}=t;r!==void 0&&(m=ou(r));const v=m*ar,w=i*ar,T=hb(m);let E=T;o&&(E+=o[2]*a/Math.cos(w)/n);const I=v*(.5+(s?s[1]:0)/n),U=Math.sin(I)*E/Math.sin(Sd(Math.PI/2-w-I,.01,Math.PI-.01)),R=Math.sin(w)*U+E,P=E*10,C=Math.min(R*p,P);return{fov:v,aspect:e/n,focalDistance:T,near:f,far:C}}function ou(t){return 2*Math.atan(.5/t)*Cd}function hb(t){return .5/Math.tan(.5*t*ar)}function db(t,e){const[n,r,i=0]=t;return ci(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),Co(e,[n,r,i,1])}function dg(t,e,n=0){const[r,i,s]=t;if(ci(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return Co(e,[r,i,s,1]);const o=Co(e,[r,i,0,1]),a=Co(e,[r,i,1,1]),f=o[2],p=a[2],m=f===p?0:((n||0)-f)/(p-f);return $w([],o,a,m)}function K6(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,f],[p,m]]=r,v=Z6(t.padding),w=su([a,Sd(m,-85.051129,V_)]),T=su([p,Sd(f,-85.051129,V_)]),E=[Math.max(Math.abs(T[0]-w[0]),i),Math.max(Math.abs(T[1]-w[1]),i)],I=[e-v.left-v.right-Math.abs(o[0])*2,n-v.top-v.bottom-Math.abs(o[1])*2];ci(I[0]>0&&I[1]>0);const U=I[0]/E[0],R=I[1]/E[1],P=(v.right-v.left)/2/U,C=(v.top-v.bottom)/2/R,D=[(T[0]+w[0])/2+P,(T[1]+w[1])/2+C],$=$o(D),q=Math.min(s,hg(Math.abs(Math.min(U,R))));return ci(Number.isFinite(q)),{longitude:$[0],latitude:$[1],zoom:q}}function Z6(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(ci(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const z_=Math.PI/180;function q6(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let f,p;const m=t.fovy?.5*t.fovy*z_:Math.atan(.5/t.altitude),v=(90-t.pitch)*z_;return m>v-.01?(f=j_(t,0,e),p=j_(t,n,e)):(f=i([0,0],s),p=i([n,0],s)),[o,a,p,f]}function j_(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=Co(r,[e,0,1,1]),s=Co(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),f=$w([],i,s,a),p=$o(f);return p.push(n),p}const W_=512;function G6(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=U_(i+180,360)-180),(a<-180||a>180)&&(a=U_(a+180,360)-180);const f=hg(n/W_);if(o<=f)o=f,s=0;else{const p=n/2/Math.pow(2,o),m=$o([0,p])[1];if(s<m)s=m;else{const v=$o([0,W_-p])[1];s>v&&(s=v)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const pb=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,J6=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,e8=`
${pb}
${J6}
`,t8=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,n8=`
${pb}
${t8}
`,r8=Wl(l8),i8=Wl(A8),s8=[0,0,0,1],o8=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function a8(t,e){const[n,r,i]=t,s=dg([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function l8({viewport:t,center:e}){return new jr(t.viewProjectionMatrix).invert().transform(e)}function A8({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>a8(o,r));for(const o of e){const a=o.clone().translate(new zr(t.center).negate()),f=s.map(m=>a.transform(m)),p=new jr().ortho({left:Math.min(...f.map(m=>m[0])),right:Math.max(...f.map(m=>m[0])),bottom:Math.min(...f.map(m=>m[1])),top:Math.max(...f.map(m=>m[1])),near:Math.min(...f.map(m=>-m[2])),far:Math.max(...f.map(m=>-m[2]))});n.push(p.multiplyRight(o))}return n}function c8(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r=fg.getUniforms(n),i=r8({viewport:n.viewport,center:r.center}),s=[],o=i8({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let f=0;f<t.shadowMatrices.length;f++){const p=o[f],m=p.clone().translate(new zr(n.viewport.center).negate());r.coordinateSystem===ft.LNGLAT&&r.projectionMode===Lr.WEB_MERCATOR?(o[f]=m,s[f]=i):(o[f]=p.clone().multiplyRight(o8),s[f]=m.transform(i))}const a={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||s8,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let f=0;f<o.length;f++)a[`viewProjectionMatrix${f}`]=o[f],a[`projectCenter${f}`]=s[f];for(let f=0;f<2;f++)a[`shadow_uShadowMap${f}`]=t.shadowMaps&&t.shadowMaps[f]||t.dummyShadowMap;return a}const $_={name:"shadow",dependencies:[fg],vs:e8,fs:n8,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:c8,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},ta={...v_,defaultUniforms:{...v_.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},u8=[tb],f8=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],h8=[];function d8(t){const e=$c.getDefaultShaderAssembler();for(const r of u8)e.addDefaultModule(r);const n=t==="glsl"?f8:h8;for(const r of n)e.addShaderHook(r);return e}const p8=[255,255,255],g8=1;let m8=0;class _8{constructor(e={}){this.type="ambient";const{color:n=p8}=e,{intensity:r=g8}=e;this.id=e.id||`ambient-${m8++}`,this.color=n,this.intensity=r}}const y8=[255,255,255],v8=1,w8=[0,0,-1];let b8=0;class H_{constructor(e={}){this.type="directional";const{color:n=y8}=e,{intensity:r=v8}=e,{direction:i=w8}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${b8++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new zr(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class x8{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class pg extends x8{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,f=e.colorMask??15,p={viewport:[0,0,n,r]};e.colorMask&&(p.colorMask=f),e.scissorRect&&(p.scissorRect=e.scissorRect);const m=this.device.beginRenderPass({framebuffer:e.target,parameters:p,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(m,e)}finally{m.end(),this.device.submit()}}_drawLayers(e,n){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:a,clearStack:f=!0}=n;n.pass=n.pass||"unknown",f&&(this._lastRenderIndex=-1);const p=[];for(const m of s){const v=o&&o[m.id];a==null||a(m);const w=this._getDrawLayerParams(m,n),T=m.subViewports||[m];for(const E of T){const I=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:E,view:v,pass:n.pass,layers:n.layers},w);p.push(I)}}return p}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,shaderModuleProps:f},p=!1){var E;const m=[],v=gb(this._lastRenderIndex+1),w={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},T={};for(let I=0;I<n.length;I++){const U=n[I],R=this._shouldDrawLayer(U,w,s,T),P={shouldDrawLayer:R};R&&!p&&(P.shouldDrawLayer=!0,P.layerRenderIndex=v(U,R),P.shaderModuleProps=this._getShaderModuleProps(U,a,r,f),P.layerParameters={...(E=U.context.deck)==null?void 0:E.props.parameters,...this.getLayerParameters(U,I,e)}),m[I]=P}return m}_drawLayersInViewport(e,{layers:n,shaderModuleProps:r,pass:i,target:s,viewport:o,view:a},f){const p=T8(this.device,{shaderModuleProps:r,target:s,viewport:o});if(a&&a.props.clear){const v=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:p,scissorRect:p},clearColor:v.color?[0,0,0,0]:!1,clearDepth:v.depth?1:!1}).end()}const m={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:p});for(let v=0;v<n.length;v++){const w=n[v],T=f[v],{shouldDrawLayer:E}=T;if(E&&w.props.pickable&&m.pickableCount++,w.isComposite&&m.compositeCount++,w.isDrawable&&T.shouldDrawLayer){const{layerRenderIndex:I,shaderModuleProps:U,layerParameters:R}=T;m.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,I),U.project&&(U.project.viewport=o),w.context.renderPass=e;try{w._drawLayer({renderPass:e,shaderModuleProps:U,uniforms:{layerIndex:I},parameters:R})}catch(P){w.raiseError(P,`drawing ${w} to ${i}`)}}}return m}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,r){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,r,i){var f,p;const s=this.device.canvasContext.cssToDeviceRatio(),o=((f=e.internalState)==null?void 0:f.propsInTransition)||e.props,a={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const m of n)X_(a,(p=m.getShaderModuleProps)==null?void 0:p.call(m,e,a));return X_(a,this.getShaderModuleProps(e,n,a),i)}}function gb(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,f=i.parent&&i.parent.id;let p;if(f&&!(f in e)&&r(i.parent,!1),f in n){const m=n[f]=n[f]||gb(e[f],e);p=m(i,s),n[a]=m}else Number.isFinite(o)?(p=o+(e[f]||0),n[a]=null):p=t;return s&&p>=t&&(t=p+1),e[a]=p,p};return r}function T8(t,{shaderModuleProps:e,target:n,viewport:r}){var f;const i=((f=e==null?void 0:e.project)==null?void 0:f.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i,0,1]}function X_(t,...e){for(const n of e)if(n)for(const r in n)t[r]?Object.assign(t[r],n[r]):t[r]=n[r];return t}class E8 extends pg{constructor(e,n){super(e,n);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const S8={color:[255,255,255],intensity:1},Q_=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],C8=[0,0,0,200/255];class mb{constructor(e={}){this.id="lighting-effect",this.shadowColor=C8,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule($_),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const r=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule($_))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new jr().lookAt({eye:new zr(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new E8(e);this.shadowPasses[n]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new _8(S8),this.directionalLights.push(new H_(Q_[0]),new H_(Q_[1])))}}class P8{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:f}){const p=i||e&&e.constructor||Float32Array,m=n*r+s;if(ArrayBuffer.isView(e)){if(m<=e.length)return e;if(m*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new p(e.buffer,0,m)}let v=1/0;f&&(v=f*r+s);const w=this._allocate(p,m,a,v);return e&&o?w.set(e):a||w.fill(0,0,4),this._release(e),w}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,f=o.findIndex(p=>p.byteLength>=a);if(f>=0){const p=new e(o.splice(f,1)[0],0,s);return r&&p.fill(0),p}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const Ho=new P8;function Ua(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function k8(t){return[t[12],t[13],t[14]]}function R8(t){return{left:qs(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:qs(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:qs(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:qs(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:qs(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:qs(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Y_=new zr;function qs(t,e,n,r){Y_.set(t,e,n);const i=Y_.len();return{distance:r/i,normal:new zr(-t/i,-e/i,-n/i)}}function I8(t){return t-Math.fround(t)}let Pa;function Hh(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;Pa=Ho.allocate(Pa,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let f=0;f<n;f++){const p=t[o++];Pa[a+f]=p,Pa[a+f+n]=I8(p)}a+=n*2}return Pa.subarray(0,s*n*2)}function M8(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const N8=Math.PI/180,O8=Ua(),K_=[0,0,0],D8={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function B8({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const f=t/e,p=n?new jr().orthographic({fovy:r,aspect:f,focalDistance:i,near:o,far:a}):new jr().perspective({fovy:r,aspect:f,near:o,far:a});if(s){const{left:m=0,right:v=0,top:w=0,bottom:T=0}=s,E=Mi((m+t-v)/2,0,t)-t/2,I=Mi((w+e-T)/2,0,e)-e/2;p[8]-=E*2/t,p[9]+=I*2/e}return p}class $l{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||D8,this.focalDistance=e.focalDistance||1,this.position=e.position||K_,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Lr.WEB_MERCATOR:Lr.WEB_MERCATOR_AUTO_OFFSET:Lr.IDENTITY}equals(e){return e instanceof $l?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Sl(e.projectionMatrix,this.projectionMatrix)&&Sl(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=db(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,f=r&&r*this.distanceScales.unitsPerMeter[2],p=dg([i,a,o],this.pixelUnprojectionMatrix,f),[m,v,w]=this.unprojectPosition(p);return Number.isFinite(o)?[m,v,w]:Number.isFinite(r)?[m,v,r]:[m,v]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=su(e);return n[1]=Mi(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?$o(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?Pd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,R8(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=X6({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||Pd({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=K_;if(s&&(a=o?new jr(o).transformAsVector(s,[]):s),this.isGeospatial){const f=this.projectPosition([n,r,0]);this.center=new zr(a).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=O8,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:f=1e3,padding:p=null,focalDistance:m=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new jr().multiplyRight(n).translate(new zr(this.center).negate()),this.projectionMatrix=r||B8({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*N8,focalDistance:m,padding:p,near:a,far:f});const v=Ua();_s(v,v,this.projectionMatrix),_s(v,v,this.viewMatrix),this.viewProjectionMatrix=v,this.viewMatrixInverse=yd([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=k8(this.viewMatrixInverse);const w=Ua(),T=Ua();cg(w,w,[this.width/2,-this.height/2,1]),nu(w,w,[1,-1,0]),_s(T,w,this.viewProjectionMatrix),this.pixelProjectionMatrix=T,this.pixelUnprojectionMatrix=yd(Ua(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ot.warn("Pixel project matrix not invertible")()}}$l.displayName="Viewport";class Xo extends $l{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:f=1.01,nearZ:p,farZ:m,orthographic:v=!1,projectionMatrix:w,repeat:T=!1,worldOffset:E=0,position:I,padding:U,legacyMeterSizes:R=!1}=e;let{width:P,height:C,altitude:D=1.5}=e;const $=Math.pow(2,i);P=P||1,C=C||1;let q,fe=null;if(w)D=w[5]/2,q=ou(D);else{e.fovy?(q=e.fovy,D=hb(q)):q=ou(D);let he;if(U){const{top:ye=0,bottom:ke=0}=U;he=[0,Mi((ye+C-ke)/2,0,C)-C/2]}fe=Y6({width:P,height:C,scale:$,center:I&&[0,0,I[2]*$h(n)],offset:he,pitch:s,fovy:q,nearZMultiplier:a,farZMultiplier:f}),Number.isFinite(p)&&(fe.near=p),Number.isFinite(m)&&(fe.far=m)}let ae=Q6({height:C,pitch:s,bearing:o,scale:$,altitude:D});E&&(ae=new jr().translate([512*E,0,0]).multiplyLeft(ae)),super({...e,width:P,height:C,viewMatrix:ae,longitude:r,latitude:n,zoom:i,...fe,fovy:q,focalDistance:D}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=D,this.fovy=q,this.orthographic=v,this._subViewports=T?[]:null,this._pseudoMeters=R,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new Xo({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*$h(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/$h(r);return[n,r,i]}addMetersToLngLat(e,n){return fb(e,n)}panByPosition(e,n){const r=dg(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=__([],i,II([],r)),o=__([],this.center,s),[a,f]=this.unprojectFlat(o);return{longitude:a,latitude:f}}getBounds(e={}){const n=q6(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=K6({width:r,height:i,bounds:e,...n});return new Xo({width:r,height:i,longitude:s,latitude:o,zoom:a})}}Xo.displayName="WebMercatorViewport";const Z_=[0,0,0];function Xh(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof Xo){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function F8(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===ft.DEFAULT&&(i=e.isGeospatial?ft.LNGLAT:ft.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function _b(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,f=0]=t;switch(n&&([o,a,f]=jl([],[o,a,f,1],n)),r){case ft.LNGLAT:return Xh([o,a,f],e,s);case ft.LNGLAT_OFFSETS:return Xh([o+i[0],a+i[1],f+(i[2]||0)],e,s);case ft.METER_OFFSETS:return Xh(fb(i,[o,a,f]),e,s);case ft.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],f+i[2]]:e.projectPosition([o,a,f])}}function L8(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=F8(e),{autoOffset:f=!0}=e,{geospatialOrigin:p=Z_,shaderCoordinateOrigin:m=Z_,offsetMode:v=!1}=f?cb(n,r,i):{},w=_b(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:v});if(v){const T=n.projectPosition(p||m);XI(w,w,T)}return w}let U8=1,V8=1;class yb{constructor(){M(this,"time",0);M(this,"channels",new Map);M(this,"animations",new Map);M(this,"playing",!1);M(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=U8++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=V8++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function z8(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function j8(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let W8=0;const $8={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Ad.stats.get(`animation-loop-${W8++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class H8{constructor(e){M(this,"device",null);M(this,"canvas",null);M(this,"props");M(this,"animationProps",null);M(this,"timeline",null);M(this,"stats");M(this,"cpuTime");M(this,"gpuTime");M(this,"frameRate");M(this,"display");M(this,"needsRedraw","initialized");M(this,"_initialized",!1);M(this,"_running",!1);M(this,"_animationFrameId",null);M(this,"_nextFramePromise",null);M(this,"_resolveNextFrame",null);M(this,"_cpuStartTime",0);M(this,"_error",null);if(this.props={...$8,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Qu({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,i;if(this.props.onError(e),this._error=Error(),((i=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=z8(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(j8(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var n;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(n=this.device)==null||n.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var n,r;const e=(r=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,a,f;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(f=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:f.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Qh={};function qu(t="id"){Qh[t]=Qh[t]||1;const e=Qh[t]++;return`${t}-${e}`}class q_{constructor(e){M(this,"id");M(this,"userData",{});M(this,"topology");M(this,"bufferLayout",[]);M(this,"vertexCount");M(this,"indices");M(this,"attributes");if(this.id=e.id||qu("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Pt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function X8(t,e){if(e instanceof q_)return e;const n=Q8(t,e),{attributes:r,bufferLayout:i}=Y8(t,e);return new q_({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function Q8(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:Pt.INDEX,data:n})}function Y8(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(o){r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:f,size:p,normalized:m}=o;n.push({name:a,format:XR(f,p,m)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}const Pu=class Pu{constructor(e){M(this,"device");M(this,"destroyPolicy");M(this,"_hashCounter",0);M(this,"_hashes",{});M(this,"_renderPipelineCache",{});M(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Pu(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...Lo.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...Kc.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof Kc?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&this.destroyPolicy==="unused"&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};M(Pu,"defaultProps",{...Lo.defaultProps});let kd=Pu;const ku=class ku{constructor(e){M(this,"device");M(this,"destroyPolicy");M(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new ku(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};M(ku,"defaultProps",{...Xc.defaultProps});let Rd=ku;function K8(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s)}}return n}let tn=null,ss=null;function Z8(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){tn||(tn=document.createElement("canvas"),tn.id=e,tn.title=e,tn.style.zIndex="100",tn.style.position="absolute",tn.style.top=i,tn.style.left=s,tn.style.border="blue 5px solid",tn.style.transform="scaleY(-1)",document.body.appendChild(tn),ss=tn.getContext("2d")),(tn.width!==t.width||tn.height!==t.height)&&(tn.width=t.width/2,tn.height=t.height/2,tn.style.width="400px",tn.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),f=ss==null?void 0:ss.createImageData(t.width,t.height);if(f){for(let m=0;m<a.length;m+=4)f.data[0+m+0]=a[m+0]*o,f.data[0+m+1]=a[m+1]*o,f.data[0+m+2]=a[m+2]*o,f.data[0+m+3]=r?255:a[m+3]*o;ss==null||ss.putImageData(f,0,0)}}function Id(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Id(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Id(t[s],e[s],n-1))return!1;return!0}return!1}function q8(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function G8(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function vb(t){return q8(t)||G8(t)}function J8(t){return vb(t)||typeof t=="number"||typeof t=="boolean"}function wb(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];J8(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}class eN{constructor(e,n){M(this,"options",{disableWarnings:!1});M(this,"modules");M(this,"moduleUniforms");M(this,"moduleBindings");Object.assign(this.options,n);const r=eg(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;_e.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&_e.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||_e.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],f=this.moduleBindings[i],p=((n=o.getUniforms)==null?void 0:n.call(o,s,a))||s,{uniforms:m,bindings:v}=wb(p);this.moduleUniforms[i]={...a,...m},this.moduleBindings[i]={...f,...v}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let tN="";async function nN(t,e){const n=new Image;return n.crossOrigin="anonymous",n.src=t.startsWith("http")?t:tN+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class Yh{constructor(e,n){M(this,"device");M(this,"id");M(this,"texture");M(this,"sampler");M(this,"view");M(this,"ready");M(this,"isReady",!1);M(this,"destroyed",!1);M(this,"resolveReady",()=>{});M(this,"rejectReady",()=>{});this.device=e,this.id=n.id||qu("async-texture"),typeof(n==null?void 0:n.data)=="string"&&n.dimension==="2d"&&(n={...n,data:nN(n.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){let n,r;const i=e.data,s=await bb(i).then(n,r);if(this.destroyed)return;const o={...e,data:s};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function bb(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(bb));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=n[s];return i}return t}const os=2,rN=1e4,Ru=class Ru{constructor(e,n){M(this,"device");M(this,"id");M(this,"source");M(this,"vs");M(this,"fs");M(this,"pipelineFactory");M(this,"shaderFactory");M(this,"userData",{});M(this,"parameters");M(this,"topology");M(this,"bufferLayout");M(this,"isInstanced");M(this,"instanceCount",0);M(this,"vertexCount");M(this,"indexBuffer",null);M(this,"bufferAttributes",{});M(this,"constantAttributes",{});M(this,"bindings",{});M(this,"uniforms",{});M(this,"vertexArray");M(this,"transformFeedback",null);M(this,"pipeline");M(this,"shaderInputs");M(this,"_uniformStore");M(this,"_attributeInfos",{});M(this,"_gpuGeometry",null);M(this,"_getModuleUniforms");M(this,"props");M(this,"_pipelineNeedsUpdate","newly created");M(this,"_needsRedraw","initializing");M(this,"_destroyed",!1);M(this,"_lastDrawTimestamp",-1);M(this,"_lastLogTime",0);M(this,"_logOpen",!1);M(this,"_drawCount",0);var f,p,m,v;this.props={...Ru.defaultProps,...n},n=this.props,this.id=n.id||qu("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((f=this.props.modules)==null?void 0:f.map(w=>[w.name,w]))||[]),i=n.shaderInputs||new eN(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=sN(e),o=(((p=this.props.modules)==null?void 0:p.length)>0?this.props.modules:(m=this.shaderInputs)==null?void 0:m.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:w,getUniforms:T}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=w,this._getModuleUniforms=T,(v=this.props).shaderLayout||(v.shaderLayout=wI(this.source))}else{const{vs:w,fs:T,getUniforms:E}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=w,this.fs=T,this._getModuleUniforms=E}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||kd.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Rd.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniformsWebGL(n.uniforms),n.moduleSettings&&this.updateModuleSettingsWebGL(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return _e.info(os,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),Md(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&X8(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new Nh(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new Nh(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Id(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new HR(this.shaderInputs.modules);for(const[n,r]of Object.entries(this.shaderInputs.modules))if(iN(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const r=(n==null?void 0:n.disableWarnings)??this.props.disableWarnings;e.indices&&_e.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const i=new Nh(this.bufferLayout);for(const[s,o]of Object.entries(e)){const a=i.getBufferLayout(s);if(!a){r||_e.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const f=i.getAttributeNamesForBuffer(a);let p=!1;for(const m of f){const v=this._attributeInfos[m];v&&(this.vertexArray.setBuffer(v.location,o),p=!0)}!p&&!r&&_e.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||_e.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){Md(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:n,uniforms:r}=wb(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Yh&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,r]of Object.entries(this.bindings))r instanceof Yh?r.isReady&&(e[n]=r.texture):e[n]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof Hc?e=Math.max(e,n.texture.updateTimestamp):n instanceof Pt||n instanceof Ut?e=Math.max(e,n.updateTimestamp):n instanceof Yh?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof Qc||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(_e.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=_w(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=_e.level>3?0:rN;_e.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,_e.group(os,`>>> DRAWING MODEL ${this.id}`,{collapsed:_e.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=K8(this.pipeline.shaderLayout,this.id);_e.table(os,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};_e.table(os,n)();const r=this._getAttributeDebugTable();_e.table(os,this._attributeInfos)(),_e.table(os,r)(),_e.groupEnd(os)(),this._logOpen=!1}}_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const r=e.props.framebuffer;r&&Z8(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:n,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=ww(n);return(e instanceof Pt?new r(e.debugData):e).toString()}};M(Ru,"defaultProps",{...Lo.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:$c.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Yn=Ru;function iN(t){return!!(t.uniformTypes&&!Md(t.uniformTypes))}function sN(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Md(t){for(const e in t)return!1;return!0}const al=class al{constructor(e,n=al.defaultProps){M(this,"device");M(this,"model");M(this,"transformFeedback");if(!al.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Yn(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||Yk(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof Pt)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}};M(al,"defaultProps",{...Yn.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Pl=al;class Ps{constructor(e){M(this,"id");M(this,"topology");M(this,"vertexCount");M(this,"indices");M(this,"attributes");M(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||qu("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const oN={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class xb extends pg{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:f,width:p,height:m},cullRect:v,effects:w,pass:T="picking",pickZ:E,shaderModuleProps:I}){this.pickZ=E;const U=this._resetColorEncoder(E),R=[a,f,p,m],P=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:v,effects:w==null?void 0:w.filter(D=>D.useInPicking),pass:T,isPicking:!0,shaderModuleProps:I,clearColor:[0,0,0,0],colorMask:15,scissorRect:R});return this._colorEncoderState=null,{decodePickingColor:U&&lN.bind(null,U),stats:P}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,n,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,oN),i.blend=!0,i.blendColor=aN(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function aN(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(ot.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function lN(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Js={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},au=Symbol.for("component"),Hi=Symbol.for("propTypes"),Kh=Symbol.for("deprecatedProps"),Po=Symbol.for("asyncPropDefaults"),ks=Symbol.for("asyncPropOriginal"),Ni=Symbol.for("asyncPropResolved");function gg(t,e=()=>!0){return Array.isArray(t)?Tb(t,e,[]):e(t)?[t]:[]}function Tb(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?Tb(i,e,n):e(i)&&n.push(i)}return n}function AN({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class cN{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=zc(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class uN{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new cN(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const f=a&&a.resourceId&&this._resources[a.resourceId];f&&(f.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const fN="layerManager.setLayers",hN="layerManager.activateViewport";class dN{constructor(e,n){var a;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=f=>{xn(hN,this,f),f&&(this.context.viewport=f)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new uN({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:d8(((a=e==null?void 0:e.info)==null?void 0:a.shadingLanguage)||"glsl"),defaultShaderModules:[IM],renderPass:void 0,stats:i||new Qu({id:"deck.gl"}),viewport:s||new $l({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new yb,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){xn(fN,this,n,e),this._lastRenderedLayers=e;const r=gg(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?ot.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&ot.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Js.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Js.MATCHED,n!==e&&(e.lifecycle=Js.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Js.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Js.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function wr(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!wr(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!wr(t[s],e[s],n-1))return!1;return!0}return!1}class pN{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=gg(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!wr(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ot.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let f=n[s.id];const p=!!s.controller;p&&!f&&(r=!0),(r||!p)&&f&&(f.finalize(),f=null),this.controllers[s.id]=this._updateController(s,o,a,f),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const gN=/([0-9]+\.?[0-9]*)(%|px)/;function _i(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=gN.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function yi(t,e){return t.relative?Math.round(t.position*e):t.position}class Qo{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=_i(r),this._y=_i(i),this._width=_i(s),this._height=_i(o),this._padding=a&&{left:_i(a.left||0),right:_i(a.right||0),top:_i(a.top||0),bottom:_i(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&wr(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:yi(this._x,e),y:yi(this._y,n),width:yi(this._width,e),height:yi(this._height,n)};return this._padding&&(r.padding={left:yi(this._padding.left,e),top:yi(this._padding.top,n),right:yi(this._padding.right,e),bottom:yi(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Gu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const G_=()=>{},Nd={BREAK:1,SNAP_TO_END:2,IGNORE:3},mN=t=>t,_N=Nd.BREAK;class yN{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:f}}=n,p=f(r/a),m=i.interpolateProps(s,o,p);this.propsInTransition=this.getControllerState({...this.props,...m}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Gu(e.timeline),this.onViewStateChange=e.onViewStateChange||G_,this.onStateChange=e.onStateChange||G_}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===Nd.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Nd.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const f={duration:o,easing:n.transitionEasing||mN,interpolator:s,interruption:n.transitionInterruption||_N,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function An(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class vN{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Sl(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];An(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const wN=["longitude","latitude","zoom","bearing","pitch"],bN=["longitude","latitude","zoom"];class Eb extends vN{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:wN,required:bN},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),f=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(f),aroundPosition:f,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=zo(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,zo(e.around,n.around,r)))}return i}}const vi={transitionDuration:0},xN=300,DA=t=>1-(1-t)*(1-t),Gs={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},as={};class TN{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new yN({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?xN:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:f=!1,keyboard:p=!0}=e,m=!!this.onViewStateChange;this.toggleEvents(Gs.WHEEL,m&&r),this.toggleEvents(Gs.PAN,m),this.toggleEvents(Gs.PINCH,m&&(a||f)),this.toggleEvents(Gs.MULTI_PAN,m&&f),this.toggleEvents(Gs.DOUBLE_CLICK,m&&o),this.toggleEvents(Gs.KEYBOARD,m&&p),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=f,this.keyboard=p}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,vi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,vi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:DA},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,vi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:DA},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,vi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,vi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:DA},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return as._startPinchRotation=e.rotation,as._lastPinchEvent=e,this.updateViewport(r,vi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:as._startPinchRotation-r})}return this.updateViewport(n,vi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),as._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=as;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),f=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:f}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:DA},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return as._startPinchRotation=null,as._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let f;const p={};switch(e.srcEvent.code){case"Minus":f=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),p.isZooming=!0;break;case"Equal":f=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),p.isZooming=!0;break;case"ArrowLeft":n?(f=a.rotateLeft(s),p.isRotating=!0):(f=a.moveLeft(i),p.isPanning=!0);break;case"ArrowRight":n?(f=a.rotateRight(s),p.isRotating=!0):(f=a.moveRight(i),p.isPanning=!0);break;case"ArrowUp":n?(f=a.rotateUp(o),p.isRotating=!0):(f=a.moveUp(i),p.isPanning=!0);break;case"ArrowDown":n?(f=a.rotateDown(o),p.isRotating=!0):(f=a.moveDown(i),p.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),p),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?vi:e?{...n,transitionInterpolator:new Eb({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class EN{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const J_=5,SN=1.2;class CN extends EN{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:f=0,altitude:p=1.5,position:m=[0,0,0],maxZoom:v=20,minZoom:w=0,maxPitch:T=60,minPitch:E=0,startPanLngLat:I,startZoomLngLat:U,startRotatePos:R,startBearing:P,startPitch:C,startZoom:D,normalize:$=!0}=e;An(Number.isFinite(s)),An(Number.isFinite(i)),An(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:f,altitude:p,maxZoom:v,minZoom:w,maxPitch:T,minPitch:E,normalize:$,position:m},{startPanLngLat:I,startZoomLngLat:U,startRotatePos:R,startBearing:P,startPitch:C,startZoom:D}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let f=i+Math.log2(r);f=Mi(f,a,o);const p=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...p.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Mi(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=Mi(a,o,s);const{normalize:f=!0}=e;return f&&Object.assign(e,G6(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],f=n[1],{width:p,height:m}=this.getViewportProps(),v=s/p;let w=0;o>0?Math.abs(m-f)>J_&&(w=o/(f-m)*SN):o<0&&f>J_&&(w=1-a/f),w=Mi(w,-1,1);const{minPitch:T,maxPitch:E}=this.getViewportProps(),I=i+180*v;let U=r;return w>0?U=r+w*(E-r):w<0&&(U=r-w*(T-r)),{pitch:U,bearing:I}}}class PN extends TN{constructor(){super(...arguments),this.ControllerState=CN,this.transition={transitionDuration:300,transitionInterpolator:new Eb({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Sb extends Qo{constructor(e={}){super(e)}getViewportType(){return Xo}get ControllerType(){return PN}}Sb.displayName="MapView";const kN=new mb;function RN(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class IN{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>RN(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(wr(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof mb)||this._resolvedEffects.push(kN),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class MN extends pg{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const NN="deckRenderer.renderLayers";class ON{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new MN(e),this.pickLayersPass=new xb(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,xn(NN,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const DN={pickedColor:null,pickedObjectIndex:-1};function BN({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:f,height:p}=s;let m=i*i,v=-1,w=0;for(let T=0;T<p;T++){const E=T+a-r,I=E*E;if(I>m)w+=4*f;else for(let U=0;U<f;U++){if(t[w+3]-1>=0){const P=U+o-n,C=P*P+I;C<=m&&(m=C,v=w)}w+=4}}if(v>=0){const T=t.slice(v,v+4),E=e(T);if(E){const I=Math.floor(v/4/f),U=v/4-I*f;return{...E,pickedColor:T,pickedX:o+U,pickedY:a+I}}ot.error("Picked non-existent layer. Is picking buffer corrupt?")()}return DN}function FN({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):ot.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Cb({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=UN((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const f=[r-o.x,i-o.y];s!==void 0&&(f[2]=s),a=o.unproject(f)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function LN(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,f=o?[o]:[];if(r==="hover"){const v=n.index,w=n.layerId,T=o?o.props.id:null;if(T!==w||a!==v){if(T!==w){const E=i.find(I=>I.props.id===w);E&&f.unshift(E)}n.layerId=T,n.index=a,n.info=null}}const p=Cb(t),m=new Map;return m.set(null,p),f.forEach(v=>{let w={...p};v===o&&(w.color=s,w.index=a,w.picked=!0),w=Pb({layer:v,info:w,mode:r});const T=w.layer;v===o&&r==="hover"&&(n.info=w),m.set(T.id,w),r==="hover"&&T.updateAutoHighlight(w)}),m}function Pb({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function UN(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class VN{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new xb(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,f=o?r.find(w=>w.id===o):null,p=a&&i.find(w=>w.id===a)||i[0],m=p&&p.unproject([e-p.x,n-p.y]);return{...s,...{x:e,y:n,viewport:p,coordinate:m,layer:f}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:f="query",unproject3D:p,onViewportActive:m,effects:v}){const w=this.device.canvasContext.cssToDeviceRatio(),T=this._getPickable(e);if(!T||r.length===0)return{result:[],emptyInfo:Cb({viewports:r,x:i,y:s,pixelRatio:w})};this._resizeBuffer();const E=this.device.canvasContext.cssToDevicePixels([i,s],!0),I=[E.x+Math.floor(E.width/2),E.y+Math.floor(E.height/2)],U=Math.round(o*w),{width:R,height:P}=this.pickingFBO,C=this._getPickingRect({deviceX:I[0],deviceY:I[1],deviceRadius:U,deviceWidth:R,deviceHeight:P}),D={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let $;const q=[],fe=new Set;for(let ae=0;ae<a;ae++){let he;if(C){const ke=this._drawAndSample({layers:T,views:n,viewports:r,onViewportActive:m,deviceRect:C,cullRect:D,effects:v,pass:`picking:${f}`});he=BN({...ke,deviceX:I[0],deviceY:I[1],deviceRadius:U,deviceRect:C})}else he={pickedColor:null,pickedObjectIndex:-1};let ye;if(he.pickedLayer&&p&&this.depthFBO){const{pickedColors:ke}=this._drawAndSample({layers:[he.pickedLayer],views:n,viewports:r,onViewportActive:m,deviceRect:{x:he.pickedX,y:he.pickedY,width:1,height:1},cullRect:D,effects:v,pass:`picking:${f}:z`},!0);ke[3]&&(ye=ke[0])}he.pickedLayer&&ae+1<a&&(fe.add(he.pickedLayer),he.pickedLayer.disablePickingIndex(he.pickedObjectIndex)),$=LN({pickInfo:he,lastPickedInfo:this.lastPickedInfo,mode:f,layers:T,viewports:r,x:i,y:s,z:ye,pixelRatio:w});for(const ke of $.values())ke.layer&&q.push(ke);if(!he.pickedColor)break}for(const ae of fe)ae.restorePickingColors();return{result:q,emptyInfo:$.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:f="query",maxObjects:p=null,onViewportActive:m,effects:v}){const w=this._getPickable(e);if(!w||r.length===0)return[];this._resizeBuffer();const T=this.device.canvasContext.cssToDeviceRatio(),E=this.device.canvasContext.cssToDevicePixels([i,s],!0),I=E.x,U=E.y+E.height,R=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),P=R.x+R.width,C=R.y,D={x:I,y:C,width:P-I,height:U-C},$=this._drawAndSample({layers:w,views:n,viewports:r,onViewportActive:m,deviceRect:D,cullRect:{x:i,y:s,width:o,height:a},effects:v,pass:`picking:${f}`}),q=FN($),fe=new Map,ae=[],he=Number.isFinite(p);for(let ye=0;ye<q.length&&!(he&&ae.length>=p);ye++){const ke=q[ye];let Le={color:ke.pickedColor,layer:null,index:ke.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:T};Le=Pb({layer:ke.pickedLayer,info:Le,mode:f});const Ve=Le.layer.id;fe.has(Ve)||fe.set(Ve,new Set);const Ae=fe.get(Ve),Re=Le.object??Le.index;Ae.has(Re)||(Ae.add(Re),ae.push(Le))}return ae}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:f},p=!1){const m=p?this.depthFBO:this.pickingFBO,v={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:m,deviceRect:s,cullRect:o,effects:a,pass:f,pickZ:p,preRenderStats:{},isPicking:!0};for(const P of a)P.useInPicking&&(v.preRenderStats[P.id]=P.preRender(v));const{decodePickingColor:w}=this.pickLayersPass.render(v),{x:T,y:E,width:I,height:U}=s,R=new(p?Float32Array:Uint8Array)(I*U*4);return this.device.readPixelsToArrayWebGL(m,{sourceX:T,sourceY:E,sourceWidth:I,sourceHeight:U,target:R}),{pickedColors:R,decodePickingColor:w}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),f=Math.min(i,e+r+1)-o,p=Math.min(s,n+r+1)-a;return f<=0||p<=0?null:{x:o,y:a,width:f,height:p}}}const zN={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},jN="top-left",e1="__root";class WN{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!wr(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=jN}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){var n;(n=e.onRemove)==null||n.call(e),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||e1;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,zN[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===e1||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var i,s;const r=e.reduce((o,a)=>(o[a.id]=a,o),{});for(const o of this.getWidgets()){const{viewId:a}=o;if(a){const f=r[a];f&&(o.onViewportChange&&o.onViewportChange(f),(i=o.onRedraw)==null||i.call(o,{viewports:[f],layers:n}))}else{if(o.onViewportChange)for(const f of e)o.onViewportChange(f);(s=o.onRedraw)==null||s.call(o,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=Ed[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r])==null||s.call(o,e,n))}}}const $N={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class HN{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,$N),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var ho;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(ho||(ho={}));const mg={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ht=(t,e,n)=>e?t.enable(n):t.disable(n),t1=(t,e,n)=>t.hint(n,e),jn=(t,e,n)=>t.pixelStorei(n,e),n1=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},ka=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function Zh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const XN={3042:Ht,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Ht,2885:(t,e)=>t.cullFace(e),2929:Ht,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Ht,35723:t1,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:n1,36010:n1,34964:ka,36662:ka,36663:ka,35053:ka,35055:ka,2886:(t,e)=>t.frontFace(e),33170:t1,2849:(t,e)=>t.lineWidth(e),32823:Ht,32824:"polygonOffset",10752:"polygonOffset",35977:Ht,32926:Ht,32928:Ht,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ht,3088:(t,e)=>t.scissor(...e),2960:Ht,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Ht,10754:Ht,12288:Ht,12289:Ht,12290:Ht,12291:Ht,12292:Ht,12293:Ht,12294:Ht,12295:Ht,3333:jn,3317:jn,37440:jn,37441:jn,37443:jn,3330:jn,3332:jn,3331:jn,3314:jn,32878:jn,3316:jn,3315:jn,32877:jn,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=Zh(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=Zh(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=Zh(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function Lt(t,e,n){return e[t]!==void 0?e[t]:n[t]}const QN={blendEquation:(t,e,n)=>t.blendEquationSeparate(Lt(32777,e,n),Lt(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Lt(32969,e,n),Lt(32968,e,n),Lt(32971,e,n),Lt(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Lt(32824,e,n),Lt(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Lt(32938,e,n),Lt(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Lt(2962,e,n),Lt(2967,e,n),Lt(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Lt(34816,e,n),Lt(36003,e,n),Lt(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Lt(2964,e,n),Lt(2965,e,n),Lt(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Lt(34817,e,n),Lt(34818,e,n),Lt(34819,e,n))},r1={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Mr=(t,e)=>t.isEnabled(e),i1={3042:Mr,2884:Mr,2929:Mr,3024:Mr,32823:Mr,32926:Mr,32928:Mr,3089:Mr,2960:Mr,35977:Mr},YN=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function na(t,e){if(ZN(e))return;const n={};for(const i in e){const s=Number(i),o=XN[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=QN[i];s(t,e,r)}}function kb(t,e=mg){if(typeof e=="number"){const i=e,s=i1[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=i1[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function KN(t){na(t,mg)}function ZN(t){for(const e in t)return!1;return!0}function qN(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class ys{constructor(e,n){M(this,"gl");M(this,"program",null);M(this,"stateStack",[]);M(this,"enable",!0);M(this,"cache",null);M(this,"log");M(this,"initialized",!1);this.gl=e,this.log=(n==null?void 0:n.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];na(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?kb(e):Object.assign({},mg),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,JN(e);for(const r in r1){const i=r1[r];GN(e,r,i)}s1(e,"getParameter"),s1(e,"isEnabled")}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],a=this.cache[s];qN(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function s1(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||YN.has(i))return n(i);const s=ys.get(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function GN(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=ys.get(t),{valueChanged:a,oldValue:f}=n(o._updateCache,...s);return a&&r(...s),f},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function JN(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=ys.get(t);i.program!==r&&(e(r),i.program=r)}}function eO(t,e,n){let r="";const i={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=t.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!n.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:a}=e;return t.addEventListener("webglcontextlost",f=>o(f),!1),t.addEventListener("webglcontextrestored",f=>a(f),!1),s.luma||(s.luma={}),s}function Yo(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function tO(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Yo(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,f=o||r,p=t.getParameter(7938),m=Rb(a,f),v=nO(a,f),w=rO(a,f);return{type:"webgl",gpu:m,gpuType:w,gpuBackend:v,vendor:a,renderer:f,version:p,shadingLanguage:"glsl",shadingLanguageVersion:300}}function Rb(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function nO(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function rO(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(Rb(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function Ib(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Va="WEBGL_compressed_texture_s3tc",za="WEBGL_compressed_texture_s3tc_srgb",po="EXT_texture_compression_rgtc",go="EXT_texture_compression_bptc",iO="WEBGL_compressed_texture_etc",sO="WEBGL_compressed_texture_astc",oO="WEBGL_compressed_texture_etc1",aO="WEBGL_compressed_texture_pvrtc",lO="WEBGL_compressed_texture_atc",o1="EXT_texture_norm16",a1="EXT_render_snorm",AO="EXT_color_buffer_float",_g={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[a1],"norm16-renderable-webgl":[o1],"snorm16-renderable-webgl":[o1,a1],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Va,za,po,go],"texture-compression-bc5-webgl":[po],"texture-compression-bc7-webgl":[go],"texture-compression-etc2":[iO],"texture-compression-astc":[sO],"texture-compression-etc1-webgl":[oO],"texture-compression-pvrtc-webgl":[aO],"texture-compression-atc-webgl":[lO]};function cO(t){return t in _g}function uO(t,e,n){return(_g[e]||[]).every(i=>Yo(t,i,n))}const yg={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:AO,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Va},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:za},"bc1-rgba-unorm":{gl:33777,x:Va},"bc1-rgba-unorm-srgb":{gl:35916,x:za},"bc2-rgba-unorm":{gl:33778,x:Va},"bc2-rgba-unorm-srgb":{gl:35918,x:za},"bc3-rgba-unorm":{gl:33779,x:Va},"bc3-rgba-unorm-srgb":{gl:35919,x:za},"bc4-r-unorm":{gl:36283,x:po},"bc4-r-snorm":{gl:36284,x:po},"bc5-rg-unorm":{gl:36285,x:po},"bc5-rg-snorm":{gl:36286,x:po},"bc6h-rgb-ufloat":{gl:36495,x:go},"bc6h-rgb-float":{gl:36494,x:go},"bc7-rgba-unorm":{gl:36492,x:go},"bc7-rgba-unorm-srgb":{gl:36493,x:go},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function fO(t,e,n){let r=e.create;const i=yg[e.format];return(i==null?void 0:i.gl)===void 0&&(r=!1),i!=null&&i.x&&(r=r&&!!Yo(t,i.x,n)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function Mb(t){var i;const e=yg[t],n=pO(t),r=tg(t);return{internalFormat:n,format:(e==null?void 0:e.dataFormat)||dO(r.channels,r.integer,r.normalized,n),type:r.dataType?Ib(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed||!1}}function hO(t){switch(tg(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function dO(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function pO(t){const e=yg[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const l1={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class gO extends cR{constructor(n,r,i){super([],i);M(this,"gl");M(this,"extensions");M(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Yo(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){var r;return(r=this.disabledFeatures)!=null&&r[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),cO(n)&&uO(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(l1),...Object.keys(_g)]}getWebGLFeature(n){const r=l1[n];return typeof r=="string"?!!Yo(this.gl,r,this.extensions):!!r}}class mO extends AR{constructor(n){super();M(this,"gl");M(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]||0}}class rl extends Yc{constructor(n,r){super(n,r);M(this,"device");M(this,"gl");M(this,"handle");M(this,"colorAttachments",[]);M(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const n=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=hO(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${yO(r)}`)}this.gl.bindFramebuffer(36160,n)}_attachTextureView(n,r){const{gl:i}=this.device,{texture:s}=r,o=r.props.baseMipLevel,a=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,n,s.handle,o,a);break;case 34067:const f=_O(a);i.framebufferTexture2D(36160,n,f,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,n,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function _O(t){return t<34069?t+34069:t}function yO(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class vO extends cd{constructor(n,r){super(r);M(this,"device");M(this,"format","rgba8unorm");M(this,"depthStencilFormat","depth24plus");M(this,"presentationSize");M(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new rl(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}async function Nb(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}const wO=1;let wt=null,A1=!1;const vg={debugSpectorJS:_e.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function bO(t){if(!globalThis.SPECTOR)try{await Nb(t.debugSpectorJSUrl||vg.debugSpectorJSUrl)}catch(e){_e.warn(String(e))}}function xO(t){var e;if(t={...vg,...t},!t.debugSpectorJS)return null;if(!wt&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){_e.probe(wO,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:n}=globalThis.SPECTOR;wt=new n,globalThis.luma&&(globalThis.luma.spector=wt)}if(!wt)return null;if(A1||(A1=!0,wt.spyCanvases(),wt==null||wt.onCaptureStarted.add(n=>_e.info("Spector capture started:",n)()),wt==null||wt.onCapture.add(n=>{_e.info("Spector capture complete:",n)(),wt==null||wt.getResultUI(),wt==null||wt.resultView.display(),wt==null||wt.resultView.addCapture(n)})),t.gl){const n=t.gl,r=n.device;wt==null||wt.startCapture(t.gl,500),n.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{_e.info("Spector capture stopped after 2 seconds")(),wt==null||wt.stopCapture()})}return wt}const TO="https://unpkg.com/webgl-debug@2.0.1/index.js";function Ob(t){return t.luma=t.luma||{},t.luma}async function EO(){Ds()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await Nb(TO))}function SO(t,e={}){return e.debugWebGL||e.traceWebGL?PO(t,e):CO(t)}function CO(t){const e=Ob(t);return e.realContext?e.realContext:t}function PO(t,e){if(!globalThis.WebGLDebugUtils)return _e.warn("webgl-debug not loaded")(),t;const n=Ob(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...ho,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,kO.bind(null,e),RO.bind(null,e));for(const o in ho)!(o in r)&&typeof ho[o]=="number"&&(r[o]=ho[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function c1(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function kO(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;_e.error(o)();debugger}function RO(t,e,n){let r="";_e.level>=1&&(r=c1(e,n),t.traceWebGL&&_e.log(1,r)());for(const i of n)if(i===void 0){r=r||c1(e,n);debugger}}const qh={};function IO(t="id"){qh[t]=qh[t]||1;const e=qh[t]++;return`${t}-${e}`}class il extends Pt{constructor(n,r={}){super(n,r);M(this,"device");M(this,"gl");M(this,"handle");M(this,"glTarget");M(this,"glUsage");M(this,"glIndexType",5123);M(this,"byteLength");M(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=MO(this.props.usage),this.glUsage=NO(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function MO(t){return t&Pt.INDEX?34963:t&Pt.VERTEX?34962:t&Pt.UNIFORM?35345:34962}function NO(t){return t&Pt.INDEX||t&Pt.VERTEX?35044:t&Pt.UNIFORM?35048:35044}function OO(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[v,w]=i;n.push({message:w.trim(),type:u1(v),lineNum:0,linePos:0});continue}const[s,o,a,...f]=i;let p=parseInt(a,10);isNaN(p)&&(p=0);let m=parseInt(o,10);isNaN(m)&&(m=0),n.push({message:f.join(":").trim(),type:u1(s),lineNum:p,linePos:m})}return n}function u1(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class DO extends Xc{constructor(n,r){super(n,r);M(this,"device");M(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return n?OO(n):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(n){n=n.startsWith("#version ")?n:`#version 300 es
${n}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}_e.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),_e.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function BO(t,e,n,r){if(VO(e))return r(t);const i=t;i.pushState();try{return FO(t,e),na(i.gl,n),r(t)}finally{i.popState()}}function FO(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(vs("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=vs("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=vs("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(UO("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Od("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&_e.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Od("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Gh("stencilPassOperation",e.stencilPassOperation),s=Gh("stencilFailOperation",e.stencilFailOperation),o=Gh("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=f1("blendColorOperation",e.blendColorOperation||"add"),s=f1("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=BA("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=BA("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=BA("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),p=BA("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,f,p)}}function Od(t,e){return vs(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Gh(t,e){return vs(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function f1(t,e){return vs(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function BA(t,e){return vs(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function LO(t,e){return`Illegal parameter ${e} for ${t}`}function vs(t,e,n){if(!(e in n))throw new Error(LO(t,e));return n[e]}function UO(t,e){return e}function VO(t){let e=!0;for(const n in t){e=!1;break}return e}function Db(t){const e={};return t.addressModeU&&(e[10242]=Jh(t.addressModeU)),t.addressModeV&&(e[10243]=Jh(t.addressModeV)),t.addressModeW&&(e[32882]=Jh(t.addressModeW)),t.magFilter&&(e[10240]=Dd(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=zO(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Od("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function Jh(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Dd(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function zO(t,e="none"){if(!e)return Dd(t);switch(e){case"none":return Dd(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Bd extends Qc{constructor(n,r){super(n,r);M(this,"device");M(this,"handle");M(this,"parameters");this.device=n,this.parameters=Db(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class mo extends Hc{constructor(n,r){super(n,{...Ut.defaultProps,...r});M(this,"device");M(this,"gl");M(this,"handle");M(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const jO="Failed to deduce GL constant from typed array";function WO(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(jO)}}function $O(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Bb(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function HO(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function lu(t,e,n){if(XO(e))return n(t);const{nocatch:r=!0}=e,i=ys.get(t);i.push(),na(t,e);let s;if(r)s=n(t),i.pop();else try{s=n(t)}finally{i.pop()}return s}function XO(t){for(const e in t)return!1;return!0}function QO(t,e,n){const{dimension:r,width:i,height:s,depth:o=0}=n,{glInternalFormat:a}=n,f=n.glTarget;switch(r){case"2d-array":case"3d":t.texStorage3D(f,e,a,i,s,o);break;default:t.texStorage2D(f,e,a,i,s)}}function h1(t,e,n,r){const{width:i,height:s}=r,{dimension:o,depth:a=0,mipLevel:f=0}=r,{x:p=0,y:m=0,z:v=0}=r,{glFormat:w,glType:T}=r,E=Fb(r.glTarget,o,a),I=r.flipY?{37440:!0}:{};lu(t,I,()=>{switch(o){case"2d-array":case"3d":t.bindTexture(E,e),t.texSubImage3D(E,f,p,m,v,i,s,a,w,T,n),t.bindTexture(E,null);break;case"2d":case"cube":t.bindTexture(E,e),t.texSubImage2D(E,f,p,m,i,s,w,T,n),t.bindTexture(E,null);break;default:throw new Error(o)}})}function d1(t,e,n){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:a=0,byteOffset:f=0}=n,{x:p=0,y:m=0,z:v=0}=n,{glFormat:w,glType:T,compressed:E}=n,I=Fb(n.glTarget,r,o);switch(r){case"2d-array":case"3d":E?t.compressedTexSubImage3D(I,a,p,m,v,i,s,o,w,e,f):t.texSubImage3D(I,a,p,m,v,i,s,o,w,T,e,f);break;case"2d":case"cube":E?t.compressedTexSubImage2D(I,a,p,m,i,s,w,e,f):t.texSubImage2D(I,a,p,m,i,s,w,T,e,f);break;default:throw new Error(r)}}function YO(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function Fb(t,e,n){return e==="cube"?34069+n:t}function KO(t,e){var R;const{sourceX:n=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:a,sourceDepth:f,sourceFormat:p,sourceType:m}=e||{};const{framebuffer:v,deleteFramebuffer:w}=Lb(t),{gl:T,handle:E}=v;o||(o=v.width),a||(a=v.height);const I=(R=v.colorAttachments[i])==null?void 0:R.texture;if(!I)throw new Error(`Invalid framebuffer attachment ${i}`);f=(I==null?void 0:I.depth)||1,p||(p=(I==null?void 0:I.glFormat)||6408),m||(m=(I==null?void 0:I.glType)||5121),s=GO(s,m,p,o,a),m=m||WO(s);const U=T.bindFramebuffer(36160,E);return T.readBuffer(36064+i),T.readPixels(n,r,o,a,p,m,s),T.readBuffer(36064),T.bindFramebuffer(36160,U||null),w&&v.destroy(),s}function ZO(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:f,sourceType:p}=e||{};const{framebuffer:m,deleteFramebuffer:v}=Lb(t);a=a||m.width,f=f||m.height;const w=m;p=p||5121;let T=n;if(!T){const I=Bb(s),U=HO(p),R=o+a*f*I*U;T=w.device.createBuffer({byteLength:R})}const E=t.device.createCommandEncoder();return E.copyTextureToBuffer({sourceTexture:t,width:a,height:f,origin:[r,i],destinationBuffer:T,byteOffset:o}),E.destroy(),v&&m.destroy(),T}function Lb(t){return t instanceof Yc?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:qO(t),deleteFramebuffer:!0}}function qO(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function GO(t,e,n,r,i,s){if(t)return t;e||(e=5121);const o=$O(e,{clamped:!1}),a=Bb(n);return new o(r*i*a)}class sl extends Ut{constructor(n,r){super(n,r);M(this,"device");M(this,"gl");M(this,"handle");M(this,"sampler");M(this,"view");M(this,"mipmaps");M(this,"compressed");M(this,"glTarget");M(this,"glFormat");M(this,"glType");M(this,"glInternalFormat");M(this,"textureUnit",0);const i={...this.props};i.data=r.data,this.device=n,this.gl=this.device.gl,this.glTarget=YO(this.props.dimension);const s=Mb(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(n){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:n.data});let{width:r,height:i}=n;if(!r||!i){const s=Ut.getTextureDataSize(n.data);r=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=r,this.height=i,this.depth=n.depth,this.setSampler(n.sampler),this.view=new mo(this.device,{...this.props,texture:this}),this.bind(),QO(this.gl,this.mipLevels,this),n.data)switch(n.dimension){case"1d":this.setTexture1DData(n.data);break;case"2d":this.setTexture2DData(n.data);break;case"3d":this.setTexture3DData(n.data);break;case"cube":this.setTextureCubeData(n.data);break;case"2d-array":this.setTextureArrayData(n.data);break;case"cube-array":this.setTextureCubeArrayData(n.data);break;default:throw new Error(n.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(n){return new mo(this.device,{...n,texture:this})}setSampler(n={}){let r;n instanceof Bd?(this.sampler=n,r=n.props):(this.sampler=new Bd(this.device,n),r=n);const i=Db(r);this._setSamplerParameters(i)}generateMipmap(n){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(_e.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(n!=null&&n.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){_e.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(n){const r=Ut.getExternalImageSize(n.image),i={...Ut.defaultCopyExternalImageOptions,...r,...n},{image:s,depth:o,mipLevel:a,x:f,y:p,z:m,flipY:v}=i;let{width:w,height:T}=i;const{dimension:E,glTarget:I,glFormat:U,glInternalFormat:R,glType:P}=this;if(w=Math.min(w,this.width-f),T=Math.min(T,this.height-p),n.sourceX||n.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return h1(this.device.gl,this.handle,s,{dimension:E,mipLevel:a,x:f,y:p,z:m,width:w,height:T,depth:o,glFormat:U,glType:P,glTarget:I,flipY:v}),{width:i.width,height:i.height}}setTexture1DData(n){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(n,r=0){this.bind();const i=Ut.normalizeTextureData(n,this);i.length>1&&this.props.mipmaps!==!1&&_e.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this._setMipLevel(r,s,o)}this.unbind()}setTexture3DData(n){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(n)&&(this.bind(),d1(this.device.gl,n,this),this.unbind())}setTextureCubeData(n,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of Ut.CubeFaces)this.setTextureCubeFaceData(n[i],i)}setTextureArrayData(n){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(n){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(n,r,i=0){Array.isArray(n)&&n.length>1&&this.props.mipmaps!==!1&&_e.warn(`${this.id} has mipmap and multiple LODs.`)();const s=Ut.CubeFaces.indexOf(r);this.setTexture2DData(n,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:a,format:f=6408,type:p=5121}=n,{gl:m}=this,v=o||a;this.bind(),v instanceof Promise?v.then(w=>this.setImageDataForFace(Object.assign({},n,{face:r,data:w,pixels:w}))):this.width||this.height?m.texImage2D(r,0,f,i,s,0,f,p,v):m.texImage2D(r,0,f,f,p,v)}_getImageDataMap(n){for(let r=0;r<Ut.CubeFaces.length;++r){const i=Ut.CubeFaces[r];n[i]&&(n[34069+r]=n[i],delete n[i])}return n}_setSamplerParameters(n){_e.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(n))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;default:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(n,r,i,s=this.glTarget){if(Ut.isExternalImage(i)){h1(this.device.gl,this.handle,i,{...this,depth:n,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(Ut.isTextureLevelData(i)){d1(this.device.gl,i.data,{...this,depth:n,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,this.handle),n}unbind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,null),n}}const JO=[1,2,4,8];class e5 extends ud{constructor(n,r){var o;super(n,r);M(this,"device");M(this,"glParameters");this.device=n;let i;if(!((o=r==null?void 0:r.parameters)!=null&&o.viewport))if(r!=null&&r.framebuffer){const{width:a,height:f}=r.framebuffer;i=[0,0,a,f]}else{const[a,f]=n.getCanvasContext().getDrawingBufferSize();i=[0,0,a,f]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const a=this.props.framebuffer.colorAttachments.map((f,p)=>36064+p);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=JO.map(i=>!!(i&n.colorMask))),this.glParameters=r,na(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,n.clearStencil=this.props.clearStencil),r!==0&&lu(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){lu(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,n,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,n,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,n,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function t5(t){return n5.includes(t)}const n5=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Ub={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Vb(t){const e=Ub[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function r5(t){const e=Ub[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function i5(t,e){const n={attributes:[],bindings:[]};n.attributes=s5(t,e);const r=l5(t,e);for(const a of r){const f=a.uniforms.map(p=>({name:p.name,format:p.format,byteOffset:p.byteOffset,byteStride:p.byteStride,arrayLength:p.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:f})}const i=a5(t,e);let s=0;for(const a of i)if(t5(a.type)){const{viewDimension:f,sampleType:p}=c5(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:s,viewDimension:f,sampleType:p}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=o5(t,e);return o!=null&&o.length&&(n.varyings=o),n}function s5(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,f=t.getAttribLocation(e,o);if(f>=0){const{attributeType:p}=r5(a),m=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:f,stepMode:m,type:p})}}return n.sort((i,s)=>i.location-s.location),n}function o5(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:f}=s,{glType:p,components:m}=Vb(a),v={location:i,name:o,type:p,size:f*m};n.push(v)}return n.sort((i,s)=>i.location-s.location),n}function a5(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:f}=s,{name:p,isArray:m}=u5(o);let v=t.getUniformLocation(e,p);const w={location:v,name:p,size:a,type:f,isArray:m};if(n.push(w),w.size>1)for(let T=0;T<w.size;T++){const E=`${p}[${T}]`;v=t.getUniformLocation(e,E);const I={...w,name:E,location:v};n.push(I)}}return n}function l5(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],f=t.getActiveUniforms(e,a,35383),p=t.getActiveUniforms(e,a,35384),m=t.getActiveUniforms(e,a,35387),v=t.getActiveUniforms(e,a,35388);for(let w=0;w<o.uniformCount;++w){const T=t.getActiveUniform(e,a[w]);if(!T)throw new Error("activeInfo");o.uniforms.push({name:T.name,format:Vb(f[w]).format,type:f[w],arrayLength:p[w],byteOffset:m[w],byteStride:v[w]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const A5={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function c5(t){const e=A5[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function u5(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function f5(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function h5(t){return vb(t)!==null||typeof t=="number"||typeof t=="boolean"}function d5(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];h5(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function p5(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function g5(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const p1=4;class m5 extends Lo{constructor(n,r){super(n,r);M(this,"device");M(this,"handle");M(this,"vs");M(this,"fs");M(this,"introspectedLayout");M(this,"uniforms",{});M(this,"bindings",{});M(this,"varyings",null);M(this,"_uniformCount",0);M(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),_e.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=i5(this.device.gl,this.handle),_e.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=_5(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(f=>`"${f.name}"`).join(", ");r!=null&&r.disableWarnings||_e.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${a}`,s)();continue}switch(s||_e.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof il)&&!(s.buffer instanceof il))throw new Error("buffer value");break;case"texture":if(!(s instanceof mo||s instanceof sl||s instanceof rl))throw new Error("texture value");break;case"sampler":_e.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var U;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:f,isInstanced:p=!1,firstVertex:m=0,transformFeedback:v}=n,w=p5(s),T=!!o.indexBuffer,E=(U=o.indexBuffer)==null?void 0:U.glIndexType;if(this.linkStatus!=="success")return _e.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return _e.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),v&&v.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const I=r;return BO(this.device,i,I.glParameters,()=>{T&&p?this.device.gl.drawElementsInstanced(w,a||0,E,m,f||0):T?this.device.gl.drawElements(w,a||0,E,m):p?this.device.gl.drawArraysInstanced(w,m,a||0,f||0):this.device.gl.drawArrays(w,m,a||0),v&&v.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=d5(n);Object.keys(r).forEach(i=>{_e.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),_e.time(p1,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),_e.timeEnd(p1,`linkProgram for ${this.id}`)(),_e.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}_e.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),_e.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(n){var r;switch(n){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${n}: ${i}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(_e.warn(`Binding ${r.name} not found in ${this.id}`)(),n=!1);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,f=n.getUniformBlockIndex(this.handle,a);if(f===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,f),o instanceof il?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof mo||o instanceof sl||o instanceof rl))throw new Error("texture");let p;if(o instanceof mo)p=o.texture;else if(o instanceof sl)p=o;else if(o instanceof rl&&o.colorAttachments[0]instanceof mo)_e.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),p=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(p.glTarget,p.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&f5(this.device.gl,i,s,a)}}}function _5(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):_e.warn(`shader layout attribute ${r.name} not present in shader`)}return n}class y5 extends hd{constructor(n){super(n,{});M(this,"device");M(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":v5(this.device,r.options);break;case"copy-buffer-to-texture":w5(this.device,r.options);break;case"copy-texture-to-buffer":b5(this.device,r.options);break;case"copy-texture-to-texture":x5(this.device,r.options);break;default:throw new Error(r.name)}}}function v5(t,e){const n=e.sourceBuffer,r=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function w5(t,e){throw new Error("Not implemented")}function b5(t,e){const{sourceTexture:n,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:f=[0,0],destinationBuffer:p,byteOffset:m=0,bytesPerRow:v,rowsPerImage:w}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||a!==0||v||w)throw new Error("not implemented");const{framebuffer:T,destroyFramebuffer:E}=zb(n);let I;try{const U=p,R=s||T.width,P=o||T.height,C=Mb(T.colorAttachments[0].texture.props.format),D=C.format,$=C.type;t.gl.bindBuffer(35051,U.handle),I=t.gl.bindFramebuffer(36160,T.handle),t.gl.readPixels(f[0],f[1],R,P,D,$,m)}finally{t.gl.bindBuffer(35051,null),I!==void 0&&t.gl.bindFramebuffer(36160,I),E&&T.destroy()}}function x5(t,e){const{sourceTexture:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:a=e.destinationTexture.width,height:f=e.destinationTexture.height}=e;const{framebuffer:p,destroyFramebuffer:m}=zb(n),[v,w]=i,[T,E,I]=s,U=t.gl.bindFramebuffer(36160,p.handle);let R=null,P;if(o instanceof sl)R=o,a=Number.isFinite(a)?a:R.width,f=Number.isFinite(f)?f:R.height,R.bind(0),P=R.glTarget;else throw new Error("invalid destination");switch(P){case 3553:case 34067:t.gl.copyTexSubImage2D(P,r,T,E,v,w,a,f);break;case 35866:case 32879:t.gl.copyTexSubImage3D(P,r,T,E,I,v,w,a,f);break}R&&R.unbind(),t.gl.bindFramebuffer(36160,U),m&&p.destroy()}function zb(t){if(t instanceof Ut){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class T5 extends fd{constructor(n,r){super(n,r);M(this,"device");M(this,"commandBuffer");this.device=n,this.commandBuffer=new y5(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}function E5(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let f=r;a<s;a++)e[f++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}class wg extends dd{constructor(n,r){super(n,r);M(this,"device");M(this,"handle");M(this,"buffer",null);M(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return J4()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:f,normalized:p,integer:m,divisor:v}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),m?this.device.gl.vertexAttribIPointer(n,s,o,a,f):this.device.gl.vertexAttribPointer(n,s,o,p,a,f),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,v||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=Ib(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=wg.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=S5(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!C5(i,this.bufferValue),a){const f=UR(r.constructor,o);E5({target:f,source:i,start:0,count:o}),this.buffer.write(f),this.bufferValue=r}return this.buffer}}function S5(t){return Array.isArray(t)?new Float32Array(t):t}function C5(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class P5 extends pd{constructor(n,r){super(n,r);M(this,"device");M(this,"gl");M(this,"handle");M(this,"layout");M(this,"buffers",{});M(this,"unusedBuffers",{});M(this,"bindOnUse",!0);M(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(g5(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,_e.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if(g1(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof il)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(g1(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function g1(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class k5 extends gd{constructor(n,r){super(n,r);M(this,"device");M(this,"handle");M(this,"target",null);M(this,"_queryPending",!1);M(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class _o extends Wi{constructor(n){var v,w;super({...n,id:n.id||IO("webgl-device")});M(this,"type","webgl");M(this,"handle");M(this,"features");M(this,"limits");M(this,"info");M(this,"canvasContext");M(this,"lost");M(this,"_resolveContextLost");M(this,"gl");M(this,"debug",!1);M(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});M(this,"_extensions",{});M(this,"_polyfilled",!1);M(this,"spectorJS");M(this,"renderPass",null);M(this,"_constants");const r=Wi._getCanvasContextProps(n);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(w=(v=r.canvas)==null?void 0:v.gl)==null?void 0:w.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new vO(this,r),this.lost=new Promise(T=>{this._resolveContextLost=T});const s={...n.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),n.powerPreference!==void 0&&(s.powerPreference=n.powerPreference);const a=this.props._handle||eO(this.canvasContext.canvas,{onContextLost:T=>{var E;return(E=this._resolveContextLost)==null?void 0:E.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:T=>console.log("WebGL context restored")},s);if(!a)throw new Error("WebGL context creation failed");if(i=a.device,i){if(n._reuseDevices)return _e.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=a,this.gl=a,this.spectorJS=xO({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=tO(this.gl,this._extensions),this.limits=new mO(this.gl),this.features=new gO(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new ys(this.gl,{log:(...T)=>_e.log(1,...T)()}).trackState(this.gl,{copyState:!1});const p=n.debugWebGL||n.debug,m=n.debugWebGL;p&&(this.gl=SO(this.gl,{debugWebGL:p,traceWebGL:m}),_e.warn("WebGL debug mode activated. Performance reduced.")(),n.debugWebGL&&(_e.level=Math.max(_e.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._normalizeBufferProps(n);return new il(this,r)}createTexture(n){return new sl(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new Bd(this,n)}createShader(n){return new DO(this,n)}createFramebuffer(n){return new rl(this,n)}createVertexArray(n){return new wg(this,n)}createTransformFeedback(n){return new P5(this,n)}createQuerySet(n){return new k5(this,n)}createRenderPipeline(n){return new m5(this,n)}beginRenderPass(n){return new e5(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n={}){return new T5(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return KO(n,r)}readPixelsToBufferWebGL(n,r){return ZO(n,r)}setParametersWebGL(n){na(this.gl,n)}getParametersWebGL(n){return kb(this.gl,n)}withParametersWebGL(n,r){return lu(this.gl,n,r)}resetWebGL(){_e.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),KN(this.gl)}_getDeviceSpecificTextureFormatCapabilities(n){return fO(this.gl,n,this._extensions)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){ys.get(this.gl).push()}popState(){ys.get(this.gl).pop()}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){const i=Number(n);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r!=null&&r.emptyIfUnknown?"":String(n)}getGLKeys(n){const r={emptyIfUnknown:!0};return Object.entries(n).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&N5(s,r)&&_e.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:R5(this,n,r);break;case Int32Array:I5(this,n,r);break;case Uint32Array:M5(this,n,r);break;default:throw new Error("constant")}}getExtension(n){return Yo(this.gl,n,this._extensions),this._extensions}}function R5(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function I5(t,e,n){t.gl.vertexAttribI4iv(e,n)}function M5(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function N5(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const O5={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},D5=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),B5=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),F5=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function L5(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,r){if(n==="webgl"||n==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&U5(i),i}return this.originalGetContext(n,r)}}function U5(t){t.getExtension("EXT_color_buffer_float");const e={...O5,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:D5(t),OES_vertex_array_object:B5(t),ANGLE_instanced_arrays:F5(t)},n=t.getExtension;t.getExtension=function(i){const s=n.call(t,i);return s||(i in e?e[i]:null)};const r=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=r.apply(t)||[];return i==null?void 0:i.concat(Object.keys(e))}}const FA=1;class V5 extends pR{constructor(){super();M(this,"type","webgl");Wi.defaultProps={...Wi.defaultProps,...vg},_o.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(n){L5(n)}async attach(n){if(n instanceof _o)return n;if((n==null?void 0:n.device)instanceof Wi)return n.device;if(!z5(n))throw new Error("Invalid WebGL2RenderingContext");return new _o({_handle:n,createCanvasContext:{canvas:n.canvas,autoResize:!1}})}async create(n={}){_e.groupCollapsed(FA,"WebGLDevice created")();const r=[];(n.debugWebGL||n.debug)&&r.push(EO()),n.debugSpectorJS&&r.push(bO(n));const i=await Promise.allSettled(r);for(const a of i)a.status==="rejected"&&_e.error(`Failed to initialize debug libraries ${a.reason}`)();const s=new _o(n),o=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return _e.probe(FA,o)(),_e.table(FA,s.info)(),_e.groupEnd(FA)(),s}}function z5(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const m1=new V5;function wi(){}const j5=({isDragging:t})=>t?"grabbing":"grab",jb={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:wi,onWebGLInitialized:wi,onResize:wi,onViewStateChange:wi,onInteractionStateChange:wi,onBeforeRender:wi,onAfterRender:wi,onLoad:wi,onError:t=>ot.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:j5,getTooltip:null,debug:!1,drawPickingColors:!1};class bg{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Qu({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=Ed[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:f}=a,p=f&&(f[i]||f.props[i]),m=this.props[i];let v=!1;p&&(v=p.call(f,a,r)),v||(m==null||m(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...jb,...e},e=this.props,e.viewState&&e.initialViewState&&ot.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&ot.error("WebGL1 context not supported.")(),n=m1.attach(e.gl)),n||(n=Ad.createDevice({type:"best-available",_reuseDevices:!0,adapters:[m1],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Ho.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,f,p,m;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(f=this.eventManager)==null||f.destroy(),this.eventManager=null,(p=this.widgetManager)==null||p.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((m=this.canvas.parentElement)==null||m.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ot.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ot.removed("onLayerClick","onClick")(),e.initialViewState&&!wr(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return An(this.viewManager),this.viewManager.views}getViewports(e){return An(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){An(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),An(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new H8({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new Sb({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i,s;if(((n=this.device)==null?void 0:n.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let f=a,p=!1;for(const m of o)f=m,p=((r=m.layer)==null?void 0:r.onHover(m,e.event))||p;p||((s=(i=this.props).onHover)==null||s.call(i,f,e.event),this.widgetManager.onHover(f,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const n=new yb;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new C6(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(F_).map(o=>{var T;const[a,f,p,m]=F_[o],v=(T=this.props.eventRecognizerOptions)==null?void 0:T[o],w={...f,...v,event:o};return{recognizer:new a(w),recognizeWith:p,requestFailure:m}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Ed)this.eventManager.on(o,this._onEvent);this.viewManager=new pN({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new dN(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new IN({deck:this,device:this.device}),this.deckRenderer=new ON(this.device),this.deckPicker=new VN(this.device),this.widgetManager=new WN({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new HN),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ot.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=Ad.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}bg.defaultProps=jb;bg.VERSION=vk;function W5(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return ww(t)}}const $5=vw;function LA(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function ds(t){return t.stride||t.size*t.bytesPerElement}function H5(t,e){return t.type===e.type&&t.size===e.size&&ds(t)===ds(e)&&(t.offset||0)===(e.offset||0)}function Fd(t,e){e.offset&&ot.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=ds(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function X5(t,e){const n=Fd(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class Q5{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let f=W5(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...n,defaultType:f,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*ds(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ho.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=Fd(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:ds(r),attributes:i};if(this.doublePrecision){const o=X5(r,n||{});i.push(LA(e,{...r,...o.high}),LA(`${e}64Low`,{...r,...o.low}))}else if(n){const o=Fd(r,n);i.push(LA(e,{...r,...o}))}else i.push(LA(e,r));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let f=0;f<s;)for(let p=0;p<i;p++){const m=n[f++];m<o[p]&&(o[p]=m),m>a[p]&&(a[p]=m)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Pt?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=$5(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=ds(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=ds(i),f=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=Hh(s,i)),this.settings.isIndexed){const m=this.settings.defaultType;s.constructor!==m&&(s=new m(s))}const p=s.byteLength+f+a*2;(!o||o.byteLength<p)&&(o=this._createBuffer(p)),o.write(s,f)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?Hh(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=Ho.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?Hh(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ot.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(n?Pt.INDEX:Pt.VERTEX)|Pt.COPY_DST,indexType:n?r:void 0,byteLength:e}),this._buffer}}const _1=[],y1=[];function ra(t,e=0,n=1/0){let r=_1;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(y1.length=t.length,r=y1):r=_1,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function Wb(t){return t&&t[Symbol.asyncIterator]}function $b(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,f=r?r/a:n,p=i?i/a:0,m=Math.floor((t.length-p)/f);return(v,{index:w,target:T})=>{if(!s){const R=w*f+p;for(let P=0;P<n;P++)T[P]=t[R+P];return T}const E=s[w],I=s[w+1]||m;let U;if(o){U=new Array(I-E);for(let R=E;R<I;R++){const P=R*f+p;T=new Array(n);for(let C=0;C<n;C++)T[C]=t[P+C];U[R-E]=T}}else if(f===n)U=t.subarray(E*n+p,I*n+p);else{U=new t.constructor((I-E)*n);let R=0;for(let P=E;P<I;P++){const C=P*f+p;for(let D=0;D<n;D++)U[R++]=t[C+D]}}return U}}const Y5=[],lc=[[0,1/0]];function K5(t,e){if(t===lc||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const Z5={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function Hb(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...Z5[n],...e,...t,type:n}}class Xb extends Q5{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:lc}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!H5(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return Hb(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=K5(this.state.updateRanges,[r,i])}else this.state.updateRanges=lc}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Y5}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==lc),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let f=!0;if(o){for(const[p,m]of s)o.call(i,this,{data:n,startRow:p,endRow:m,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[p,m]of s){const v=Number.isFinite(p)?this.getVertexOffset(p):0,w=Number.isFinite(m)?this.getVertexOffset(m):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:v,endOffset:w})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;An(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=$b(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:f,value:p,size:m,startIndices:v}=e,{accessor:w,transform:T}=a,E=f.binaryAccessor||(typeof w=="function"?w:s[w]);An(typeof E=="function",`accessor "${w}" is not a function`);let I=e.getVertexOffset(r);const{iterable:U,objectInfo:R}=ra(n,r,i);for(const P of U){R.index++;let C=E(P,R);if(T&&(C=T.call(this,C)),v){const D=(R.index<v.length-1?v[R.index+1]:o)-v[R.index];if(C&&Array.isArray(C[0])){let $=I;for(const q of C)e._normalizeValue(q,p,$),$+=m}else C&&C.length>m?p.set(C,I):(e._normalizeValue(C,R.target,0),AN({target:p,source:R.target,start:I,count:D}));I+=D*m}else e._normalizeValue(C,p,I),I+=m}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function e0(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,f=o-r;if(a>f){n.set(e.subarray(0,f),r);return}if(n.set(e,r),!s)return;let p=a;for(;p<f;){const m=s(p,e);for(let v=0;v<i;v++)n[r+p]=m[v]||0,p++}}function q5({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return e0({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const f=r&&((m,v)=>r(m+a,v)),p=Math.min(i.length,s.length);for(let m=1;m<p;m++){const v=i[m]*n,w=s[m]*n;e0({source:t.subarray(o,v),target:e,start:a,end:w,size:n,getData:f}),o=v,a=w}return a<e.length&&e0({source:[],target:e,start:a,size:n,getData:f}),e}function G5(t){const{device:e,settings:n,value:r}=t,i=new Xb(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function Qb(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function Yb(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Kb(t){t.push(t.shift())}function J5(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:f}=t.settings;if(f)for(const p of Object.values(f))a=Math.max(a,p.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function Zb({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function qb({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,f=n.size*a,p=n.byteOffset,m=n.settings.bytesPerElement<4?p/n.settings.bytesPerElement*4:p,v=n.startIndices,w=s&&v,T=n.isConstant;if(!w&&e&&r>=i)return e;const E=n.value instanceof Float64Array?Float32Array:n.value.constructor,I=T?n.value:new E(n.getBuffer().readSyncWebGL(p,i*E.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!T){const C=o;o=(D,$)=>n.normalizeConstant(C(D,$))}const U=T?(C,D)=>o(I,D):(C,D)=>o(I.subarray(C+p,C+p+f),D),R=e?new Float32Array(e.readSyncWebGL(m,r*4).buffer):new Float32Array(0),P=new Float32Array(i);return q5({source:R,target:P,sourceStartIndices:s,targetStartIndices:v,size:f,getData:U}),(!e||e.byteLength<P.byteLength+m)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:P.byteLength+m,usage:35050})),e.write(P,m),e}class Gb{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Gu(r),this.attribute=n,this.attributeInTransition=G5(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=J5(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class eD extends Gb{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=iD(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;Kb(s),s[0]=qb({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=Zb({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,f=a.model;let p=Math.floor(this.currentLength/o.size);Jb(o)&&(p/=2),f.setVertexCount(p),o.isConstant?(f.setAttributes({aFrom:s[0]}),f.setConstantAttributes({aTo:o.value})):f.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const tD=`uniform interpolationUniforms {
  float time;
} interpolation;
`,v1={name:"interpolation",vs:tD,uniformTypes:{time:"f32"}},nD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,rD=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function Jb(t){return t.doublePrecision&&t.value instanceof Float64Array}function iD(t,e){const n=e.size,r=Qb(n),i=Yb(n),s=e.getBufferLayout();return Jb(e)?new Pl(t,{vs:rD,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[vM,v1],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Pl(t,{vs:nD,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[v1],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class sD extends Gb{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=uD(e),this.framebuffer=fD(e,this.texture),this.transform=cD(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let f=0;f<2;f++)s[f]=qb({device:this.device,buffer:s[f],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=Zb({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:o}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Kb(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const oD=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,aD={name:"spring",vs:oD,uniformTypes:{damping:"f32",stiffness:"f32"}},lD=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,AD=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function cD(t,e){const n=Qb(e.size),r=Yb(e.size);return new Pl(t,{vs:lD,fs:AD,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[aD],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function uD(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function fD(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const hD={interpolation:eD,spring:sD};class dD{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=hD[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(ot.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const w1="attributeManager.invalidate",pD="attributeManager.updateStart",gD="attributeManager.updateEnd",mD="attribute.updateStart",_D="attribute.allocate",yD="attribute.updateEnd";class vD{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Wl(M8),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new dD(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);xn(w1,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);xn(w1,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let f=!1;xn(pD,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const p in this.attributes){const m=this.attributes[p],v=m.settings.accessor;m.startIndices=r,m.numInstances=n,s[p]&&ot.removed(`props.${p}`,`data.attributes.${p}`)(),m.setExternalBuffer(o[p])||m.setBinaryValue(typeof v=="string"?o[v]:void 0,e.startIndices)||typeof v=="string"&&!o[v]&&m.setConstantValue(s[v])||m.needsUpdate()&&(f=!0,this._updateAttribute({attribute:m,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||m.needsRedraw()}f&&xn(gD,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new Xb(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(xn(mD,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&xn(_D,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,xn(yD,n,r))}}class wD extends Gu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=zo(n,r,o)}}const b1=1e-5;function x1(t,e,n,r,i){const s=e-t,a=(n-e)*i,f=-s*r;return a+f+s+e}function bD(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=x1(t[o],e[o],n[o],r,i);return s}return x1(t,e,n,r,i)}function T1(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class xD extends Gu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=bD(s,o,n,r,i);const f=T1(a,n),p=T1(a,o);f<b1&&p<b1&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const TD={interpolation:wD,spring:xD};class ED{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const f=s.get(e),{value:p=f.settings.fromValue}=f;n=p,this.remove(e)}if(i=Hb(i),!i)return;const o=TD[i.type];if(!o){ot.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function SD(t){const e=t[Hi];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function CD(t,e){const n=ex({newProps:t,oldProps:e,propTypes:t[Hi],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=kD(t,e);let i=!1;return r||(i=RD(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:ID(t,e),transitionsChanged:PD(t,e)}}function PD(t,e){if(!t.transitions)return!1;const n={},r=t[Hi];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Ld(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function ex({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=Ld(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=Ld(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function Ld(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function kD(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function RD(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&E1(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&E1(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function ID(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function E1(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},ex({oldProps:i,newProps:r,triggerName:n})}const MD="count(): argument not an object",ND="count(): argument not a container";function OD(t){if(!BD(t))throw new Error(MD);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(DD(t))return Object.keys(t).length;throw new Error(ND)}function DD(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function BD(t){return t!==null&&typeof t=="object"}function S1(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const FD={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Ud={};function LD(t,e,n,r){if(n instanceof Ut)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...FD,...i,...r},mipmaps:!0});return Ud[s.id]=t,s}function UD(t,e){!e||!(e instanceof Ut)||Ud[e.id]===t&&(e.delete(),delete Ud[e.id])}const VD={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Vd(t)&&(t.length===3||t.length===4)},equal(t,e,n){return wr(t,e,1)}},accessor:{validate(t,e){const n=Au(t);return n==="function"||n===Au(e.value)},equal(t,e,n){return typeof e=="function"?!0:wr(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Vd(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?wr(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?wr(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:LD(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{UD(n.id,t)}}};function zD(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=jD(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function jD(t,e){switch(Au(e)){case"object":return Ra(t,e);case"array":return Ra(t,{type:"array",value:e,compare:!1});case"boolean":return Ra(t,{type:"boolean",value:e});case"number":return Ra(t,{type:"number",value:e});case"function":return Ra(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Ra(t,e){return"type"in e?{name:t,...VD[e.type],...e}:"value"in e?{name:t,type:Au(e.value),...e}:{name:t,type:"object",value:e}}function Vd(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Au(t){return Vd(t)?"array":t===null?"null":typeof t}function WD(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=zd(t.constructor,n),i=Object.create(r);i[au]=t,i[ks]={},i[Ni]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const $D="_mergedDefaultProps";function zd(t,e){if(!(t instanceof Ju.constructor))return{};let n=$D;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=tx(t,n);return r||(t[n]=HD(t,e||[]))}function HD(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=zd(r),s=tx(t,"defaultProps")||{},o=zD(s),a=Object.assign(Object.create(null),i,o.defaultProps),f=Object.assign(Object.create(null),i==null?void 0:i[Hi],o.propTypes),p=Object.assign(Object.create(null),i==null?void 0:i[Kh],o.deprecatedProps);for(const m of e){const v=zd(m.constructor);v&&(Object.assign(a,v),Object.assign(f,v[Hi]),Object.assign(p,v[Kh]))}return XD(a,t),YD(a,f),QD(a,p),a[Hi]=f,a[Kh]=p,e.length===0&&!xg(t,"_propTypes")&&(t._propTypes=f),a}function XD(t,e){const n=ZD(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function QD(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])xg(this,s)||(this[s]=r);ot.deprecated(i,e[n].join("/"))()}})}function YD(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=KD(o))}t[Po]=n,t[ks]={},Object.defineProperties(t,r)}function KD(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||Wb(e)?this[ks][t]=e:this[Ni][t]=e},get(){if(this[Ni]){if(t in this[Ni])return this[Ni][t]||this[Po][t];if(t in this[ks]){const e=this[au]&&this[au].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Po][t]}}return this[Po][t]}}}function xg(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function tx(t,e){return xg(t,e)&&t[e]}function ZD(t){const e=t.componentName;return e||ot.warn(`${t.name}.componentName not specified`)(),e||t.name}let qD=0;class Ju{constructor(...e){this.props=WD(this,e),this.id=this.props.id,this.count=qD++}clone(e){const{props:n}=this,r={};for(const i in n[Po])i in n[Ni]?r[i]=n[Ni][i]:i in n[ks]&&(r[i]=n[ks][i]);return new this.constructor({...n,...r,...e})}}Ju.componentName="Component";Ju.defaultProps={};const GD=Object.freeze({});class JD{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||GD}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[au]||this.component;const n=e[Ni]||{},r=e[ks]||e,i=e[Po]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(Wb(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:f}=this.component.props;f?s=f(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Hi];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class eB extends JD{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const tB="layer.changeFlag",nB="layer.initialize",rB="layer.update",iB="layer.finalize",sB="layer.matched",C1=2**24-1,oB=Object.freeze([]),aB=Wl(({oldViewport:t,viewport:e})=>t.equals(e));let dr=new Uint8ClampedArray(0);const lB={data:{type:"data",value:oB,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:zc(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:f=>{var p;return(p=n.internalState)==null?void 0:p.reloadAsyncProp(e,f)},consumerId:n.id,requestId:e}):zc(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ft.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class $r extends Ju{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Js.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){An(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=_b(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=db(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return An(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){An(this.internalState);const r=this.internalState.viewport||this.context.viewport;return L8(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ft.DEFAULT||e===ft.LNGLAT||e===ft.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){An(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:OD(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=S1(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=S1(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:f}=n.attributes,p=a||f;p&&(o&&p.constant&&(p.constant=!1,n.invalidate(p.id)),!p.value&&!o&&(p.constant=!0,p.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!aB({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(dr.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>C1&&ot.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),dr=Ho.allocate(dr,n,{size:4,copy:!0,maxCount:Math.max(n,C1)});const i=Math.floor(dr.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),dr[o*4+0]=s[0],dr[o*4+1]=s[1],dr[o*4+2]=s[2],dr[o*4+3]=0}e.value=dr.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const f=this.getAttributeManager();e.setBufferLayout(f.getBufferLayouts(e)),n=f.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const f in n){if(i[f])continue;const p=n[f].getValue();for(const m in p){const v=p[m];v instanceof Pt?n[f].settings.isIndexed?e.setIndexBuffer(v):s[m]=v:v&&(o[m]=v)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,f=this.encodePickingColor(e);for(let p=0;p<n.length;p++){const m=s.getVertexOffset(p);a[m]===f[0]&&a[m+1]===f[1]&&a[m+2]===f[2]&&this._disablePickingIndex(p)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==dr.buffer&&(r.value=dr.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){An(!this.internalState),An(Number.isFinite(this.props.coordinateSystem)),xn(nB,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new eB({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ot.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new ED(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){xn(sB,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(xn(rB,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),f=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const m of this.props.extensions)m.updateState.call(this,a,m);this.setNeedsRedraw(),this._updateAttributes();const p=this.getModels()[0]!==f[0];this._postUpdate(a,p)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){xn(iB,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:a}=this.props,f=a&&a(r)||[0,0];o.device instanceof _o&&o.device.setParametersWebGL({polygonOffset:f});for(const p of this.getModels())p.device.type==="webgpu"?p.setParameters({...p.parameters,...i}):p.setParameters(i);if(o.device instanceof _o)o.device.withParametersWebGL(i,()=>{const p={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const m of this.props.extensions)m.draw.call(this,p,m);this.draw(p)});else{const p={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const m of this.props.extensions)m.draw.call(this,p,m);this.draw(p)}}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&xn(tB,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=CD(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){SD(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new vD(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:f}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==f){const p={};Array.isArray(f)&&(p.highlightColor=f),(n||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(p.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:p})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}$r.defaultProps=lB;$r.layerName="Layer";const AB="compositeLayer.renderLayers";class Hl extends $r{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var fe;const{opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:f,highlightColor:p,coordinateSystem:m,coordinateOrigin:v,wrapLongitude:w,positionFormat:T,modelMatrix:E,extensions:I,fetch:U,operation:R,_subLayerProps:P}=this.props,C={id:"",updateTriggers:{},opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:f,highlightColor:p,coordinateSystem:m,coordinateOrigin:v,wrapLongitude:w,positionFormat:T,modelMatrix:E,extensions:I,fetch:U,operation:R},D=P&&e.id&&P[e.id],$=D&&D.updateTriggers,q=e.id||"sublayer";if(D){const ae=this.props[Hi],he=e.type?e.type._propTypes:{};for(const ye in D){const ke=he[ye]||ae[ye];ke&&ke.type==="accessor"&&(D[ye]=this.getSubLayerAccessor(D[ye]))}}Object.assign(C,e,D),C.id=`${this.props.id}-${q}`,C.updateTriggers={all:(fe=this.props.updateTriggers)==null?void 0:fe.all,...e.updateTriggers,...$};for(const ae of I){const he=ae.getSubLayerProps.call(this,ae);he&&Object.assign(C,he,{updateTriggers:Object.assign(C.updateTriggers,he.updateTriggers)})}return C}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=gg(s,Boolean),this.internalState.subLayers=r}xn(AB,this,i,r);for(const s of r)s.parent=this}}Hl.layerName="CompositeLayer";class nx{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=Ho,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:f=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=f,s&&(An(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),f||(r.vertexPositions=s)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const p of a)this._rebuildGeometry(p);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?$b(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in i)o.release(r[a]),r[a]=null;else{const f=s[a];f.copy=n,r[a]=o.allocate(r[a],e,f)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:a}=ra(i,n,r);for(const f of o){a.index++;const p=s?s(f,a):null;e(p,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:f=1/0}=e||{},p={};if(e||(n=[0],r=[0]),this.normalize||!o)this._forEachGeometry((v,w)=>{const T=v&&this.normalizeGeometry(v);p[w]=T,r[w+1]=r[w]+(T?this.getGeometrySize(T):0)},a,f),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof Pt){const v=this.positionSize*4;i=i||o.byteLength/v}else if(o.buffer){const v=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/v}else if(o.value){const v=o.value,w=o.stride/v.BYTES_PER_ELEMENT||this.positionSize;i=i||v.length/w}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const m={};this._forEachGeometry((v,w)=>{const T=p[w]||v;m.vertexStart=r[w],m.indexStart=n[w];const E=w<r.length-1?r[w+1]:i;m.geometrySize=E-r[w],m.geometryIndex=w,this.updateGeometryAttributes(T,m)},a,f),this.vertexCount=n[n.length-1]}}const cB=typeof window<"u"?le.useLayoutEffect:le.useEffect;function cu(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const uB={position:"absolute",zIndex:-1};function rx(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>rx(n,e));if(ef(t)){if(fB(t))return e.style=uB,le.cloneElement(t,e);if(hB(t))return le.cloneElement(t,e)}return t}function ef(t){return t&&typeof t=="object"&&"type"in t||!1}function fB(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function hB(t){const e=t.type;return e&&e.deckGLViewProps}function jd(t){if(typeof t=="function")return le.createElement(Qo,{},t);if(Array.isArray(t))return t.map(jd);if(ef(t)){if(t.type===le.Fragment)return jd(t.props.children);if(cu(t.type,Qo))return t}return t}function dB({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return le.Children.forEach(jd(t),o=>{if(ef(o)){const a=o.type;if(cu(a,$r)){const f=pB(a,o.props);i.push(f)}else r.push(o);if(cu(a,Qo)&&a!==Qo&&o.props.id){const f=new a(o.props);s[f.id]=f}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function pB(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}const gB=le.createContext();function mB({children:t,deck:e,ContextProvider:n=gB.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,f=o;ef(o)&&cu(o.type,Qo)&&(a=o.props.id||s,f=o.props.children);const p=r.getViewport(a),m=r.getViewState(a);if(p){m.padding=p.padding;const{x:v,y:w,width:T,height:E}=p;f=rx(f,{x:v,y:w,width:T,height:E,viewport:p,viewState:m}),i[a]||(i[a]={viewport:p,children:[]}),i[a].children.push(f)}}return Object.keys(i).map(o=>{const{viewport:a,children:f}=i[o],{x:p,y:m,width:v,height:w}=a,T={position:"absolute",left:p,top:m,width:v,height:w},E=`view-${o}`,I=le.createElement("div",{key:E,id:E,style:T},...f),U={deck:e,viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:P=>{P.viewId=o,e._onViewStateChange(P)},widgets:[]},R=`view-${o}-context`;return le.createElement(n,{key:R,value:U},I)})}const _B={mixBlendMode:null};function yB({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in _B?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function vB(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function ix(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function wB(t,e,n){var i,s,o;const r=new e({...n,_customRender:((o=(s=(i=n.deviceProps)==null?void 0:i.adapters)==null?void 0:s[0])==null?void 0:o.type)==="webgpu"?void 0:a=>{t.redrawReason=a;const f=r.getViewports();t.lastRenderedViewports!==f?t.forceUpdate():ix(t)}});return r}function bB(t,e){const[n,r]=le.useState(0),s=le.useRef({control:null,version:n,forceUpdate:()=>r($=>$+1)}).current,o=le.useRef(null),a=le.useRef(null),f=le.useMemo(()=>dB(t),[t.layers,t.views,t.children]);let p=!0;const m=$=>{var q;return p&&t.viewState?(s.viewStateUpdateRequested=$,null):(s.viewStateUpdateRequested=null,(q=t.onViewStateChange)==null?void 0:q.call(t,$))},v=$=>{var q;p?s.interactionStateUpdateRequested=$:(s.interactionStateUpdateRequested=null,(q=t.onInteractionStateChange)==null||q.call(t,$))},w=le.useMemo(()=>{const $={widgets:[],...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:f.layers,views:f.views,onViewStateChange:m,onInteractionStateChange:v};return delete $._customRender,s.deck&&s.deck.setProps($),$},[t]);le.useEffect(()=>{const $=t.Deck||bg;return s.deck=wB(s,$,{...w,parent:o.current,canvas:a.current}),()=>{var q;return(q=s.deck)==null?void 0:q.finalize()}},[]),cB(()=>{ix(s);const{viewStateUpdateRequested:$,interactionStateUpdateRequested:q}=s;$&&m($),q&&v(q)}),le.useImperativeHandle(e,()=>vB(s),[]);const T=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:E,width:I="100%",height:U="100%",id:R,style:P}=t,{containerStyle:C,canvasStyle:D}=le.useMemo(()=>yB({width:I,height:U,style:P}),[I,U,P]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===T||s.version!==n){s.lastRenderedViewports=T,s.version=n;const $=mB({children:f.children,deck:s.deck,ContextProvider:E}),q=le.createElement("canvas",{key:"canvas",id:R||"deckgl-overlay",ref:a,style:D});s.control=le.createElement("div",{id:`${R||"deckgl"}-wrapper`,ref:o,style:C},[q,$])}return p=!1,s.control}const xB=le.forwardRef(bB),P1=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,TB={name:"icon",vs:P1,fs:P1,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},EB=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,SB=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,CB=1024,PB=4,k1=()=>{},R1={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},kB={x:0,y:0,width:0,height:0};function RB(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function IB(t,e,n,r){const i=Math.min(n/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{image:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{image:t.canvas,width:s,height:o})}function kl(t){return t&&(t.id||t.url)}function MB(t,e,n,r){const{width:i,height:s,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:n,sampler:r,mipmaps:!0}),f=o.createCommandEncoder();return f.copyTextureToTexture({sourceTexture:t,destinationTexture:a,width:i,height:s}),f.finish(),t.destroy(),a}function I1(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=kl(i);t[o]={...i,x:s,y:n}}}function NB({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let f=0;f<t.length;f++){const p=t[f],m=kl(p);if(!n[m]){const{height:v,width:w}=p;r+w+e>o&&(I1(n,a,i),r=0,i=s+i+e,s=0,a=[]),a.push({icon:p,xOffset:r}),r=r+w+e,s=Math.max(s,v)}}return a.length>0&&I1(n,a,i),{mapping:n,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:RB(s+i+e)}}function OB(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:s}=ra(t);for(const o of i){s.index++;const a=e(o,s),f=kl(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[f]&&(!n[f]||a.url!==n[f].url)&&(r[f]={...a,source:o,sourceIndex:s.index})}return r}class DB{constructor(e,{onUpdate:n=k1,onError:r=k1}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=PB,this._canvasWidth=CB,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?kl(e):e;return this._mapping[n]||kB}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:s}){var o;e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=r),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(OB(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:f}=NB({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=f,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||R1,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=MB(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||R1)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,zc(r.url,this._loadOptions).then(i=>{var E;const s=kl(r),o=this._mapping[s],{x:a,y:f,width:p,height:m}=o,{image:v,width:w,height:T}=IB(n,i,p,m);(E=this._texture)==null||E.copyExternalImage({image:v,x:a+(p-w)/2,y:f+(m-T)/2,width:w,height:T}),o.width=w,o.height=T,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const sx=[0,0,0,255],BB={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:sx},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class tf extends $r{getShaders(){return super.getShaders({vs:EB,fs:SB,modules:[ea,ta,TB]})}initializeState(){this.state={iconManager:new DB(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:sx},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var T;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:f,getIcon:p,textureParameters:m}=n,{iconManager:v}=this.state;if(typeof o=="string")return;const w=o||this.internalState.isAsyncPropLoading("iconAtlas");v.setProps({loadOptions:n.loadOptions,autoPacking:!w,iconAtlas:o,iconMapping:w?a:null,textureParameters:m}),w?r.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&v.packIcons(f,p),i.extensionsChanged&&((T=this.state.model)==null||T.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:f}=this.state,p=f.getTexture();if(p){const m=this.state.model,v={iconsTexture:p,iconsTextureDim:[p.width,p.height],sizeUnits:Ai[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:a};m.shaderInputs.setProps({icon:v}),m.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Yn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ps({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const n=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;n?n(e):ot.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[n,r,i,s]}}tf.defaultProps=BB;tf.layerName="IconLayer";const M1=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,FB={name:"scatterplot",vs:M1,fs:M1,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},LB=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,UB=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,N1=[0,0,0,255],VB={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:N1},getLineColor:{type:"accessor",value:N1},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class nf extends $r{getShaders(){return super.getShaders({vs:LB,fs:UB,modules:[ea,ta,FB]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:a,billboard:f,antialiasing:p,lineWidthUnits:m,lineWidthScale:v,lineWidthMinPixels:w,lineWidthMaxPixels:T}=this.props,E={stroked:o,filled:a,billboard:f,antialiasing:p,radiusUnits:Ai[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:Ai[m],lineWidthScale:v,lineWidthMinPixels:w,lineWidthMaxPixels:T},I=this.state.model;I.shaderInputs.setProps({scatterplot:E}),I.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Yn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ps({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}nf.defaultProps=VB;nf.layerName="ScatterplotLayer";const Tg={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Eg(t,e,n={}){return zB(t,n)!==e?(WB(t,n),!0):!1}function zB(t,e={}){return Math.sign(jB(t,e))}const O1={x:0,y:1,z:2};function jB(t,e={}){const{start:n=0,end:r=t.length,plane:i="xy"}=e,s=e.size||2;let o=0;const a=O1[i[0]],f=O1[i[1]];for(let p=n,m=r-s;p<r;p+=s)o+=(t[p+a]-t[m+a])*(t[p+f]+t[m+f]),m=p;return o/2}function WB(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,s=(r-n)/i,o=Math.floor(s/2);for(let a=0;a<o;++a){const f=n+a*i,p=n+(s-1-a)*i;for(let m=0;m<i;++m){const v=t[f+m];t[f+m]=t[p+m],t[p+m]=v}}}function br(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let s=0;s<n;s++)if(t[r-n+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function Wd(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function Rl(t,e,n,r,i=[]){const s=r+e*n;for(let o=0;o<n;o++)i[o]=t[s+o];return i}function $d(t,e,n,r,i=[]){let s,o;if(n&8)s=(r[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(r[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(r[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(r[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)i[a]=(o&1)===a?r[o]:s*(e[a]-t[a])+t[a];return i}function Ac(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function ox(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},f=(a-o)/n;let p=[];const m=[p],v=Rl(t,0,n,o);let w,T;const E=lx(v,i,s,[]),I=[];br(p,v);for(let U=1;U<f;U++){for(w=Rl(t,U,n,o,w),T=Ac(w,E);T;){$d(v,w,T,E,I);const R=Ac(I,E);R&&($d(v,I,R,E,I),T=R),br(p,I),Wd(v,I),HB(E,i,T),r&&p.length>n&&(p=[],m.push(p),br(p,v)),T=Ac(w,E)}br(p,w),Wd(v,w)}return r?m:m[0]}const D1=0,$B=1;function ax(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],f=[{pos:t,types:o?new Array(t.length/r).fill($B):null,holes:e||[]}],p=[[],[]];let m=[];for(;f.length;){const{pos:v,types:w,holes:T}=f.shift();XB(v,r,T[0]||v.length,p),m=lx(p[0],i,s,m);const E=Ac(p[1],m);if(E){let I=B1(v,w,r,0,T[0]||v.length,m,E);const U={pos:I[0].pos,types:I[0].types,holes:[]},R={pos:I[1].pos,types:I[1].types,holes:[]};f.push(U,R);for(let P=0;P<T.length;P++)I=B1(v,w,r,T[P],T[P+1]||v.length,m,E),I[0]&&(U.holes.push(U.pos.length),U.pos=UA(U.pos,I[0].pos),o&&(U.types=UA(U.types,I[0].types))),I[1]&&(R.holes.push(R.pos.length),R.pos=UA(R.pos,I[1].pos),o&&(R.types=UA(R.types,I[1].types)))}else{const I={positions:v};o&&(I.edgeTypes=w),T.length&&(I.holeIndices=T),a.push(I)}}return a}function B1(t,e,n,r,i,s,o){const a=(i-r)/n,f=[],p=[],m=[],v=[],w=[];let T,E,I;const U=Rl(t,a-1,n,r);let R=Math.sign(o&8?U[1]-s[3]:U[0]-s[2]),P=e&&e[a-1],C=0,D=0;for(let $=0;$<a;$++)T=Rl(t,$,n,r,T),E=Math.sign(o&8?T[1]-s[3]:T[0]-s[2]),I=e&&e[r/n+$],E&&R&&R!==E&&($d(U,T,o,s,w),br(f,w)&&m.push(P),br(p,w)&&v.push(P)),E<=0?(br(f,T)&&m.push(I),C-=E):m.length&&(m[m.length-1]=D1),E>=0?(br(p,T)&&v.push(I),D+=E):v.length&&(v[v.length-1]=D1),Wd(U,T),R=E,P=I;return[C?{pos:f,types:e&&m}:null,D?{pos:p,types:e&&v}:null]}function lx(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function HB(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function XB(t,e,n,r){let i=1/0,s=-1/0,o=1/0,a=-1/0;for(let f=0;f<n;f+=e){const p=t[f],m=t[f+1];i=p<i?p:i,s=p>s?p:s,o=m<o?m:o,a=m>a?m:a}return r[0][0]=i,r[0][1]=o,r[1][0]=s,r[1][1]=a,r}function UA(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}const QB=85.051129;function YB(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:s=!0}=e||{},o=t.slice(r,i);Ax(o,n,0,i-r);const a=ox(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const f of a)cx(f,n);return a}function KB(t,e=null,n){const{size:r=2,normalize:i=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let f=0,p=0;for(let v=0;v<=e.length;v++){const w=e[v]||t.length,T=p,E=ZB(t,r,f,w);for(let I=E;I<w;I++)o[p++]=t[I];for(let I=f;I<E;I++)o[p++]=t[I];Ax(o,r,T,p),qB(o,r,T,p,n==null?void 0:n.maxLatitude),f=w,a[v]=p}a.pop();const m=ax(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(i)for(const v of m)cx(v.positions,r);return m}function ZB(t,e,n,r){let i=-1,s=-1;for(let o=n+1;o<r;o+=e){const a=Math.abs(t[o]);a>i&&(i=a,s=o-1)}return s}function qB(t,e,n,r,i=QB){const s=t[n],o=t[r-e];if(Math.abs(s-o)>180){const a=Rl(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,br(t,a),a[1]=Math.sign(a[1])*i,br(t,a),a[0]=s,br(t,a)}}function Ax(t,e,n,r){let i=t[0],s;for(let o=n;o<r;o+=e){s=t[o];const a=s-i;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=i=s}}function cx(t,e){let n;const r=t.length/e;for(let s=0;s<r&&(n=t[s*e],(n+180)%360===0);s++);const i=-Math.round(n/360)*360;if(i!==0)for(let s=0;s<r;s++)t[s*e]+=i}class GB extends Ps{constructor(e){const{indices:n,attributes:r}=JB(e);super({...e,indices:n,attributes:r})}}function JB(t){const{radius:e,height:n=1,nradial:r=10}=t;let{vertices:i}=t;i&&(ot.assert(i.length>=r),i=i.flatMap(T=>[T[0],T[1]]),Eg(i,Tg.COUNTER_CLOCKWISE));const s=n>0,o=r+1,a=s?o*3+1:r,f=Math.PI*2/r,p=new Uint16Array(s?r*3*2:0),m=new Float32Array(a*3),v=new Float32Array(a*3);let w=0;if(s){for(let T=0;T<o;T++){const E=T*f,I=T%r,U=Math.sin(E),R=Math.cos(E);for(let P=0;P<2;P++)m[w+0]=i?i[I*2]:R*e,m[w+1]=i?i[I*2+1]:U*e,m[w+2]=(1/2-P)*n,v[w+0]=i?i[I*2]:R,v[w+1]=i?i[I*2+1]:U,w+=3}m[w+0]=m[w-3],m[w+1]=m[w-2],m[w+2]=m[w-1],w+=3}for(let T=s?0:1;T<o;T++){const E=Math.floor(T/2)*Math.sign(.5-T%2),I=E*f,U=(E+r)%r,R=Math.sin(I),P=Math.cos(I);m[w+0]=i?i[U*2]:P*e,m[w+1]=i?i[U*2+1]:R*e,m[w+2]=n/2,v[w+2]=1,w+=3}if(s){let T=0;for(let E=0;E<r;E++)p[T++]=E*2+0,p[T++]=E*2+2,p[T++]=E*2+0,p[T++]=E*2+1,p[T++]=E*2+1,p[T++]=E*2+3}return{indices:p,attributes:{POSITION:{size:3,value:m},NORMAL:{size:3,value:v}}}}const F1=`uniform columnUniforms {
  float radius;
  float angle;
  vec2 offset;
  bool extruded;
  bool stroked;
  bool isStroke;
  float coverage;
  float elevationScale;
  float edgeDistance;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int radiusUnits;
  highp int widthUnits;
} column;
`,eF={name:"column",vs:F1,fs:F1,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}},tF=`#version 300 es
#define SHADER_NAME column-layer-vertex-shader
in vec3 positions;
in vec3 normals;
in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;
in vec3 instancePickingColors;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec3 cameraPosition;
out vec4 position_commonspace;
#endif
void main(void) {
geometry.worldPosition = instancePositions;
vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
float elevation = 0.0;
float strokeOffsetRatio = 1.0;
if (column.extruded) {
elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
} else if (column.stroked) {
float widthPixels = clamp(
project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
column.widthMinPixels, column.widthMaxPixels) / 2.0;
float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
if (column.isStroke) {
strokeOffsetRatio -= sign(positions.z) * halfOffset;
} else {
strokeOffsetRatio -= halfOffset;
}
}
float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
float dotRadius = column.radius * column.coverage * shouldRender;
geometry.pickingColor = instancePickingColors;
vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
vec3 centroidPosition64Low = instancePositions64Low;
vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
if (column.radiusUnits == UNIT_METERS) {
offset = project_size(offset);
}
vec3 pos = vec3(offset, 0.);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (column.extruded && !column.isStroke) {
#ifdef FLAT_SHADING
cameraPosition = project.cameraPosition;
position_commonspace = geometry.position;
vColor = vec4(color.rgb, color.a * layer.opacity);
#else
vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, color.a * layer.opacity);
#endif
} else {
vColor = vec4(color.rgb, color.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nF=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader
precision highp float;
out vec4 fragColor;
in vec4 vColor;
#ifdef FLAT_SHADING
in vec3 cameraPosition;
in vec4 position_commonspace;
#endif
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
#ifdef FLAT_SHADING
if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
}
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,uu=[0,0,0,255],rF={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:t=>t.position},getFillColor:{type:"accessor",value:uu},getLineColor:{type:"accessor",value:uu},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Sg extends $r{getShaders(){const e={},{flatShading:n}=this.props;return n&&(e.FLAT_SHADING=1),super.getShaders({vs:tF,fs:nF,defines:e,modules:[ea,n?Jw:ug,ta,eF]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:uu},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:uu},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(e){var a;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=i.extensionsChanged||n.flatShading!==r.flatShading;s&&((a=this.state.models)==null||a.forEach(f=>f.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());const o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(s||n.diskResolution!==r.diskResolution||n.vertices!==r.vertices||(n.extruded||n.stroked)!==(r.extruded||r.stroked))&&this._updateGeometry(n)}getGeometry(e,n,r){const i=new GB({radius:1,height:r?2:0,vertices:n,nradial:e});let s=0;if(n)for(let o=0;o<e;o++){const a=n[o],f=Math.sqrt(a[0]*a[0]+a[1]*a[1]);s+=f/e}else s=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*s}),i}_getModels(){const e=this.getShaders(),n=this.getAttributeManager().getBufferLayouts(),r=new Yn(this.context.device,{...e,id:`${this.props.id}-fill`,bufferLayout:n,isInstanced:!0}),i=new Yn(this.context.device,{...e,id:`${this.props.id}-wireframe`,bufferLayout:n,isInstanced:!0});return{fillModel:r,wireframeModel:i,models:[i,r]}}_updateGeometry({diskResolution:e,vertices:n,extruded:r,stroked:i}){const s=this.getGeometry(e,n,r||i);this.setState({fillVertexCount:s.attributes.POSITION.value.length/3});const o=this.state.fillModel,a=this.state.wireframeModel;o.setGeometry(s),o.setTopology("triangle-strip"),o.setIndexBuffer(null),a.setGeometry(s),a.setTopology("line-list")}draw({uniforms:e}){const{lineWidthUnits:n,lineWidthScale:r,lineWidthMinPixels:i,lineWidthMaxPixels:s,radiusUnits:o,elevationScale:a,extruded:f,filled:p,stroked:m,wireframe:v,offset:w,coverage:T,radius:E,angle:I}=this.props,U=this.state.fillModel,R=this.state.wireframeModel,{fillVertexCount:P,edgeDistance:C}=this.state,D={radius:E,angle:I/180*Math.PI,offset:w,extruded:f,stroked:m,coverage:T,elevationScale:a,edgeDistance:C,radiusUnits:Ai[o],widthUnits:Ai[n],widthScale:r,widthMinPixels:i,widthMaxPixels:s};f&&v&&(R.shaderInputs.setProps({column:{...D,isStroke:!0}}),R.draw(this.context.renderPass)),p&&(U.setVertexCount(P),U.shaderInputs.setProps({column:{...D,isStroke:!1}}),U.draw(this.context.renderPass)),!f&&m&&(U.setVertexCount(P*2/3),U.shaderInputs.setProps({column:{...D,isStroke:!0}}),U.draw(this.context.renderPass))}}Sg.layerName="ColumnLayer";Sg.defaultProps=rF;function iF(t,e,n,r){let i;if(Array.isArray(t[0])){const s=t.length*e;i=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)i[o*e+a]=t[o][a]||0}else i=t;return n?ox(i,{size:e,gridResolution:n}):r?YB(i,{size:e}):i}const sF=1,oF=2,t0=4;class aF extends nx{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?iF(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(L1(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&L1(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;r.fill(0,s,s+o),i?(r[s]=t0,r[s+o-2]=t0):(r[s]+=sF,r[s+o-2]+=oF),r[s+o-1]=t0}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=n,o=new Array(3);for(let a=i,f=0;f<s;a++,f++)this.getPointOnPath(e,f,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const s=n*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function L1(t){return Array.isArray(t[0])}const U1=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,lF={name:"path",vs:U1,fs:U1,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},AF=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,cF=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ux=[0,0,0,255],uF={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:ux},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},n0={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class rf extends $r{getShaders(){return super.getShaders({vs:AF,fs:cF,modules:[ea,ta,lF]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:n0,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:n0,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:n0,defaultValue:ux},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new aF({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,f=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:f.getPath,buffers:f,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:f,widthMaxPixels:p}=this.props,m=this.state.model,v={jointType:Number(n),capType:Number(r),billboard:i,widthUnits:Ai[o],widthScale:a,miterLimit:s,widthMinPixels:f,widthMaxPixels:p};m.shaderInputs.setProps({path:v}),m.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Yn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ps({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}rf.defaultProps=uF;rf.layerName="PathLayer";var Cg={exports:{}};Cg.exports=sf;Cg.exports.default=sf;function sf(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,s=fx(t,0,i,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,f,p,m,v,w,T;if(r&&(s=gF(t,e,s,n)),t.length>80*n){a=p=t[0],f=m=t[1];for(var E=n;E<i;E+=n)v=t[E],w=t[E+1],v<a&&(a=v),w<f&&(f=w),v>p&&(p=v),w>m&&(m=w);T=Math.max(p-a,m-f),T=T!==0?32767/T:0}return Il(s,o,n,a,f,T,0),o}function fx(t,e,n,r,i){var s,o;if(i===Qd(t,e,n,r)>0)for(s=e;s<n;s+=r)o=V1(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=V1(s,t[s],t[s+1],o);return o&&of(o,o.next)&&(Nl(o),o=o.next),o}function Rs(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(of(n,n.next)||Dt(n.prev,n,n.next)===0)){if(Nl(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function Il(t,e,n,r,i,s,o){if(t){!o&&s&&wF(t,r,i,s);for(var a=t,f,p;t.prev!==t.next;){if(f=t.prev,p=t.next,s?hF(t,r,i,s):fF(t)){e.push(f.i/n|0),e.push(t.i/n|0),e.push(p.i/n|0),Nl(t),t=p.next,a=p.next;continue}if(t=p,t===a){o?o===1?(t=dF(Rs(t),e,n),Il(t,e,n,r,i,s,2)):o===2&&pF(t,e,n,r,i,s):Il(Rs(t),e,n,r,i,s,1);break}}}}function fF(t){var e=t.prev,n=t,r=t.next;if(Dt(e,n,r)>=0)return!1;for(var i=e.x,s=n.x,o=r.x,a=e.y,f=n.y,p=r.y,m=i<s?i<o?i:o:s<o?s:o,v=a<f?a<p?a:p:f<p?f:p,w=i>s?i>o?i:o:s>o?s:o,T=a>f?a>p?a:p:f>p?f:p,E=r.next;E!==e;){if(E.x>=m&&E.x<=w&&E.y>=v&&E.y<=T&&yo(i,a,s,f,o,p,E.x,E.y)&&Dt(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function hF(t,e,n,r){var i=t.prev,s=t,o=t.next;if(Dt(i,s,o)>=0)return!1;for(var a=i.x,f=s.x,p=o.x,m=i.y,v=s.y,w=o.y,T=a<f?a<p?a:p:f<p?f:p,E=m<v?m<w?m:w:v<w?v:w,I=a>f?a>p?a:p:f>p?f:p,U=m>v?m>w?m:w:v>w?v:w,R=Hd(T,E,e,n,r),P=Hd(I,U,e,n,r),C=t.prevZ,D=t.nextZ;C&&C.z>=R&&D&&D.z<=P;){if(C.x>=T&&C.x<=I&&C.y>=E&&C.y<=U&&C!==i&&C!==o&&yo(a,m,f,v,p,w,C.x,C.y)&&Dt(C.prev,C,C.next)>=0||(C=C.prevZ,D.x>=T&&D.x<=I&&D.y>=E&&D.y<=U&&D!==i&&D!==o&&yo(a,m,f,v,p,w,D.x,D.y)&&Dt(D.prev,D,D.next)>=0))return!1;D=D.nextZ}for(;C&&C.z>=R;){if(C.x>=T&&C.x<=I&&C.y>=E&&C.y<=U&&C!==i&&C!==o&&yo(a,m,f,v,p,w,C.x,C.y)&&Dt(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;D&&D.z<=P;){if(D.x>=T&&D.x<=I&&D.y>=E&&D.y<=U&&D!==i&&D!==o&&yo(a,m,f,v,p,w,D.x,D.y)&&Dt(D.prev,D,D.next)>=0)return!1;D=D.nextZ}return!0}function dF(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!of(i,s)&&hx(i,r,r.next,s)&&Ml(i,s)&&Ml(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),Nl(r),Nl(r.next),r=t=s),r=r.next}while(r!==t);return Rs(r)}function pF(t,e,n,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&TF(o,a)){var f=dx(o,a);o=Rs(o,o.next),f=Rs(f,f.next),Il(o,e,n,r,i,s,0),Il(f,e,n,r,i,s,0);return}a=a.next}o=o.next}while(o!==t)}function gF(t,e,n,r){var i=[],s,o,a,f,p;for(s=0,o=e.length;s<o;s++)a=e[s]*r,f=s<o-1?e[s+1]*r:t.length,p=fx(t,a,f,r,!1),p===p.next&&(p.steiner=!0),i.push(xF(p));for(i.sort(mF),s=0;s<i.length;s++)n=_F(i[s],n);return n}function mF(t,e){return t.x-e.x}function _F(t,e){var n=yF(t,e);if(!n)return e;var r=dx(n,t);return Rs(r,r.next),Rs(n,n.next)}function yF(t,e){var n=e,r=t.x,i=t.y,s=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===r))return o}n=n.next}while(n!==e);if(!o)return null;var f=o,p=o.x,m=o.y,v=1/0,w;n=o;do r>=n.x&&n.x>=p&&r!==n.x&&yo(i<m?r:s,i,p,m,i<m?s:r,i,n.x,n.y)&&(w=Math.abs(i-n.y)/(r-n.x),Ml(n,t)&&(w<v||w===v&&(n.x>o.x||n.x===o.x&&vF(o,n)))&&(o=n,v=w)),n=n.next;while(n!==f);return o}function vF(t,e){return Dt(t.prev,t,e.prev)<0&&Dt(e.next,t,t.next)<0}function wF(t,e,n,r){var i=t;do i.z===0&&(i.z=Hd(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,bF(i)}function bF(t){var e,n,r,i,s,o,a,f,p=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<p&&(a++,r=r.nextZ,!!r);e++);for(f=p;a>0||f>0&&r;)a!==0&&(f===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,f--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,p*=2}while(o>1);return t}function Hd(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function xF(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function yo(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function TF(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!EF(t,e)&&(Ml(t,e)&&Ml(e,t)&&SF(t,e)&&(Dt(t.prev,t,e.prev)||Dt(t,e.prev,e))||of(t,e)&&Dt(t.prev,t,t.next)>0&&Dt(e.prev,e,e.next)>0)}function Dt(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function of(t,e){return t.x===e.x&&t.y===e.y}function hx(t,e,n,r){var i=zA(Dt(t,e,n)),s=zA(Dt(t,e,r)),o=zA(Dt(n,r,t)),a=zA(Dt(n,r,e));return!!(i!==s&&o!==a||i===0&&VA(t,n,e)||s===0&&VA(t,r,e)||o===0&&VA(n,t,r)||a===0&&VA(n,e,r))}function VA(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function zA(t){return t>0?1:t<0?-1:0}function EF(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&hx(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Ml(t,e){return Dt(t.prev,t,t.next)<0?Dt(t,e,t.next)>=0&&Dt(t,t.prev,e)>=0:Dt(t,e,t.prev)<0||Dt(t,t.next,e)<0}function SF(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function dx(t,e){var n=new Xd(t.i,t.x,t.y),r=new Xd(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function V1(t,e,n,r){var i=new Xd(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Nl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Xd(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}sf.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,o=Math.abs(Qd(t,0,s,n));if(i)for(var a=0,f=e.length;a<f;a++){var p=e[a]*n,m=a<f-1?e[a+1]*n:t.length;o-=Math.abs(Qd(t,p,m,n))}var v=0;for(a=0;a<r.length;a+=3){var w=r[a]*n,T=r[a+1]*n,E=r[a+2]*n;v+=Math.abs((t[w]-t[E])*(t[T+1]-t[w+1])-(t[w]-t[T])*(t[E+1]-t[w+1]))}return o===0&&v===0?0:Math.abs((v-o)/o)};function Qd(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}sf.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var CF=Cg.exports;const PF=vy(CF),jA=Tg.CLOCKWISE,z1=Tg.COUNTER_CLOCKWISE,Oi={};function kF(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function ja(t){return"positions"in t?t.positions:t}function cc(t){return"holeIndices"in t?t.holeIndices:null}function RF(t){return Array.isArray(t[0])}function IF(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function MF(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function NF(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function j1(t,e,n,r,i){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let f=0;f<r;f++)t[s++]=n[a][f]||0;if(!MF(n))for(let a=0;a<r;a++)t[s++]=n[0][a]||0;return Oi.start=e,Oi.end=s,Oi.size=r,Eg(t,i,Oi),s}function W1(t,e,n,r,i=0,s,o){s=s||n.length;const a=s-i;if(a<=0)return e;let f=e;for(let p=0;p<a;p++)t[f++]=n[i+p];if(!NF(n,r,i,s))for(let p=0;p<r;p++)t[f++]=n[i+p];return Oi.start=e,Oi.end=f,Oi.size=r,Eg(t,o,Oi),f}function px(t,e){kF(t);const n=[],r=[];if("positions"in t){const{positions:i,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=W1(n,o,i,e,s[a-1],s[a],a===0?jA:z1),r.push(o);return r.pop(),{positions:n,holeIndices:r}}t=i}if(!RF(t))return W1(n,0,t,e,0,n.length,jA),n;if(!IF(t)){let i=0;for(const[s,o]of t.entries())i=j1(n,i,o,e,s===0?jA:z1),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return j1(n,0,t,e,jA),n}function r0(t,e,n){const r=t.length/3;let i=0;for(let s=0;s<r;s++){const o=(s+1)%r;i+=t[s*3+e]*t[o*3+n],i-=t[o*3+e]*t[s*3+n]}return Math.abs(i/2)}function $1(t,e,n,r){const i=t.length/3;for(let s=0;s<i;s++){const o=s*3,a=t[o+0],f=t[o+1],p=t[o+2];t[o+e]=a,t[o+n]=f,t[o+r]=p}}function OF(t,e,n,r){let i=cc(t);i&&(i=i.map(a=>a/e));let s=ja(t);const o=r&&e===3;if(n){const a=s.length;s=s.slice();const f=[];for(let p=0;p<a;p+=e){f[0]=s[p],f[1]=s[p+1],o&&(f[2]=s[p+2]);const m=n(f);s[p]=m[0],s[p+1]=m[1],o&&(s[p+2]=m[2])}}if(o){const a=r0(s,0,1),f=r0(s,0,2),p=r0(s,1,2);if(!a&&!f&&!p)return[];a>f&&a>p||(f>p?(n||(s=s.slice()),$1(s,0,2,1)):(n||(s=s.slice()),$1(s,2,0,1)))}return PF(s,i,e)}class DF extends nx{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=px(e,this.positionSize);return this.opts.resolution?ax(ja(n),cc(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?KB(ja(n),cc(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(H1(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return ja(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&H1(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i,n.indexStart=this.indexStarts[n.geometryIndex+1]}else{const r=e;this._updateIndices(r,n),this._updatePositions(r,n),this._updateVertexValid(r,n)}}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:i}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let f=s.indices;if(!f||!e)return;let p=i;const m=OF(e,this.positionSize,this.opts.preproject,this.opts.full3d);f=a.allocate(f,i+m.length,{copy:!0});for(let v=0;v<m.length;v++)f[p++]=m[v]+r;o[n+1]=i+m.length,s.indices=f}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:i},positionSize:s}=this;if(!i||!e)return;const o=ja(e);for(let a=n,f=0;f<r;a++,f++){const p=o[f*s],m=o[f*s+1],v=s>2?o[f*s+2]:0;i[a*3]=p,i[a*3+1]=m,i[a*3+2]=v}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:i}=this,s=this.attributes.vertexValid,o=e&&cc(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+r),o)for(let a=0;a<o.length;a++)s[n+o[a]/i-1]=0;s[n+r-1]=0}}function H1(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const X1=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,BF={name:"solidPolygon",vs:X1,fs:X1,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},gx=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,FF=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${gx}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,LF=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${gx}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,UF=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,fu=[0,0,0,255],VF={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:fu},getLineColor:{type:"accessor",value:fu},material:!0},WA={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class af extends $r{getShaders(e){return super.getShaders({vs:e==="top"?FF:LF,fs:UF,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[ea,ug,ta,BF]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&n===ft.DEFAULT&&(n=ft.LNGLAT);let i;n===ft.LNGLAT&&(r?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new DF({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:WA,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:WA,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:WA,accessor:"getFillColor",defaultValue:fu},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:WA,accessor:"getLineColor",defaultValue:fu},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:f,target:p})=>this.encodePickingColor(a&&a.__source?a.__source.index:f,p)}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:i,elevationScale:s}=this.props,{topModel:o,sideModel:a,wireframeModel:f,polygonTesselator:p}=this.state,m={extruded:!!n,elevationScale:s,isWireframe:!1};f&&i&&(f.setInstanceCount(p.instanceCount-1),f.shaderInputs.setProps({solidPolygon:{...m,isWireframe:!0}}),f.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(p.instanceCount-1),a.shaderInputs.setProps({solidPolygon:m}),a.draw(this.context.renderPass)),o&&r&&(o.setVertexCount(p.vertexCount),o.shaderInputs.setProps({solidPolygon:m}),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager();(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded)&&((a=this.state.models)==null||a.forEach(f=>f.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:n,extruded:r}=this.props;let i,s,o;if(n){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const f=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Yn(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",bufferLayout:f,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new Yn(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,geometry:new Ps({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Yn(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,geometry:new Ps({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,i].filter(Boolean),topModel:i,sideModel:s,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}af.defaultProps=VF;af.layerName="SolidPolygonLayer";function mx({data:t,getIndex:e,dataRange:n,replace:r}){const{startRow:i=0,endRow:s=1/0}=n,o=t.length;let a=o,f=o;for(let w=0;w<o;w++){const T=e(t[w]);if(a>w&&T>=i&&(a=w),T>=s){f=w;break}}let p=a;const v=f-a!==r.length?t.slice(f):void 0;for(let w=0;w<r.length;w++)t[p++]=r[w];if(v){for(let w=0;w<v.length;w++)t[p++]=v[w];t.length=p}return{startRow:a,endRow:a+r.length}}const _x=[0,0,0,255],zF=[0,0,0,255],jF={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:zF},getLineColor:{type:"accessor",value:_x},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class lf extends Hl{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&ot.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),i=e.dataChanged.map(s=>mx({data:r,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:r,pathsDiff:i})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:r,positionFormat:i,_normalize:s}=this.props,o=[],a=i==="XY"?2:3,{startRow:f,endRow:p}=e,{iterable:m,objectInfo:v}=ra(n,f,p);for(const w of m){v.index++;let T=r(w,v);s&&(T=px(T,a));const{holeIndices:E}=T,I=T.positions||T;if(E)for(let U=0;U<=E.length;U++){const R=I.slice(E[U-1]||0,E[U]||I.length);o.push(this.getSubLayerRow({path:R},w,v.index))}else o.push(this.getSubLayerRow({path:I},w,v.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:r,filled:i,extruded:s,wireframe:o,_normalize:a,_windingOrder:f,elevationScale:p,transitions:m,positionFormat:v}=this.props,{lineWidthUnits:w,lineWidthScale:T,lineWidthMinPixels:E,lineWidthMaxPixels:I,lineJointRounded:U,lineMiterLimit:R,lineDashJustified:P}=this.props,{getFillColor:C,getLineColor:D,getLineWidth:$,getLineDashArray:q,getElevation:fe,getPolygon:ae,updateTriggers:he,material:ye}=this.props,{paths:ke,pathsDiff:Le}=this.state,Ve=this.getSubLayerClass("fill",af),Ae=this.getSubLayerClass("stroke",rf),Re=this.shouldRenderSubLayer("fill",ke)&&new Ve({_dataDiff:n,extruded:s,elevationScale:p,filled:i,wireframe:o,_normalize:a,_windingOrder:f,getElevation:fe,getFillColor:C,getLineColor:s&&o?D:_x,material:ye,transitions:m},this.getSubLayerProps({id:"fill",updateTriggers:he&&{getPolygon:he.getPolygon,getElevation:he.getElevation,getFillColor:he.getFillColor,lineColors:s&&o,getLineColor:he.getLineColor}}),{data:e,positionFormat:v,getPolygon:ae}),At=!s&&r&&this.shouldRenderSubLayer("stroke",ke)&&new Ae({_dataDiff:Le&&(()=>Le),widthUnits:w,widthScale:T,widthMinPixels:E,widthMaxPixels:I,jointRounded:U,miterLimit:R,dashJustified:P,_pathType:"loop",transitions:m&&{getWidth:m.getLineWidth,getColor:m.getLineColor,getPath:m.getPolygon},getColor:this.getSubLayerAccessor(D),getWidth:this.getSubLayerAccessor($),getDashArray:this.getSubLayerAccessor(q)},this.getSubLayerProps({id:"stroke",updateTriggers:he&&{getWidth:he.getLineWidth,getColor:he.getLineColor,getDashArray:he.getLineDashArray}}),{data:ke,positionFormat:v,getPath:it=>it.path});return[!s&&Re,At,s&&Re]}}lf.layerName="PolygonLayer";lf.defaultProps=jF;function WF(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,r=t.featureIds.value[n];return n!==-1?$F(t,r,n):null}function $F(t,e,n){const r={properties:{...t.properties[e]}};for(const i in t.numericProps)r.properties[i]=t.numericProps[i].value[n];return r}function HF(t,e){const n={points:null,lines:null,polygons:null};for(const r in n){const i=t[r].globalFeatureIds.value;n[r]=new Uint8ClampedArray(i.length*4);const s=[];for(let o=0;o<i.length;o++)e(i[o],s),n[r][o*4+0]=s[0],n[r][o*4+1]=s[1],n[r][o*4+2]=s[2],n[r][o*4+3]=255}return n}const Q1=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,XF={name:"sdf",vs:Q1,fs:Q1,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},QF=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,i0=192/256,Y1=[],YF={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class Pg extends tf{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,XF],fs:QF}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&ot.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,i0*(1-i)):-1,a=this.state.model,f={buffer:i0,outlineBuffer:o,gamma:r,enabled:!!n,outlineColor:s};if(a.shaderInputs.setProps({sdf:f}),super.draw(e),n&&i){const{iconManager:p}=this.state;p.getTexture()&&(a.shaderInputs.setProps({sdf:{...f,outlineBuffer:i0}}),a.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):Y1}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):Y1}}Pg.defaultProps=YF;Pg.layerName="MultiIconLayer";const hu=1e20;class KF{constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=i,this.radius=r;const f=this.size=e+n*4,p=this._createCanvas(f),m=this.ctx=p.getContext("2d",{willReadFrequently:!0});m.font=`${a} ${o} ${e}px ${s}`,m.textBaseline="alphabetic",m.textAlign="left",m.fillStyle="black",this.gridOuter=new Float64Array(f*f),this.gridInner=new Float64Array(f*f),this.f=new Float64Array(f),this.z=new Float64Array(f+1),this.v=new Uint16Array(f)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),f=0,p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),m=Math.min(this.size-this.buffer,a+Math.ceil(i)),v=p+2*this.buffer,w=m+2*this.buffer,T=Math.max(v*w,0),E=new Uint8ClampedArray(T),I={data:E,width:v,height:w,glyphWidth:p,glyphHeight:m,glyphTop:a,glyphLeft:f,glyphAdvance:n};if(p===0||m===0)return I;const{ctx:U,buffer:R,gridInner:P,gridOuter:C}=this;U.clearRect(R,R,p,m),U.fillText(e,R,R+a);const D=U.getImageData(R,R,p,m);C.fill(hu,0,T),P.fill(0,0,T);for(let $=0;$<m;$++)for(let q=0;q<p;q++){const fe=D.data[4*($*p+q)+3]/255;if(fe===0)continue;const ae=($+R)*v+q+R;if(fe===1)C[ae]=0,P[ae]=hu;else{const he=.5-fe;C[ae]=he>0?he*he:0,P[ae]=he<0?he*he:0}}K1(C,0,0,v,w,v,this.f,this.v,this.z),K1(P,R,R,p,m,v,this.f,this.v,this.z);for(let $=0;$<T;$++){const q=Math.sqrt(C[$])-Math.sqrt(P[$]);E[$]=Math.round(255-255*(q/this.radius+this.cutoff))}return I}}function K1(t,e,n,r,i,s,o,a,f){for(let p=e;p<e+r;p++)Z1(t,n*s+p,s,i,o,a,f);for(let p=n;p<n+i;p++)Z1(t,p*s+e,1,r,o,a,f)}function Z1(t,e,n,r,i,s,o){s[0]=0,o[0]=-1e20,o[1]=hu,i[0]=t[e];for(let a=1,f=0,p=0;a<r;a++){i[a]=t[e+a*n];const m=a*a;do{const v=s[f];p=(i[a]-i[v]+m-v*v)/(a-v)/2}while(p<=o[f]&&--f>-1);f++,s[f]=a,o[f]=p,o[f+1]=hu}for(let a=0,f=0;a<r;a++){for(;o[f+1]<a;)f++;const p=s[f],m=a-p;t[e+a*n]=i[p]+m*m}}const ZF=32,qF=[];function GF(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function JF({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:a=0}){let f=0,p=o;const m=n+r*2;for(const v of t)if(!s[v]){const w=e(v);p+w+r*2>i&&(p=0,f++),s[v]={x:p+r,y:a+f*m+r,width:w,height:m,layoutWidth:w,layoutHeight:n},p+=w+r*2}return{mapping:s,xOffset:p,yOffset:a+f*m,canvasHeight:GF(a+(f+1)*m)}}function yx(t,e,n,r){var s;let i=0;for(let o=e;o<n;o++){const a=t[o];i+=((s=r[a])==null?void 0:s.layoutWidth)||0}return i}function vx(t,e,n,r,i,s){let o=e,a=0;for(let f=e;f<n;f++){const p=yx(t,f,f+1,i);a+p>r&&(o<f&&s.push(f),o=f,a=0),a+=p}return a}function eL(t,e,n,r,i,s){let o=e,a=e,f=e,p=0;for(let m=e;m<n;m++)if((t[m]===" "||t[m+1]===" "||m+1===n)&&(f=m+1),f>a){let v=yx(t,a,f,i);p+v>r&&(o<a&&(s.push(a),o=a,p=0),v>r&&(v=vx(t,a,f,r,i,s),o=s[s.length-1])),a=f,p+=v}return p}function tL(t,e,n,r,i=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?vx(t,i,s,n,r,o):eL(t,i,s,n,r,o),o}function nL(t,e,n,r,i,s){let o=0,a=0;for(let f=e;f<n;f++){const p=t[f],m=r[p];m?(a||(a=m.layoutHeight),i[f]=o+m.layoutWidth/2,o+=m.layoutWidth):(ot.warn(`Missing character: ${p} (${p.codePointAt(0)})`)(),i[f]=o,o+=ZF)}s[0]=o,s[1]=a}function rL(t,e,n,r,i){var U;const s=Array.from(t),o=s.length,a=new Array(o),f=new Array(o),p=new Array(o),m=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,v=[0,0],w=[0,0];let T=0,E=0,I=0;for(let R=0;R<=o;R++){const P=s[R];if((P===`
`||R===o)&&(I=R),I>E){const C=m?tL(s,n,r,i,E,I):qF;for(let D=0;D<=C.length;D++){const $=D===0?E:C[D-1],q=D<C.length?C[D]:I;nL(s,$,q,i,a,w);for(let fe=$;fe<q;fe++){const ae=s[fe],he=((U=i[ae])==null?void 0:U.layoutOffsetY)||0;f[fe]=T+w[1]/2+he,p[fe]=w[0]}T=T+w[1]*e,v[0]=Math.max(v[0],w[0])}E=I}P===`
`&&(a[E]=0,f[E]=0,p[E]=0,E++)}return v[1]=T,{x:a,y:f,rowWidth:p,size:v}}function iL({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,f=r?r/o:0,p=i[e]||Math.ceil((t.length-f)/a),m=s&&new Set,v=new Array(e);let w=t;if(a>1||f>0){const T=t.constructor;w=new T(p);for(let E=0;E<p;E++)w[E]=t[E*a+f]}for(let T=0;T<e;T++){const E=i[T],I=i[T+1]||p,U=w.subarray(E,I);v[T]=String.fromCodePoint.apply(null,U),m&&U.forEach(m.add,m)}if(m)for(const T of m)s.add(String.fromCodePoint(T));return{texts:v,characterCount:p}}class wx{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function sL(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const ko={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:sL(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},q1=1024,G1=.9,J1=1.2,bx=3;let du=new wx(bx);function oL(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=du.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function aL(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function ey(t,e,n,r){t.font=`${r} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function lL(t){ot.assert(Number.isFinite(t)&&t>=bx,"Invalid cache limit"),du=new wx(t)}class AL{constructor(){this.props={...ko}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*J1+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=oL(this._key,this.props.characterSet),r=du.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,du.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:a,radius:f,cutoff:p}=this.props;let m=n&&n.data;m||(m=document.createElement("canvas"),m.width=q1);const v=m.getContext("2d",{willReadFrequently:!0});ey(v,r,s,i);const{mapping:w,canvasHeight:T,xOffset:E,yOffset:I}=JF({getFontWidth:U=>v.measureText(U).width,fontHeight:s*J1,buffer:o,characterSet:e,maxCanvasWidth:q1,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(m.height!==T){const U=v.getImageData(0,0,m.width,m.height);m.height=T,v.putImageData(U,0,0)}if(ey(v,r,s,i),a){const U=new KF({fontSize:s,buffer:o,radius:f,cutoff:p,fontFamily:r,fontWeight:`${i}`});for(const R of e){const{data:P,width:C,height:D,glyphTop:$}=U.draw(R);w[R].width=C,w[R].layoutOffsetY=s*G1-$;const q=v.createImageData(C,D);aL(P,q),v.putImageData(q,w[R].x,w[R].y)}}else for(const U of e)v.fillText(U,w[U].x,w[U].y+o+s*G1);return{xOffset:E,yOffset:I,mapping:w,data:m,width:m.width,height:m.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:a}=this.props;return s?`${e} ${n} ${r} ${i} ${o} ${a}`:`${e} ${n} ${r} ${i}`}}const ty=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,cL={name:"textBackground",vs:ty,fs:ty,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},uL=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,fL=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,hL={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class kg extends $r{getShaders(){return super.getShaders({vs:uL,fs:fL,modules:[ea,ta,cL]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:f}=this.props;f.length<4&&(f=[f[0],f[1],f[0],f[1]]);const p=this.state.model,m={billboard:n,stroked:!!a,padding:f,sizeUnits:Ai[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o};p.shaderInputs.setProps({textBackground:m}),p.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Yn(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Ps({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}kg.defaultProps=hL;kg.layerName="TextBackgroundLayer";const ny={start:1,middle:0,end:-1},ry={top:1,center:0,bottom:-1},s0=[0,0,0,255],dL=1,pL={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:s0},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:ko.characterSet},fontFamily:ko.fontFamily,fontWeight:ko.fontWeight,lineHeight:dL,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:s0},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:s0},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class Rg extends Hl{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[r,i]}=this.transformParagraph(e,n);const{fontSize:s}=this.state.fontAtlasManager.props;r/=s,i/=s;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,f=ny[typeof o=="function"?o(e,n):o],p=ry[typeof a=="function"?a(e,n):a];return[(f-1)*r/2,(p-1)*i/2,r,i]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:s,y:o,rowWidth:a,size:[f,p]}=this.transformParagraph(e,n),m=ny[typeof r=="function"?r(e,n):r],v=ry[typeof i=="function"?i(e,n):i],w=s.length,T=new Array(w*2);let E=0;for(let I=0;I<w;I++){const U=(1-m)*(f-a[I])/2;T[E++]=(m-1)*f/2+U+s[I],T[E++]=(v-1)*p/2+o[I]}return T}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new AL},this.props.maxWidth>0&&ot.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const a in o)if(o[a]!==i.props[a])return i.setProps(o),!0;return!1}_updateText(){var f;const{data:e,characterSet:n}=this.props,r=(f=e.attributes)==null?void 0:f.getText;let{getText:i}=this.props,s=e.startIndices,o;const a=n==="auto"&&new Set;if(r&&s){const{texts:p,characterCount:m}=iL({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:s,characterSet:a});o=m,i=(v,{index:w})=>p[w]}else{const{iterable:p,objectInfo:m}=ra(e);s=[0],o=0;for(const v of p){m.index++;const w=Array.from(i(v,m)||"");a&&w.forEach(a.add,a),o+=w.length,s.push(o)}}this.setState({getText:i,startIndices:s,numInstances:o,characterSet:a||n})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:f}=this.props,p=s(e,n)||"";return rL(p,a,o,f*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,atlas:s,mapping:o},styleVersion:a}=this.state,{data:f,_dataDiff:p,getPosition:m,getColor:v,getSize:w,getAngle:T,getPixelOffset:E,getBackgroundColor:I,getBorderColor:U,getBorderWidth:R,backgroundPadding:P,background:C,billboard:D,fontSettings:$,outlineWidth:q,outlineColor:fe,sizeScale:ae,sizeUnits:he,sizeMinPixels:ye,sizeMaxPixels:ke,transitions:Le,updateTriggers:Ve}=this.props,Ae=this.getSubLayerClass("characters",Pg),Re=this.getSubLayerClass("background",kg);return[C&&new Re({getFillColor:I,getLineColor:U,getLineWidth:R,padding:P,getPosition:m,getSize:w,getAngle:T,getPixelOffset:E,billboard:D,sizeScale:ae,sizeUnits:he,sizeMinPixels:ye,sizeMaxPixels:ke,transitions:Le&&{getPosition:Le.getPosition,getAngle:Le.getAngle,getSize:Le.getSize,getFillColor:Le.getBackgroundColor,getLineColor:Le.getBorderColor,getLineWidth:Le.getBorderWidth,getPixelOffset:Le.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:Ve.getPosition,getAngle:Ve.getAngle,getSize:Ve.getSize,getFillColor:Ve.getBackgroundColor,getLineColor:Ve.getBorderColor,getLineWidth:Ve.getBorderWidth,getPixelOffset:Ve.getPixelOffset,getBoundingRect:{getText:Ve.getText,getTextAnchor:Ve.getTextAnchor,getAlignmentBaseline:Ve.getAlignmentBaseline,styleVersion:a}}}),{data:f.attributes&&f.attributes.background?{length:f.length,attributes:f.attributes.background}:f,_dataDiff:p,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Ae({sdf:$.sdf,smoothing:Number.isFinite($.smoothing)?$.smoothing:ko.smoothing,outlineWidth:q/($.radius||ko.radius),outlineColor:fe,iconAtlas:s,iconMapping:o,getPosition:m,getColor:v,getSize:w,getAngle:T,getPixelOffset:E,billboard:D,sizeScale:ae*i,sizeUnits:he,sizeMinPixels:ye*i,sizeMaxPixels:ke*i,transitions:Le&&{getPosition:Le.getPosition,getAngle:Le.getAngle,getColor:Le.getColor,getSize:Le.getSize,getPixelOffset:Le.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:Ve.getText,getPosition:Ve.getPosition,getAngle:Ve.getAngle,getColor:Ve.getColor,getSize:Ve.getSize,getPixelOffset:Ve.getPixelOffset,getIconOffsets:{getTextAnchor:Ve.getTextAnchor,getAlignmentBaseline:Ve.getAlignmentBaseline,styleVersion:a}}}),{data:f,_dataDiff:p,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){lL(e)}}Rg.defaultProps=pL;Rg.layerName="TextLayer";const uc={circle:{type:nf,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:tf,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:Rg,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},fc={type:rf,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Yd={type:af,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Ia({type:t,props:e}){const n={};for(const r in e)n[r]=t.defaultProps[e[r]];return n}function o0(t,e){const{transitions:n,updateTriggers:r}=t.props,i={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),i.updateTriggers[o]=r[s],n&&(i.transitions[o]=n[s])),i[o]=a}return i}function gL(t){if(Array.isArray(t))return t;switch(ot.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return ot.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function iy(t,e,n={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:s=t.length}=n;for(let o=i;o<s;o++){const a=t[o],{geometry:f}=a;if(f)if(f.type==="GeometryCollection"){ot.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");const{geometries:p}=f;for(let m=0;m<p.length;m++){const v=p[m];sy(v,r,e,a,o)}}else sy(f,r,e,a,o)}return r}function sy(t,e,n,r,i){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:f,polygonFeatures:p,polygonOutlineFeatures:m}=e;if(!_L(s,o)){ot.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":a.push(n({geometry:t},r,i));break;case"MultiPoint":o.forEach(v=>{a.push(n({geometry:{type:"Point",coordinates:v}},r,i))});break;case"LineString":f.push(n({geometry:t},r,i));break;case"MultiLineString":o.forEach(v=>{f.push(n({geometry:{type:"LineString",coordinates:v}},r,i))});break;case"Polygon":p.push(n({geometry:t},r,i)),o.forEach(v=>{m.push(n({geometry:{type:"LineString",coordinates:v}},r,i))});break;case"MultiPolygon":o.forEach(v=>{p.push(n({geometry:{type:"Polygon",coordinates:v}},r,i)),v.forEach(w=>{m.push(n({geometry:{type:"LineString",coordinates:w}},r,i))})});break}}const mL={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function _L(t,e){let n=mL[t];for(ot.assert(n,`Unknown GeoJSON type ${t}`);e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function xx(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function $A(t){return t.geometry.coordinates}function yL(t,e){const n=xx(),{pointFeatures:r,lineFeatures:i,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=r,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=$A,n.lines.data=i,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=$A,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=$A,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=$A,n}function vL(t,e){const n=xx(),{points:r,lines:i,polygons:s}=t,o=HF(t,e);return n.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:o.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const wL=["points","linestrings","polygons"],bL={...Ia(uc.circle),...Ia(uc.icon),...Ia(uc.text),...Ia(fc),...Ia(Yd),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class Ig extends Hl{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const r=vL(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:n}){const r=gL(e.data),i=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const f=this.state.features;for(const p in f)s[p]=f[p].slice(),o[p]=[];for(const p of n.dataChanged){const m=iy(r,i,p);for(const v in f)o[v].push(mx({data:s[v],getIndex:w=>w.__source.index,dataRange:p,replace:m[v]}))}}else s=iy(r,i);const a=yL(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r,sourceLayer:i}=n;return n.featureType=wL.find(s=>i.id.startsWith(`${this.id}-${s}-`)),r>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[r]),n}_updateAutoHighlight(e){const n=`${this.id}-points-`,r=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(n)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){var o;const{extruded:e,wireframe:n}=this.props,{layerProps:r}=this.state,i="polygons-fill",s=this.shouldRenderSubLayer(i,(o=r.polygons)==null?void 0:o.data)&&this.getSubLayerClass(i,Yd.type);if(s){const a=o0(this,Yd.props),f=e&&n;return f||delete a.getLineColor,a.updateTriggers.lineColors=f,new s(a,this.getSubLayerProps({id:i,updateTriggers:a.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var f,p;const{extruded:e,stroked:n}=this.props,{layerProps:r}=this.state,i="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(i,(f=r.polygonsOutline)==null?void 0:f.data)&&this.getSubLayerClass(i,fc.type),a=this.shouldRenderSubLayer(s,(p=r.lines)==null?void 0:p.data)&&this.getSubLayerClass(s,fc.type);if(o||a){const m=o0(this,fc.props);return[o&&new o(m,this.getSubLayerProps({id:i,updateTriggers:m.updateTriggers}),r.polygonsOutline),a&&new a(m,this.getSubLayerProps({id:s,updateTriggers:m.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:n,binary:r}=this.state;let{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=n.points.data.findIndex(f=>f.__source.index===i));const s=new Set(e.split("+")),o=[];for(const f of s){const p=`points-${f}`,m=uc[f],v=m&&this.shouldRenderSubLayer(p,(a=n.points)==null?void 0:a.data)&&this.getSubLayerClass(p,m.type);if(v){const w=o0(this,m.props);let T=n.points;if(f==="text"&&r){const{instancePickingColors:E,...I}=T.data.attributes;T={...T,data:{...T.data,attributes:I}}}o.push(new v(w,this.getSubLayerProps({id:p,updateTriggers:w.updateTriggers,highlightedObjectIndex:i}),T))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),r=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&n,r,i,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:s,index:o}=i,a=WF(s,o);return e(a,i)}}}Ig.layerName="GeoJsonLayer";Ig.defaultProps=bL;const xL="modulepreload",TL=function(t){return"/mapviewer-gl/"+t},oy={},EL=function(e,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(n.map(f=>{if(f=TL(f),f in oy)return;oy[f]=!0;const p=f.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${f}"]${m}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":xL,p||(v.as="script"),v.crossOrigin="",v.href=f,a&&v.setAttribute("nonce",a),document.head.appendChild(v),p)return new Promise((w,T)=>{v.addEventListener("load",w),v.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${f}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},SL=le.createContext(null);function CL(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function ti(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!ti(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!ti(t[i],e[i]))return!1;return!0}return!1}function PL(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function ay(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();ti(n,r)||e.setProjection(n)}function ly(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function Ay(t,e){const n=e.viewState||e;let r=!1;if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}if(n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),"longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}return r}const kL=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function cy(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of kL)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}var uy={};const fy={version:8,sources:{},layers:[]},hy={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},a0={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},dy={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},RL=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],IL=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ko{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[dy[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[hy[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[a0[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=Ko.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=fy}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||ML()||null,container:e,style:cy(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const m=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=m,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=m=>{this._inRender=!0,a.call(o,m),this._inRender=!1};const f=o._renderTaskQueue.run;o._renderTaskQueue.run=m=>{f.call(o._renderTaskQueue,m),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const p=o.fire;o.fire=this._fireEvent.bind(this,p),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),ay(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const m in hy)o.on(m,this._onPointerEvent);for(const m in a0)o.on(m,this._onCameraEvent);for(const m in dy)o.on(m,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Ko.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=PL(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,f=r.isMoving();f&&(i.cameraElevationReference="sea");const p=Ay(i,{...ly(r.transform),...e});if(f&&(i.cameraElevationReference="ground"),p&&n){const m=this._deferredEvents;m.move=!0,m.zoom||(m.zoom=s!==i.zoom),m.rotate||(m.rotate=a!==i.bearing),m.pitch||(m.pitch=o!==i.pitch)}return f||Ay(r.transform,e),p}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of RL)if(s in e&&!ti(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=fy,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(cy(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!ti(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!ti(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!ti(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of IL){const f=(r=e[a])!==null&&r!==void 0?r:!0,p=(i=n[a])!==null&&i!==void 0?i:!0;ti(f,p)||(o=!0,f?s[a].enable(f):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),f=a.length>0;!f&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,f&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in a0&&(typeof n=="object"&&(n.viewState=ly(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{ay(this._renderTransform,n),e.transform=n}}}Ko.savedMaps=[];function ML(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||uy.MapboxAccessToken}catch{}try{t=t||uy.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const NL=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function OL(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of DL(e))!(r in n)&&!NL.includes(r)&&(n[r]=e[r].bind(e));return n}function DL(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const BL=typeof document<"u"?le.useLayoutEffect:le.useEffect,FL=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function LL(t,e){for(const r of FL)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const Af=le.createContext(null);function UL(t,e,n){const r=le.useContext(SL),[i,s]=le.useState(null),o=le.useRef(),{current:a}=le.useRef({mapLib:null,map:null});le.useEffect(()=>{const m=t.mapLib;let v=!0,w;return Promise.resolve(m||n).then(T=>{if(!v)return;if(!T)throw new Error("Invalid mapLib");const E="Map"in T?T:T.default;if(!E.Map)throw new Error("Invalid mapLib");if(LL(E,t),!E.supported||E.supported(t))t.reuseMaps&&(w=Ko.reuse(t,o.current)),w||(w=new Ko(E.Map,t,o.current)),a.map=OL(w),a.mapLib=E,s(w),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(T=>{const{onError:E}=t;E?E({type:"error",target:null,originalEvent:null,error:T}):console.error(T)}),()=>{v=!1,w&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?w.recycle():w.destroy())}},[]),BL(()=>{i&&i.setProps(t)}),le.useImperativeHandle(e,()=>a.map,[i]);const f=le.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),p={height:"100%"};return le.createElement("div",{id:t.id,ref:o,style:f},i&&le.createElement(Af.Provider,{value:a},le.createElement("div",{"mapboxgl-children":"",style:p},t.children)))}const VL=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Ls(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!VL.test(r)?n[r]=`${i}px`:n[r]=i}}function zL(t,e){const{map:n,mapLib:r}=le.useContext(Af),i=le.useRef({props:t});i.current.props=t;const s=le.useMemo(()=>{let I=!1;le.Children.forEach(t.children,P=>{P&&(I=!0)});const U={...t,element:I?document.createElement("div"):null},R=new r.Marker(U);return R.setLngLat([t.longitude,t.latitude]),R.getElement().addEventListener("click",P=>{var C,D;(D=(C=i.current.props).onClick)===null||D===void 0||D.call(C,{type:"click",target:R,originalEvent:P})}),R.on("dragstart",P=>{var C,D;const $=P;$.lngLat=s.getLngLat(),(D=(C=i.current.props).onDragStart)===null||D===void 0||D.call(C,$)}),R.on("drag",P=>{var C,D;const $=P;$.lngLat=s.getLngLat(),(D=(C=i.current.props).onDrag)===null||D===void 0||D.call(C,$)}),R.on("dragend",P=>{var C,D;const $=P;$.lngLat=s.getLngLat(),(D=(C=i.current.props).onDragEnd)===null||D===void 0||D.call(C,$)}),R},[]);le.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:f,style:p,draggable:m=!1,popup:v=null,rotation:w=0,rotationAlignment:T="auto",pitchAlignment:E="auto"}=t;return le.useEffect(()=>{Ls(s.getElement(),p)},[p]),le.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),f&&!CL(s.getOffset(),f)&&s.setOffset(f),s.isDraggable()!==m&&s.setDraggable(m),s.getRotation()!==w&&s.setRotation(w),s.getRotationAlignment()!==T&&s.setRotationAlignment(T),s.getPitchAlignment()!==E&&s.setPitchAlignment(E),s.getPopup()!==v&&s.setPopup(v),Hp.createPortal(t.children,s.getElement())}le.memo(le.forwardRef(zL));function py(t){return new Set(t?t.trim().split(/\s+/):[])}function jL(t,e){const{map:n,mapLib:r}=le.useContext(Af),i=le.useMemo(()=>document.createElement("div"),[]),s=le.useRef({props:t});s.current.props=t;const o=le.useMemo(()=>{const a={...t},f=new r.Popup(a);return f.setLngLat([t.longitude,t.latitude]),f.once("open",p=>{var m,v;(v=(m=s.current.props).onOpen)===null||v===void 0||v.call(m,p)}),f},[]);if(le.useEffect(()=>{const a=f=>{var p,m;(m=(p=s.current.props).onClose)===null||m===void 0||m.call(p,f)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),le.useEffect(()=>{Ls(o.getElement(),t.style)},[t.style]),le.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!ti(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=py(o.options.className),f=py(t.className);for(const p of a)f.has(p)||o.removeClassName(p);for(const p of f)a.has(p)||o.addClassName(p);o.options.className=t.className}return Hp.createPortal(t.children,i)}le.memo(le.forwardRef(jL));function Xl(t,e,n,r){const i=le.useContext(Af),s=le.useMemo(()=>t(i),[]);return le.useEffect(()=>{const o=e,a=null,f=typeof e=="function"?e:null,{map:p}=i;return p.hasControl(s)||(p.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{f&&f(i),p.hasControl(s)&&p.removeControl(s)}},[]),s}function WL(t){const e=Xl(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return le.useEffect(()=>{Ls(e._container,t.style)},[t.style]),null}le.memo(WL);function $L(t){const e=Xl(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return le.useEffect(()=>{Ls(e._controlContainer,t.style)},[t.style]),null}le.memo($L);function HL(t,e){const n=le.useRef({props:t}),r=Xl(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var f,p;(p=(f=n.current.props).onGeolocate)===null||p===void 0||p.call(f,a)}),s.on("error",a=>{var f,p;(p=(f=n.current.props).onError)===null||p===void 0||p.call(f,a)}),s.on("outofmaxbounds",a=>{var f,p;(p=(f=n.current.props).onOutOfMaxBounds)===null||p===void 0||p.call(f,a)}),s.on("trackuserlocationstart",a=>{var f,p;(p=(f=n.current.props).onTrackUserLocationStart)===null||p===void 0||p.call(f,a)}),s.on("trackuserlocationend",a=>{var f,p;(p=(f=n.current.props).onTrackUserLocationEnd)===null||p===void 0||p.call(f,a)}),s},{position:t.position});return n.current.props=t,le.useImperativeHandle(e,()=>r,[]),le.useEffect(()=>{Ls(r._container,t.style)},[t.style]),null}le.memo(le.forwardRef(HL));function XL(t){const e=Xl(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return le.useEffect(()=>{Ls(e._container,t.style)},[t.style]),null}le.memo(XL);function QL(t){const e=Xl(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=le.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),le.useEffect(()=>{Ls(e._container,i)},[i]),null}le.memo(QL);const YL=EL(()=>import("./mapbox-gl-a1rVkgvR.js").then(t=>t.m),[]),KL=le.forwardRef(function(e,n){return UL(e,n,YL)});function ZL({title:t,titleId:e,...n},r){return le.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},n),t?le.createElement("title",{id:e},t):null,le.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const qL=le.forwardRef(ZL);function GL({title:t,titleId:e,...n},r){return le.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},n),t?le.createElement("title",{id:e},t):null,le.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 0 0-5.78 1.128 2.25 2.25 0 0 1-2.4 2.245 4.5 4.5 0 0 0 8.4-2.245c0-.399-.078-.78-.22-1.128Zm0 0a15.998 15.998 0 0 0 3.388-1.62m-5.043-.025a15.994 15.994 0 0 1 1.622-3.395m3.42 3.42a15.995 15.995 0 0 0 4.764-4.648l3.876-5.814a1.151 1.151 0 0 0-1.597-1.597L14.146 6.32a15.996 15.996 0 0 0-4.649 4.763m3.42 3.42a6.776 6.776 0 0 0-3.42-3.42"}))}const JL=le.forwardRef(GL);function eU({title:t,titleId:e,...n},r){return le.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":e},n),t?le.createElement("title",{id:e},t):null,le.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const Ro=le.forwardRef(eU),tU=({isOpen:t,onClose:e,data:n,onApplyFilter:r,activeFilters:i,onRemoveFilter:s,layerType:o})=>{var Ve;const[a,f]=le.useState([]),[p,m]=le.useState(""),[v,w]=le.useState({min:0,max:0}),[T,E]=le.useState(""),[I,U]=le.useState([]),[R,P]=le.useState([]),[C,D]=le.useState("="),[$,q]=le.useState("");le.useEffect(()=>{U([]),E(""),q(""),D("=")},[p]),le.useEffect(()=>{if(n.length>0){const Ae=n[0],Re=Ae.properties||Ae,At=Object.keys(Re).filter(it=>it!=="position").map(it=>{const Te=n.map(rt=>(rt.properties||rt)[it]),Fe=Te.every(rt=>typeof rt=="number"),be=Fe?void 0:[...new Set(Te.map(String))].sort((rt,qe)=>rt.toLowerCase().localeCompare(qe.toLowerCase()));return{name:it,type:Fe?"numeric":"text",uniqueValues:be}});f(At)}},[n]),le.useEffect(()=>{if(p){const Ae=a.find(Re=>Re.name===p);if((Ae==null?void 0:Ae.type)==="numeric"){const Re=n.map(At=>(At.properties||At)[p]);w({min:Math.min(...Re),max:Math.max(...Re)})}else(Ae==null?void 0:Ae.type)==="text"&&Ae.uniqueValues&&P(Ae.uniqueValues)}else P([])},[p,a,n]),le.useEffect(()=>{if(p&&T){const Ae=a.find(Re=>Re.name===p);if((Ae==null?void 0:Ae.type)==="text"&&Ae.uniqueValues){const Re=Ae.uniqueValues.filter(At=>At.toLowerCase().includes(T.toLowerCase()));P(Re)}}},[p,T,a]);const fe=Ae=>{if(Ae.type==="numeric"){if(Ae.value.type==="range")return`${Ae.column}: ${Ae.value.min} to ${Ae.value.max}`;{const At=Ae.value;return`${Ae.column} ${At.operator} ${At.value}`}}if(Ae.value.type==="multiple")return`${Ae.column}: ${Ae.value.values.join(" OR ")}`;const Re=Ae.value;return`${Ae.column} ${Re.operator} "${Re.value}"`},ae=()=>{if(!p)return;const Ae=a.find(it=>it.name===p);if(!Ae)return;let Re,At;if(Ae.type==="numeric")if(C==="="||$!==""){const it=Number($);Re=Te=>{const be=(Te.properties||Te)[p];switch(C){case"=":return be===it;case"<":return be<it;case"<=":return be<=it;case">":return be>it;case">=":return be>=it;default:return!1}},At={column:p,type:"numeric",value:{type:"comparison",operator:C,value:it}}}else Re=it=>{const Fe=(it.properties||it)[p];return Fe>=v.min&&Fe<=v.max},At={column:p,type:"numeric",value:{type:"range",min:v.min,max:v.max}};else if(C==="="&&I.length>0)Re=it=>{const Te=it.properties||it,Fe=String(Te[p]).toLowerCase();return I.some(be=>Fe.includes(be.toLowerCase()))},At={column:p,type:"text",value:{type:"multiple",values:I}};else if($)Re=it=>{const Te=it.properties||it,Fe=String(Te[p]),be=$;switch(C){case"=":return Fe===be;case"<":return Fe<be;case"<=":return Fe<=be;case">":return Fe>be;case">=":return Fe>=be;default:return!1}},At={column:p,type:"text",value:{type:"comparison",operator:C,value:$}};else return;r(Re,At),e()},he=()=>{const Ae=a.find(Re=>Re.name===p);(Ae==null?void 0:Ae.type)==="text"&&Ae.uniqueValues&&P(Ae.uniqueValues.slice(0,5))},ye=Ae=>{I.includes(Ae)||U(Re=>[...Re,Ae]),E("")},ke=Ae=>{U(Re=>Re.filter(At=>At!==Ae))},Le=()=>{const Ae=a.find(Re=>Re.name===p);return Ae?W.jsxs("div",{className:"space-y-4",children:[W.jsxs("div",{className:"flex items-center space-x-2",children:[W.jsxs("select",{className:"p-2 border rounded-md bg-white shadow-sm",value:C,onChange:Re=>D(Re.target.value),children:[W.jsx("option",{value:"=",children:"="}),W.jsx("option",{value:"<=",children:"≤"}),W.jsx("option",{value:"<",children:"<"}),W.jsx("option",{value:">=",children:"≥"}),W.jsx("option",{value:">",children:">"})]}),C==="="&&Ae.type==="text"?W.jsxs("div",{className:"flex-1",children:[W.jsx("input",{type:"text",className:"w-full p-2 border rounded-md shadow-sm",value:T,onChange:Re=>E(Re.target.value),onFocus:he,placeholder:"Type to search..."}),I.length>0&&W.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:I.map(Re=>W.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-700",children:[Re,W.jsx("button",{onClick:()=>ke(Re),className:"ml-1.5 text-blue-500 hover:text-blue-700",children:W.jsx(Ro,{className:"h-4 w-4"})})]},Re))})]}):W.jsx("input",{type:Ae.type==="numeric"?"number":"text",className:"flex-1 p-2 border rounded-md shadow-sm",value:$,onChange:Re=>q(Re.target.value),placeholder:`Enter ${Ae.type==="numeric"?"number":"text"}...`})]}),C==="="&&Ae.type==="text"&&R.length>0&&W.jsx("div",{className:"mt-1 border rounded-md bg-white shadow-lg max-h-60 overflow-y-auto",children:R.filter(Re=>!I.includes(Re)).map(Re=>W.jsx("div",{className:"px-3 py-2 hover:bg-gray-50 cursor-pointer text-gray-700",onClick:()=>ye(Re),children:Re},Re))})]}):null};return t?W.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:W.jsxs("div",{className:"bg-white rounded-xl p-6 w-[480px] max-h-[90vh] overflow-y-auto",children:[W.jsxs("div",{className:"flex justify-between items-center mb-6",children:[W.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Filter Data"}),W.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-500 transition-colors",children:W.jsx(Ro,{className:"w-6 h-6"})})]}),i.length>0&&W.jsxs("div",{className:"mb-6",children:[W.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Active Filters"}),W.jsx("div",{className:"space-y-2",children:i.map((Ae,Re)=>W.jsxs("div",{className:"flex items-center justify-between bg-gray-50 px-3 py-2 rounded-lg",children:[W.jsx("span",{className:"text-sm text-gray-600",children:fe(Ae)}),W.jsx("button",{onClick:()=>s(Re),className:"text-gray-400 hover:text-gray-500",children:W.jsx(Ro,{className:"h-4 w-4"})})]},Re))})]}),W.jsxs("div",{className:"space-y-4",children:[W.jsxs("div",{children:[W.jsx("label",{className:"block text-base font-medium text-gray-700 mb-2",children:"Select Column"}),W.jsxs("select",{className:"w-full p-2.5 border rounded-lg bg-white shadow-sm text-gray-900",value:p,onChange:Ae=>m(Ae.target.value),children:[W.jsx("option",{value:"",children:"Select a column"}),a.map(Ae=>W.jsx("option",{value:Ae.name,children:Ae.name},Ae.name))]})]}),p&&Le()]}),W.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[W.jsx("button",{onClick:e,className:"px-4 py-2 text-gray-700 hover:text-gray-900 font-medium",children:"Cancel"}),W.jsx("button",{onClick:ae,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!p||((Ve=a.find(Ae=>Ae.name===p))==null?void 0:Ve.type)==="text"&&C==="="&&I.length===0&&!$,children:"Apply Filter"})]})]})}):null};var jt=function(t){t=t||{};var e=typeof t<"u"?t:{},n={},r;for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);var i="";function s(H){return e.locateFile?e.locateFile(H,i):i+H}var o;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",o=function(ee,oe,ge){var c=new XMLHttpRequest;c.open("GET",ee,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status==200||c.status==0&&c.response){oe(c.response);return}var we=la(ee);if(we){oe(we.buffer);return}ge()},c.onerror=ge,c.send(null)};var a=e.print||console.log.bind(console),f=e.printErr||console.warn.bind(console);for(r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);n=null,e.arguments&&e.arguments;var p=0,m=function(H){p=H},v=function(){return p},w=8;function T(H,ee,oe,ge){switch(oe=oe||"i8",oe.charAt(oe.length-1)==="*"&&(oe="i32"),oe){case"i1":Le[H>>0]=ee;break;case"i8":Le[H>>0]=ee;break;case"i16":Ae[H>>1]=ee;break;case"i32":Re[H>>2]=ee;break;case"i64":aa=[ee>>>0,(fi=ee,+Ql(fi)>=1?fi>0?(mf(+gf(fi/4294967296),4294967295)|0)>>>0:~~+pf((fi-+(~~fi>>>0))/4294967296)>>>0:0)],Re[H>>2]=aa[0],Re[H+4>>2]=aa[1];break;case"float":At[H>>2]=ee;break;case"double":it[H>>3]=ee;break;default:Ee("invalid type for setValue: "+oe)}}function E(H,ee,oe){switch(ee=ee||"i8",ee.charAt(ee.length-1)==="*"&&(ee="i32"),ee){case"i1":return Le[H>>0];case"i8":return Le[H>>0];case"i16":return Ae[H>>1];case"i32":return Re[H>>2];case"i64":return Re[H>>2];case"float":return At[H>>2];case"double":return it[H>>3];default:Ee("invalid type for getValue: "+ee)}return null}var I=!1;function U(H,ee){H||Ee("Assertion failed: "+ee)}function R(H){var ee=e["_"+H];return U(ee,"Cannot call unknown function "+H+", make sure it is exported"),ee}function P(H,ee,oe,ge,c){var k={string:function(Ue){var bt=0;if(Ue!=null&&Ue!==0){var Sn=(Ue.length<<2)+1;bt=Aa(Sn),ae(Ue,bt,Sn)}return bt},array:function(Ue){var bt=Aa(Ue.length);return he(Ue,bt),bt}};function we(Ue){return ee==="string"?q(Ue):ee==="boolean"?!!Ue:Ue}var Oe=R(H),ze=[],Me=0;if(ge)for(var je=0;je<ge.length;je++){var Mt=k[oe[je]];Mt?(Me===0&&(Me=Gl()),ze[je]=Mt(ge[je])):ze[je]=ge[je]}var Ie=Oe.apply(null,ze);return Ie=we(Ie),Me!==0&&ql(Me),Ie}function C(H,ee,oe,ge){oe=oe||[];var c=oe.every(function(we){return we==="number"}),k=ee!=="string";return k&&c&&!ge?R(H):function(){return P(H,ee,oe,arguments)}}var D=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function $(H,ee,oe){for(var ge=ee+oe,c=ee;H[c]&&!(c>=ge);)++c;if(c-ee>16&&H.subarray&&D)return D.decode(H.subarray(ee,c));for(var k="";ee<c;){var we=H[ee++];if(!(we&128)){k+=String.fromCharCode(we);continue}var Oe=H[ee++]&63;if((we&224)==192){k+=String.fromCharCode((we&31)<<6|Oe);continue}var ze=H[ee++]&63;if((we&240)==224?we=(we&15)<<12|Oe<<6|ze:we=(we&7)<<18|Oe<<12|ze<<6|H[ee++]&63,we<65536)k+=String.fromCharCode(we);else{var Me=we-65536;k+=String.fromCharCode(55296|Me>>10,56320|Me&1023)}}return k}function q(H,ee){return H?$(Ve,H,ee):""}function fe(H,ee,oe,ge){if(!(ge>0))return 0;for(var c=oe,k=oe+ge-1,we=0;we<H.length;++we){var Oe=H.charCodeAt(we);if(Oe>=55296&&Oe<=57343){var ze=H.charCodeAt(++we);Oe=65536+((Oe&1023)<<10)|ze&1023}if(Oe<=127){if(oe>=k)break;ee[oe++]=Oe}else if(Oe<=2047){if(oe+1>=k)break;ee[oe++]=192|Oe>>6,ee[oe++]=128|Oe&63}else if(Oe<=65535){if(oe+2>=k)break;ee[oe++]=224|Oe>>12,ee[oe++]=128|Oe>>6&63,ee[oe++]=128|Oe&63}else{if(oe+3>=k)break;ee[oe++]=240|Oe>>18,ee[oe++]=128|Oe>>12&63,ee[oe++]=128|Oe>>6&63,ee[oe++]=128|Oe&63}}return ee[oe]=0,oe-c}function ae(H,ee,oe){return fe(H,Ve,ee,oe)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function he(H,ee){Le.set(H,ee)}function ye(H,ee){return H%ee>0&&(H+=ee-H%ee),H}var ke,Le,Ve,Ae,Re,At,it;function Te(H){ke=H,e.HEAP8=Le=new Int8Array(H),e.HEAP16=Ae=new Int16Array(H),e.HEAP32=Re=new Int32Array(H),e.HEAPU8=Ve=new Uint8Array(H),e.HEAPU16=new Uint16Array(H),e.HEAPU32=new Uint32Array(H),e.HEAPF32=At=new Float32Array(H),e.HEAPF64=it=new Float64Array(H)}var Fe=5267040,be=24128,rt=e.TOTAL_MEMORY||33554432;e.buffer?ke=e.buffer:ke=new ArrayBuffer(rt),rt=ke.byteLength,Te(ke),Re[be>>2]=Fe;function qe(H){for(;H.length>0;){var ee=H.shift();if(typeof ee=="function"){ee();continue}var oe=ee.func;typeof oe=="number"?ee.arg===void 0?e.dynCall_v(oe):e.dynCall_vi(oe,ee.arg):oe(ee.arg===void 0?null:ee.arg)}}var hn=[],Sr=[],Us=[],kt=[];function sn(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)sa(e.preRun.shift());qe(hn)}function Hr(){qe(Sr)}function ff(){qe(Us)}function hf(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)df(e.postRun.shift());qe(kt)}function sa(H){hn.unshift(H)}function df(H){kt.unshift(H)}var Ql=Math.abs,pf=Math.ceil,gf=Math.floor,mf=Math.min,Xr=0,Gi=null;function _f(H){Xr++,e.monitorRunDependencies&&e.monitorRunDependencies(Xr)}function yf(H){if(Xr--,e.monitorRunDependencies&&e.monitorRunDependencies(Xr),Xr==0&&Gi){var ee=Gi;Gi=null,ee()}}e.preloadedImages={},e.preloadedAudios={};var fr=null,oa="data:application/octet-stream;base64,";function Yl(H){return String.prototype.startsWith?H.startsWith(oa):H.indexOf(oa)===0}var fi,aa;fr="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAOgehWlKfUEEz1zLi+JsiQa2og3wcMfVAWCbHorc0yEDi+Yn/Y6mbQJ11/mfsnG9At6bnG4UQQkBvMCQWKqUUQJVmwwswmOc/3hVgVBL3uj//qqOEOdGOPw/WDN4gnGE/H3ANkCUgND+AA8btKgAHPwTXBqJVSdo+XfRQAqsKrj4fc+zLYbSPQklEmCZHv2FCUP+uDso1NEKYtPhwphUHQptxnyFXYdpB7CddZAMmrkGAt1AxSTqBQUibBVdTsFNBSuX3MV+AJkFocv82SLf5QAqmgj7AY81A23VDSEnLoEDGEJVSeDFzQDYrqvBk70VA8U157pcRGUBWfEF+ZKbsP7KBdLHZTpFAqKYk69AqekDbeGY41MdjQD8AZzHK501A1vcrrjubNkD5LnquvBYhQCbiRRD71QlAqt72EbOH8z8Eu+jL1YbdP4uaox/xUcY/abedg1XfsD+BsUdzJ4KZP5wE9YFySIM/rW1kAKMpbT+rZFthVRhWPy4PKlXIs0A/qMZLlwDnMEHByqEF0I0ZQQYSFD8lUQNBPpY+dFs07UAH8BZImBPWQN9RY0I0sMBA2T7kLfc6qUByFYvfhBKTQMq+0Mis1XxA0XQbeQXMZUBJJ5aEGXpQQP7/SY0a6ThAaMD92b/UIkAs8s8yqXoMQNIegOvCk/U/aOi7NZJP4D8AAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAD/////AAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAA/////wAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAP////8AAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////BQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAQAAAAEAAAABAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAUAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAEAAQAAAQEAAAAAAAEAAAABAAAAAQABAAAAAAAAAAAAAAAAAAAAAAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAAGFsZ29zLmMAaDNOZWlnaGJvclJvdGF0aW9ucwBjb29yZGlqay5jAF91cEFwN0NoZWNrZWQAX3VwQXA3ckNoZWNrZWQAZGlyZWN0ZWRFZGdlLmMAZGlyZWN0ZWRFZGdlVG9Cb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbdG1wRmlqay5mYWNlXVtmaWprLmZhY2VdID09IEtJAGZhY2VpamsuYwBfZmFjZUlqa1BlbnRUb0NlbGxCb3VuZGFyeQBhZGphY2VudEZhY2VEaXJbY2VudGVySUpLLmZhY2VdW2ZhY2UyXSA9PSBLSQBfZmFjZUlqa1RvQ2VsbEJvdW5kYXJ5AGgzSW5kZXguYwBjb21wYWN0Q2VsbHMAbGF0TG5nVG9DZWxsAGNlbGxUb0NoaWxkUG9zAHZhbGlkYXRlQ2hpbGRQb3MAbGF0TG5nLmMAY2VsbEFyZWFSYWRzMgBwb2x5Z29uLT5uZXh0ID09IE5VTEwAbGlua2VkR2VvLmMAYWRkTmV3TGlua2VkUG9seWdvbgBuZXh0ICE9IE5VTEwAbG9vcCAhPSBOVUxMAGFkZE5ld0xpbmtlZExvb3AAcG9seWdvbi0+Zmlyc3QgPT0gTlVMTABhZGRMaW5rZWRMb29wAGNvb3JkICE9IE5VTEwAYWRkTGlua2VkQ29vcmQAbG9vcC0+Zmlyc3QgPT0gTlVMTABpbm5lckxvb3BzICE9IE5VTEwAbm9ybWFsaXplTXVsdGlQb2x5Z29uAGJib3hlcyAhPSBOVUxMAGNhbmRpZGF0ZXMgIT0gTlVMTABmaW5kUG9seWdvbkZvckhvbGUAY2FuZGlkYXRlQkJveGVzICE9IE5VTEwAcmV2RGlyICE9IElOVkFMSURfRElHSVQAbG9jYWxpai5jAGNlbGxUb0xvY2FsSWprAGJhc2VDZWxsICE9IG9yaWdpbkJhc2VDZWxsACEob3JpZ2luT25QZW50ICYmIGluZGV4T25QZW50KQBiYXNlQ2VsbCA9PSBvcmlnaW5CYXNlQ2VsbABiYXNlQ2VsbCAhPSBJTlZBTElEX0JBU0VfQ0VMTABsb2NhbElqa1RvQ2VsbAAhX2lzQmFzZUNlbGxQZW50YWdvbihiYXNlQ2VsbCkAYmFzZUNlbGxSb3RhdGlvbnMgPj0gMABncmlkUGF0aENlbGxzADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var vf=24144;function wf(H,ee,oe,ge){Ee("Assertion failed: "+q(H)+", at: "+[ee?q(ee):"unknown filename",oe,ge?q(ge):"unknown function"])}function Kl(){return Le.length}function bf(H,ee,oe){Ve.set(Ve.subarray(ee,ee+oe),H)}function xf(H){return e.___errno_location&&(Re[e.___errno_location()>>2]=H),H}function Tf(H){Ee("OOM")}function Ef(H){try{var ee=new ArrayBuffer(H);return ee.byteLength!=H?void 0:(new Int8Array(ee).set(Le),Rf(ee),Te(ee),1)}catch{}}function Sf(H){var ee=Kl(),oe=16777216,ge=2147483648-oe;if(H>ge)return!1;for(var c=16777216,k=Math.max(ee,c);k<H;)k<=536870912?k=ye(2*k,oe):k=Math.min(ye((3*k+2147483648)/4,oe),ge);var we=Ef(k);return!!we}var Zl=typeof atob=="function"?atob:function(H){var ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",oe="",ge,c,k,we,Oe,ze,Me,je=0;H=H.replace(/[^A-Za-z0-9\+\/\=]/g,"");do we=ee.indexOf(H.charAt(je++)),Oe=ee.indexOf(H.charAt(je++)),ze=ee.indexOf(H.charAt(je++)),Me=ee.indexOf(H.charAt(je++)),ge=we<<2|Oe>>4,c=(Oe&15)<<4|ze>>2,k=(ze&3)<<6|Me,oe=oe+String.fromCharCode(ge),ze!==64&&(oe=oe+String.fromCharCode(c)),Me!==64&&(oe=oe+String.fromCharCode(k));while(je<H.length);return oe};function Cf(H){try{for(var ee=Zl(H),oe=new Uint8Array(ee.length),ge=0;ge<ee.length;++ge)oe[ge]=ee.charCodeAt(ge);return oe}catch{throw new Error("Converting base64 string to bytes failed.")}}function la(H){if(Yl(H))return Cf(H.slice(oa.length))}var Pf={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},kf={b:m,c:v,d:wf,e:xf,f:Kl,g:bf,h:Sf,i:Tf,o:vf,p:be},pe=function(H,ee,oe){"almost asm";var ge=new H.Int8Array(oe),c=new H.Int32Array(oe);new H.Uint8Array(oe),new H.Float32Array(oe);var k=new H.Float64Array(oe),we=ee.o|0,Oe=ee.p|0,ze=H.Math.floor,Me=H.Math.abs,je=H.Math.sqrt,Mt=H.Math.pow,Ie=H.Math.cos,Ue=H.Math.sin,bt=H.Math.tan,Sn=H.Math.acos,On=H.Math.asin,Gn=H.Math.atan,Nt=H.Math.atan2,Cr=H.Math.ceil,zn=H.Math.imul,Jl=H.Math.min,Mg=H.Math.max,Qr=H.Math.clz32,Xe=ee.b,F=ee.c,We=ee.d,Ng=ee.e,Ox=ee.f,Dx=ee.g,Bx=ee.h,Fx=ee.i,N=24160;function Lx(A){return ge=new Int8Array(A),c=new Int32Array(A),k=new Float64Array(A),oe=A,!0}function Ux(A){A=A|0;var l=0;return l=N,N=N+A|0,N=N+15&-16,l|0}function Vx(){return N|0}function zx(A){A=A|0,N=A}function jx(A,l){A=A|0,N=A}function Wx(A,l){A=A|0,l=l|0;var u=0,h=0,d=0;return(A|0)<0?(l=2,l|0):(A|0)>13780509?(l=Hf(15,l)|0,l|0):(u=((A|0)<0)<<31>>31,d=gn(A|0,u|0,3,0)|0,h=F()|0,u=st(A|0,u|0,1,0)|0,u=gn(d|0,h|0,u|0,F()|0)|0,u=st(u|0,F()|0,1,0)|0,A=F()|0,c[l>>2]=u,c[l+4>>2]=A,l=0,l|0)}function Og(A,l,u,h){return A=A|0,l=l|0,u=u|0,h=h|0,Dg(A,l,u,h,0)|0}function Dg(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0;if(b=N,N=N+16|0,_=b,!(Bg(A,l,u,h,d)|0))return h=0,N=b,h|0;do if((u|0)>=0){if((u|0)>13780509){if(g=Hf(15,_)|0,g|0)break;y=_,_=c[y>>2]|0,y=c[y+4>>2]|0}else g=((u|0)<0)<<31>>31,x=gn(u|0,g|0,3,0)|0,y=F()|0,g=st(u|0,g|0,1,0)|0,g=gn(x|0,y|0,g|0,F()|0)|0,g=st(g|0,F()|0,1,0)|0,y=F()|0,c[_>>2]=g,c[_+4>>2]=y,_=g;if(is(h|0,0,_<<3|0)|0,d|0){is(d|0,0,_<<2|0)|0,g=Yr(A,l,u,h,d,_,y,0)|0;break}g=kr(_,4)|0,g?(x=Yr(A,l,u,h,g,_,y,0)|0,Qe(g),g=x):g=13}else g=2;while(!1);return x=g,N=b,x|0}function Bg(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0;if(G=N,N=N+16|0,j=G,V=G+8|0,z=j,c[z>>2]=A,c[z+4>>2]=l,(u|0)<0)return V=2,N=G,V|0;if(g=h,c[g>>2]=A,c[g+4>>2]=l,g=(d|0)!=0,g&&(c[d>>2]=0),Tt(A,l)|0)return V=9,N=G,V|0;c[V>>2]=0;e:do if((u|0)>=1)if(g)for(S=1,x=0,O=0,z=1,g=A;;){if(!(x|O)){if(g=en(g,l,4,V,j)|0,g|0)break e;if(l=j,g=c[l>>2]|0,l=c[l+4>>2]|0,Tt(g,l)|0){g=9;break e}}if(g=en(g,l,c[22384+(O<<2)>>2]|0,V,j)|0,g|0)break e;if(l=j,g=c[l>>2]|0,l=c[l+4>>2]|0,A=h+(S<<3)|0,c[A>>2]=g,c[A+4>>2]=l,c[d+(S<<2)>>2]=z,A=x+1|0,_=(A|0)==(z|0),y=O+1|0,b=(y|0)==6,Tt(g,l)|0){g=9;break e}if(z=z+(b&_&1)|0,(z|0)>(u|0)){g=0;break}else S=S+1|0,x=_?0:A,O=_?b?0:y:O}else for(S=1,x=0,O=0,z=1,g=A;;){if(!(x|O)){if(g=en(g,l,4,V,j)|0,g|0)break e;if(l=j,g=c[l>>2]|0,l=c[l+4>>2]|0,Tt(g,l)|0){g=9;break e}}if(g=en(g,l,c[22384+(O<<2)>>2]|0,V,j)|0,g|0)break e;if(l=j,g=c[l>>2]|0,l=c[l+4>>2]|0,A=h+(S<<3)|0,c[A>>2]=g,c[A+4>>2]=l,A=x+1|0,_=(A|0)==(z|0),y=O+1|0,b=(y|0)==6,Tt(g,l)|0){g=9;break e}if(z=z+(b&_&1)|0,(z|0)>(u|0)){g=0;break}else S=S+1|0,x=_?0:A,O=_?b?0:y:O}else g=0;while(!1);return V=g,N=G,V|0}function Yr(A,l,u,h,d,g,_,y){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0,g=g|0,_=_|0,y=y|0;var b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0;if(G=N,N=N+16|0,j=G+8|0,V=G,b=$s(A|0,l|0,g|0,_|0)|0,S=F()|0,O=h+(b<<3)|0,se=O,ie=c[se>>2]|0,se=c[se+4>>2]|0,x=(ie|0)==(A|0)&(se|0)==(l|0),!((ie|0)==0&(se|0)==0|x))do b=st(b|0,S|0,1,0)|0,b=sA(b|0,F()|0,g|0,_|0)|0,S=F()|0,O=h+(b<<3)|0,ie=O,se=c[ie>>2]|0,ie=c[ie+4>>2]|0,x=(se|0)==(A|0)&(ie|0)==(l|0);while(!((se|0)==0&(ie|0)==0|x));if(b=d+(b<<2)|0,x&&(c[b>>2]|0)<=(y|0)||(ie=O,c[ie>>2]=A,c[ie+4>>2]=l,c[b>>2]=y,(y|0)>=(u|0)))return ie=0,N=G,ie|0;switch(x=y+1|0,c[j>>2]=0,b=en(A,l,2,j,V)|0,b|0){case 9:{z=9;break}case 0:{b=V,b=Yr(c[b>>2]|0,c[b+4>>2]|0,u,h,d,g,_,x)|0,b||(z=9);break}}e:do if((z|0)==9){switch(c[j>>2]=0,b=en(A,l,3,j,V)|0,b|0){case 9:break;case 0:{if(b=V,b=Yr(c[b>>2]|0,c[b+4>>2]|0,u,h,d,g,_,x)|0,b|0)break e;break}default:break e}switch(c[j>>2]=0,b=en(A,l,1,j,V)|0,b|0){case 9:break;case 0:{if(b=V,b=Yr(c[b>>2]|0,c[b+4>>2]|0,u,h,d,g,_,x)|0,b|0)break e;break}default:break e}switch(c[j>>2]=0,b=en(A,l,5,j,V)|0,b|0){case 9:break;case 0:{if(b=V,b=Yr(c[b>>2]|0,c[b+4>>2]|0,u,h,d,g,_,x)|0,b|0)break e;break}default:break e}switch(c[j>>2]=0,b=en(A,l,4,j,V)|0,b|0){case 9:break;case 0:{if(b=V,b=Yr(c[b>>2]|0,c[b+4>>2]|0,u,h,d,g,_,x)|0,b|0)break e;break}default:break e}switch(c[j>>2]=0,b=en(A,l,6,j,V)|0,b|0){case 9:break;case 0:{if(b=V,b=Yr(c[b>>2]|0,c[b+4>>2]|0,u,h,d,g,_,x)|0,b|0)break e;break}default:break e}return ie=0,N=G,ie|0}while(!1);return ie=b,N=G,ie|0}function en(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0;if(u>>>0>6)return d=1,d|0;if(O=(c[h>>2]|0)%6|0,c[h>>2]=O,(O|0)>0){g=0;do u=ts(u)|0,g=g+1|0;while((g|0)<(c[h>>2]|0))}if(O=de(A|0,l|0,45)|0,F()|0,S=O&127,S>>>0>121)return d=5,d|0;b=Dn(A,l)|0,g=de(A|0,l|0,52)|0,F()|0,g=g&15;e:do if(!g)x=8;else{for(;;){if(_=(15-g|0)*3|0,y=de(A|0,l|0,_|0)|0,F()|0,y=y&7,(y|0)==7){l=5;break}if(V=(Jn(g)|0)==0,g=g+-1|0,z=xe(7,0,_|0)|0,l=l&~(F()|0),j=xe(c[(V?432:16)+(y*28|0)+(u<<2)>>2]|0,0,_|0)|0,_=F()|0,u=c[(V?640:224)+(y*28|0)+(u<<2)>>2]|0,A=j|A&~z,l=_|l,!u){u=0;break e}if(!g){x=8;break e}}return l|0}while(!1);(x|0)==8&&(V=c[848+(S*28|0)+(u<<2)>>2]|0,j=xe(V|0,0,45)|0,A=j|A,l=F()|0|l&-1040385,u=c[4272+(S*28|0)+(u<<2)>>2]|0,(V&127|0)==127&&(V=xe(c[848+(S*28|0)+20>>2]|0,0,45)|0,l=F()|0|l&-1040385,u=c[4272+(S*28|0)+20>>2]|0,A=ns(V|A,l)|0,l=F()|0,c[h>>2]=(c[h>>2]|0)+1)),y=de(A|0,l|0,45)|0,F()|0,y=y&127;e:do if(xt(y)|0){t:do if((Dn(A,l)|0)==1){if((S|0)!=(y|0))if(Ug(y,c[7696+(S*28|0)>>2]|0)|0){A=jf(A,l)|0,_=1,l=F()|0;break}else We(23313,22416,436,22424);switch(b|0){case 3:{A=ns(A,l)|0,l=F()|0,c[h>>2]=(c[h>>2]|0)+1,_=0;break t}case 5:{A=jf(A,l)|0,l=F()|0,c[h>>2]=(c[h>>2]|0)+5,_=0;break t}case 0:return V=9,V|0;default:return V=1,V|0}}else _=0;while(!1);if((u|0)>0){g=0;do A=zf(A,l)|0,l=F()|0,g=g+1|0;while((g|0)!=(u|0))}if((S|0)!=(y|0)){if(!(Mf(y)|0)){if((_|0)!=0|(Dn(A,l)|0)!=5)break;c[h>>2]=(c[h>>2]|0)+1;break}switch(O&127){case 8:case 118:break e}(Dn(A,l)|0)!=3&&(c[h>>2]=(c[h>>2]|0)+1)}}else if((u|0)>0){g=0;do A=ns(A,l)|0,l=F()|0,g=g+1|0;while((g|0)!=(u|0))}while(!1);return c[h>>2]=((c[h>>2]|0)+u|0)%6|0,V=d,c[V>>2]=A,c[V+4>>2]=l,V=0,V|0}function If(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0;for(y=N,N=N+16|0,g=y,_=y+8|0,d=(Tt(A,l)|0)==0,d=d?1:2;;){if(c[_>>2]=0,x=(en(A,l,d,_,g)|0)==0,b=g,x&((c[b>>2]|0)==(u|0)?(c[b+4>>2]|0)==(h|0):0)){A=4;break}if(d=d+1|0,d>>>0>=7){d=7,A=4;break}}return(A|0)==4?(N=y,d|0):0}function $x(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0;if(V=N,N=N+16|0,z=V,j=V+8|0,O=z,c[O>>2]=A,c[O+4>>2]=l,!u)return j=h,c[j>>2]=A,c[j+4>>2]=l,j=0,N=V,j|0;c[j>>2]=0;e:do if(Tt(A,l)|0)A=9;else{if(g=(u|0)>0,g){d=0,O=A;do{if(A=en(O,l,4,j,z)|0,A|0)break e;if(l=z,O=c[l>>2]|0,l=c[l+4>>2]|0,d=d+1|0,Tt(O,l)|0){A=9;break e}}while((d|0)<(u|0));if(S=h,c[S>>2]=O,c[S+4>>2]=l,S=u+-1|0,g){x=0,A=1;do{if(d=22384+(x<<2)|0,(x|0)==5)for(_=c[d>>2]|0,g=0,d=A;;){if(A=z,A=en(c[A>>2]|0,c[A+4>>2]|0,_,j,z)|0,A|0)break e;if((g|0)!=(S|0))if(b=z,y=c[b>>2]|0,b=c[b+4>>2]|0,A=h+(d<<3)|0,c[A>>2]=y,c[A+4>>2]=b,!(Tt(y,b)|0))A=d+1|0;else{A=9;break e}else A=d;if(g=g+1|0,(g|0)>=(u|0))break;d=A}else for(_=z,b=c[d>>2]|0,y=0,d=A,g=c[_>>2]|0,_=c[_+4>>2]|0;;){if(A=en(g,_,b,j,z)|0,A|0)break e;if(_=z,g=c[_>>2]|0,_=c[_+4>>2]|0,A=h+(d<<3)|0,c[A>>2]=g,c[A+4>>2]=_,A=d+1|0,Tt(g,_)|0){A=9;break e}if(y=y+1|0,(y|0)>=(u|0))break;d=A}x=x+1|0}while(x>>>0<6);A=z,_=O,d=c[A>>2]|0,g=l,A=c[A+4>>2]|0}else _=O,d=O,g=l,A=l}else _=h,c[_>>2]=A,c[_+4>>2]=l,_=A,d=A,g=l,A=l;A=(_|0)==(d|0)&(g|0)==(A|0)?0:9}while(!1);return j=A,N=V,j|0}function Hx(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0;if(y=N,N=N+48|0,d=y+16|0,g=y+8|0,_=y,u|0)return _=15,N=y,_|0;if(x=A,b=c[x+4>>2]|0,u=g,c[u>>2]=c[x>>2],c[u+4>>2]=b,lm(g,d),l=jg(d,l,_)|0,!l){if(u=c[g>>2]|0,g=c[A+8>>2]|0,(g|0)>0){d=c[A+12>>2]|0,l=0;do u=(c[d+(l<<3)>>2]|0)+u|0,l=l+1|0;while((l|0)<(g|0))}l=_,d=c[l>>2]|0,l=c[l+4>>2]|0,g=((u|0)<0)<<31>>31,(l|0)<(g|0)|(l|0)==(g|0)&d>>>0<u>>>0?(l=_,c[l>>2]=u,c[l+4>>2]=g,l=g):u=d,b=st(u|0,l|0,12,0)|0,x=F()|0,l=_,c[l>>2]=b,c[l+4>>2]=x,l=h,c[l>>2]=b,c[l+4>>2]=x,l=0}return x=l,N=y,x|0}function Fg(A,l,u,h,d,g,_){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0,g=g|0,_=_|0;var y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0,Z=0,Se=0,Ne=0,ve=0,Ce=0,ht=0,lt=0,ct=0,Je=0,Ge=0,et=0,gt=0,Ye=0,vt=0,Pn=0,ym=0;if(gt=N,N=N+64|0,ct=gt+48|0,Je=gt+32|0,Ge=gt+24|0,Se=gt+8|0,Ne=gt,b=c[A>>2]|0,(b|0)<=0)return et=0,N=gt,et|0;for(ve=A+4|0,Ce=ct+8|0,ht=Je+8|0,lt=Se+8|0,y=0,re=0;;){x=c[ve>>2]|0,ne=x+(re<<4)|0,c[ct>>2]=c[ne>>2],c[ct+4>>2]=c[ne+4>>2],c[ct+8>>2]=c[ne+8>>2],c[ct+12>>2]=c[ne+12>>2],(re|0)==(b+-1|0)?(c[Je>>2]=c[x>>2],c[Je+4>>2]=c[x+4>>2],c[Je+8>>2]=c[x+8>>2],c[Je+12>>2]=c[x+12>>2]):(ne=x+(re+1<<4)|0,c[Je>>2]=c[ne>>2],c[Je+4>>2]=c[ne+4>>2],c[Je+8>>2]=c[ne+8>>2],c[Je+12>>2]=c[ne+12>>2]),b=eT(ct,Je,h,Ge)|0;e:do if(b)x=0,y=b;else if(x=Ge,b=c[x>>2]|0,x=c[x+4>>2]|0,(x|0)>0|(x|0)==0&b>>>0>0){ie=0,ne=0;t:for(;;){if(ym=+k[ct>>3],se=pn(b|0,x|0,ie|0,ne|0)|0,Pn=+(se>>>0)+4294967296*+(F()|0),Ye=+(b>>>0)+4294967296*+(x|0),vt=+(ie>>>0)+4294967296*+(ne|0),k[Se>>3]=ym*Pn/Ye+ +k[Je>>3]*vt/Ye,k[lt>>3]=+k[Ce>>3]*Pn/Ye+ +k[ht>>3]*vt/Ye,b=Jg(Se,h,Ne)|0,b|0){y=b;break}se=Ne,G=c[se>>2]|0,se=c[se+4>>2]|0,z=$s(G|0,se|0,l|0,u|0)|0,S=F()|0,b=_+(z<<3)|0,O=b,x=c[O>>2]|0,O=c[O+4>>2]|0;n:do if((x|0)==0&(O|0)==0)Z=b,et=16;else for(j=0,V=0;;){if((j|0)>(u|0)|(j|0)==(u|0)&V>>>0>l>>>0){y=1;break t}if((x|0)==(G|0)&(O|0)==(se|0))break n;if(b=st(z|0,S|0,1,0)|0,z=sA(b|0,F()|0,l|0,u|0)|0,S=F()|0,V=st(V|0,j|0,1,0)|0,j=F()|0,b=_+(z<<3)|0,O=b,x=c[O>>2]|0,O=c[O+4>>2]|0,(x|0)==0&(O|0)==0){Z=b,et=16;break}}while(!1);if((et|0)==16&&(et=0,!((G|0)==0&(se|0)==0))&&(V=Z,c[V>>2]=G,c[V+4>>2]=se,V=g+(c[d>>2]<<3)|0,c[V>>2]=G,c[V+4>>2]=se,V=d,V=st(c[V>>2]|0,c[V+4>>2]|0,1,0)|0,G=F()|0,se=d,c[se>>2]=V,c[se+4>>2]=G),ie=st(ie|0,ne|0,1,0)|0,ne=F()|0,x=Ge,b=c[x>>2]|0,x=c[x+4>>2]|0,!((x|0)>(ne|0)|(x|0)==(ne|0)&b>>>0>ie>>>0)){x=1;break e}}x=0}else x=1;while(!1);if(re=re+1|0,!x){et=21;break}if(b=c[A>>2]|0,(re|0)>=(b|0)){y=0,et=21;break}}return(et|0)==21?(N=gt,y|0):0}function Xx(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0,Z=0,Se=0,Ne=0,ve=0,Ce=0,ht=0,lt=0,ct=0,Je=0,Ge=0,et=0,gt=0,Ye=0,vt=0,Pn=0;if(Pn=N,N=N+112|0,et=Pn+80|0,b=Pn+72|0,gt=Pn,Ye=Pn+56|0,u|0)return vt=15,N=Pn,vt|0;if(x=A+8|0,vt=Pr((c[x>>2]<<5)+32|0)|0,!vt)return vt=13,N=Pn,vt|0;if(nE(A,vt),Je=A,Ge=c[Je+4>>2]|0,u=b,c[u>>2]=c[Je>>2],c[u+4>>2]=Ge,lm(b,et),u=jg(et,l,gt)|0,u)Je=0,Ge=0;else{if(u=c[b>>2]|0,g=c[x>>2]|0,(g|0)>0){_=c[A+12>>2]|0,d=0;do u=(c[_+(d<<3)>>2]|0)+u|0,d=d+1|0;while((d|0)!=(g|0));d=u}else d=u;u=gt,g=c[u>>2]|0,u=c[u+4>>2]|0,_=((d|0)<0)<<31>>31,(u|0)<(_|0)|(u|0)==(_|0)&g>>>0<d>>>0?(u=gt,c[u>>2]=d,c[u+4>>2]=_,u=_):d=g,Je=st(d|0,u|0,12,0)|0,Ge=F()|0,u=gt,c[u>>2]=Je,c[u+4>>2]=Ge,u=0}if(u|0)return Qe(vt),vt=u,N=Pn,vt|0;if(d=kr(Je,8)|0,!d)return Qe(vt),vt=13,N=Pn,vt|0;if(y=kr(Je,8)|0,!y)return Qe(vt),Qe(d),vt=13,N=Pn,vt|0;lt=et,c[lt>>2]=0,c[lt+4>>2]=0,lt=A,ct=c[lt+4>>2]|0,u=b,c[u>>2]=c[lt>>2],c[u+4>>2]=ct,u=Fg(b,Je,Ge,l,et,d,y)|0;e:do if(u)Qe(d),Qe(y),Qe(vt);else{t:do if((c[x>>2]|0)>0){for(_=A+12|0,g=0;u=Fg((c[_>>2]|0)+(g<<3)|0,Je,Ge,l,et,d,y)|0,g=g+1|0,!(u|0);)if((g|0)>=(c[x>>2]|0))break t;Qe(d),Qe(y),Qe(vt);break e}while(!1);(Ge|0)>0|(Ge|0)==0&Je>>>0>0&&is(y|0,0,Je<<3|0)|0,ct=et,lt=c[ct+4>>2]|0;t:do if((lt|0)>0|(lt|0)==0&(c[ct>>2]|0)>>>0>0){ve=d,Ce=y,ht=d,lt=y,ct=d,u=d,Z=d,Se=y,Ne=y,d=y;n:for(;;){for(se=0,ie=0,ne=0,re=0,g=0,_=0;;){y=gt,b=y+56|0;do c[y>>2]=0,y=y+4|0;while((y|0)<(b|0));if(l=ve+(se<<3)|0,x=c[l>>2]|0,l=c[l+4>>2]|0,Bg(x,l,1,gt,0)|0){y=gt,b=y+56|0;do c[y>>2]=0,y=y+4|0;while((y|0)<(b|0));y=kr(7,4)|0,y|0&&(Yr(x,l,1,gt,y,7,0,0)|0,Qe(y))}for(G=0;;){V=gt+(G<<3)|0,j=c[V>>2]|0,V=c[V+4>>2]|0;r:do if((j|0)==0&(V|0)==0)y=g,b=_;else{if(S=$s(j|0,V|0,Je|0,Ge|0)|0,x=F()|0,y=h+(S<<3)|0,l=y,b=c[l>>2]|0,l=c[l+4>>2]|0,!((b|0)==0&(l|0)==0)){O=0,z=0;do{if((O|0)>(Ge|0)|(O|0)==(Ge|0)&z>>>0>Je>>>0)break n;if((b|0)==(j|0)&(l|0)==(V|0)){y=g,b=_;break r}y=st(S|0,x|0,1,0)|0,S=sA(y|0,F()|0,Je|0,Ge|0)|0,x=F()|0,z=st(z|0,O|0,1,0)|0,O=F()|0,y=h+(S<<3)|0,l=y,b=c[l>>2]|0,l=c[l+4>>2]|0}while(!((b|0)==0&(l|0)==0))}(j|0)==0&(V|0)==0?(y=g,b=_):(da(j,V,Ye)|0,rE(A,vt,Ye)|0&&(z=st(g|0,_|0,1,0)|0,_=F()|0,O=y,c[O>>2]=j,c[O+4>>2]=V,g=Ce+(g<<3)|0,c[g>>2]=j,c[g+4>>2]=V,g=z),y=g,b=_)}while(!1);if(G=G+1|0,G>>>0>=7)break;g=y,_=b}if(se=st(se|0,ie|0,1,0)|0,ie=F()|0,ne=st(ne|0,re|0,1,0)|0,re=F()|0,_=et,g=c[_>>2]|0,_=c[_+4>>2]|0,(re|0)<(_|0)|(re|0)==(_|0)&ne>>>0<g>>>0)g=y,_=b;else break}if((_|0)>0|(_|0)==0&g>>>0>0){g=0,_=0;do re=ve+(g<<3)|0,c[re>>2]=0,c[re+4>>2]=0,g=st(g|0,_|0,1,0)|0,_=F()|0,re=et,ne=c[re+4>>2]|0;while((_|0)<(ne|0)|((_|0)==(ne|0)?g>>>0<(c[re>>2]|0)>>>0:0))}if(re=et,c[re>>2]=y,c[re+4>>2]=b,(b|0)>0|(b|0)==0&y>>>0>0)G=d,se=Ne,ie=ct,ne=Se,re=Ce,d=Z,Ne=u,Se=ht,Z=G,u=se,ct=lt,lt=ie,ht=ne,Ce=ve,ve=re;else break t}Qe(ht),Qe(lt),Qe(vt),u=1;break e}else u=y;while(!1);Qe(vt),Qe(d),Qe(u),u=0}while(!1);return vt=u,N=Pn,vt|0}function Qx(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0;if(S=N,N=N+176|0,b=S,(l|0)<1)return um(u,0,0),x=0,N=S,x|0;for(y=A,y=de(c[y>>2]|0,c[y+4>>2]|0,52)|0,F()|0,um(u,(l|0)>6?l:6,y&15),y=0;h=A+(y<<3)|0,h=pa(c[h>>2]|0,c[h+4>>2]|0,b)|0,!(h|0);){if(h=c[b>>2]|0,(h|0)>0){_=0;do g=b+8+(_<<4)|0,_=_+1|0,h=b+8+(((_|0)%(h|0)|0)<<4)|0,d=yE(u,h,g)|0,d?dm(u,d)|0:_E(u,g,h)|0,h=c[b>>2]|0;while((_|0)<(h|0))}if(y=y+1|0,(y|0)>=(l|0)){h=0,x=13;break}}return(x|0)==13?(N=S,h|0):(fm(u),x=h,N=S,x|0)}function Yx(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0;if(g=N,N=N+32|0,h=g,d=g+16|0,A=Qx(A,l,d)|0,A|0)return u=A,N=g,u|0;if(c[u>>2]=0,c[u+4>>2]=0,c[u+8>>2]=0,A=hm(d)|0,A|0)do{l=YT(u)|0;do KT(l,A)|0,_=A+16|0,c[h>>2]=c[_>>2],c[h+4>>2]=c[_+4>>2],c[h+8>>2]=c[_+8>>2],c[h+12>>2]=c[_+12>>2],dm(d,A)|0,A=vE(d,h)|0;while(A|0);A=hm(d)|0}while(A|0);return fm(d),A=ZT(u)|0,A?(im(u),_=A,N=g,_|0):(_=0,N=g,_|0)}function xt(A){return A=A|0,A>>>0>121?(A=0,A|0):(A=c[7696+(A*28|0)+16>>2]|0,A|0)}function Mf(A){return A=A|0,(A|0)==4|(A|0)==117|0}function Lg(A){return A=A|0,c[11120+((c[A>>2]|0)*216|0)+((c[A+4>>2]|0)*72|0)+((c[A+8>>2]|0)*24|0)+(c[A+12>>2]<<3)>>2]|0}function Kx(A){return A=A|0,c[11120+((c[A>>2]|0)*216|0)+((c[A+4>>2]|0)*72|0)+((c[A+8>>2]|0)*24|0)+(c[A+12>>2]<<3)+4>>2]|0}function Zx(A,l){A=A|0,l=l|0,A=7696+(A*28|0)|0,c[l>>2]=c[A>>2],c[l+4>>2]=c[A+4>>2],c[l+8>>2]=c[A+8>>2],c[l+12>>2]=c[A+12>>2]}function qx(A,l){A=A|0,l=l|0;var u=0,h=0;if(l>>>0>20)return l=-1,l|0;do if((c[11120+(l*216|0)>>2]|0)!=(A|0))if((c[11120+(l*216|0)+8>>2]|0)!=(A|0))if((c[11120+(l*216|0)+16>>2]|0)!=(A|0))if((c[11120+(l*216|0)+24>>2]|0)!=(A|0))if((c[11120+(l*216|0)+32>>2]|0)!=(A|0))if((c[11120+(l*216|0)+40>>2]|0)!=(A|0))if((c[11120+(l*216|0)+48>>2]|0)!=(A|0))if((c[11120+(l*216|0)+56>>2]|0)!=(A|0))if((c[11120+(l*216|0)+64>>2]|0)!=(A|0))if((c[11120+(l*216|0)+72>>2]|0)!=(A|0))if((c[11120+(l*216|0)+80>>2]|0)!=(A|0))if((c[11120+(l*216|0)+88>>2]|0)!=(A|0))if((c[11120+(l*216|0)+96>>2]|0)!=(A|0))if((c[11120+(l*216|0)+104>>2]|0)!=(A|0))if((c[11120+(l*216|0)+112>>2]|0)!=(A|0))if((c[11120+(l*216|0)+120>>2]|0)!=(A|0))if((c[11120+(l*216|0)+128>>2]|0)!=(A|0))if((c[11120+(l*216|0)+136>>2]|0)==(A|0))A=2,u=1,h=2;else{if((c[11120+(l*216|0)+144>>2]|0)==(A|0)){A=0,u=2,h=0;break}if((c[11120+(l*216|0)+152>>2]|0)==(A|0)){A=0,u=2,h=1;break}if((c[11120+(l*216|0)+160>>2]|0)==(A|0)){A=0,u=2,h=2;break}if((c[11120+(l*216|0)+168>>2]|0)==(A|0)){A=1,u=2,h=0;break}if((c[11120+(l*216|0)+176>>2]|0)==(A|0)){A=1,u=2,h=1;break}if((c[11120+(l*216|0)+184>>2]|0)==(A|0)){A=1,u=2,h=2;break}if((c[11120+(l*216|0)+192>>2]|0)==(A|0)){A=2,u=2,h=0;break}if((c[11120+(l*216|0)+200>>2]|0)==(A|0)){A=2,u=2,h=1;break}if((c[11120+(l*216|0)+208>>2]|0)==(A|0)){A=2,u=2,h=2;break}else A=-1;return A|0}else A=2,u=1,h=1;else A=2,u=1,h=0;else A=1,u=1,h=2;else A=1,u=1,h=1;else A=1,u=1,h=0;else A=0,u=1,h=2;else A=0,u=1,h=1;else A=0,u=1,h=0;else A=2,u=0,h=2;else A=2,u=0,h=1;else A=2,u=0,h=0;else A=1,u=0,h=2;else A=1,u=0,h=1;else A=1,u=0,h=0;else A=0,u=0,h=2;else A=0,u=0,h=1;else A=0,u=0,h=0;while(!1);return l=c[11120+(l*216|0)+(u*72|0)+(A*24|0)+(h<<3)+4>>2]|0,l|0}function Ug(A,l){return A=A|0,l=l|0,(c[7696+(A*28|0)+20>>2]|0)==(l|0)?(l=1,l|0):(l=(c[7696+(A*28|0)+24>>2]|0)==(l|0),l|0)}function Nf(A,l){return A=A|0,l=l|0,c[848+(A*28|0)+(l<<2)>>2]|0}function Of(A,l){return A=A|0,l=l|0,(c[848+(A*28|0)>>2]|0)==(l|0)?(l=0,l|0):(c[848+(A*28|0)+4>>2]|0)==(l|0)?(l=1,l|0):(c[848+(A*28|0)+8>>2]|0)==(l|0)?(l=2,l|0):(c[848+(A*28|0)+12>>2]|0)==(l|0)?(l=3,l|0):(c[848+(A*28|0)+16>>2]|0)==(l|0)?(l=4,l|0):(c[848+(A*28|0)+20>>2]|0)==(l|0)?(l=5,l|0):((c[848+(A*28|0)+24>>2]|0)==(l|0)?6:7)|0}function Gx(){return 122}function Jx(A){A=A|0;var l=0,u=0,h=0;l=0;do xe(l|0,0,45)|0,h=F()|0|134225919,u=A+(l<<3)|0,c[u>>2]=-1,c[u+4>>2]=h,l=l+1|0;while((l|0)!=122);return 0}function Vg(A){return A=A|0,+k[A+16>>3]<+k[A+24>>3]|0}function zg(A,l){A=A|0,l=l|0;var u=0,h=0,d=0;return u=+k[l>>3],!(u>=+k[A+8>>3])||!(u<=+k[A>>3])?(l=0,l|0):(h=+k[A+16>>3],u=+k[A+24>>3],d=+k[l+8>>3],l=d>=u,A=d<=h&1,h<u?l&&(A=1):l||(A=0),l=(A|0)!=0,l|0)}function jg(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0;V=N,N=N+288|0,S=V+264|0,O=V+96|0,x=V,y=x,b=y+96|0;do c[y>>2]=0,y=y+4|0;while((y|0)<(b|0));return l=$f(l,x)|0,l|0?(j=l,N=V,j|0):(b=x,x=c[b>>2]|0,b=c[b+4>>2]|0,da(x,b,S)|0,pa(x,b,O)|0,_=+ma(S,O+8|0),k[S>>3]=+k[A>>3],b=S+8|0,k[b>>3]=+k[A+16>>3],k[O>>3]=+k[A+8>>3],x=O+8|0,k[x>>3]=+k[A+24>>3],d=+ma(S,O),se=+k[b>>3]-+k[x>>3],g=+Me(+se),G=+k[S>>3]-+k[O>>3],h=+Me(+G),!(se==0|G==0)&&(se=+mm(+g,+h),se=+Cr(+(d*d/+Yf(+(se/+Yf(+g,+h)),3)/(_*(_*2.59807621135)*.8))),k[we>>3]=se,z=~~se>>>0,j=+Me(se)>=1?se>0?~~+Jl(+ze(se/4294967296),4294967295)>>>0:~~+Cr((se-+(~~se>>>0))/4294967296)>>>0:0,(c[we+4>>2]&2146435072|0)!=2146435072)?(O=(z|0)==0&(j|0)==0,l=u,c[l>>2]=O?1:z,c[l+4>>2]=O?0:j,l=0):l=1,j=l,N=V,j|0)}function eT(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0,S=0;x=N,N=N+288|0,_=x+264|0,y=x+96|0,b=x,d=b,g=d+96|0;do c[d>>2]=0,d=d+4|0;while((d|0)<(g|0));return u=$f(u,b)|0,u|0?(h=u,N=x,h|0):(u=b,d=c[u>>2]|0,u=c[u+4>>2]|0,da(d,u,_)|0,pa(d,u,y)|0,S=+ma(_,y+8|0),S=+Cr(+(+ma(A,l)/(S*2))),k[we>>3]=S,u=~~S>>>0,d=+Me(S)>=1?S>0?~~+Jl(+ze(S/4294967296),4294967295)>>>0:~~+Cr((S-+(~~S>>>0))/4294967296)>>>0:0,(c[we+4>>2]&2146435072|0)==2146435072?(h=1,N=x,h|0):(b=(u|0)==0&(d|0)==0,c[h>>2]=b?1:u,c[h+4>>2]=b?0:d,h=0,N=x,h|0))}function tT(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0,c[A>>2]=l,c[A+4>>2]=u,c[A+8>>2]=h}function nT(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0;O=l+8|0,c[O>>2]=0,b=+k[A>>3],_=+Me(+b),x=+k[A+8>>3],y=+Me(+x)/.8660254037844386,_=_+y*.5,u=~~_,A=~~y,_=_-+(u|0),y=y-+(A|0);do if(_<.5)if(_<.3333333333333333)if(c[l>>2]=u,y<(_+1)*.5){c[l+4>>2]=A;break}else{A=A+1|0,c[l+4>>2]=A;break}else if(z=1-_,A=(!(y<z)&1)+A|0,c[l+4>>2]=A,z<=y&y<_*2){u=u+1|0,c[l>>2]=u;break}else{c[l>>2]=u;break}else{if(!(_<.6666666666666666))if(u=u+1|0,c[l>>2]=u,y<_*.5){c[l+4>>2]=A;break}else{A=A+1|0,c[l+4>>2]=A;break}if(y<1-_){if(c[l+4>>2]=A,_*2+-1<y){c[l>>2]=u;break}}else A=A+1|0,c[l+4>>2]=A;u=u+1|0,c[l>>2]=u}while(!1);do if(b<0)if(A&1){S=(A+1|0)/2|0,S=pn(u|0,((u|0)<0)<<31>>31|0,S|0,((S|0)<0)<<31>>31|0)|0,u=~~(+(u|0)-((+(S>>>0)+4294967296*+(F()|0))*2+1)),c[l>>2]=u;break}else{S=(A|0)/2|0,S=pn(u|0,((u|0)<0)<<31>>31|0,S|0,((S|0)<0)<<31>>31|0)|0,u=~~(+(u|0)-(+(S>>>0)+4294967296*+(F()|0))*2),c[l>>2]=u;break}while(!1);S=l+4|0,x<0&&(u=u-((A<<1|1|0)/2|0)|0,c[l>>2]=u,A=0-A|0,c[S>>2]=A),h=A-u|0,(u|0)<0?(d=0-u|0,c[S>>2]=h,c[O>>2]=d,c[l>>2]=0,A=h,u=0):d=0,(A|0)<0&&(u=u-A|0,c[l>>2]=u,d=d-A|0,c[O>>2]=d,c[S>>2]=0,A=0),g=u-d|0,h=A-d|0,(d|0)<0&&(c[l>>2]=g,c[S>>2]=h,c[O>>2]=0,A=h,u=g,d=0),h=(A|0)<(u|0)?A:u,h=(d|0)<(h|0)?d:h,!((h|0)<=0)&&(c[l>>2]=u-h,c[S>>2]=A-h,c[O>>2]=d-h)}function dn(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0;l=c[A>>2]|0,_=A+4|0,u=c[_>>2]|0,(l|0)<0&&(u=u-l|0,c[_>>2]=u,g=A+8|0,c[g>>2]=(c[g>>2]|0)-l,c[A>>2]=0,l=0),(u|0)<0?(l=l-u|0,c[A>>2]=l,g=A+8|0,d=(c[g>>2]|0)-u|0,c[g>>2]=d,c[_>>2]=0,u=0):(d=A+8|0,g=d,d=c[d>>2]|0),(d|0)<0&&(l=l-d|0,c[A>>2]=l,u=u-d|0,c[_>>2]=u,c[g>>2]=0,d=0),h=(u|0)<(l|0)?u:l,h=(d|0)<(h|0)?d:h,!((h|0)<=0)&&(c[A>>2]=l-h,c[_>>2]=u-h,c[g>>2]=d-h)}function Ji(A,l){A=A|0,l=l|0;var u=0,h=0;h=c[A+8>>2]|0,u=+((c[A+4>>2]|0)-h|0),k[l>>3]=+((c[A>>2]|0)-h|0)-u*.5,k[l+8>>3]=u*.8660254037844386}function Cn(A,l,u){A=A|0,l=l|0,u=u|0,c[u>>2]=(c[l>>2]|0)+(c[A>>2]|0),c[u+4>>2]=(c[l+4>>2]|0)+(c[A+4>>2]|0),c[u+8>>2]=(c[l+8>>2]|0)+(c[A+8>>2]|0)}function Df(A,l,u){A=A|0,l=l|0,u=u|0,c[u>>2]=(c[A>>2]|0)-(c[l>>2]|0),c[u+4>>2]=(c[A+4>>2]|0)-(c[l+4>>2]|0),c[u+8>>2]=(c[A+8>>2]|0)-(c[l+8>>2]|0)}function Wg(A,l){A=A|0,l=l|0;var u=0,h=0;u=zn(c[A>>2]|0,l)|0,c[A>>2]=u,u=A+4|0,h=zn(c[u>>2]|0,l)|0,c[u>>2]=h,A=A+8|0,l=zn(c[A>>2]|0,l)|0,c[A>>2]=l}function eA(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;_=c[A>>2]|0,y=(_|0)<0,h=(c[A+4>>2]|0)-(y?_:0)|0,g=(h|0)<0,d=(g?0-h|0:0)+((c[A+8>>2]|0)-(y?_:0))|0,u=(d|0)<0,A=u?0:d,l=(g?0:h)-(u?d:0)|0,d=(y?0:_)-(g?h:0)-(u?d:0)|0,u=(l|0)<(d|0)?l:d,u=(A|0)<(u|0)?A:u,h=(u|0)>0,A=A-(h?u:0)|0,l=l-(h?u:0)|0;e:do switch(d-(h?u:0)|0){case 0:switch(l|0){case 0:return y=A|0?(A|0)==1?1:7:0,y|0;case 1:return y=A|0?(A|0)==1?3:7:2,y|0;default:break e}case 1:switch(l|0){case 0:return y=A|0?(A|0)==1?5:7:4,y|0;case 1:{if(!A)A=6;else break e;return A|0}default:break e}}while(!1);return y=7,y|0}function rT(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;_=A+8|0,d=c[_>>2]|0,g=(c[A>>2]|0)-d|0,y=A+4|0,d=(c[y>>2]|0)-d|0;do if(g>>>0>715827881|d>>>0>715827881){if(u=(g|0)>0,u){if((2147483647-g|0)<(g|0)||(2147483647-(g<<1)|0)<(g|0))return y=1,y|0}else if((-2147483648-g|0)>(g|0)||(-2147483648-(g<<1)|0)>(g|0))return y=1,y|0;if(l=g*3|0,(d|0)>0){if((2147483647-d|0)<(d|0))return y=1,y|0}else if((-2147483648-d|0)>(d|0))return y=1,y|0;if(h=d<<1,(g|0)>-1){if((l|-2147483648|0)>=(d|0))return y=1,y|0}else if((l^-2147483648|0)<(d|0))return y=1,y|0;if(u){if((2147483647-g|0)<(h|0))l=1;else{u=h;break}return l|0}else{if((-2147483648-g|0)>(h|0))l=1;else{u=h;break}return l|0}}else u=d<<1,l=g*3|0;while(!1);h=pi(+(l-d|0)/7)|0,c[A>>2]=h,d=pi(+(u+g|0)/7)|0,c[y>>2]=d,c[_>>2]=0,u=(d|0)<(h|0),l=u?h:d,u=u?d:h;do if((u|0)<0){if((l|0)>0){if((l|-2147483648|0)<(u|0)&((u|0)!=-2147483648&(2147483647-l|0)>=(u|0)))break;We(23313,22444,355,22455)}if((u|0)==-2147483648|(-2147483648-l|0)>(u|0)&&We(23313,22444,355,22455),(l|0)>-1){if((l|-2147483648|0)<(u|0))break;We(23313,22444,355,22455)}else{if((l^-2147483648|0)>=(u|0))break;We(23313,22444,355,22455)}}while(!1);return l=d-h|0,(h|0)<0?(u=0-h|0,c[y>>2]=l,c[_>>2]=u,c[A>>2]=0,h=0):(l=d,u=0),(l|0)<0&&(h=h-l|0,c[A>>2]=h,u=u-l|0,c[_>>2]=u,c[y>>2]=0,l=0),g=h-u|0,d=l-u|0,(u|0)<0?(c[A>>2]=g,c[y>>2]=d,c[_>>2]=0,l=d,d=g,u=0):d=h,h=(l|0)<(d|0)?l:d,h=(u|0)<(h|0)?u:h,(h|0)<=0?(y=0,y|0):(c[A>>2]=d-h,c[y>>2]=l-h,c[_>>2]=u-h,y=0,y|0)}function iT(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;_=A+8|0,d=c[_>>2]|0,g=(c[A>>2]|0)-d|0,y=A+4|0,d=(c[y>>2]|0)-d|0;do if(g>>>0>715827881|d>>>0>715827881){if(u=(g|0)>0,u){if((2147483647-g|0)<(g|0))return y=1,y|0}else if((-2147483648-g|0)>(g|0))return y=1,y|0;if(l=g<<1,(d|0)>0){if((2147483647-d|0)<(d|0)||(2147483647-(d<<1)|0)<(d|0))return y=1,y|0}else if((-2147483648-d|0)>(d|0)||(-2147483648-(d<<1)|0)>(d|0))return y=1,y|0;if(h=d*3|0,u){if((2147483647-l|0)<(d|0))return y=1,y|0}else if((-2147483648-l|0)>(d|0))return y=1,y|0;if((d|0)>-1){if((h|-2147483648|0)<(g|0)){u=h;break}else l=1;return l|0}else{if((h^-2147483648|0)<(g|0))l=1;else{u=h;break}return l|0}}else u=d*3|0,l=g<<1;while(!1);h=pi(+(l+d|0)/7)|0,c[A>>2]=h,d=pi(+(u-g|0)/7)|0,c[y>>2]=d,c[_>>2]=0,u=(d|0)<(h|0),l=u?h:d,u=u?d:h;do if((u|0)<0){if((l|0)>0){if((l|-2147483648|0)<(u|0)&((u|0)!=-2147483648&(2147483647-l|0)>=(u|0)))break;We(23313,22444,404,22469)}if((u|0)==-2147483648|(-2147483648-l|0)>(u|0)&&We(23313,22444,404,22469),(l|0)>-1){if((l|-2147483648|0)<(u|0))break;We(23313,22444,404,22469)}else{if((l^-2147483648|0)>=(u|0))break;We(23313,22444,404,22469)}}while(!1);return l=d-h|0,(h|0)<0?(u=0-h|0,c[y>>2]=l,c[_>>2]=u,c[A>>2]=0,h=0):(l=d,u=0),(l|0)<0&&(h=h-l|0,c[A>>2]=h,u=u-l|0,c[_>>2]=u,c[y>>2]=0,l=0),g=h-u|0,d=l-u|0,(u|0)<0?(c[A>>2]=g,c[y>>2]=d,c[_>>2]=0,l=d,d=g,u=0):d=h,h=(l|0)<(d|0)?l:d,h=(u|0)<(h|0)?u:h,(h|0)<=0?(y=0,y|0):(c[A>>2]=d-h,c[y>>2]=l-h,c[_>>2]=u-h,y=0,y|0)}function sT(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;_=A+8|0,u=c[_>>2]|0,l=(c[A>>2]|0)-u|0,y=A+4|0,u=(c[y>>2]|0)-u|0,h=pi(+((l*3|0)-u|0)/7)|0,c[A>>2]=h,l=pi(+((u<<1)+l|0)/7)|0,c[y>>2]=l,c[_>>2]=0,u=l-h|0,(h|0)<0?(g=0-h|0,c[y>>2]=u,c[_>>2]=g,c[A>>2]=0,l=u,h=0,u=g):u=0,(l|0)<0&&(h=h-l|0,c[A>>2]=h,u=u-l|0,c[_>>2]=u,c[y>>2]=0,l=0),g=h-u|0,d=l-u|0,(u|0)<0?(c[A>>2]=g,c[y>>2]=d,c[_>>2]=0,l=d,d=g,u=0):d=h,h=(l|0)<(d|0)?l:d,h=(u|0)<(h|0)?u:h,!((h|0)<=0)&&(c[A>>2]=d-h,c[y>>2]=l-h,c[_>>2]=u-h)}function $g(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;_=A+8|0,u=c[_>>2]|0,l=(c[A>>2]|0)-u|0,y=A+4|0,u=(c[y>>2]|0)-u|0,h=pi(+((l<<1)+u|0)/7)|0,c[A>>2]=h,l=pi(+((u*3|0)-l|0)/7)|0,c[y>>2]=l,c[_>>2]=0,u=l-h|0,(h|0)<0?(g=0-h|0,c[y>>2]=u,c[_>>2]=g,c[A>>2]=0,l=u,h=0,u=g):u=0,(l|0)<0&&(h=h-l|0,c[A>>2]=h,u=u-l|0,c[_>>2]=u,c[y>>2]=0,l=0),g=h-u|0,d=l-u|0,(u|0)<0?(c[A>>2]=g,c[y>>2]=d,c[_>>2]=0,l=d,d=g,u=0):d=h,h=(l|0)<(d|0)?l:d,h=(u|0)<(h|0)?u:h,!((h|0)<=0)&&(c[A>>2]=d-h,c[y>>2]=l-h,c[_>>2]=u-h)}function tA(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;l=c[A>>2]|0,_=A+4|0,u=c[_>>2]|0,y=A+8|0,h=c[y>>2]|0,d=u+(l*3|0)|0,c[A>>2]=d,u=h+(u*3|0)|0,c[_>>2]=u,l=(h*3|0)+l|0,c[y>>2]=l,h=u-d|0,(d|0)<0?(l=l-d|0,c[_>>2]=h,c[y>>2]=l,c[A>>2]=0,u=h,h=0):h=d,(u|0)<0&&(h=h-u|0,c[A>>2]=h,l=l-u|0,c[y>>2]=l,c[_>>2]=0,u=0),g=h-l|0,d=u-l|0,(l|0)<0?(c[A>>2]=g,c[_>>2]=d,c[y>>2]=0,h=g,l=0):d=u,u=(d|0)<(h|0)?d:h,u=(l|0)<(u|0)?l:u,!((u|0)<=0)&&(c[A>>2]=h-u,c[_>>2]=d-u,c[y>>2]=l-u)}function es(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;d=c[A>>2]|0,_=A+4|0,l=c[_>>2]|0,y=A+8|0,u=c[y>>2]|0,h=(l*3|0)+d|0,d=u+(d*3|0)|0,c[A>>2]=d,c[_>>2]=h,l=(u*3|0)+l|0,c[y>>2]=l,u=h-d|0,(d|0)<0?(l=l-d|0,c[_>>2]=u,c[y>>2]=l,c[A>>2]=0,d=0):u=h,(u|0)<0&&(d=d-u|0,c[A>>2]=d,l=l-u|0,c[y>>2]=l,c[_>>2]=0,u=0),g=d-l|0,h=u-l|0,(l|0)<0?(c[A>>2]=g,c[_>>2]=h,c[y>>2]=0,d=g,l=0):h=u,u=(h|0)<(d|0)?h:d,u=(l|0)<(u|0)?l:u,!((u|0)<=0)&&(c[A>>2]=d-u,c[_>>2]=h-u,c[y>>2]=l-u)}function Hg(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0;(l+-1|0)>>>0>=6||(d=(c[15440+(l*12|0)>>2]|0)+(c[A>>2]|0)|0,c[A>>2]=d,y=A+4|0,h=(c[15440+(l*12|0)+4>>2]|0)+(c[y>>2]|0)|0,c[y>>2]=h,_=A+8|0,l=(c[15440+(l*12|0)+8>>2]|0)+(c[_>>2]|0)|0,c[_>>2]=l,u=h-d|0,(d|0)<0?(l=l-d|0,c[y>>2]=u,c[_>>2]=l,c[A>>2]=0,h=0):(u=h,h=d),(u|0)<0&&(h=h-u|0,c[A>>2]=h,l=l-u|0,c[_>>2]=l,c[y>>2]=0,u=0),g=h-l|0,d=u-l|0,(l|0)<0?(c[A>>2]=g,c[y>>2]=d,c[_>>2]=0,h=g,l=0):d=u,u=(d|0)<(h|0)?d:h,u=(l|0)<(u|0)?l:u,!((u|0)<=0)&&(c[A>>2]=h-u,c[y>>2]=d-u,c[_>>2]=l-u))}function Xg(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;d=c[A>>2]|0,_=A+4|0,l=c[_>>2]|0,y=A+8|0,u=c[y>>2]|0,h=l+d|0,d=u+d|0,c[A>>2]=d,c[_>>2]=h,l=u+l|0,c[y>>2]=l,u=h-d|0,(d|0)<0?(l=l-d|0,c[_>>2]=u,c[y>>2]=l,c[A>>2]=0,h=0):(u=h,h=d),(u|0)<0&&(h=h-u|0,c[A>>2]=h,l=l-u|0,c[y>>2]=l,c[_>>2]=0,u=0),g=h-l|0,d=u-l|0,(l|0)<0?(c[A>>2]=g,c[_>>2]=d,c[y>>2]=0,h=g,l=0):d=u,u=(d|0)<(h|0)?d:h,u=(l|0)<(u|0)?l:u,!((u|0)<=0)&&(c[A>>2]=h-u,c[_>>2]=d-u,c[y>>2]=l-u)}function nA(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;l=c[A>>2]|0,_=A+4|0,h=c[_>>2]|0,y=A+8|0,u=c[y>>2]|0,d=h+l|0,c[A>>2]=d,h=u+h|0,c[_>>2]=h,l=u+l|0,c[y>>2]=l,u=h-d|0,(d|0)<0?(l=l-d|0,c[_>>2]=u,c[y>>2]=l,c[A>>2]=0,h=0):(u=h,h=d),(u|0)<0&&(h=h-u|0,c[A>>2]=h,l=l-u|0,c[y>>2]=l,c[_>>2]=0,u=0),g=h-l|0,d=u-l|0,(l|0)<0?(c[A>>2]=g,c[_>>2]=d,c[y>>2]=0,h=g,l=0):d=u,u=(d|0)<(h|0)?d:h,u=(l|0)<(u|0)?l:u,!((u|0)<=0)&&(c[A>>2]=h-u,c[_>>2]=d-u,c[y>>2]=l-u)}function ts(A){switch(A=A|0,A|0){case 1:{A=5;break}case 5:{A=4;break}case 4:{A=6;break}case 6:{A=2;break}case 2:{A=3;break}case 3:{A=1;break}}return A|0}function hi(A){switch(A=A|0,A|0){case 1:{A=3;break}case 3:{A=2;break}case 2:{A=6;break}case 6:{A=4;break}case 4:{A=5;break}case 5:{A=1;break}}return A|0}function Qg(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;l=c[A>>2]|0,_=A+4|0,u=c[_>>2]|0,y=A+8|0,h=c[y>>2]|0,d=u+(l<<1)|0,c[A>>2]=d,u=h+(u<<1)|0,c[_>>2]=u,l=(h<<1)+l|0,c[y>>2]=l,h=u-d|0,(d|0)<0?(l=l-d|0,c[_>>2]=h,c[y>>2]=l,c[A>>2]=0,u=h,h=0):h=d,(u|0)<0&&(h=h-u|0,c[A>>2]=h,l=l-u|0,c[y>>2]=l,c[_>>2]=0,u=0),g=h-l|0,d=u-l|0,(l|0)<0?(c[A>>2]=g,c[_>>2]=d,c[y>>2]=0,h=g,l=0):d=u,u=(d|0)<(h|0)?d:h,u=(l|0)<(u|0)?l:u,!((u|0)<=0)&&(c[A>>2]=h-u,c[_>>2]=d-u,c[y>>2]=l-u)}function Yg(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;d=c[A>>2]|0,_=A+4|0,l=c[_>>2]|0,y=A+8|0,u=c[y>>2]|0,h=(l<<1)+d|0,d=u+(d<<1)|0,c[A>>2]=d,c[_>>2]=h,l=(u<<1)+l|0,c[y>>2]=l,u=h-d|0,(d|0)<0?(l=l-d|0,c[_>>2]=u,c[y>>2]=l,c[A>>2]=0,d=0):u=h,(u|0)<0&&(d=d-u|0,c[A>>2]=d,l=l-u|0,c[y>>2]=l,c[_>>2]=0,u=0),g=d-l|0,h=u-l|0,(l|0)<0?(c[A>>2]=g,c[_>>2]=h,c[y>>2]=0,d=g,l=0):h=u,u=(h|0)<(d|0)?h:d,u=(l|0)<(u|0)?l:u,!((u|0)<=0)&&(c[A>>2]=d-u,c[_>>2]=h-u,c[y>>2]=l-u)}function Bf(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0;return _=(c[A>>2]|0)-(c[l>>2]|0)|0,y=(_|0)<0,h=(c[A+4>>2]|0)-(c[l+4>>2]|0)-(y?_:0)|0,g=(h|0)<0,d=(y?0-_|0:0)+(c[A+8>>2]|0)-(c[l+8>>2]|0)+(g?0-h|0:0)|0,A=(d|0)<0,l=A?0:d,u=(g?0:h)-(A?d:0)|0,d=(y?0:_)-(g?h:0)-(A?d:0)|0,A=(u|0)<(d|0)?u:d,A=(l|0)<(A|0)?l:A,h=(A|0)>0,l=l-(h?A:0)|0,u=u-(h?A:0)|0,A=d-(h?A:0)|0,A=(A|0)>-1?A:0-A|0,u=(u|0)>-1?u:0-u|0,l=(l|0)>-1?l:0-l|0,l=(u|0)>(l|0)?u:l,((A|0)>(l|0)?A:l)|0}function oT(A,l){A=A|0,l=l|0;var u=0;u=c[A+8>>2]|0,c[l>>2]=(c[A>>2]|0)-u,c[l+4>>2]=(c[A+4>>2]|0)-u}function aT(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0;h=c[A>>2]|0,c[l>>2]=h,d=c[A+4>>2]|0,_=l+4|0,c[_>>2]=d,y=l+8|0,c[y>>2]=0,u=(d|0)<(h|0),A=u?h:d,u=u?d:h;do if((u|0)<0){if((A|0)>0){if((A|-2147483648|0)<(u|0)&((u|0)!=-2147483648&(2147483647-A|0)>=(u|0)))break;return A=1,A|0}if((u|0)==-2147483648|(-2147483648-A|0)>(u|0))return l=1,l|0;if((A|0)>-1){if((A|-2147483648|0)<(u|0))break;return A=1,A|0}else{if((A^-2147483648|0)<(u|0))A=1;else break;return A|0}}while(!1);return A=d-h|0,(h|0)<0?(u=0-h|0,c[_>>2]=A,c[y>>2]=u,c[l>>2]=0,h=0):(A=d,u=0),(A|0)<0&&(h=h-A|0,c[l>>2]=h,u=u-A|0,c[y>>2]=u,c[_>>2]=0,A=0),g=h-u|0,d=A-u|0,(u|0)<0?(c[l>>2]=g,c[_>>2]=d,c[y>>2]=0,A=d,d=g,u=0):d=h,h=(A|0)<(d|0)?A:d,h=(u|0)<(h|0)?u:h,(h|0)<=0?(l=0,l|0):(c[l>>2]=d-h,c[_>>2]=A-h,c[y>>2]=u-h,l=0,l|0)}function Kg(A){A=A|0;var l=0,u=0,h=0,d=0;l=A+8|0,d=c[l>>2]|0,u=d-(c[A>>2]|0)|0,c[A>>2]=u,h=A+4|0,A=(c[h>>2]|0)-d|0,c[h>>2]=A,c[l>>2]=0-(A+u)}function lT(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;u=c[A>>2]|0,l=0-u|0,c[A>>2]=l,_=A+8|0,c[_>>2]=0,y=A+4|0,h=c[y>>2]|0,d=h+u|0,(u|0)>0?(c[y>>2]=d,c[_>>2]=u,c[A>>2]=0,l=0,h=d):u=0,(h|0)<0?(g=l-h|0,c[A>>2]=g,u=u-h|0,c[_>>2]=u,c[y>>2]=0,d=g-u|0,l=0-u|0,(u|0)<0?(c[A>>2]=d,c[y>>2]=l,c[_>>2]=0,h=l,u=0):(h=0,d=g)):d=l,l=(h|0)<(d|0)?h:d,l=(u|0)<(l|0)?u:l,!((l|0)<=0)&&(c[A>>2]=d-l,c[y>>2]=h-l,c[_>>2]=u-l)}function AT(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0;if(O=N,N=N+64|0,S=O,y=O+56|0,!(!0&(l&2013265920|0)==134217728&(!0&(h&2013265920|0)==134217728)))return d=5,N=O,d|0;if((A|0)==(u|0)&(l|0)==(h|0))return c[d>>2]=0,d=0,N=O,d|0;if(_=de(A|0,l|0,52)|0,F()|0,_=_&15,x=de(u|0,h|0,52)|0,F()|0,(_|0)!=(x&15|0))return d=12,N=O,d|0;if(g=_+-1|0,_>>>0>1){Vf(A,l,g,S)|0,Vf(u,h,g,y)|0,x=S,b=c[x>>2]|0,x=c[x+4>>2]|0;e:do if((b|0)==(c[y>>2]|0)&&(x|0)==(c[y+4>>2]|0)){_=(_^15)*3|0,g=de(A|0,l|0,_|0)|0,F()|0,g=g&7,_=de(u|0,h|0,_|0)|0,F()|0,_=_&7;do if((g|0)==0|(_|0)==0)c[d>>2]=1,g=0;else if((g|0)==7)g=5;else{if((g|0)==1|(_|0)==1&&Tt(b,x)|0){g=5;break}if((c[15536+(g<<2)>>2]|0)!=(_|0)&&(c[15568+(g<<2)>>2]|0)!=(_|0))break e;c[d>>2]=1,g=0}while(!1);return d=g,N=O,d|0}while(!1)}g=S,_=g+56|0;do c[g>>2]=0,g=g+4|0;while((g|0)<(_|0));return Og(A,l,1,S)|0,l=S,!((c[l>>2]|0)==(u|0)&&(c[l+4>>2]|0)==(h|0))&&(l=S+8|0,!((c[l>>2]|0)==(u|0)&&(c[l+4>>2]|0)==(h|0)))&&(l=S+16|0,!((c[l>>2]|0)==(u|0)&&(c[l+4>>2]|0)==(h|0)))&&(l=S+24|0,!((c[l>>2]|0)==(u|0)&&(c[l+4>>2]|0)==(h|0)))&&(l=S+32|0,!((c[l>>2]|0)==(u|0)&&(c[l+4>>2]|0)==(h|0)))&&(l=S+40|0,!((c[l>>2]|0)==(u|0)&&(c[l+4>>2]|0)==(h|0)))?(g=S+48|0,g=((c[g>>2]|0)==(u|0)?(c[g+4>>2]|0)==(h|0):0)&1):g=1,c[d>>2]=g,d=0,N=O,d|0}function cT(A,l,u,h,d){return A=A|0,l=l|0,u=u|0,h=h|0,d=d|0,u=If(A,l,u,h)|0,(u|0)==7?(d=11,d|0):(h=xe(u|0,0,56)|0,l=l&-2130706433|(F()|0)|268435456,c[d>>2]=A|h,c[d+4>>2]=l,d=0,d|0)}function uT(A,l,u){return A=A|0,l=l|0,u=u|0,!0&(l&2013265920|0)==268435456?(c[u>>2]=A,c[u+4>>2]=l&-2130706433|134217728,u=0,u|0):(u=6,u|0)}function fT(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0;return d=N,N=N+16|0,h=d,c[h>>2]=0,!0&(l&2013265920|0)==268435456?(g=de(A|0,l|0,56)|0,F()|0,h=en(A,l&-2130706433|134217728,g&7,h,u)|0,N=d,h|0):(h=6,N=d,h|0)}function hT(A,l){A=A|0,l=l|0;var u=0;switch(u=de(A|0,l|0,56)|0,F()|0,u&7){case 0:case 7:return u=0,u|0}return u=l&-2130706433|134217728,!(!0&(l&2013265920|0)==268435456)||!0&(l&117440512|0)==16777216&(Tt(A,u)|0)!=0?(u=0,u|0):(u=Uf(A,u)|0,u|0)}function dT(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0;return d=N,N=N+16|0,h=d,!0&(l&2013265920|0)==268435456?(g=l&-2130706433|134217728,_=u,c[_>>2]=A,c[_+4>>2]=g,c[h>>2]=0,l=de(A|0,l|0,56)|0,F()|0,h=en(A,g,l&7,h,u+8|0)|0,N=d,h|0):(h=6,N=d,h|0)}function pT(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0;return d=(Tt(A,l)|0)==0,l=l&-2130706433,h=u,c[h>>2]=d?A:0,c[h+4>>2]=d?l|285212672:0,h=u+8|0,c[h>>2]=A,c[h+4>>2]=l|301989888,h=u+16|0,c[h>>2]=A,c[h+4>>2]=l|318767104,h=u+24|0,c[h>>2]=A,c[h+4>>2]=l|335544320,h=u+32|0,c[h>>2]=A,c[h+4>>2]=l|352321536,u=u+40|0,c[u>>2]=A,c[u+4>>2]=l|369098752,0}function rA(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0;return _=N,N=N+16|0,d=_,g=l&-2130706433|134217728,!0&(l&2013265920|0)==268435456?(h=de(A|0,l|0,56)|0,F()|0,h=dE(A,g,h&7)|0,(h|0)==-1?(c[u>>2]=0,g=6,N=_,g|0):(js(A,g,d)|0&&We(23313,22484,282,22499),l=de(A|0,l|0,52)|0,F()|0,l=l&15,Tt(A,g)|0?Ff(d,l,h,2,u):Lf(d,l,h,2,u),g=0,N=_,g|0)):(g=6,N=_,g|0)}function gT(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0;h=N,N=N+16|0,d=h,mT(A,l,u,d),nT(d,u+4|0),N=h}function mT(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0;if(y=N,N=N+16|0,b=y,_T(A,u,b),g=+Sn(+(1-+k[b>>3]*.5)),g<1e-16){c[h>>2]=0,c[h+4>>2]=0,c[h+8>>2]=0,c[h+12>>2]=0,N=y;return}if(b=c[u>>2]|0,d=+k[15920+(b*24|0)>>3],d=+ga(d-+ga(+FT(15600+(b<<4)|0,A))),Jn(l)|0?_=+ga(d+-.3334731722518321):_=d,d=+bt(+g)/.381966011250105,(l|0)>0){A=0;do d=d*2.6457513110645907,A=A+1|0;while((A|0)!=(l|0))}g=+Ie(+_)*d,k[h>>3]=g,_=+Ue(+_)*d,k[h+8>>3]=_,N=y}function _T(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0;if(g=N,N=N+32|0,d=g,hE(A,d),c[l>>2]=0,k[u>>3]=5,h=+$t(16400,d),h<+k[u>>3]&&(c[l>>2]=0,k[u>>3]=h),h=+$t(16424,d),h<+k[u>>3]&&(c[l>>2]=1,k[u>>3]=h),h=+$t(16448,d),h<+k[u>>3]&&(c[l>>2]=2,k[u>>3]=h),h=+$t(16472,d),h<+k[u>>3]&&(c[l>>2]=3,k[u>>3]=h),h=+$t(16496,d),h<+k[u>>3]&&(c[l>>2]=4,k[u>>3]=h),h=+$t(16520,d),h<+k[u>>3]&&(c[l>>2]=5,k[u>>3]=h),h=+$t(16544,d),h<+k[u>>3]&&(c[l>>2]=6,k[u>>3]=h),h=+$t(16568,d),h<+k[u>>3]&&(c[l>>2]=7,k[u>>3]=h),h=+$t(16592,d),h<+k[u>>3]&&(c[l>>2]=8,k[u>>3]=h),h=+$t(16616,d),h<+k[u>>3]&&(c[l>>2]=9,k[u>>3]=h),h=+$t(16640,d),h<+k[u>>3]&&(c[l>>2]=10,k[u>>3]=h),h=+$t(16664,d),h<+k[u>>3]&&(c[l>>2]=11,k[u>>3]=h),h=+$t(16688,d),h<+k[u>>3]&&(c[l>>2]=12,k[u>>3]=h),h=+$t(16712,d),h<+k[u>>3]&&(c[l>>2]=13,k[u>>3]=h),h=+$t(16736,d),h<+k[u>>3]&&(c[l>>2]=14,k[u>>3]=h),h=+$t(16760,d),h<+k[u>>3]&&(c[l>>2]=15,k[u>>3]=h),h=+$t(16784,d),h<+k[u>>3]&&(c[l>>2]=16,k[u>>3]=h),h=+$t(16808,d),h<+k[u>>3]&&(c[l>>2]=17,k[u>>3]=h),h=+$t(16832,d),h<+k[u>>3]&&(c[l>>2]=18,k[u>>3]=h),h=+$t(16856,d),!(h<+k[u>>3])){N=g;return}c[l>>2]=19,k[u>>3]=h,N=g}function ha(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0;if(g=+fE(A),g<1e-16){l=15600+(l<<4)|0,c[d>>2]=c[l>>2],c[d+4>>2]=c[l+4>>2],c[d+8>>2]=c[l+8>>2],c[d+12>>2]=c[l+12>>2];return}if(_=+Nt(+ +k[A+8>>3],+ +k[A>>3]),(u|0)>0){A=0;do g=g/2.6457513110645907,A=A+1|0;while((A|0)!=(u|0))}h?(g=g/3,u=(Jn(u)|0)==0,g=+Gn(+((u?g:g/2.6457513110645907)*.381966011250105))):(g=+Gn(+(g*.381966011250105)),Jn(u)|0&&(_=+ga(_+.3334731722518321))),LT(15600+(l<<4)|0,+ga(+k[15920+(l*24|0)>>3]-_),g,d)}function yT(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0;h=N,N=N+16|0,d=h,Ji(A+4|0,d),ha(d,c[A>>2]|0,l,0,u),N=h}function Ff(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0,Z=0,Se=0,Ne=0,ve=0,Ce=0,ht=0,lt=0,ct=0,Je=0,Ge=0,et=0,gt=0,Ye=0;if(et=N,N=N+272|0,g=et+256|0,ne=et+240|0,ct=et,Je=et+224|0,Ge=et+208|0,re=et+176|0,Z=et+160|0,Se=et+192|0,Ne=et+144|0,ve=et+128|0,Ce=et+112|0,ht=et+96|0,lt=et+80|0,c[g>>2]=l,c[ne>>2]=c[A>>2],c[ne+4>>2]=c[A+4>>2],c[ne+8>>2]=c[A+8>>2],c[ne+12>>2]=c[A+12>>2],Zg(ne,g,ct),c[d>>2]=0,ne=h+u+((h|0)==5&1)|0,(ne|0)<=(u|0)){N=et;return}b=c[g>>2]|0,x=Je+4|0,S=re+4|0,O=u+5|0,z=16880+(b<<2)|0,j=16960+(b<<2)|0,V=ve+8|0,G=Ce+8|0,se=ht+8|0,ie=Ge+4|0,y=u;e:for(;;){_=ct+(((y|0)%5|0)<<4)|0,c[Ge>>2]=c[_>>2],c[Ge+4>>2]=c[_+4>>2],c[Ge+8>>2]=c[_+8>>2],c[Ge+12>>2]=c[_+12>>2];do;while((zs(Ge,b,0,1)|0)==2);if((y|0)>(u|0)&(Jn(l)|0)!=0){if(c[re>>2]=c[Ge>>2],c[re+4>>2]=c[Ge+4>>2],c[re+8>>2]=c[Ge+8>>2],c[re+12>>2]=c[Ge+12>>2],Ji(x,Z),h=c[re>>2]|0,g=c[17040+(h*80|0)+(c[Je>>2]<<2)>>2]|0,c[re>>2]=c[18640+(h*80|0)+(g*20|0)>>2],_=c[18640+(h*80|0)+(g*20|0)+16>>2]|0,(_|0)>0){A=0;do Xg(S),A=A+1|0;while((A|0)<(_|0))}switch(_=18640+(h*80|0)+(g*20|0)+4|0,c[Se>>2]=c[_>>2],c[Se+4>>2]=c[_+4>>2],c[Se+8>>2]=c[_+8>>2],Wg(Se,(c[z>>2]|0)*3|0),Cn(S,Se,S),dn(S),Ji(S,Ne),gt=+(c[j>>2]|0),k[ve>>3]=gt*3,k[V>>3]=0,Ye=gt*-1.5,k[Ce>>3]=Ye,k[G>>3]=gt*2.598076211353316,k[ht>>3]=Ye,k[se>>3]=gt*-2.598076211353316,c[17040+((c[re>>2]|0)*80|0)+(c[Ge>>2]<<2)>>2]|0){case 1:{A=Ce,h=ve;break}case 3:{A=ht,h=Ce;break}case 2:{A=ve,h=ht;break}default:{A=12;break e}}Am(Z,Ne,h,A,lt),ha(lt,c[re>>2]|0,b,1,d+8+(c[d>>2]<<4)|0),c[d>>2]=(c[d>>2]|0)+1}if((y|0)<(O|0)&&(Ji(ie,re),ha(re,c[Ge>>2]|0,b,1,d+8+(c[d>>2]<<4)|0),c[d>>2]=(c[d>>2]|0)+1),c[Je>>2]=c[Ge>>2],c[Je+4>>2]=c[Ge+4>>2],c[Je+8>>2]=c[Ge+8>>2],c[Je+12>>2]=c[Ge+12>>2],y=y+1|0,(y|0)>=(ne|0)){A=3;break}}if((A|0)==3){N=et;return}else(A|0)==12&&We(22522,22569,571,22579)}function Zg(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0;b=N,N=N+128|0,h=b+64|0,d=b,g=h,_=20240,y=g+60|0;do c[g>>2]=c[_>>2],g=g+4|0,_=_+4|0;while((g|0)<(y|0));g=d,_=20304,y=g+60|0;do c[g>>2]=c[_>>2],g=g+4|0,_=_+4|0;while((g|0)<(y|0));y=(Jn(c[l>>2]|0)|0)==0,h=y?h:d,d=A+4|0,Qg(d),Yg(d),Jn(c[l>>2]|0)|0&&(es(d),c[l>>2]=(c[l>>2]|0)+1),c[u>>2]=c[A>>2],l=u+4|0,Cn(d,h,l),dn(l),c[u+16>>2]=c[A>>2],l=u+20|0,Cn(d,h+12|0,l),dn(l),c[u+32>>2]=c[A>>2],l=u+36|0,Cn(d,h+24|0,l),dn(l),c[u+48>>2]=c[A>>2],l=u+52|0,Cn(d,h+36|0,l),dn(l),c[u+64>>2]=c[A>>2],u=u+68|0,Cn(d,h+48|0,u),dn(u),N=b}function zs(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0;if(V=N,N=N+32|0,z=V+12|0,y=V,j=A+4|0,O=c[16960+(l<<2)>>2]|0,S=(h|0)!=0,O=S?O*3|0:O,d=c[j>>2]|0,x=A+8|0,_=c[x>>2]|0,S){if(g=A+12|0,h=c[g>>2]|0,d=_+d+h|0,(d|0)==(O|0))return j=1,N=V,j|0;b=g}else b=A+12|0,h=c[b>>2]|0,d=_+d+h|0;if((d|0)<=(O|0))return j=0,N=V,j|0;do if((h|0)>0){if(h=c[A>>2]|0,(_|0)>0){g=18640+(h*80|0)+60|0,h=A;break}h=18640+(h*80|0)+40|0,u?(tT(z,O,0,0),Df(j,z,y),nA(y),Cn(y,z,j),g=h,h=A):(g=h,h=A)}else g=18640+((c[A>>2]|0)*80|0)+20|0,h=A;while(!1);if(c[h>>2]=c[g>>2],d=g+16|0,(c[d>>2]|0)>0){h=0;do Xg(j),h=h+1|0;while((h|0)<(c[d>>2]|0))}return A=g+4|0,c[z>>2]=c[A>>2],c[z+4>>2]=c[A+4>>2],c[z+8>>2]=c[A+8>>2],l=c[16880+(l<<2)>>2]|0,Wg(z,S?l*3|0:l),Cn(j,z,j),dn(j),S?h=((c[x>>2]|0)+(c[j>>2]|0)+(c[b>>2]|0)|0)==(O|0)?1:2:h=2,j=h,N=V,j|0}function vT(A,l){A=A|0,l=l|0;var u=0;do u=zs(A,l,0,1)|0;while((u|0)==2);return u|0}function Lf(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0,Z=0,Se=0,Ne=0,ve=0,Ce=0,ht=0,lt=0,ct=0;if(ht=N,N=N+240|0,g=ht+224|0,Se=ht+208|0,Ne=ht,ve=ht+192|0,Ce=ht+176|0,se=ht+160|0,ie=ht+144|0,ne=ht+128|0,re=ht+112|0,Z=ht+96|0,c[g>>2]=l,c[Se>>2]=c[A>>2],c[Se+4>>2]=c[A+4>>2],c[Se+8>>2]=c[A+8>>2],c[Se+12>>2]=c[A+12>>2],qg(Se,g,Ne),c[d>>2]=0,G=h+u+((h|0)==6&1)|0,(G|0)<=(u|0)){N=ht;return}b=c[g>>2]|0,x=u+6|0,S=16960+(b<<2)|0,O=ie+8|0,z=ne+8|0,j=re+8|0,V=ve+4|0,_=0,y=u,h=-1;e:for(;;){if(g=(y|0)%6|0,A=Ne+(g<<4)|0,c[ve>>2]=c[A>>2],c[ve+4>>2]=c[A+4>>2],c[ve+8>>2]=c[A+8>>2],c[ve+12>>2]=c[A+12>>2],A=_,_=zs(ve,b,0,1)|0,(y|0)>(u|0)&(Jn(l)|0)!=0&&(A|0)!=1&&(c[ve>>2]|0)!=(h|0)){switch(Ji(Ne+(((g+5|0)%6|0)<<4)+4|0,Ce),Ji(Ne+(g<<4)+4|0,se),lt=+(c[S>>2]|0),k[ie>>3]=lt*3,k[O>>3]=0,ct=lt*-1.5,k[ne>>3]=ct,k[z>>3]=lt*2.598076211353316,k[re>>3]=ct,k[j>>3]=lt*-2.598076211353316,g=c[Se>>2]|0,c[17040+(g*80|0)+(((h|0)==(g|0)?c[ve>>2]|0:h)<<2)>>2]|0){case 1:{A=ne,h=ie;break}case 3:{A=re,h=ne;break}case 2:{A=ie,h=re;break}default:{A=8;break e}}Am(Ce,se,h,A,Z),!(cm(Ce,Z)|0)&&!(cm(se,Z)|0)&&(ha(Z,c[Se>>2]|0,b,1,d+8+(c[d>>2]<<4)|0),c[d>>2]=(c[d>>2]|0)+1)}if((y|0)<(x|0)&&(Ji(V,Ce),ha(Ce,c[ve>>2]|0,b,1,d+8+(c[d>>2]<<4)|0),c[d>>2]=(c[d>>2]|0)+1),y=y+1|0,(y|0)>=(G|0)){A=3;break}else h=c[ve>>2]|0}if((A|0)==3){N=ht;return}else(A|0)==8&&We(22606,22569,736,22651)}function qg(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0;b=N,N=N+160|0,h=b+80|0,d=b,g=h,_=20368,y=g+72|0;do c[g>>2]=c[_>>2],g=g+4|0,_=_+4|0;while((g|0)<(y|0));g=d,_=20448,y=g+72|0;do c[g>>2]=c[_>>2],g=g+4|0,_=_+4|0;while((g|0)<(y|0));y=(Jn(c[l>>2]|0)|0)==0,h=y?h:d,d=A+4|0,Qg(d),Yg(d),Jn(c[l>>2]|0)|0&&(es(d),c[l>>2]=(c[l>>2]|0)+1),c[u>>2]=c[A>>2],l=u+4|0,Cn(d,h,l),dn(l),c[u+16>>2]=c[A>>2],l=u+20|0,Cn(d,h+12|0,l),dn(l),c[u+32>>2]=c[A>>2],l=u+36|0,Cn(d,h+24|0,l),dn(l),c[u+48>>2]=c[A>>2],l=u+52|0,Cn(d,h+36|0,l),dn(l),c[u+64>>2]=c[A>>2],l=u+68|0,Cn(d,h+48|0,l),dn(l),c[u+80>>2]=c[A>>2],u=u+84|0,Cn(d,h+60|0,u),dn(u),N=b}function wT(A,l){return A=A|0,l=l|0,l=de(A|0,l|0,52)|0,F()|0,l&15|0}function Gg(A,l){return A=A|0,l=l|0,l=de(A|0,l|0,45)|0,F()|0,l&127|0}function Uf(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0;if(!(!0&(l&-16777216|0)==134217728)||(_=de(A|0,l|0,45)|0,F()|0,_=_&127,_>>>0>121))return l=0,l|0;u=de(A|0,l|0,52)|0,F()|0,u=u&15;do if(u|0){for(d=1,h=0;;){if(g=de(A|0,l|0,(15-d|0)*3|0)|0,F()|0,g=g&7,(g|0)!=0&(h^1))if((g|0)==1&(xt(_)|0)!=0){y=0,h=13;break}else h=1;if((g|0)==7){y=0,h=13;break}if(d>>>0<u>>>0)d=d+1|0;else{h=9;break}}if((h|0)==9){if((u|0)==15)y=1;else break;return y|0}else if((h|0)==13)return y|0}while(!1);for(;;){if(y=de(A|0,l|0,(14-u|0)*3|0)|0,F()|0,!((y&7|0)==7&!0)){y=0,h=13;break}if(u>>>0<14)u=u+1|0;else{y=1,h=13;break}}return(h|0)==13?y|0:0}function Vf(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0;if(g=de(A|0,l|0,52)|0,F()|0,g=g&15,u>>>0>15)return h=4,h|0;if((g|0)<(u|0))return h=12,h|0;if((g|0)==(u|0))return c[h>>2]=A,c[h+4>>2]=l,h=0,h|0;if(d=xe(u|0,0,52)|0,d=d|A,A=F()|0|l&-15728641,(g|0)>(u|0))do l=xe(7,0,(14-u|0)*3|0)|0,u=u+1|0,d=l|d,A=F()|0|A;while((u|0)<(g|0));return c[h>>2]=d,c[h+4>>2]=A,h=0,h|0}function iA(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0;if(g=de(A|0,l|0,52)|0,F()|0,g=g&15,!((u|0)<16&(g|0)<=(u|0)))return h=4,h|0;d=u-g|0,u=de(A|0,l|0,45)|0,F()|0;e:do if(!(xt(u&127)|0))u=di(7,0,d,((d|0)<0)<<31>>31)|0,d=F()|0;else{t:do if(g|0){for(u=1;_=xe(7,0,(15-u|0)*3|0)|0,!!((_&A|0)==0&((F()|0)&l|0)==0);)if(u>>>0<g>>>0)u=u+1|0;else break t;u=di(7,0,d,((d|0)<0)<<31>>31)|0,d=F()|0;break e}while(!1);u=di(7,0,d,((d|0)<0)<<31>>31)|0,u=gn(u|0,F()|0,5,0)|0,u=st(u|0,F()|0,-5,-1)|0,u=rs(u|0,F()|0,6,0)|0,u=st(u|0,F()|0,1,0)|0,d=F()|0}while(!1);return _=h,c[_>>2]=u,c[_+4>>2]=d,_=0,_|0}function Tt(A,l){A=A|0,l=l|0;var u=0,h=0,d=0;if(d=de(A|0,l|0,45)|0,F()|0,!(xt(d&127)|0))return d=0,d|0;d=de(A|0,l|0,52)|0,F()|0,d=d&15;e:do if(!d)u=0;else for(h=1;;){if(u=de(A|0,l|0,(15-h|0)*3|0)|0,F()|0,u=u&7,u|0)break e;if(h>>>0<d>>>0)h=h+1|0;else{u=0;break}}while(!1);return d=(u|0)==0&1,d|0}function bT(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0;if(_=N,N=N+16|0,g=_,tm(g,A,l,u),l=g,A=c[l>>2]|0,l=c[l+4>>2]|0,(A|0)==0&(l|0)==0)return N=_,0;d=0,u=0;do y=h+(d<<3)|0,c[y>>2]=A,c[y+4>>2]=l,d=st(d|0,u|0,1,0)|0,u=F()|0,nm(g),y=g,A=c[y>>2]|0,l=c[y+4>>2]|0;while(!((A|0)==0&(l|0)==0));return N=_,0}function xT(A,l,u,h){return A=A|0,l=l|0,u=u|0,h=h|0,(h|0)<(u|0)?(u=l,h=A,Xe(u|0),h|0):(u=xe(-1,-1,((h-u|0)*3|0)+3|0)|0,h=xe(~u|0,~(F()|0)|0,(15-h|0)*3|0)|0,u=~(F()|0)&l,h=~h&A,Xe(u|0),h|0)}function TT(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0;return d=de(A|0,l|0,52)|0,F()|0,d=d&15,(u|0)<16&(d|0)<=(u|0)?((d|0)<(u|0)&&(d=xe(-1,-1,((u+-1-d|0)*3|0)+3|0)|0,d=xe(~d|0,~(F()|0)|0,(15-u|0)*3|0)|0,l=~(F()|0)&l,A=~d&A),d=xe(u|0,0,52)|0,u=l&-15728641|(F()|0),c[h>>2]=A|d,c[h+4>>2]=u,h=0,h|0):(h=4,h|0)}function ET(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0,Z=0,Se=0,Ne=0,ve=0,Ce=0;if((u|0)==0&(h|0)==0)return ve=0,ve|0;if(d=A,g=c[d>>2]|0,d=c[d+4>>2]|0,!0&(d&15728640|0)==0){if(!((h|0)>0|(h|0)==0&u>>>0>0)||(ve=l,c[ve>>2]=g,c[ve+4>>2]=d,(u|0)==1&(h|0)==0))return ve=0,ve|0;d=1;do Se=A+(d<<3)|0,Ne=c[Se+4>>2]|0,ve=l+(d<<3)|0,c[ve>>2]=c[Se>>2],c[ve+4>>2]=Ne,d=d+1|0;while(0<(h|0)|(h|0)==0&d>>>0<u>>>0);return d=0,d|0}if(Z=u<<3,Ne=Pr(Z)|0,!Ne)return ve=13,ve|0;if(aA(Ne|0,A|0,Z|0)|0,Se=kr(u,8)|0,!Se)return Qe(Ne),ve=13,ve|0;e:do if(u|0){t:for(;;){d=Ne,ie=c[d>>2]|0,d=c[d+4>>2]|0,ne=de(ie|0,d|0,52)|0,F()|0,ne=ne&15,re=ne+-1|0,se=(u|0)>0;n:do if((ne|0)!=0&se){if(j=((u|0)<0)<<31>>31,V=xe(re|0,0,52)|0,G=F()|0,re>>>0>15){if(!((ie|0)==0&(d|0)==0)){ve=17;break t}for(g=0;;){if(g=g+1|0,(g|0)>=(u|0))break n;if(h=Ne+(g<<3)|0,G=c[h>>2]|0,h=c[h+4>>2]|0,!((G|0)==0&(h|0)==0)){d=h,ve=17;break t}}}for(g=0,A=ie,h=d;;){if(!((A|0)==0&(h|0)==0)){if(!(!0&(h&117440512|0)==0)){ve=22;break t}if(y=de(A|0,h|0,52)|0,F()|0,y=y&15,(y|0)<(re|0)){d=12,ve=28;break t}if((y|0)!=(re|0)&&(A=A|V,h=h&-15728641|G,y>>>0>=ne>>>0)){_=re;do z=xe(7,0,(14-_|0)*3|0)|0,_=_+1|0,A=z|A,h=F()|0|h;while(_>>>0<y>>>0)}if(_=$s(A|0,h|0,u|0,j|0)|0,F()|0,x=Se+(_<<3)|0,y=x,b=c[y>>2]|0,y=c[y+4>>2]|0,(b|0)==0&(y|0)==0)_=x;else for(z=0;;){if((z|0)>(u|0)){ve=32;break t}if((b|0)==(A|0)&(y&-117440513|0)==(h|0)){S=de(b|0,y|0,56)|0,F()|0,S=S&7,O=S+1|0,Ce=de(b|0,y|0,45)|0,F()|0;r:do if(!(xt(Ce&127)|0))y=7;else{if(b=de(b|0,y|0,52)|0,F()|0,b=b&15,!b){y=6;break}for(y=1;;){if(Ce=xe(7,0,(15-y|0)*3|0)|0,!((Ce&A|0)==0&((F()|0)&h|0)==0)){y=7;break r}if(y>>>0<b>>>0)y=y+1|0;else{y=6;break}}}while(!1);if((S+2|0)>>>0>y>>>0){ve=42;break t}Ce=xe(O|0,0,56)|0,h=F()|0|h&-117440513,O=x,c[O>>2]=0,c[O+4>>2]=0,A=Ce|A}else _=(_+1|0)%(u|0)|0;if(x=Se+(_<<3)|0,y=x,b=c[y>>2]|0,y=c[y+4>>2]|0,(b|0)==0&(y|0)==0){_=x;break}else z=z+1|0}Ce=_,c[Ce>>2]=A,c[Ce+4>>2]=h}if(g=g+1|0,(g|0)>=(u|0))break n;h=Ne+(g<<3)|0,A=c[h>>2]|0,h=c[h+4>>2]|0}}while(!1);if((u+5|0)>>>0<11){ve=85;break}if(G=kr((u|0)/6|0,8)|0,!G){ve=49;break}n:do if(se){z=0,O=0;do{if(y=Se+(z<<3)|0,h=y,g=c[h>>2]|0,h=c[h+4>>2]|0,!((g|0)==0&(h|0)==0)){b=de(g|0,h|0,56)|0,F()|0,b=b&7,A=b+1|0,x=h&-117440513,Ce=de(g|0,h|0,45)|0,F()|0;r:do if(xt(Ce&127)|0){if(S=de(g|0,h|0,52)|0,F()|0,S=S&15,S|0)for(_=1;;){if(Ce=xe(7,0,(15-_|0)*3|0)|0,!((g&Ce|0)==0&(x&(F()|0)|0)==0))break r;if(_>>>0<S>>>0)_=_+1|0;else break}h=xe(A|0,0,56)|0,g=h|g,h=F()|0|x,A=y,c[A>>2]=g,c[A+4>>2]=h,A=b+2|0}while(!1);(A|0)==7&&(Ce=G+(O<<3)|0,c[Ce>>2]=g,c[Ce+4>>2]=h&-117440513,O=O+1|0)}z=z+1|0}while((z|0)!=(u|0));if(se){if(z=((u|0)<0)<<31>>31,j=xe(re|0,0,52)|0,V=F()|0,re>>>0>15){if(!((ie|0)==0&(d|0)==0)){d=4,ve=84;break t}for(d=0;;){if(d=d+1|0,(d|0)>=(u|0)){g=0,d=O;break n}if(Ce=Ne+(d<<3)|0,!((c[Ce>>2]|0)==0&(c[Ce+4>>2]|0)==0)){d=4,ve=84;break t}}}for(S=0,g=0,x=ie;;){do if(!((x|0)==0&(d|0)==0)){if(y=de(x|0,d|0,52)|0,F()|0,y=y&15,(y|0)<(re|0)){d=12,ve=84;break t}do if((y|0)==(re|0))h=x,y=d;else{if(h=x|j,A=d&-15728641|V,y>>>0<ne>>>0){y=A;break}_=re;do Ce=xe(7,0,(14-_|0)*3|0)|0,_=_+1|0,h=Ce|h,A=F()|0|A;while(_>>>0<y>>>0);y=A}while(!1);for(_=$s(h|0,y|0,u|0,z|0)|0,F()|0,A=0;;){if((A|0)>(u|0)){ve=77;break t}if(Ce=Se+(_<<3)|0,b=c[Ce+4>>2]|0,(b&-117440513|0)==(y|0)&&(c[Ce>>2]|0)==(h|0)){ve=79;break}if(_=(_+1|0)%(u|0)|0,Ce=Se+(_<<3)|0,(c[Ce>>2]|0)==(h|0)&&(c[Ce+4>>2]|0)==(y|0))break;A=A+1|0}if((ve|0)==79&&(ve=0,!0&(b&117440512|0)==100663296))break;Ce=l+(g<<3)|0,c[Ce>>2]=x,c[Ce+4>>2]=d,g=g+1|0}while(!1);if(d=S+1|0,(d|0)>=(u|0)){d=O;break n}Ce=Ne+(d<<3)|0,S=d,x=c[Ce>>2]|0,d=c[Ce+4>>2]|0}}else g=0,d=O}else g=0,d=0;while(!1);if(is(Se|0,0,Z|0)|0,aA(Ne|0,G|0,d<<3|0)|0,Qe(G),d)l=l+(g<<3)|0,u=d;else break e}if((ve|0)==17)!0&(d&117440512|0)==0?(d=4,ve=28):ve=22;else if((ve|0)==32)We(23313,22674,362,22684);else{if((ve|0)==42)return Qe(Ne),Qe(Se),Ce=10,Ce|0;if((ve|0)==49)return Qe(Ne),Qe(Se),Ce=13,Ce|0;if((ve|0)==77)We(23313,22674,462,22684);else{if((ve|0)==84)return Qe(G),Qe(Ne),Qe(Se),Ce=d,Ce|0;if((ve|0)==85){aA(l|0,Ne|0,u<<3|0)|0;break}}}if((ve|0)==22)return Qe(Ne),Qe(Se),Ce=5,Ce|0;if((ve|0)==28)return Qe(Ne),Qe(Se),Ce=d,Ce|0}while(!1);return Qe(Ne),Qe(Se),Ce=0,Ce|0}function ST(A,l,u,h,d,g,_){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0,g=g|0,_=_|0;var y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0;if(G=N,N=N+16|0,V=G,!((u|0)>0|(u|0)==0&l>>>0>0))return V=0,N=G,V|0;if((_|0)>=16)return V=12,N=G,V|0;z=0,j=0,O=0,y=0;e:for(;;){if(x=A+(z<<3)|0,b=c[x>>2]|0,x=c[x+4>>2]|0,S=de(b|0,x|0,52)|0,F()|0,(S&15|0)>(_|0)){y=12,b=11;break}if(tm(V,b,x,_),S=V,x=c[S>>2]|0,S=c[S+4>>2]|0,(x|0)==0&(S|0)==0)b=O;else{b=O;do{if(!((y|0)<(g|0)|(y|0)==(g|0)&b>>>0<d>>>0)){b=10;break e}O=h+(b<<3)|0,c[O>>2]=x,c[O+4>>2]=S,b=st(b|0,y|0,1,0)|0,y=F()|0,nm(V),O=V,x=c[O>>2]|0,S=c[O+4>>2]|0}while(!((x|0)==0&(S|0)==0))}if(z=st(z|0,j|0,1,0)|0,j=F()|0,(j|0)<(u|0)|(j|0)==(u|0)&z>>>0<l>>>0)O=b;else{y=0,b=11;break}}return(b|0)==10?(V=14,N=G,V|0):(b|0)==11?(N=G,y|0):0}function CT(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0;z=N,N=N+16|0,O=z;e:do if((u|0)>0|(u|0)==0&l>>>0>0){for(x=0,_=0,g=0,S=0;;){if(b=A+(x<<3)|0,y=c[b>>2]|0,b=c[b+4>>2]|0,!((y|0)==0&(b|0)==0)&&(b=(iA(y,b,h,O)|0)==0,y=O,_=st(c[y>>2]|0,c[y+4>>2]|0,_|0,g|0)|0,g=F()|0,!b)){g=12;break}if(x=st(x|0,S|0,1,0)|0,S=F()|0,!((S|0)<(u|0)|(S|0)==(u|0)&x>>>0<l>>>0))break e}return N=z,g|0}else _=0,g=0;while(!1);return c[d>>2]=_,c[d+4>>2]=g,d=0,N=z,d|0}function PT(A,l){return A=A|0,l=l|0,l=de(A|0,l|0,52)|0,F()|0,l&1|0}function Dn(A,l){A=A|0,l=l|0;var u=0,h=0,d=0;if(d=de(A|0,l|0,52)|0,F()|0,d=d&15,!d)return d=0,d|0;for(h=1;;){if(u=de(A|0,l|0,(15-h|0)*3|0)|0,F()|0,u=u&7,u|0){h=5;break}if(h>>>0<d>>>0)h=h+1|0;else{u=0,h=5;break}}return(h|0)==5?u|0:0}function zf(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0,b=0;if(b=de(A|0,l|0,52)|0,F()|0,b=b&15,!b)return y=l,b=A,Xe(y|0),b|0;for(y=1,u=0;;){g=(15-y|0)*3|0,h=xe(7,0,g|0)|0,d=F()|0,_=de(A|0,l|0,g|0)|0,F()|0,g=xe(ts(_&7)|0,0,g|0)|0,_=F()|0,A=g|A&~h,l=_|l&~d;e:do if(!u)if((g&h|0)==0&(_&d|0)==0)u=0;else if(h=de(A|0,l|0,52)|0,F()|0,h=h&15,!h)u=1;else{u=1;t:for(;;){switch(_=de(A|0,l|0,(15-u|0)*3|0)|0,F()|0,_&7){case 1:break t;case 0:break;default:{u=1;break e}}if(u>>>0<h>>>0)u=u+1|0;else{u=1;break e}}for(u=1;;)if(_=(15-u|0)*3|0,d=de(A|0,l|0,_|0)|0,F()|0,g=xe(7,0,_|0)|0,l=l&~(F()|0),_=xe(ts(d&7)|0,0,_|0)|0,A=A&~g|_,l=l|(F()|0),u>>>0<h>>>0)u=u+1|0;else{u=1;break}}while(!1);if(y>>>0<b>>>0)y=y+1|0;else break}return Xe(l|0),A|0}function ns(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0;if(h=de(A|0,l|0,52)|0,F()|0,h=h&15,!h)return u=l,h=A,Xe(u|0),h|0;for(u=1;g=(15-u|0)*3|0,_=de(A|0,l|0,g|0)|0,F()|0,d=xe(7,0,g|0)|0,l=l&~(F()|0),g=xe(ts(_&7)|0,0,g|0)|0,A=g|A&~d,l=F()|0|l,u>>>0<h>>>0;)u=u+1|0;return Xe(l|0),A|0}function kT(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0,b=0;if(b=de(A|0,l|0,52)|0,F()|0,b=b&15,!b)return y=l,b=A,Xe(y|0),b|0;for(y=1,u=0;;){g=(15-y|0)*3|0,h=xe(7,0,g|0)|0,d=F()|0,_=de(A|0,l|0,g|0)|0,F()|0,g=xe(hi(_&7)|0,0,g|0)|0,_=F()|0,A=g|A&~h,l=_|l&~d;e:do if(!u)if((g&h|0)==0&(_&d|0)==0)u=0;else if(h=de(A|0,l|0,52)|0,F()|0,h=h&15,!h)u=1;else{u=1;t:for(;;){switch(_=de(A|0,l|0,(15-u|0)*3|0)|0,F()|0,_&7){case 1:break t;case 0:break;default:{u=1;break e}}if(u>>>0<h>>>0)u=u+1|0;else{u=1;break e}}for(u=1;;)if(d=(15-u|0)*3|0,g=xe(7,0,d|0)|0,_=l&~(F()|0),l=de(A|0,l|0,d|0)|0,F()|0,l=xe(hi(l&7)|0,0,d|0)|0,A=A&~g|l,l=_|(F()|0),u>>>0<h>>>0)u=u+1|0;else{u=1;break}}while(!1);if(y>>>0<b>>>0)y=y+1|0;else break}return Xe(l|0),A|0}function jf(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0;if(h=de(A|0,l|0,52)|0,F()|0,h=h&15,!h)return u=l,h=A,Xe(u|0),h|0;for(u=1;_=(15-u|0)*3|0,g=xe(7,0,_|0)|0,d=l&~(F()|0),l=de(A|0,l|0,_|0)|0,F()|0,l=xe(hi(l&7)|0,0,_|0)|0,A=l|A&~g,l=F()|0|d,u>>>0<h>>>0;)u=u+1|0;return Xe(l|0),A|0}function RT(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0;if(b=N,N=N+64|0,y=b+40|0,h=b+24|0,d=b+12|0,g=b,xe(l|0,0,52)|0,u=F()|0|134225919,!l)return(c[A+4>>2]|0)>2||(c[A+8>>2]|0)>2||(c[A+12>>2]|0)>2?(_=0,y=0,Xe(_|0),N=b,y|0):(xe(Lg(A)|0,0,45)|0,_=F()|0|u,y=-1,Xe(_|0),N=b,y|0);if(c[y>>2]=c[A>>2],c[y+4>>2]=c[A+4>>2],c[y+8>>2]=c[A+8>>2],c[y+12>>2]=c[A+12>>2],_=y+4|0,(l|0)>0)for(A=-1;c[h>>2]=c[_>>2],c[h+4>>2]=c[_+4>>2],c[h+8>>2]=c[_+8>>2],l&1?(sT(_),c[d>>2]=c[_>>2],c[d+4>>2]=c[_+4>>2],c[d+8>>2]=c[_+8>>2],tA(d)):($g(_),c[d>>2]=c[_>>2],c[d+4>>2]=c[_+4>>2],c[d+8>>2]=c[_+8>>2],es(d)),Df(h,d,g),dn(g),S=(15-l|0)*3|0,x=xe(7,0,S|0)|0,u=u&~(F()|0),S=xe(eA(g)|0,0,S|0)|0,A=S|A&~x,u=F()|0|u,(l|0)>1;)l=l+-1|0;else A=-1;e:do if((c[_>>2]|0)<=2&&(c[y+8>>2]|0)<=2&&(c[y+12>>2]|0)<=2){if(h=Lg(y)|0,l=xe(h|0,0,45)|0,l=l|A,A=F()|0|u&-1040385,g=Kx(y)|0,!(xt(h)|0)){if((g|0)<=0)break;for(d=0;;){if(h=de(l|0,A|0,52)|0,F()|0,h=h&15,h)for(u=1;S=(15-u|0)*3|0,y=de(l|0,A|0,S|0)|0,F()|0,x=xe(7,0,S|0)|0,A=A&~(F()|0),S=xe(ts(y&7)|0,0,S|0)|0,l=l&~x|S,A=A|(F()|0),u>>>0<h>>>0;)u=u+1|0;if(d=d+1|0,(d|0)==(g|0))break e}}d=de(l|0,A|0,52)|0,F()|0,d=d&15;t:do if(d){u=1;n:for(;;){switch(S=de(l|0,A|0,(15-u|0)*3|0)|0,F()|0,S&7){case 1:break n;case 0:break;default:break t}if(u>>>0<d>>>0)u=u+1|0;else break t}if(Ug(h,c[y>>2]|0)|0)for(u=1;y=(15-u|0)*3|0,x=xe(7,0,y|0)|0,S=A&~(F()|0),A=de(l|0,A|0,y|0)|0,F()|0,A=xe(hi(A&7)|0,0,y|0)|0,l=l&~x|A,A=S|(F()|0),u>>>0<d>>>0;)u=u+1|0;else for(u=1;S=(15-u|0)*3|0,y=de(l|0,A|0,S|0)|0,F()|0,x=xe(7,0,S|0)|0,A=A&~(F()|0),S=xe(ts(y&7)|0,0,S|0)|0,l=l&~x|S,A=A|(F()|0),u>>>0<d>>>0;)u=u+1|0}while(!1);if((g|0)>0){u=0;do l=zf(l,A)|0,A=F()|0,u=u+1|0;while((u|0)!=(g|0))}}else l=0,A=0;while(!1);return x=A,S=l,Xe(x|0),N=b,S|0}function Jn(A){return A=A|0,(A|0)%2|0|0}function Jg(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0;return d=N,N=N+16|0,h=d,l>>>0>15?(h=4,N=d,h|0):(c[A+4>>2]&2146435072|0)==2146435072||(c[A+8+4>>2]&2146435072|0)==2146435072?(h=3,N=d,h|0):(gT(A,l,h),l=RT(h,l)|0,h=F()|0,c[u>>2]=l,c[u+4>>2]=h,(l|0)==0&(h|0)==0&&We(23313,22674,786,22697),h=0,N=d,h|0)}function Wf(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0;if(d=u+4|0,g=de(A|0,l|0,52)|0,F()|0,g=g&15,_=de(A|0,l|0,45)|0,F()|0,h=(g|0)==0,xt(_&127)|0){if(h)return _=1,_|0;h=1}else{if(h)return _=0,_|0;!(c[d>>2]|0)&&!(c[u+8>>2]|0)?h=(c[u+12>>2]|0)!=0&1:h=1}for(u=1;u&1?tA(d):es(d),_=de(A|0,l|0,(15-u|0)*3|0)|0,F()|0,Hg(d,_&7),u>>>0<g>>>0;)u=u+1|0;return h|0}function js(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0;if(S=N,N=N+16|0,b=S,x=de(A|0,l|0,45)|0,F()|0,x=x&127,x>>>0>121)return c[u>>2]=0,c[u+4>>2]=0,c[u+8>>2]=0,c[u+12>>2]=0,x=5,N=S,x|0;e:do if(xt(x)|0&&(g=de(A|0,l|0,52)|0,F()|0,g=g&15,(g|0)!=0)){h=1;t:for(;;){switch(y=de(A|0,l|0,(15-h|0)*3|0)|0,F()|0,y&7){case 5:break t;case 0:break;default:{h=l;break e}}if(h>>>0<g>>>0)h=h+1|0;else{h=l;break e}}for(d=1,h=l;l=(15-d|0)*3|0,_=xe(7,0,l|0)|0,y=h&~(F()|0),h=de(A|0,h|0,l|0)|0,F()|0,h=xe(hi(h&7)|0,0,l|0)|0,A=A&~_|h,h=y|(F()|0),d>>>0<g>>>0;)d=d+1|0}else h=l;while(!1);if(y=7696+(x*28|0)|0,c[u>>2]=c[y>>2],c[u+4>>2]=c[y+4>>2],c[u+8>>2]=c[y+8>>2],c[u+12>>2]=c[y+12>>2],!(Wf(A,h,u)|0))return x=0,N=S,x|0;if(_=u+4|0,c[b>>2]=c[_>>2],c[b+4>>2]=c[_+4>>2],c[b+8>>2]=c[_+8>>2],g=de(A|0,h|0,52)|0,F()|0,y=g&15,g&1?(es(_),g=y+1|0):g=y,!(xt(x)|0))h=0;else{e:do if(!y)h=0;else for(l=1;;){if(d=de(A|0,h|0,(15-l|0)*3|0)|0,F()|0,d=d&7,d|0){h=d;break e}if(l>>>0<y>>>0)l=l+1|0;else{h=0;break}}while(!1);h=(h|0)==4&1}if(!(zs(u,g,h,0)|0))(g|0)!=(y|0)&&(c[_>>2]=c[b>>2],c[_+4>>2]=c[b+4>>2],c[_+8>>2]=c[b+8>>2]);else{if(xt(x)|0)do;while(zs(u,g,0,0)|0);(g|0)!=(y|0)&&$g(_)}return x=0,N=S,x|0}function da(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0;return g=N,N=N+16|0,h=g,d=js(A,l,h)|0,d|0?(N=g,d|0):(d=de(A|0,l|0,52)|0,F()|0,yT(h,d&15,u),d=0,N=g,d|0)}function pa(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0;if(_=N,N=N+16|0,g=_,h=js(A,l,g)|0,h|0)return g=h,N=_,g|0;h=de(A|0,l|0,45)|0,F()|0,h=(xt(h&127)|0)==0,d=de(A|0,l|0,52)|0,F()|0,d=d&15;e:do if(!h){if(d|0)for(h=1;;){if(y=xe(7,0,(15-h|0)*3|0)|0,!((y&A|0)==0&((F()|0)&l|0)==0))break e;if(h>>>0<d>>>0)h=h+1|0;else break}return Ff(g,d,0,5,u),y=0,N=_,y|0}while(!1);return Lf(g,d,0,6,u),y=0,N=_,y|0}function IT(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0;if(d=de(A|0,l|0,45)|0,F()|0,!(xt(d&127)|0))return d=2,c[u>>2]=d,0;if(d=de(A|0,l|0,52)|0,F()|0,d=d&15,!d)return d=5,c[u>>2]=d,0;for(h=1;;){if(g=xe(7,0,(15-h|0)*3|0)|0,!((g&A|0)==0&((F()|0)&l|0)==0)){h=2,A=6;break}if(h>>>0<d>>>0)h=h+1|0;else{h=5,A=6;break}}return(A|0)==6&&(c[u>>2]=h),0}function em(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0;O=N,N=N+128|0,x=O+112|0,g=O+96|0,S=O,d=de(A|0,l|0,52)|0,F()|0,y=d&15,c[x>>2]=y,_=de(A|0,l|0,45)|0,F()|0,_=_&127;e:do if(xt(_)|0){if(y|0)for(h=1;;){if(b=xe(7,0,(15-h|0)*3|0)|0,!((b&A|0)==0&((F()|0)&l|0)==0)){d=0;break e}if(h>>>0<y>>>0)h=h+1|0;else break}if(d&1)d=1;else return b=xe(y+1|0,0,52)|0,S=F()|0|l&-15728641,x=xe(7,0,(14-y|0)*3|0)|0,S=em((b|A)&~x,S&~(F()|0),u)|0,N=O,S|0}else d=0;while(!1);if(h=js(A,l,g)|0,!h){d?(Zg(g,x,S),b=5):(qg(g,x,S),b=6);e:do if(xt(_)|0)if(!y)A=5;else for(h=1;;){if(_=xe(7,0,(15-h|0)*3|0)|0,!((_&A|0)==0&((F()|0)&l|0)==0)){A=2;break e}if(h>>>0<y>>>0)h=h+1|0;else{A=5;break}}else A=2;while(!1);is(u|0,-1,A<<2|0)|0;e:do if(d)for(g=0;;){if(_=S+(g<<4)|0,vT(_,c[x>>2]|0)|0,_=c[_>>2]|0,y=c[u>>2]|0,(y|0)==-1|(y|0)==(_|0))h=u;else{d=0;do{if(d=d+1|0,d>>>0>=A>>>0){h=1;break e}h=u+(d<<2)|0,y=c[h>>2]|0}while(!((y|0)==-1|(y|0)==(_|0)))}if(c[h>>2]=_,g=g+1|0,g>>>0>=b>>>0){h=0;break}}else for(g=0;;){if(_=S+(g<<4)|0,zs(_,c[x>>2]|0,0,1)|0,_=c[_>>2]|0,y=c[u>>2]|0,(y|0)==-1|(y|0)==(_|0))h=u;else{d=0;do{if(d=d+1|0,d>>>0>=A>>>0){h=1;break e}h=u+(d<<2)|0,y=c[h>>2]|0}while(!((y|0)==-1|(y|0)==(_|0)))}if(c[h>>2]=_,g=g+1|0,g>>>0>=b>>>0){h=0;break}}while(!1)}return S=h,N=O,S|0}function MT(){return 12}function $f(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0,b=0;if(A>>>0>15)return y=4,y|0;if(xe(A|0,0,52)|0,y=F()|0|134225919,!A){u=0,h=0;do xt(h)|0&&(xe(h|0,0,45)|0,_=y|(F()|0),A=l+(u<<3)|0,c[A>>2]=-1,c[A+4>>2]=_,u=u+1|0),h=h+1|0;while((h|0)!=122);return u=0,u|0}u=0,_=0;do{if(xt(_)|0){for(xe(_|0,0,45)|0,h=1,d=-1,g=y|(F()|0);b=xe(7,0,(15-h|0)*3|0)|0,d=d&~b,g=g&~(F()|0),(h|0)!=(A|0);)h=h+1|0;b=l+(u<<3)|0,c[b>>2]=d,c[b+4>>2]=g,u=u+1|0}_=_+1|0}while((_|0)!=122);return u=0,u|0}function NT(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0;if(ne=N,N=N+16|0,se=ne,ie=de(A|0,l|0,52)|0,F()|0,ie=ie&15,u>>>0>15)return ie=4,N=ne,ie|0;if((ie|0)<(u|0))return ie=12,N=ne,ie|0;if((ie|0)!=(u|0))if(g=xe(u|0,0,52)|0,g=g|A,y=F()|0|l&-15728641,(ie|0)>(u|0)){b=u;do G=xe(7,0,(14-b|0)*3|0)|0,b=b+1|0,g=G|g,y=F()|0|y;while((b|0)<(ie|0));G=g}else G=g;else G=A,y=l;V=de(G|0,y|0,45)|0,F()|0;e:do if(xt(V&127)|0){if(b=de(G|0,y|0,52)|0,F()|0,b=b&15,b|0)for(g=1;;){if(V=xe(7,0,(15-g|0)*3|0)|0,!((V&G|0)==0&((F()|0)&y|0)==0)){x=33;break e}if(g>>>0<b>>>0)g=g+1|0;else break}if(V=h,c[V>>2]=0,c[V+4>>2]=0,(ie|0)>(u|0)){for(V=l&-15728641,j=ie;;){if(z=j,j=j+-1|0,j>>>0>15|(ie|0)<(j|0)){x=19;break}if((ie|0)!=(j|0))if(g=xe(j|0,0,52)|0,g=g|A,b=F()|0|V,(ie|0)<(z|0))O=g;else{x=j;do O=xe(7,0,(14-x|0)*3|0)|0,x=x+1|0,g=O|g,b=F()|0|b;while((x|0)<(ie|0));O=g}else O=A,b=l;if(S=de(O|0,b|0,45)|0,F()|0,!(xt(S&127)|0))g=0;else{S=de(O|0,b|0,52)|0,F()|0,S=S&15;t:do if(!S)g=0;else for(x=1;;){if(g=de(O|0,b|0,(15-x|0)*3|0)|0,F()|0,g=g&7,g|0)break t;if(x>>>0<S>>>0)x=x+1|0;else{g=0;break}}while(!1);g=(g|0)==0&1}if(b=de(A|0,l|0,(15-z|0)*3|0)|0,F()|0,b=b&7,(b|0)==7){d=5,x=42;break}if(g=(g|0)!=0,(b|0)==1&g){d=5,x=42;break}if(O=b+(((b|0)!=0&g)<<31>>31)|0,O|0&&(x=ie-z|0,x=di(7,0,x,((x|0)<0)<<31>>31)|0,S=F()|0,g?(g=gn(x|0,S|0,5,0)|0,g=st(g|0,F()|0,-5,-1)|0,g=rs(g|0,F()|0,6,0)|0,g=st(g|0,F()|0,1,0)|0,b=F()|0):(g=x,b=S),z=O+-1|0,z=gn(x|0,S|0,z|0,((z|0)<0)<<31>>31|0)|0,z=st(g|0,b|0,z|0,F()|0)|0,O=F()|0,S=h,S=st(z|0,O|0,c[S>>2]|0,c[S+4>>2]|0)|0,O=F()|0,z=h,c[z>>2]=S,c[z+4>>2]=O),(j|0)<=(u|0)){x=37;break}}if((x|0)==19)We(23313,22674,1099,22710);else if((x|0)==37){_=h,d=c[_+4>>2]|0,_=c[_>>2]|0;break}else if((x|0)==42)return N=ne,d|0}else d=0,_=0}else x=33;while(!1);e:do if((x|0)==33)if(V=h,c[V>>2]=0,c[V+4>>2]=0,(ie|0)>(u|0)){for(g=ie;;){if(d=de(A|0,l|0,(15-g|0)*3|0)|0,F()|0,d=d&7,(d|0)==7){d=5;break}if(_=ie-g|0,_=di(7,0,_,((_|0)<0)<<31>>31)|0,d=gn(_|0,F()|0,d|0,0)|0,_=F()|0,V=h,_=st(c[V>>2]|0,c[V+4>>2]|0,d|0,_|0)|0,d=F()|0,V=h,c[V>>2]=_,c[V+4>>2]=d,g=g+-1|0,(g|0)<=(u|0))break e}return N=ne,d|0}else d=0,_=0;while(!1);return iA(G,y,ie,se)|0&&We(23313,22674,1063,22725),ie=se,se=c[ie+4>>2]|0,((d|0)>-1|(d|0)==-1&_>>>0>4294967295)&((se|0)>(d|0)|((se|0)==(d|0)?(c[ie>>2]|0)>>>0>_>>>0:0))?(ie=0,N=ne,ie|0):(We(23313,22674,1139,22710),0)}function OT(A,l,u,h,d,g){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0,g=g|0;var _=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0;if(O=N,N=N+16|0,_=O,d>>>0>15)return g=4,N=O,g|0;if(y=de(u|0,h|0,52)|0,F()|0,y=y&15,(y|0)>(d|0))return g=12,N=O,g|0;if(iA(u,h,d,_)|0&&We(23313,22674,1063,22725),S=_,x=c[S+4>>2]|0,!(((l|0)>-1|(l|0)==-1&A>>>0>4294967295)&((x|0)>(l|0)|((x|0)==(l|0)?(c[S>>2]|0)>>>0>A>>>0:0))))return g=2,N=O,g|0;S=d-y|0,d=xe(d|0,0,52)|0,b=F()|0|h&-15728641,x=g,c[x>>2]=d|u,c[x+4>>2]=b,x=de(u|0,h|0,45)|0,F()|0;e:do if(xt(x&127)|0){if(y|0)for(_=1;;){if(x=xe(7,0,(15-_|0)*3|0)|0,!((x&u|0)==0&((F()|0)&h|0)==0))break e;if(_>>>0<y>>>0)_=_+1|0;else break}if((S|0)<1)return g=0,N=O,g|0;for(x=y^15,h=-1,b=1,_=1;;){y=S-b|0,y=di(7,0,y,((y|0)<0)<<31>>31)|0,u=F()|0;do if(_)if(_=gn(y|0,u|0,5,0)|0,_=st(_|0,F()|0,-5,-1)|0,_=rs(_|0,F()|0,6,0)|0,d=F()|0,(l|0)>(d|0)|(l|0)==(d|0)&A>>>0>_>>>0){l=st(A|0,l|0,-1,-1)|0,l=pn(l|0,F()|0,_|0,d|0)|0,_=F()|0,z=g,V=c[z>>2]|0,z=c[z+4>>2]|0,G=(x+h|0)*3|0,j=xe(7,0,G|0)|0,z=z&~(F()|0),h=rs(l|0,_|0,y|0,u|0)|0,A=F()|0,d=st(h|0,A|0,2,0)|0,G=xe(d|0,F()|0,G|0)|0,z=F()|0|z,d=g,c[d>>2]=G|V&~j,c[d+4>>2]=z,A=gn(h|0,A|0,y|0,u|0)|0,A=pn(l|0,_|0,A|0,F()|0)|0,_=0,l=F()|0;break}else{G=g,j=c[G>>2]|0,G=c[G+4>>2]|0,V=xe(7,0,(x+h|0)*3|0)|0,G=G&~(F()|0),_=g,c[_>>2]=j&~V,c[_+4>>2]=G,_=1;break}else j=g,d=c[j>>2]|0,j=c[j+4>>2]|0,h=(x+h|0)*3|0,z=xe(7,0,h|0)|0,j=j&~(F()|0),G=rs(A|0,l|0,y|0,u|0)|0,_=F()|0,h=xe(G|0,_|0,h|0)|0,j=F()|0|j,V=g,c[V>>2]=h|d&~z,c[V+4>>2]=j,_=gn(G|0,_|0,y|0,u|0)|0,A=pn(A|0,l|0,_|0,F()|0)|0,_=0,l=F()|0;while(!1);if((S|0)>(b|0))h=~b,b=b+1|0;else{l=0;break}}return N=O,l|0}while(!1);if((S|0)<1)return G=0,N=O,G|0;for(d=y^15,_=1;;)if(V=S-_|0,V=di(7,0,V,((V|0)<0)<<31>>31)|0,G=F()|0,b=g,u=c[b>>2]|0,b=c[b+4>>2]|0,y=(d-_|0)*3|0,h=xe(7,0,y|0)|0,b=b&~(F()|0),z=rs(A|0,l|0,V|0,G|0)|0,j=F()|0,y=xe(z|0,j|0,y|0)|0,b=F()|0|b,x=g,c[x>>2]=y|u&~h,c[x+4>>2]=b,G=gn(z|0,j|0,V|0,G|0)|0,A=pn(A|0,l|0,G|0,F()|0)|0,l=F()|0,(S|0)<=(_|0)){l=0;break}else _=_+1|0;return N=O,l|0}function tm(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0;d=de(l|0,u|0,52)|0,F()|0,d=d&15,(l|0)==0&(u|0)==0|((h|0)>15|(d|0)>(h|0))?(h=-1,d=-1,l=0,u=0):(g=xT(l,u,d+1|0,h)|0,u=(F()|0)&-15728641,l=xe(h|0,0,52)|0,l=g|l,u=u|(F()|0),g=(Tt(l,u)|0)==0,h=g?-1:h),g=A,c[g>>2]=l,c[g+4>>2]=u,c[A+8>>2]=d,c[A+12>>2]=h}function nm(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0,b=0,x=0;if(u=A,l=c[u>>2]|0,u=c[u+4>>2]|0,!((l|0)==0&(u|0)==0)&&(h=de(l|0,u|0,52)|0,F()|0,h=h&15,y=xe(1,0,(h^15)*3|0)|0,l=st(y|0,F()|0,l|0,u|0)|0,u=F()|0,y=A,c[y>>2]=l,c[y+4>>2]=u,y=A+8|0,_=c[y>>2]|0,!((h|0)<(_|0)))){for(b=A+12|0,g=h;;){if((g|0)==(_|0)){h=5;break}if(x=(g|0)==(c[b>>2]|0),d=(15-g|0)*3|0,h=de(l|0,u|0,d|0)|0,F()|0,h=h&7,x&((h|0)==1&!0)){h=7;break}if(!((h|0)==7&!0)){h=10;break}if(x=xe(1,0,d|0)|0,l=st(l|0,u|0,x|0,F()|0)|0,u=F()|0,x=A,c[x>>2]=l,c[x+4>>2]=u,(g|0)>(_|0))g=g+-1|0;else{h=10;break}}if((h|0)==5){x=A,c[x>>2]=0,c[x+4>>2]=0,c[y>>2]=-1,c[b>>2]=-1;return}else if((h|0)==7){_=xe(1,0,d|0)|0,_=st(l|0,u|0,_|0,F()|0)|0,y=F()|0,x=A,c[x>>2]=_,c[x+4>>2]=y,c[b>>2]=g+-1;return}else if((h|0)==10)return}}function ga(A){A=+A;var l=0;return l=A<0?A+6.283185307179586:A,+(A>=6.283185307179586?l+-6.283185307179586:l)}function Ws(A,l){return A=A|0,l=l|0,+Me(+(+k[A>>3]-+k[l>>3]))<17453292519943298e-27?(l=+Me(+(+k[A+8>>3]-+k[l+8>>3]))<17453292519943298e-27,l|0):(l=0,l|0)}function DT(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0;return d=+k[l>>3],h=+k[A>>3],g=+Ue(+((d-h)*.5)),u=+Ue(+((+k[l+8>>3]-+k[A+8>>3])*.5)),u=g*g+u*(+Ie(+d)*+Ie(+h)*u),+(+Nt(+ +je(+u),+ +je(+(1-u)))*2)}function ma(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0;return d=+k[l>>3],h=+k[A>>3],g=+Ue(+((d-h)*.5)),u=+Ue(+((+k[l+8>>3]-+k[A+8>>3])*.5)),u=g*g+u*(+Ie(+d)*+Ie(+h)*u),+(+Nt(+ +je(+u),+ +je(+(1-u)))*2*6371.007180918475)}function BT(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0;return d=+k[l>>3],h=+k[A>>3],g=+Ue(+((d-h)*.5)),u=+Ue(+((+k[l+8>>3]-+k[A+8>>3])*.5)),u=g*g+u*(+Ie(+d)*+Ie(+h)*u),+(+Nt(+ +je(+u),+ +je(+(1-u)))*2*6371.007180918475*1e3)}function FT(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0;return g=+k[l>>3],h=+Ie(+g),d=+k[l+8>>3]-+k[A+8>>3],_=h*+Ue(+d),u=+k[A>>3],+ +Nt(+_,+(+Ue(+g)*+Ie(+u)-+Ie(+d)*(h*+Ue(+u))))}function LT(A,l,u,h){A=A|0,l=+l,u=+u,h=h|0;var d=0,g=0,_=0,y=0;if(u<1e-16){c[h>>2]=c[A>>2],c[h+4>>2]=c[A+4>>2],c[h+8>>2]=c[A+8>>2],c[h+12>>2]=c[A+12>>2];return}g=l<0?l+6.283185307179586:l,g=l>=6.283185307179586?g+-6.283185307179586:g;do if(g<1e-16)l=+k[A>>3]+u,k[h>>3]=l,d=h;else{if(d=+Me(+(g+-3.141592653589793))<1e-16,l=+k[A>>3],d){l=l-u,k[h>>3]=l,d=h;break}if(_=+Ie(+u),u=+Ue(+u),l=_*+Ue(+l)+ +Ie(+g)*(u*+Ie(+l)),l=l>1?1:l,l=+On(+(l<-1?-1:l)),k[h>>3]=l,+Me(+(l+-1.5707963267948966))<1e-16){k[h>>3]=1.5707963267948966,k[h+8>>3]=0;return}if(+Me(+(l+1.5707963267948966))<1e-16){k[h>>3]=-1.5707963267948966,k[h+8>>3]=0;return}if(y=+Ie(+l),g=u*+Ue(+g)/y,u=+k[A>>3],l=(_-+Ue(+l)*+Ue(+u))/+Ie(+u)/y,_=g>1?1:g,l=l>1?1:l,l=+k[A+8>>3]+ +Nt(+(_<-1?-1:_),+(l<-1?-1:l)),l>3.141592653589793)do l=l+-6.283185307179586;while(l>3.141592653589793);if(l<-3.141592653589793)do l=l+6.283185307179586;while(l<-3.141592653589793);k[h+8>>3]=l;return}while(!1);if(+Me(+(l+-1.5707963267948966))<1e-16){k[d>>3]=1.5707963267948966,k[h+8>>3]=0;return}if(+Me(+(l+1.5707963267948966))<1e-16){k[d>>3]=-1.5707963267948966,k[h+8>>3]=0;return}if(l=+k[A+8>>3],l>3.141592653589793)do l=l+-6.283185307179586;while(l>3.141592653589793);if(l<-3.141592653589793)do l=l+6.283185307179586;while(l<-3.141592653589793);k[h+8>>3]=l}function UT(A,l){return A=A|0,l=l|0,A>>>0>15?(l=4,l|0):(k[l>>3]=+k[20528+(A<<3)>>3],l=0,l|0)}function VT(A,l){return A=A|0,l=l|0,A>>>0>15?(l=4,l|0):(k[l>>3]=+k[20656+(A<<3)>>3],l=0,l|0)}function zT(A,l){return A=A|0,l=l|0,A>>>0>15?(l=4,l|0):(k[l>>3]=+k[20784+(A<<3)>>3],l=0,l|0)}function jT(A,l){return A=A|0,l=l|0,A>>>0>15?(l=4,l|0):(k[l>>3]=+k[20912+(A<<3)>>3],l=0,l|0)}function Hf(A,l){A=A|0,l=l|0;var u=0;return A>>>0>15?(l=4,l|0):(u=di(7,0,A,((A|0)<0)<<31>>31)|0,u=gn(u|0,F()|0,120,0)|0,A=F()|0,c[l>>2]=u|2,c[l+4>>2]=A,l=0,l|0)}function rm(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0;return z=+k[l>>3],S=+k[A>>3],b=+Ue(+((z-S)*.5)),g=+k[l+8>>3],x=+k[A+8>>3],_=+Ue(+((g-x)*.5)),y=+Ie(+S),O=+Ie(+z),_=b*b+_*(O*y*_),_=+Nt(+ +je(+_),+ +je(+(1-_)))*2,b=+k[u>>3],z=+Ue(+((b-z)*.5)),h=+k[u+8>>3],g=+Ue(+((h-g)*.5)),d=+Ie(+b),g=z*z+g*(O*d*g),g=+Nt(+ +je(+g),+ +je(+(1-g)))*2,b=+Ue(+((S-b)*.5)),h=+Ue(+((x-h)*.5)),h=b*b+h*(y*d*h),h=+Nt(+ +je(+h),+ +je(+(1-h)))*2,d=(_+g+h)*.5,+(+Gn(+ +je(+(+bt(+(d*.5))*+bt(+((d-_)*.5))*+bt(+((d-g)*.5))*+bt(+((d-h)*.5)))))*4)}function Xf(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0;if(y=N,N=N+192|0,g=y+168|0,_=y,d=da(A,l,g)|0,d|0)return u=d,N=y,u|0;if(pa(A,l,_)|0&&We(23313,22742,386,22751),l=c[_>>2]|0,(l|0)>0){if(h=+rm(_+8|0,_+8+(((l|0)!=1&1)<<4)|0,g)+0,(l|0)!=1){A=1;do d=A,A=A+1|0,h=h+ +rm(_+8+(d<<4)|0,_+8+(((A|0)%(l|0)|0)<<4)|0,g);while((A|0)<(l|0))}}else h=0;return k[u>>3]=h,u=0,N=y,u|0}function WT(A,l,u){return A=A|0,l=l|0,u=u|0,A=Xf(A,l,u)|0,A|0||(k[u>>3]=+k[u>>3]*6371.007180918475*6371.007180918475),A|0}function $T(A,l,u){return A=A|0,l=l|0,u=u|0,A=Xf(A,l,u)|0,A|0||(k[u>>3]=+k[u>>3]*6371.007180918475*6371.007180918475*1e3*1e3),A|0}function HT(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0;if(y=N,N=N+176|0,_=y,A=rA(A,l,_)|0,A|0)return _=A,N=y,_|0;if(k[u>>3]=0,A=c[_>>2]|0,(A|0)<=1)return _=0,N=y,_|0;l=A+-1|0,A=0,h=+k[_+8>>3],d=+k[_+16>>3],g=0;do A=A+1|0,x=h,h=+k[_+8+(A<<4)>>3],S=+Ue(+((h-x)*.5)),b=d,d=+k[_+8+(A<<4)+8>>3],b=+Ue(+((d-b)*.5)),b=S*S+b*(+Ie(+h)*+Ie(+x)*b),g=g+ +Nt(+ +je(+b),+ +je(+(1-b)))*2;while((A|0)<(l|0));return k[u>>3]=g,_=0,N=y,_|0}function XT(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0;if(y=N,N=N+176|0,_=y,A=rA(A,l,_)|0,A|0)return _=A,g=+k[u>>3],g=g*6371.007180918475,k[u>>3]=g,N=y,_|0;if(k[u>>3]=0,A=c[_>>2]|0,(A|0)<=1)return _=0,g=0,g=g*6371.007180918475,k[u>>3]=g,N=y,_|0;l=A+-1|0,A=0,h=+k[_+8>>3],d=+k[_+16>>3],g=0;do A=A+1|0,x=h,h=+k[_+8+(A<<4)>>3],S=+Ue(+((h-x)*.5)),b=d,d=+k[_+8+(A<<4)+8>>3],b=+Ue(+((d-b)*.5)),b=S*S+b*(+Ie(+x)*+Ie(+h)*b),g=g+ +Nt(+ +je(+b),+ +je(+(1-b)))*2;while((A|0)!=(l|0));return k[u>>3]=g,_=0,S=g,S=S*6371.007180918475,k[u>>3]=S,N=y,_|0}function QT(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0;if(y=N,N=N+176|0,_=y,A=rA(A,l,_)|0,A|0)return _=A,g=+k[u>>3],g=g*6371.007180918475,g=g*1e3,k[u>>3]=g,N=y,_|0;if(k[u>>3]=0,A=c[_>>2]|0,(A|0)<=1)return _=0,g=0,g=g*6371.007180918475,g=g*1e3,k[u>>3]=g,N=y,_|0;l=A+-1|0,A=0,h=+k[_+8>>3],d=+k[_+16>>3],g=0;do A=A+1|0,x=h,h=+k[_+8+(A<<4)>>3],S=+Ue(+((h-x)*.5)),b=d,d=+k[_+8+(A<<4)+8>>3],b=+Ue(+((d-b)*.5)),b=S*S+b*(+Ie(+x)*+Ie(+h)*b),g=g+ +Nt(+ +je(+b),+ +je(+(1-b)))*2;while((A|0)!=(l|0));return k[u>>3]=g,_=0,S=g,S=S*6371.007180918475,S=S*1e3,k[u>>3]=S,N=y,_|0}function YT(A){A=A|0;var l=0,u=0,h=0;return l=kr(1,12)|0,l||We(22832,22787,49,22845),u=A+4|0,h=c[u>>2]|0,h|0?(h=h+8|0,c[h>>2]=l,c[u>>2]=l,l|0):(c[A>>2]|0&&We(22862,22787,61,22885),h=A,c[h>>2]=l,c[u>>2]=l,l|0)}function KT(A,l){A=A|0,l=l|0;var u=0,h=0;return h=Pr(24)|0,h||We(22899,22787,78,22913),c[h>>2]=c[l>>2],c[h+4>>2]=c[l+4>>2],c[h+8>>2]=c[l+8>>2],c[h+12>>2]=c[l+12>>2],c[h+16>>2]=0,l=A+4|0,u=c[l>>2]|0,u|0?(c[u+16>>2]=h,c[l>>2]=h,h|0):(c[A>>2]|0&&We(22928,22787,82,22913),c[A>>2]=h,c[l>>2]=h,h|0)}function im(A){A=A|0;var l=0,u=0,h=0,d=0;if(A)for(h=1;;){if(l=c[A>>2]|0,l|0)do{if(u=c[l>>2]|0,u|0)do d=u,u=c[u+16>>2]|0,Qe(d);while(u|0);d=l,l=c[l+8>>2]|0,Qe(d)}while(l|0);if(l=A,A=c[A+8>>2]|0,h||Qe(l),A)h=0;else break}}function ZT(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0,Z=0,Se=0,Ne=0,ve=0,Ce=0,ht=0,lt=0,ct=0,Je=0,Ge=0,et=0,gt=0,Ye=0;if(d=A+8|0,c[d>>2]|0)return Ye=1,Ye|0;if(h=c[A>>2]|0,!h)return Ye=0,Ye|0;l=h,u=0;do u=u+1|0,l=c[l+8>>2]|0;while(l|0);if(u>>>0<2)return Ye=0,Ye|0;et=Pr(u<<2)|0,et||We(22948,22787,317,22967),Ge=Pr(u<<5)|0,Ge||We(22989,22787,321,22967),c[A>>2]=0,Ne=A+4|0,c[Ne>>2]=0,c[d>>2]=0,u=0,Je=0,Se=0,O=0;e:for(;;){if(S=c[h>>2]|0,S){g=0,_=S;do{if(b=+k[_+8>>3],l=_,_=c[_+16>>2]|0,x=(_|0)==0,d=x?S:_,y=+k[d+8>>3],+Me(+(b-y))>3.141592653589793){Ye=14;break}g=g+(y-b)*(+k[l>>3]+ +k[d>>3])}while(!x);if((Ye|0)==14){Ye=0,g=0,l=S;do Z=+k[l+8>>3],ct=l+16|0,lt=c[ct>>2]|0,lt=lt|0?lt:S,re=+k[lt+8>>3],g=g+(+k[l>>3]+ +k[lt>>3])*((re<0?re+6.283185307179586:re)-(Z<0?Z+6.283185307179586:Z)),l=c[(l|0?ct:h)>>2]|0;while(l|0)}g>0?(c[et+(Je<<2)>>2]=h,Je=Je+1|0,d=Se,l=O):Ye=19}else Ye=19;if((Ye|0)==19){Ye=0;do if(u){if(l=u+8|0,c[l>>2]|0){Ye=21;break e}if(u=kr(1,12)|0,!u){Ye=23;break e}c[l>>2]=u,d=u+4|0,_=u,l=O}else if(O){d=Ne,_=O+8|0,l=h,u=A;break}else if(c[A>>2]|0){Ye=27;break e}else{d=Ne,_=A,l=h,u=A;break}while(!1);if(c[_>>2]=h,c[d>>2]=h,_=Ge+(Se<<5)|0,x=c[h>>2]|0,x){for(S=Ge+(Se<<5)+8|0,k[S>>3]=17976931348623157e292,O=Ge+(Se<<5)+24|0,k[O>>3]=17976931348623157e292,k[_>>3]=-17976931348623157e292,z=Ge+(Se<<5)+16|0,k[z>>3]=-17976931348623157e292,ie=17976931348623157e292,ne=-17976931348623157e292,d=0,j=x,b=17976931348623157e292,G=17976931348623157e292,se=-17976931348623157e292,y=-17976931348623157e292;g=+k[j>>3],Z=+k[j+8>>3],j=c[j+16>>2]|0,V=(j|0)==0,re=+k[(V?x:j)+8>>3],g<b&&(k[S>>3]=g,b=g),Z<G&&(k[O>>3]=Z,G=Z),g>se?k[_>>3]=g:g=se,Z>y&&(k[z>>3]=Z,y=Z),ie=Z>0&Z<ie?Z:ie,ne=Z<0&Z>ne?Z:ne,d=d|+Me(+(Z-re))>3.141592653589793,!V;)se=g;d&&(k[z>>3]=ne,k[O>>3]=ie)}else c[_>>2]=0,c[_+4>>2]=0,c[_+8>>2]=0,c[_+12>>2]=0,c[_+16>>2]=0,c[_+20>>2]=0,c[_+24>>2]=0,c[_+28>>2]=0;d=Se+1|0}if(ct=h+8|0,h=c[ct>>2]|0,c[ct>>2]=0,h)Se=d,O=l;else{Ye=45;break}}if((Ye|0)==21)We(22765,22787,35,22799);else if((Ye|0)==23)We(22819,22787,37,22799);else if((Ye|0)==27)We(22862,22787,61,22885);else if((Ye|0)==45){e:do if((Je|0)>0){for(ct=(d|0)==0,ht=d<<2,lt=(A|0)==0,Ce=0,l=0;;){if(ve=c[et+(Ce<<2)>>2]|0,ct)Ye=73;else{if(Se=Pr(ht)|0,!Se){Ye=50;break}if(Ne=Pr(ht)|0,!Ne){Ye=52;break}t:do if(lt)u=0;else{for(d=0,u=0,_=A;h=Ge+(d<<5)|0,sm(c[_>>2]|0,h,c[ve>>2]|0)|0?(c[Se+(u<<2)>>2]=_,c[Ne+(u<<2)>>2]=h,V=u+1|0):V=u,_=c[_+8>>2]|0,_;)d=d+1|0,u=V;if((V|0)>0)if(h=c[Se>>2]|0,(V|0)==1)u=h;else for(z=0,j=-1,u=h,O=h;;){for(x=c[O>>2]|0,h=0,_=0;d=c[c[Se+(_<<2)>>2]>>2]|0,(d|0)==(x|0)?S=h:S=h+((sm(d,c[Ne+(_<<2)>>2]|0,c[x>>2]|0)|0)&1)|0,_=_+1|0,(_|0)!=(V|0);)h=S;if(d=(S|0)>(j|0),u=d?O:u,h=z+1|0,(h|0)==(V|0))break t;z=h,j=d?S:j,O=c[Se+(h<<2)>>2]|0}else u=0}while(!1);if(Qe(Se),Qe(Ne),u){if(d=u+4|0,h=c[d>>2]|0,h)u=h+8|0;else if(c[u>>2]|0){Ye=70;break}c[u>>2]=ve,c[d>>2]=ve}else Ye=73}if((Ye|0)==73){if(Ye=0,l=c[ve>>2]|0,l|0)do Ne=l,l=c[l+16>>2]|0,Qe(Ne);while(l|0);Qe(ve),l=1}if(Ce=Ce+1|0,(Ce|0)>=(Je|0)){gt=l;break e}}(Ye|0)==50?We(23004,22787,249,23023):(Ye|0)==52?We(23042,22787,252,23023):(Ye|0)==70&&We(22862,22787,61,22885)}else gt=0;while(!1);return Qe(et),Qe(Ge),Ye=gt,Ye|0}return 0}function sm(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0;if(!(zg(l,u)|0)||(l=Vg(l)|0,h=+k[u>>3],d=+k[u+8>>3],d=l&d<0?d+6.283185307179586:d,A=c[A>>2]|0,!A))return A=0,A|0;if(l){l=0,x=d,u=A;e:for(;;){for(;_=+k[u>>3],d=+k[u+8>>3],u=u+16|0,S=c[u>>2]|0,S=S|0?S:A,g=+k[S>>3],y=+k[S+8>>3],_>g?(b=_,_=y):(b=g,g=_,_=d,d=y),h=h==g|h==b?h+2220446049250313e-31:h,!!(h<g|h>b);)if(u=c[u>>2]|0,!u){u=22;break e}if(y=_<0?_+6.283185307179586:_,_=d<0?d+6.283185307179586:d,x=y==x|_==x?x+-2220446049250313e-31:x,b=y+(_-y)*((h-g)/(b-g)),(b<0?b+6.283185307179586:b)>x&&(l=l^1),u=c[u>>2]|0,!u){u=22;break}}if((u|0)==22)return l|0}else{l=0,x=d,u=A;e:for(;;){for(;_=+k[u>>3],d=+k[u+8>>3],u=u+16|0,S=c[u>>2]|0,S=S|0?S:A,g=+k[S>>3],y=+k[S+8>>3],_>g?(b=_,_=y):(b=g,g=_,_=d,d=y),h=h==g|h==b?h+2220446049250313e-31:h,!!(h<g|h>b);)if(u=c[u>>2]|0,!u){u=22;break e}if(x=_==x|d==x?x+-2220446049250313e-31:x,_+(d-_)*((h-g)/(b-g))>x&&(l=l^1),u=c[u>>2]|0,!u){u=22;break}}if((u|0)==22)return l|0}return 0}function Kr(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0;if(ne=N,N=N+32|0,ie=ne+16|0,se=ne,g=de(A|0,l|0,52)|0,F()|0,g=g&15,j=de(u|0,h|0,52)|0,F()|0,(g|0)!=(j&15|0))return ie=12,N=ne,ie|0;if(x=de(A|0,l|0,45)|0,F()|0,x=x&127,S=de(u|0,h|0,45)|0,F()|0,S=S&127,x>>>0>121|S>>>0>121)return ie=5,N=ne,ie|0;if(j=(x|0)!=(S|0),j){if(y=Of(x,S)|0,(y|0)==7)return ie=1,N=ne,ie|0;b=Of(S,x)|0,(b|0)==7?We(23066,23090,161,23100):(V=y,_=b)}else V=0,_=0;O=xt(x)|0,z=xt(S)|0,c[ie>>2]=0,c[ie+4>>2]=0,c[ie+8>>2]=0,c[ie+12>>2]=0;do if(V){if(S=c[4272+(x*28|0)+(V<<2)>>2]|0,y=(S|0)>0,z)if(y){x=0,b=u,y=h;do b=kT(b,y)|0,y=F()|0,_=hi(_)|0,(_|0)==1&&(_=hi(1)|0),x=x+1|0;while((x|0)!=(S|0));S=_,x=b,b=y}else S=_,x=u,b=h;else if(y){x=0,b=u,y=h;do b=jf(b,y)|0,y=F()|0,_=hi(_)|0,x=x+1|0;while((x|0)!=(S|0));S=_,x=b,b=y}else S=_,x=u,b=h;if(Wf(x,b,ie)|0,j||We(23115,23090,191,23100),y=(O|0)!=0,_=(z|0)!=0,y&_&&We(23142,23090,192,23100),y){if(_=Dn(A,l)|0,(_|0)==7){g=5;break}if(ge[21872+(_*7|0)+V>>0]|0){g=1;break}b=c[21040+(_*28|0)+(V<<2)>>2]|0,x=b}else if(_){if(_=Dn(x,b)|0,(_|0)==7){g=5;break}if(ge[21872+(_*7|0)+S>>0]|0){g=1;break}x=0,b=c[21040+(S*28|0)+(_<<2)>>2]|0}else x=0,b=0;if((x|b|0)<0)g=5;else{if((b|0)>0){y=ie+4|0,_=0;do nA(y),_=_+1|0;while((_|0)!=(b|0))}if(c[se>>2]=0,c[se+4>>2]=0,c[se+8>>2]=0,Hg(se,V),g|0)for(;Jn(g)|0?tA(se):es(se),(g|0)>1;)g=g+-1|0;if((x|0)>0){g=0;do nA(se),g=g+1|0;while((g|0)!=(x|0))}G=ie+4|0,Cn(G,se,G),dn(G),G=51}}else if(Wf(u,h,ie)|0,(O|0)!=0&(z|0)!=0)if((S|0)!=(x|0)&&We(23173,23090,261,23100),_=Dn(A,l)|0,g=Dn(u,h)|0,(_|0)==7|(g|0)==7)g=5;else if(ge[21872+(_*7|0)+g>>0]|0)g=1;else if(_=c[21040+(_*28|0)+(g<<2)>>2]|0,(_|0)>0){y=ie+4|0,g=0;do nA(y),g=g+1|0;while((g|0)!=(_|0));G=51}else G=51;else G=51;while(!1);return(G|0)==51&&(g=ie+4|0,c[d>>2]=c[g>>2],c[d+4>>2]=c[g+4>>2],c[d+8>>2]=c[g+8>>2],g=0),ie=g,N=ne,ie|0}function om(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0;if(G=N,N=N+48|0,x=G+36|0,_=G+24|0,y=G+12|0,b=G,d=de(A|0,l|0,52)|0,F()|0,d=d&15,z=de(A|0,l|0,45)|0,F()|0,z=z&127,z>>>0>121)return h=5,N=G,h|0;if(S=xt(z)|0,xe(d|0,0,52)|0,se=F()|0|134225919,g=h,c[g>>2]=-1,c[g+4>>2]=se,!d)return d=eA(u)|0,(d|0)==7||(d=Nf(z,d)|0,(d|0)==127)?(se=1,N=G,se|0):(j=xe(d|0,0,45)|0,V=F()|0,z=h,V=c[z+4>>2]&-1040385|V,se=h,c[se>>2]=c[z>>2]|j,c[se+4>>2]=V,se=0,N=G,se|0);for(c[x>>2]=c[u>>2],c[x+4>>2]=c[u+4>>2],c[x+8>>2]=c[u+8>>2],u=d;;){if(g=u,u=u+-1|0,c[_>>2]=c[x>>2],c[_+4>>2]=c[x+4>>2],c[_+8>>2]=c[x+8>>2],Jn(g)|0){if(d=rT(x)|0,d|0){u=13;break}c[y>>2]=c[x>>2],c[y+4>>2]=c[x+4>>2],c[y+8>>2]=c[x+8>>2],tA(y)}else{if(d=iT(x)|0,d|0){u=13;break}c[y>>2]=c[x>>2],c[y+4>>2]=c[x+4>>2],c[y+8>>2]=c[x+8>>2],es(y)}if(Df(_,y,b),dn(b),d=h,ne=c[d>>2]|0,d=c[d+4>>2]|0,re=(15-g|0)*3|0,ie=xe(7,0,re|0)|0,d=d&~(F()|0),re=xe(eA(b)|0,0,re|0)|0,d=F()|0|d,se=h,c[se>>2]=re|ne&~ie,c[se+4>>2]=d,(g|0)<=1){u=14;break}}e:do if((u|0)!=13&&(u|0)==14)if((c[x>>2]|0)<=1&&(c[x+4>>2]|0)<=1&&(c[x+8>>2]|0)<=1){u=eA(x)|0,d=Nf(z,u)|0,(d|0)==127?b=0:b=xt(d)|0;t:do if(u){if(S){if(d=Dn(A,l)|0,(d|0)==7){d=5;break e}if(g=c[21248+(d*28|0)+(u<<2)>>2]|0,(g|0)>0){d=u,u=0;do d=ts(d)|0,u=u+1|0;while((u|0)!=(g|0))}else d=u;if((d|0)==1){d=9;break e}u=Nf(z,d)|0,(u|0)==127&&We(23200,23090,411,23230),xt(u)|0?We(23245,23090,412,23230):(V=u,j=g,O=d)}else V=d,j=0,O=u;if(y=c[4272+(z*28|0)+(O<<2)>>2]|0,(y|0)<=-1&&We(23276,23090,419,23230),!b){if((j|0)<0){d=5;break e}if(j|0){g=h,d=0,u=c[g>>2]|0,g=c[g+4>>2]|0;do u=ns(u,g)|0,g=F()|0,re=h,c[re>>2]=u,c[re+4>>2]=g,d=d+1|0;while((d|0)<(j|0))}if((y|0)<=0){d=V,u=58;break}for(g=h,d=0,u=c[g>>2]|0,g=c[g+4>>2]|0;;)if(u=ns(u,g)|0,g=F()|0,re=h,c[re>>2]=u,c[re+4>>2]=g,d=d+1|0,(d|0)==(y|0)){d=V,u=58;break t}}if(_=Of(V,z)|0,(_|0)==7&&We(23066,23090,428,23230),d=h,u=c[d>>2]|0,d=c[d+4>>2]|0,(y|0)>0){g=0;do u=ns(u,d)|0,d=F()|0,re=h,c[re>>2]=u,c[re+4>>2]=d,g=g+1|0;while((g|0)!=(y|0))}if(d=Dn(u,d)|0,(d|0)==7&&We(23313,23090,440,23230),u=Mf(V)|0,u=c[(u?21664:21456)+(_*28|0)+(d<<2)>>2]|0,(u|0)<0&&We(23313,23090,454,23230),!u)d=V,u=58;else{_=h,d=0,g=c[_>>2]|0,_=c[_+4>>2]|0;do g=zf(g,_)|0,_=F()|0,re=h,c[re>>2]=g,c[re+4>>2]=_,d=d+1|0;while((d|0)<(u|0));d=V,u=58}}else if((S|0)!=0&(b|0)!=0){if(u=Dn(A,l)|0,g=h,g=Dn(c[g>>2]|0,c[g+4>>2]|0)|0,(u|0)==7|(g|0)==7){d=5;break e}if(g=c[21248+(u*28|0)+(g<<2)>>2]|0,(g|0)<0){d=5;break e}if(!g)u=59;else{y=h,u=0,_=c[y>>2]|0,y=c[y+4>>2]|0;do _=ns(_,y)|0,y=F()|0,re=h,c[re>>2]=_,c[re+4>>2]=y,u=u+1|0;while((u|0)<(g|0));u=58}}else u=58;while(!1);if((u|0)==58&&b&&(u=59),(u|0)==59&&(re=h,(Dn(c[re>>2]|0,c[re+4>>2]|0)|0)==1)){d=9;break}re=h,ie=c[re>>2]|0,re=c[re+4>>2]&-1040385,ne=xe(d|0,0,45)|0,re=re|(F()|0),d=h,c[d>>2]=ie|ne,c[d+4>>2]=re,d=0}else d=1;while(!1);return re=d,N=G,re|0}function qT(A,l,u,h,d,g){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0,g=g|0;var _=0,y=0;return y=N,N=N+16|0,_=y,d?A=15:(A=Kr(A,l,u,h,_)|0,A||(oT(_,g),A=0)),N=y,A|0}function GT(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0;return _=N,N=N+16|0,g=_,h?u=15:(u=aT(u,g)|0,u||(u=om(A,l,g,d)|0)),N=_,u|0}function JT(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0;return b=N,N=N+32|0,_=b+12|0,y=b,g=Kr(A,l,A,l,_)|0,g|0?(y=g,N=b,y|0):(A=Kr(A,l,u,h,y)|0,A|0?(y=A,N=b,y|0):(_=Bf(_,y)|0,y=d,c[y>>2]=_,c[y+4>>2]=((_|0)<0)<<31>>31,y=0,N=b,y|0))}function eE(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0;return b=N,N=N+32|0,_=b+12|0,y=b,g=Kr(A,l,A,l,_)|0,!g&&(g=Kr(A,l,u,h,y)|0,!g)?(h=Bf(_,y)|0,h=st(h|0,((h|0)<0)<<31>>31|0,1,0)|0,_=F()|0,y=d,c[y>>2]=h,c[y+4>>2]=_,y=0,N=b,y|0):(y=g,N=b,y|0)}function tE(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0,Z=0,Se=0,Ne=0,ve=0,Ce=0;if(ve=N,N=N+48|0,_=ve+24|0,y=ve+12|0,Ne=ve,g=Kr(A,l,A,l,_)|0,!g&&(g=Kr(A,l,u,h,y)|0,!g)){Z=Bf(_,y)|0,Se=((Z|0)<0)<<31>>31,c[_>>2]=0,c[_+4>>2]=0,c[_+8>>2]=0,c[y>>2]=0,c[y+4>>2]=0,c[y+8>>2]=0,Kr(A,l,A,l,_)|0&&We(23313,23090,691,23299),Kr(A,l,u,h,y)|0&&We(23313,23090,696,23299),Kg(_),Kg(y),Z?(O=c[_>>2]|0,V=+(Z|0),ie=_+4|0,z=c[ie>>2]|0,ne=_+8|0,j=c[ne>>2]|0,re=_,h=O,g=z,u=j,G=+((c[y>>2]|0)-O|0)/V,se=+((c[y+4>>2]|0)-z|0)/V,V=+((c[y+8>>2]|0)-j|0)/V):(g=_+4|0,u=_+8|0,ie=g,ne=u,re=_,h=c[_>>2]|0,g=c[g>>2]|0,u=c[u>>2]|0,G=0,se=0,V=0),c[Ne>>2]=h,j=Ne+4|0,c[j>>2]=g,z=Ne+8|0,c[z>>2]=u;e:do if((Z|0)<0)g=0;else for(S=0,O=0,g=h;;){x=+(O>>>0)+4294967296*+(S|0),Ce=G*x+ +(g|0),b=se*x+ +(c[ie>>2]|0),x=V*x+ +(c[ne>>2]|0),u=~~+oA(+Ce),_=~~+oA(+b),g=~~+oA(+x),Ce=+Me(+(+(u|0)-Ce)),b=+Me(+(+(_|0)-b)),x=+Me(+(+(g|0)-x));do if(Ce>b&Ce>x)u=0-(_+g)|0,h=_;else if(y=0-u|0,b>x){h=y-g|0;break}else{h=_,g=y-_|0;break}while(!1);if(c[Ne>>2]=u,c[j>>2]=h,c[z>>2]=g,lT(Ne),g=om(A,l,Ne,d+(O<<3)|0)|0,g|0)break e;if(!((S|0)<(Se|0)|(S|0)==(Se|0)&O>>>0<Z>>>0)){g=0;break e}g=st(O|0,S|0,1,0)|0,y=F()|0,S=y,O=g,g=c[re>>2]|0}while(!1);return Ne=g,N=ve,Ne|0}return Ne=g,N=ve,Ne|0}function di(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0;if((u|0)==0&(h|0)==0)return d=0,g=1,Xe(d|0),g|0;g=A,d=l,A=1,l=0;do _=(u&1|0)==0&!0,A=gn((_?1:g)|0,(_?0:d)|0,A|0,l|0)|0,l=F()|0,u=gm(u|0,h|0,1)|0,h=F()|0,g=gn(g|0,d|0,g|0,d|0)|0,d=F()|0;while(!((u|0)==0&(h|0)==0));return Xe(l|0),A|0}function am(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0;if(!(zg(l,u)|0)||(l=Vg(l)|0,h=+k[u>>3],d=+k[u+8>>3],d=l&d<0?d+6.283185307179586:d,z=c[A>>2]|0,(z|0)<=0))return z=0,z|0;if(O=c[A+4>>2]|0,l){l=0,S=d,u=-1,A=0;e:for(;;){for(x=A;_=+k[O+(x<<4)>>3],d=+k[O+(x<<4)+8>>3],A=(u+2|0)%(z|0)|0,g=+k[O+(A<<4)>>3],y=+k[O+(A<<4)+8>>3],_>g?(b=_,_=y):(b=g,g=_,_=d,d=y),h=h==g|h==b?h+2220446049250313e-31:h,!!(h<g|h>b);)if(u=x+1|0,(u|0)>=(z|0)){u=22;break e}else A=x,x=u,u=A;if(y=_<0?_+6.283185307179586:_,_=d<0?d+6.283185307179586:d,S=y==S|_==S?S+-2220446049250313e-31:S,b=y+(_-y)*((h-g)/(b-g)),(b<0?b+6.283185307179586:b)>S&&(l=l^1),A=x+1|0,(A|0)>=(z|0)){u=22;break}else u=x}if((u|0)==22)return l|0}else{l=0,S=d,u=-1,A=0;e:for(;;){for(x=A;_=+k[O+(x<<4)>>3],d=+k[O+(x<<4)+8>>3],A=(u+2|0)%(z|0)|0,g=+k[O+(A<<4)>>3],y=+k[O+(A<<4)+8>>3],_>g?(b=_,_=y):(b=g,g=_,_=d,d=y),h=h==g|h==b?h+2220446049250313e-31:h,!!(h<g|h>b);)if(u=x+1|0,(u|0)>=(z|0)){u=22;break e}else A=x,x=u,u=A;if(S=_==S|d==S?S+-2220446049250313e-31:S,_+(d-_)*((h-g)/(b-g))>S&&(l=l^1),A=x+1|0,(A|0)>=(z|0)){u=22;break}else u=x}if((u|0)==22)return l|0}return 0}function lm(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0;if(V=c[A>>2]|0,!V){c[l>>2]=0,c[l+4>>2]=0,c[l+8>>2]=0,c[l+12>>2]=0,c[l+16>>2]=0,c[l+20>>2]=0,c[l+24>>2]=0,c[l+28>>2]=0;return}if(G=l+8|0,k[G>>3]=17976931348623157e292,se=l+24|0,k[se>>3]=17976931348623157e292,k[l>>3]=-17976931348623157e292,ie=l+16|0,k[ie>>3]=-17976931348623157e292,!((V|0)<=0)){for(z=c[A+4>>2]|0,x=17976931348623157e292,S=-17976931348623157e292,O=0,A=-1,g=17976931348623157e292,_=17976931348623157e292,b=-17976931348623157e292,h=-17976931348623157e292,j=0;u=+k[z+(j<<4)>>3],y=+k[z+(j<<4)+8>>3],A=A+2|0,d=+k[z+(((A|0)==(V|0)?0:A)<<4)+8>>3],u<g&&(k[G>>3]=u,g=u),y<_&&(k[se>>3]=y,_=y),u>b?k[l>>3]=u:u=b,y>h&&(k[ie>>3]=y,h=y),x=y>0&y<x?y:x,S=y<0&y>S?y:S,O=O|+Me(+(y-d))>3.141592653589793,A=j+1|0,(A|0)!=(V|0);)ne=j,b=u,j=A,A=ne;O&&(k[ie>>3]=S,k[se>>3]=x)}}function nE(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0,Z=0,Se=0,Ne=0,ve=0;if(V=c[A>>2]|0,V){if(G=l+8|0,k[G>>3]=17976931348623157e292,se=l+24|0,k[se>>3]=17976931348623157e292,k[l>>3]=-17976931348623157e292,ie=l+16|0,k[ie>>3]=-17976931348623157e292,(V|0)>0){for(d=c[A+4>>2]|0,z=17976931348623157e292,j=-17976931348623157e292,h=0,u=-1,b=17976931348623157e292,x=17976931348623157e292,O=-17976931348623157e292,_=-17976931348623157e292,ne=0;g=+k[d+(ne<<4)>>3],S=+k[d+(ne<<4)+8>>3],Ne=u+2|0,y=+k[d+(((Ne|0)==(V|0)?0:Ne)<<4)+8>>3],g<b&&(k[G>>3]=g,b=g),S<x&&(k[se>>3]=S,x=S),g>O?k[l>>3]=g:g=O,S>_&&(k[ie>>3]=S,_=S),z=S>0&S<z?S:z,j=S<0&S>j?S:j,h=h|+Me(+(S-y))>3.141592653589793,u=ne+1|0,(u|0)!=(V|0);)Ne=ne,O=g,ne=u,u=Ne;h&&(k[ie>>3]=j,k[se>>3]=z)}}else c[l>>2]=0,c[l+4>>2]=0,c[l+8>>2]=0,c[l+12>>2]=0,c[l+16>>2]=0,c[l+20>>2]=0,c[l+24>>2]=0,c[l+28>>2]=0;if(Ne=A+8|0,u=c[Ne>>2]|0,!((u|0)<=0)){Se=A+12|0,Z=0;do if(d=c[Se>>2]|0,h=Z,Z=Z+1|0,se=l+(Z<<5)|0,ie=c[d+(h<<3)>>2]|0,ie){if(ne=l+(Z<<5)+8|0,k[ne>>3]=17976931348623157e292,A=l+(Z<<5)+24|0,k[A>>3]=17976931348623157e292,k[se>>3]=-17976931348623157e292,re=l+(Z<<5)+16|0,k[re>>3]=-17976931348623157e292,(ie|0)>0){for(V=c[d+(h<<3)+4>>2]|0,z=17976931348623157e292,j=-17976931348623157e292,d=0,h=-1,G=0,b=17976931348623157e292,x=17976931348623157e292,S=-17976931348623157e292,_=-17976931348623157e292;g=+k[V+(G<<4)>>3],O=+k[V+(G<<4)+8>>3],h=h+2|0,y=+k[V+(((h|0)==(ie|0)?0:h)<<4)+8>>3],g<b&&(k[ne>>3]=g,b=g),O<x&&(k[A>>3]=O,x=O),g>S?k[se>>3]=g:g=S,O>_&&(k[re>>3]=O,_=O),z=O>0&O<z?O:z,j=O<0&O>j?O:j,d=d|+Me(+(O-y))>3.141592653589793,h=G+1|0,(h|0)!=(ie|0);)ve=G,G=h,S=g,h=ve;d&&(k[re>>3]=j,k[A>>3]=z)}}else c[se>>2]=0,c[se+4>>2]=0,c[se+8>>2]=0,c[se+12>>2]=0,c[se+16>>2]=0,c[se+20>>2]=0,c[se+24>>2]=0,c[se+28>>2]=0,u=c[Ne>>2]|0;while((Z|0)<(u|0))}}function rE(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0;if(!(am(A,l,u)|0))return d=0,d|0;if(d=A+8|0,(c[d>>2]|0)<=0)return d=1,d|0;for(h=A+12|0,A=0;;){if(g=A,A=A+1|0,am((c[h>>2]|0)+(g<<3)|0,l+(A<<5)|0,u)|0){A=0,h=6;break}if((A|0)>=(c[d>>2]|0)){A=1,h=6;break}}return(h|0)==6?A|0:0}function iE(){return 8}function sE(){return 16}function oE(){return 168}function aE(){return 8}function lE(){return 16}function AE(){return 12}function cE(){return 8}function uE(A){return A=A|0,+(+((c[A>>2]|0)>>>0)+4294967296*+(c[A+4>>2]|0))}function fE(A){A=A|0;var l=0,u=0;return u=+k[A>>3],l=+k[A+8>>3],+ +je(+(u*u+l*l))}function Am(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0;x=+k[A>>3],b=+k[l>>3]-x,y=+k[A+8>>3],_=+k[l+8>>3]-y,O=+k[u>>3],g=+k[h>>3]-O,z=+k[u+8>>3],S=+k[h+8>>3]-z,g=(g*(y-z)-(x-O)*S)/(b*S-_*g),k[d>>3]=x+b*g,k[d+8>>3]=y+_*g}function cm(A,l){return A=A|0,l=l|0,+Me(+(+k[A>>3]-+k[l>>3]))<11920928955078125e-23?(l=+Me(+(+k[A+8>>3]-+k[l+8>>3]))<11920928955078125e-23,l|0):(l=0,l|0)}function $t(A,l){A=A|0,l=l|0;var u=0,h=0,d=0;return d=+k[A>>3]-+k[l>>3],h=+k[A+8>>3]-+k[l+8>>3],u=+k[A+16>>3]-+k[l+16>>3],+(d*d+h*h+u*u)}function hE(A,l){A=A|0,l=l|0;var u=0,h=0,d=0;u=+k[A>>3],h=+Ie(+u),u=+Ue(+u),k[l+16>>3]=u,u=+k[A+8>>3],d=h*+Ie(+u),k[l>>3]=d,u=h*+Ue(+u),k[l+8>>3]=u}function dE(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0;if(g=N,N=N+16|0,d=g,h=Tt(A,l)|0,(u+-1|0)>>>0>5||(h=(h|0)!=0,(u|0)==1&h))return d=-1,N=g,d|0;do if(_a(A,l,d)|0)h=-1;else if(h){h=((c[21936+(u<<2)>>2]|0)+5-(c[d>>2]|0)|0)%5|0;break}else{h=((c[21968+(u<<2)>>2]|0)+6-(c[d>>2]|0)|0)%6|0;break}while(!1);return d=h,N=g,d|0}function _a(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0,x=0;if(x=N,N=N+32|0,_=x+16|0,y=x,h=js(A,l,_)|0,h|0)return u=h,N=x,u|0;g=Gg(A,l)|0,b=Dn(A,l)|0,Zx(g,y),h=qx(g,c[_>>2]|0)|0;e:do if(xt(g)|0){do switch(g|0){case 4:{A=0;break}case 14:{A=1;break}case 24:{A=2;break}case 38:{A=3;break}case 49:{A=4;break}case 58:{A=5;break}case 63:{A=6;break}case 72:{A=7;break}case 83:{A=8;break}case 97:{A=9;break}case 107:{A=10;break}case 117:{A=11;break}default:{h=1;break e}}while(!1);if(d=c[22e3+(A*24|0)+8>>2]|0,l=c[22e3+(A*24|0)+16>>2]|0,A=c[_>>2]|0,(A|0)!=(c[y>>2]|0)&&(y=Mf(g)|0,A=c[_>>2]|0,y|(A|0)==(l|0)&&(h=(h+1|0)%6|0)),(b|0)==3&(A|0)==(l|0)){h=(h+5|0)%6|0,d=22;break}(b|0)==5&(A|0)==(d|0)&&(h=(h+1|0)%6|0),d=22}else d=22;while(!1);return(d|0)==22&&(c[u>>2]=h,h=0),u=h,N=x,u|0}function er(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0;if(re=N,N=N+32|0,ne=re+24|0,se=re+20|0,V=re+8|0,j=re+16|0,z=re,b=(Tt(A,l)|0)==0,b=b?6:5,S=de(A|0,l|0,52)|0,F()|0,S=S&15,b>>>0<=u>>>0)return h=2,N=re,h|0;O=(S|0)==0,!O&&(G=xe(7,0,(S^15)*3|0)|0,(G&A|0)==0&((F()|0)&l|0)==0)?d=u:g=4;e:do if((g|0)==4){if(d=(Tt(A,l)|0)!=0,((d?4:5)|0)<(u|0)||_a(A,l,ne)|0||(g=(c[ne>>2]|0)+u|0,d?d=22288+(((g|0)%5|0)<<2)|0:d=22320+(((g|0)%6|0)<<2)|0,G=c[d>>2]|0,(G|0)==7))return h=1,N=re,h|0;c[se>>2]=0,d=en(A,l,G,se,V)|0;do if(!d){if(y=V,x=c[y>>2]|0,y=c[y+4>>2]|0,_=y>>>0<l>>>0|(y|0)==(l|0)&x>>>0<A>>>0,g=_?x:A,_=_?y:l,!O&&(O=xe(7,0,(S^15)*3|0)|0,(x&O|0)==0&(y&(F()|0)|0)==0))d=u;else{if(y=(u+-1+b|0)%(b|0)|0,d=Tt(A,l)|0,(y|0)<0&&We(23313,23315,245,23324),b=(d|0)!=0,((b?4:5)|0)<(y|0)&&We(23313,23315,245,23324),_a(A,l,ne)|0&&We(23313,23315,245,23324),d=(c[ne>>2]|0)+y|0,b?d=22288+(((d|0)%5|0)<<2)|0:d=22320+(((d|0)%6|0)<<2)|0,y=c[d>>2]|0,(y|0)==7&&We(23313,23315,245,23324),c[j>>2]=0,d=en(A,l,y,j,z)|0,d|0)break;x=z,b=c[x>>2]|0,x=c[x+4>>2]|0;do if(x>>>0<_>>>0|(x|0)==(_|0)&b>>>0<g>>>0){if(Tt(b,x)|0?g=If(b,x,A,l)|0:g=c[22384+((((c[j>>2]|0)+(c[22352+(y<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,d=Tt(b,x)|0,(g+-1|0)>>>0>5){d=-1,g=b,_=x;break}if(d=(d|0)!=0,(g|0)==1&d){d=-1,g=b,_=x;break}do if(_a(b,x,ne)|0)d=-1;else if(d){d=((c[21936+(g<<2)>>2]|0)+5-(c[ne>>2]|0)|0)%5|0;break}else{d=((c[21968+(g<<2)>>2]|0)+6-(c[ne>>2]|0)|0)%6|0;break}while(!1);g=b,_=x}else d=u;while(!1);y=V,x=c[y>>2]|0,y=c[y+4>>2]|0}if((g|0)==(x|0)&(_|0)==(y|0)){if(b=(Tt(x,y)|0)!=0,b?A=If(x,y,A,l)|0:A=c[22384+((((c[se>>2]|0)+(c[22352+(G<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,d=Tt(x,y)|0,(A+-1|0)>>>0<=5&&(ie=(d|0)!=0,!((A|0)==1&ie)))do if(_a(x,y,ne)|0)d=-1;else if(ie){d=((c[21936+(A<<2)>>2]|0)+5-(c[ne>>2]|0)|0)%5|0;break}else{d=((c[21968+(A<<2)>>2]|0)+6-(c[ne>>2]|0)|0)%6|0;break}while(!1);else d=-1;d=d+1|0,d=(d|0)==6|b&(d|0)==5?0:d}l=_,A=g;break e}while(!1);return h=d,N=re,h|0}while(!1);return ie=xe(d|0,0,56)|0,ne=F()|0|l&-2130706433|536870912,c[h>>2]=ie|A,c[h+4>>2]=ne,h=0,N=re,h|0}function pE(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0;return g=(Tt(A,l)|0)==0,h=er(A,l,0,u)|0,d=(h|0)==0,g?!d||(h=er(A,l,1,u+8|0)|0,h|0)||(h=er(A,l,2,u+16|0)|0,h|0)||(h=er(A,l,3,u+24|0)|0,h|0)||(h=er(A,l,4,u+32|0)|0,h)?(g=h,g|0):er(A,l,5,u+40|0)|0:!d||(h=er(A,l,1,u+8|0)|0,h|0)||(h=er(A,l,2,u+16|0)|0,h|0)||(h=er(A,l,3,u+24|0)|0,h|0)||(h=er(A,l,4,u+32|0)|0,h|0)?(g=h,g|0):(g=u+40|0,c[g>>2]=0,c[g+4>>2]=0,g=0,g|0)}function gE(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0,y=0,b=0;return b=N,N=N+192|0,d=b,g=b+168|0,_=de(A|0,l|0,56)|0,F()|0,_=_&7,y=l&-2130706433|134217728,h=js(A,y,g)|0,h|0?(y=h,N=b,y|0):(l=de(A|0,l|0,52)|0,F()|0,l=l&15,Tt(A,y)|0?Ff(g,l,_,1,d):Lf(g,l,_,1,d),y=d+8|0,c[u>>2]=c[y>>2],c[u+4>>2]=c[y+4>>2],c[u+8>>2]=c[y+8>>2],c[u+12>>2]=c[y+12>>2],y=0,N=b,y|0)}function mE(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0;return d=N,N=N+16|0,u=d,!(!0&(l&2013265920|0)==536870912)||(h=l&-2130706433|134217728,!(Uf(A,h)|0))?(h=0,N=d,h|0):(g=de(A|0,l|0,56)|0,F()|0,g=(er(A,h,g&7,u)|0)==0,h=u,h=g&((c[h>>2]|0)==(A|0)?(c[h+4>>2]|0)==(l|0):0)&1,N=d,h|0)}function um(A,l,u){A=A|0,l=l|0,u=u|0;var h=0;(l|0)>0?(h=kr(l,4)|0,c[A>>2]=h,h||We(23337,23360,40,23374)):c[A>>2]=0,c[A+4>>2]=l,c[A+8>>2]=0,c[A+12>>2]=u}function fm(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0;d=A+4|0,g=A+12|0,_=A+8|0;e:for(;;){for(u=c[d>>2]|0,l=0;;){if((l|0)>=(u|0))break e;if(h=c[A>>2]|0,y=c[h+(l<<2)>>2]|0,!y)l=l+1|0;else break}l=h+(~~(+Me(+(+Mt(10,+ +(15-(c[g>>2]|0)|0))*(+k[y>>3]+ +k[y+8>>3])))%+(u|0))>>>0<<2)|0,u=c[l>>2]|0;t:do if(u|0){if(h=y+32|0,(u|0)==(y|0))c[l>>2]=c[h>>2];else{if(u=u+32|0,l=c[u>>2]|0,!l)break;for(;(l|0)!=(y|0);)if(u=l+32|0,l=c[u>>2]|0,!l)break t;c[u>>2]=c[h>>2]}Qe(y),c[_>>2]=(c[_>>2]|0)+-1}while(!1)}Qe(c[A>>2]|0)}function hm(A){A=A|0;var l=0,u=0,h=0;for(h=c[A+4>>2]|0,u=0;;){if((u|0)>=(h|0)){l=0,u=4;break}if(l=c[(c[A>>2]|0)+(u<<2)>>2]|0,!l)u=u+1|0;else{u=4;break}}return(u|0)==4?l|0:0}function dm(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0;if(u=~~(+Me(+(+Mt(10,+ +(15-(c[A+12>>2]|0)|0))*(+k[l>>3]+ +k[l+8>>3])))%+(c[A+4>>2]|0))>>>0,u=(c[A>>2]|0)+(u<<2)|0,h=c[u>>2]|0,!h)return g=1,g|0;g=l+32|0;do if((h|0)!=(l|0)){if(u=c[h+32>>2]|0,!u)return g=1,g|0;for(d=u;;){if((d|0)==(l|0)){d=8;break}if(u=c[d+32>>2]|0,u)h=d,d=u;else{u=1,d=10;break}}if((d|0)==8){c[h+32>>2]=c[g>>2];break}else if((d|0)==10)return u|0}else c[u>>2]=c[g>>2];while(!1);return Qe(l),g=A+8|0,c[g>>2]=(c[g>>2]|0)+-1,g=0,g|0}function _E(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0;g=Pr(40)|0,g||We(23390,23360,98,23403),c[g>>2]=c[l>>2],c[g+4>>2]=c[l+4>>2],c[g+8>>2]=c[l+8>>2],c[g+12>>2]=c[l+12>>2],d=g+16|0,c[d>>2]=c[u>>2],c[d+4>>2]=c[u+4>>2],c[d+8>>2]=c[u+8>>2],c[d+12>>2]=c[u+12>>2],c[g+32>>2]=0,d=~~(+Me(+(+Mt(10,+ +(15-(c[A+12>>2]|0)|0))*(+k[l>>3]+ +k[l+8>>3])))%+(c[A+4>>2]|0))>>>0,d=(c[A>>2]|0)+(d<<2)|0,h=c[d>>2]|0;do if(!h)c[d>>2]=g;else{for(;!(Ws(h,l)|0&&Ws(h+16|0,u)|0);)if(d=c[h+32>>2]|0,h=d|0?d:h,!(c[h+32>>2]|0)){_=10;break}if((_|0)==10){c[h+32>>2]=g;break}return Qe(g),_=h,_|0}while(!1);return _=A+8|0,c[_>>2]=(c[_>>2]|0)+1,_=g,_|0}function yE(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0;if(d=~~(+Me(+(+Mt(10,+ +(15-(c[A+12>>2]|0)|0))*(+k[l>>3]+ +k[l+8>>3])))%+(c[A+4>>2]|0))>>>0,d=c[(c[A>>2]|0)+(d<<2)>>2]|0,!d)return u=0,u|0;if(!u){for(A=d;;){if(Ws(A,l)|0){h=10;break}if(A=c[A+32>>2]|0,!A){A=0,h=10;break}}if((h|0)==10)return A|0}for(A=d;;){if(Ws(A,l)|0&&Ws(A+16|0,u)|0){h=10;break}if(A=c[A+32>>2]|0,!A){A=0,h=10;break}}return(h|0)==10?A|0:0}function vE(A,l){A=A|0,l=l|0;var u=0;if(u=~~(+Me(+(+Mt(10,+ +(15-(c[A+12>>2]|0)|0))*(+k[l>>3]+ +k[l+8>>3])))%+(c[A+4>>2]|0))>>>0,A=c[(c[A>>2]|0)+(u<<2)>>2]|0,!A)return u=0,u|0;for(;;){if(Ws(A,l)|0){l=5;break}if(A=c[A+32>>2]|0,!A){A=0,l=5;break}}return(l|0)==5?A|0:0}function wE(){return 23424}function bE(A){return A=+A,+ +_m(+A)}function pi(A){return A=+A,~~+bE(A)|0}function Pr(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0,G=0,se=0,ie=0,ne=0,re=0,Z=0,Se=0;Se=N,N=N+16|0,z=Se;do if(A>>>0<245){if(x=A>>>0<11?16:A+11&-8,A=x>>>3,O=c[5857]|0,u=O>>>A,u&3|0)return l=(u&1^1)+A|0,A=23468+(l<<1<<2)|0,u=A+8|0,h=c[u>>2]|0,d=h+8|0,g=c[d>>2]|0,(g|0)==(A|0)?c[5857]=O&~(1<<l):(c[g+12>>2]=A,c[u>>2]=g),Z=l<<3,c[h+4>>2]=Z|3,Z=h+Z+4|0,c[Z>>2]=c[Z>>2]|1,Z=d,N=Se,Z|0;if(S=c[5859]|0,x>>>0>S>>>0){if(u|0)return l=2<<A,l=u<<A&(l|0-l),l=(l&0-l)+-1|0,y=l>>>12&16,l=l>>>y,u=l>>>5&8,l=l>>>u,g=l>>>2&4,l=l>>>g,A=l>>>1&2,l=l>>>A,h=l>>>1&1,h=(u|y|g|A|h)+(l>>>h)|0,l=23468+(h<<1<<2)|0,A=l+8|0,g=c[A>>2]|0,y=g+8|0,u=c[y>>2]|0,(u|0)==(l|0)?(A=O&~(1<<h),c[5857]=A):(c[u+12>>2]=l,c[A>>2]=u,A=O),Z=h<<3,_=Z-x|0,c[g+4>>2]=x|3,d=g+x|0,c[d+4>>2]=_|1,c[g+Z>>2]=_,S|0&&(h=c[5862]|0,l=S>>>3,u=23468+(l<<1<<2)|0,l=1<<l,A&l?(A=u+8|0,l=c[A>>2]|0):(c[5857]=A|l,l=u,A=u+8|0),c[A>>2]=h,c[l+12>>2]=h,c[h+8>>2]=l,c[h+12>>2]=u),c[5859]=_,c[5862]=d,Z=y,N=Se,Z|0;if(g=c[5858]|0,g){for(u=(g&0-g)+-1|0,d=u>>>12&16,u=u>>>d,h=u>>>5&8,u=u>>>h,_=u>>>2&4,u=u>>>_,y=u>>>1&2,u=u>>>y,b=u>>>1&1,b=c[23732+((h|d|_|y|b)+(u>>>b)<<2)>>2]|0,u=b,y=b,b=(c[b+4>>2]&-8)-x|0;A=c[u+16>>2]|0,!(!A&&(A=c[u+20>>2]|0,!A));)_=(c[A+4>>2]&-8)-x|0,d=_>>>0<b>>>0,u=A,y=d?A:y,b=d?_:b;if(_=y+x|0,_>>>0>y>>>0){d=c[y+24>>2]|0,l=c[y+12>>2]|0;do if((l|0)==(y|0)){if(A=y+20|0,l=c[A>>2]|0,!l&&(A=y+16|0,l=c[A>>2]|0,!l)){u=0;break}for(;;)if(h=l+20|0,u=c[h>>2]|0,u)l=u,A=h;else if(h=l+16|0,u=c[h>>2]|0,u)l=u,A=h;else break;c[A>>2]=0,u=l}else u=c[y+8>>2]|0,c[u+12>>2]=l,c[l+8>>2]=u,u=l;while(!1);do if(d|0){if(l=c[y+28>>2]|0,A=23732+(l<<2)|0,(y|0)==(c[A>>2]|0)){if(c[A>>2]=u,!u){c[5858]=g&~(1<<l);break}}else if(Z=d+16|0,c[((c[Z>>2]|0)==(y|0)?Z:d+20|0)>>2]=u,!u)break;c[u+24>>2]=d,l=c[y+16>>2]|0,l|0&&(c[u+16>>2]=l,c[l+24>>2]=u),l=c[y+20>>2]|0,l|0&&(c[u+20>>2]=l,c[l+24>>2]=u)}while(!1);return b>>>0<16?(Z=b+x|0,c[y+4>>2]=Z|3,Z=y+Z+4|0,c[Z>>2]=c[Z>>2]|1):(c[y+4>>2]=x|3,c[_+4>>2]=b|1,c[_+b>>2]=b,S|0&&(h=c[5862]|0,l=S>>>3,u=23468+(l<<1<<2)|0,l=1<<l,l&O?(A=u+8|0,l=c[A>>2]|0):(c[5857]=l|O,l=u,A=u+8|0),c[A>>2]=h,c[l+12>>2]=h,c[h+8>>2]=l,c[h+12>>2]=u),c[5859]=b,c[5862]=_),Z=y+8|0,N=Se,Z|0}else O=x}else O=x}else O=x}else if(A>>>0<=4294967231)if(A=A+11|0,x=A&-8,h=c[5858]|0,h){d=0-x|0,A=A>>>8,A?x>>>0>16777215?b=31:(O=(A+1048320|0)>>>16&8,G=A<<O,y=(G+520192|0)>>>16&4,G=G<<y,b=(G+245760|0)>>>16&2,b=14-(y|O|b)+(G<<b>>>15)|0,b=x>>>(b+7|0)&1|b<<1):b=0,u=c[23732+(b<<2)>>2]|0;e:do if(!u)u=0,A=0,G=61;else for(A=0,y=x<<((b|0)==31?0:25-(b>>>1)|0),g=0;;){if(_=(c[u+4>>2]&-8)-x|0,_>>>0<d>>>0)if(_)A=u,d=_;else{A=u,d=0,G=65;break e}if(G=c[u+20>>2]|0,u=c[u+16+(y>>>31<<2)>>2]|0,g=(G|0)==0|(G|0)==(u|0)?g:G,u)y=y<<1;else{u=g,G=61;break}}while(!1);if((G|0)==61){if((u|0)==0&(A|0)==0){if(A=2<<b,A=(A|0-A)&h,!A){O=x;break}O=(A&0-A)+-1|0,_=O>>>12&16,O=O>>>_,g=O>>>5&8,O=O>>>g,y=O>>>2&4,O=O>>>y,b=O>>>1&2,O=O>>>b,u=O>>>1&1,A=0,u=c[23732+((g|_|y|b|u)+(O>>>u)<<2)>>2]|0}u?G=65:(y=A,_=d)}if((G|0)==65)for(g=u;;)if(O=(c[g+4>>2]&-8)-x|0,u=O>>>0<d>>>0,d=u?O:d,A=u?g:A,u=c[g+16>>2]|0,u||(u=c[g+20>>2]|0),u)g=u;else{y=A,_=d;break}if(y|0&&_>>>0<((c[5859]|0)-x|0)>>>0&&(S=y+x|0,S>>>0>y>>>0)){g=c[y+24>>2]|0,l=c[y+12>>2]|0;do if((l|0)==(y|0)){if(A=y+20|0,l=c[A>>2]|0,!l&&(A=y+16|0,l=c[A>>2]|0,!l)){l=0;break}for(;;)if(d=l+20|0,u=c[d>>2]|0,u)l=u,A=d;else if(d=l+16|0,u=c[d>>2]|0,u)l=u,A=d;else break;c[A>>2]=0}else Z=c[y+8>>2]|0,c[Z+12>>2]=l,c[l+8>>2]=Z;while(!1);do if(g){if(A=c[y+28>>2]|0,u=23732+(A<<2)|0,(y|0)==(c[u>>2]|0)){if(c[u>>2]=l,!l){h=h&~(1<<A),c[5858]=h;break}}else if(Z=g+16|0,c[((c[Z>>2]|0)==(y|0)?Z:g+20|0)>>2]=l,!l)break;c[l+24>>2]=g,A=c[y+16>>2]|0,A|0&&(c[l+16>>2]=A,c[A+24>>2]=l),A=c[y+20>>2]|0,A&&(c[l+20>>2]=A,c[A+24>>2]=l)}while(!1);e:do if(_>>>0<16)Z=_+x|0,c[y+4>>2]=Z|3,Z=y+Z+4|0,c[Z>>2]=c[Z>>2]|1;else{if(c[y+4>>2]=x|3,c[S+4>>2]=_|1,c[S+_>>2]=_,l=_>>>3,_>>>0<256){u=23468+(l<<1<<2)|0,A=c[5857]|0,l=1<<l,A&l?(A=u+8|0,l=c[A>>2]|0):(c[5857]=A|l,l=u,A=u+8|0),c[A>>2]=S,c[l+12>>2]=S,c[S+8>>2]=l,c[S+12>>2]=u;break}if(l=_>>>8,l?_>>>0>16777215?u=31:(re=(l+1048320|0)>>>16&8,Z=l<<re,ne=(Z+520192|0)>>>16&4,Z=Z<<ne,u=(Z+245760|0)>>>16&2,u=14-(ne|re|u)+(Z<<u>>>15)|0,u=_>>>(u+7|0)&1|u<<1):u=0,l=23732+(u<<2)|0,c[S+28>>2]=u,A=S+16|0,c[A+4>>2]=0,c[A>>2]=0,A=1<<u,!(h&A)){c[5858]=h|A,c[l>>2]=S,c[S+24>>2]=l,c[S+12>>2]=S,c[S+8>>2]=S;break}l=c[l>>2]|0;t:do if((c[l+4>>2]&-8|0)!=(_|0)){for(h=_<<((u|0)==31?0:25-(u>>>1)|0);u=l+16+(h>>>31<<2)|0,A=c[u>>2]|0,!!A;)if((c[A+4>>2]&-8|0)==(_|0)){l=A;break t}else h=h<<1,l=A;c[u>>2]=S,c[S+24>>2]=l,c[S+12>>2]=S,c[S+8>>2]=S;break e}while(!1);re=l+8|0,Z=c[re>>2]|0,c[Z+12>>2]=S,c[re>>2]=S,c[S+8>>2]=Z,c[S+12>>2]=l,c[S+24>>2]=0}while(!1);return Z=y+8|0,N=Se,Z|0}else O=x}else O=x;else O=-1;while(!1);if(u=c[5859]|0,u>>>0>=O>>>0)return l=u-O|0,A=c[5862]|0,l>>>0>15?(Z=A+O|0,c[5862]=Z,c[5859]=l,c[Z+4>>2]=l|1,c[A+u>>2]=l,c[A+4>>2]=O|3):(c[5859]=0,c[5862]=0,c[A+4>>2]=u|3,Z=A+u+4|0,c[Z>>2]=c[Z>>2]|1),Z=A+8|0,N=Se,Z|0;if(_=c[5860]|0,_>>>0>O>>>0)return ne=_-O|0,c[5860]=ne,Z=c[5863]|0,re=Z+O|0,c[5863]=re,c[re+4>>2]=ne|1,c[Z+4>>2]=O|3,Z=Z+8|0,N=Se,Z|0;if(c[5975]|0?A=c[5977]|0:(c[5977]=4096,c[5976]=4096,c[5978]=-1,c[5979]=-1,c[5980]=0,c[5968]=0,c[5975]=z&-16^1431655768,A=4096),y=O+48|0,b=O+47|0,g=A+b|0,d=0-A|0,x=g&d,x>>>0<=O>>>0||(A=c[5967]|0,A|0&&(S=c[5965]|0,z=S+x|0,z>>>0<=S>>>0|z>>>0>A>>>0)))return Z=0,N=Se,Z|0;e:do if(c[5968]&4)l=0,G=143;else{u=c[5863]|0;t:do if(u){for(h=23876;z=c[h>>2]|0,!(z>>>0<=u>>>0&&(z+(c[h+4>>2]|0)|0)>>>0>u>>>0);)if(A=c[h+8>>2]|0,A)h=A;else{G=128;break t}if(l=g-_&d,l>>>0<2147483647)if(A=gi(l|0)|0,(A|0)==((c[h>>2]|0)+(c[h+4>>2]|0)|0)){if((A|0)!=-1){_=l,g=A,G=145;break e}}else h=A,G=136;else l=0}else G=128;while(!1);do if((G|0)==128)if(u=gi(0)|0,(u|0)!=-1&&(l=u,j=c[5976]|0,V=j+-1|0,l=(V&l|0?(V+l&0-j)-l|0:0)+x|0,j=c[5965]|0,V=l+j|0,l>>>0>O>>>0&l>>>0<2147483647)){if(z=c[5967]|0,z|0&&V>>>0<=j>>>0|V>>>0>z>>>0){l=0;break}if(A=gi(l|0)|0,(A|0)==(u|0)){_=l,g=u,G=145;break e}else h=A,G=136}else l=0;while(!1);do if((G|0)==136){if(u=0-l|0,!(y>>>0>l>>>0&(l>>>0<2147483647&(h|0)!=-1)))if((h|0)==-1){l=0;break}else{_=l,g=h,G=145;break e}if(A=c[5977]|0,A=b-l+A&0-A,A>>>0>=2147483647){_=l,g=h,G=145;break e}if((gi(A|0)|0)==-1){gi(u|0)|0,l=0;break}else{_=A+l|0,g=h,G=145;break e}}while(!1);c[5968]=c[5968]|4,G=143}while(!1);if((G|0)==143&&x>>>0<2147483647&&(ne=gi(x|0)|0,V=gi(0)|0,se=V-ne|0,ie=se>>>0>(O+40|0)>>>0,!((ne|0)==-1|ie^1|ne>>>0<V>>>0&((ne|0)!=-1&(V|0)!=-1)^1))&&(_=ie?se:l,g=ne,G=145),(G|0)==145){l=(c[5965]|0)+_|0,c[5965]=l,l>>>0>(c[5966]|0)>>>0&&(c[5966]=l),b=c[5863]|0;e:do if(b){for(l=23876;;){if(A=c[l>>2]|0,u=c[l+4>>2]|0,(g|0)==(A+u|0)){G=154;break}if(h=c[l+8>>2]|0,h)l=h;else break}if((G|0)==154&&(re=l+4|0,(c[l+12>>2]&8|0)==0)&&g>>>0>b>>>0&A>>>0<=b>>>0){c[re>>2]=u+_,Z=(c[5860]|0)+_|0,ne=b+8|0,ne=ne&7|0?0-ne&7:0,re=b+ne|0,ne=Z-ne|0,c[5863]=re,c[5860]=ne,c[re+4>>2]=ne|1,c[b+Z+4>>2]=40,c[5864]=c[5979];break}for(g>>>0<(c[5861]|0)>>>0&&(c[5861]=g),u=g+_|0,l=23876;;){if((c[l>>2]|0)==(u|0)){G=162;break}if(A=c[l+8>>2]|0,A)l=A;else break}if((G|0)==162&&!(c[l+12>>2]&8|0)){c[l>>2]=g,S=l+4|0,c[S>>2]=(c[S>>2]|0)+_,S=g+8|0,S=g+(S&7|0?0-S&7:0)|0,l=u+8|0,l=u+(l&7|0?0-l&7:0)|0,x=S+O|0,y=l-S-O|0,c[S+4>>2]=O|3;t:do if((b|0)==(l|0))Z=(c[5860]|0)+y|0,c[5860]=Z,c[5863]=x,c[x+4>>2]=Z|1;else{if((c[5862]|0)==(l|0)){Z=(c[5859]|0)+y|0,c[5859]=Z,c[5862]=x,c[x+4>>2]=Z|1,c[x+Z>>2]=Z;break}if(A=c[l+4>>2]|0,(A&3|0)==1){_=A&-8,h=A>>>3;n:do if(A>>>0<256)if(A=c[l+8>>2]|0,u=c[l+12>>2]|0,(u|0)==(A|0)){c[5857]=c[5857]&~(1<<h);break}else{c[A+12>>2]=u,c[u+8>>2]=A;break}else{g=c[l+24>>2]|0,A=c[l+12>>2]|0;do if((A|0)==(l|0)){if(u=l+16|0,h=u+4|0,A=c[h>>2]|0,A)u=h;else if(A=c[u>>2]|0,!A){A=0;break}for(;;)if(d=A+20|0,h=c[d>>2]|0,h)A=h,u=d;else if(d=A+16|0,h=c[d>>2]|0,h)A=h,u=d;else break;c[u>>2]=0}else Z=c[l+8>>2]|0,c[Z+12>>2]=A,c[A+8>>2]=Z;while(!1);if(!g)break;u=c[l+28>>2]|0,h=23732+(u<<2)|0;do if((c[h>>2]|0)!=(l|0)){if(Z=g+16|0,c[((c[Z>>2]|0)==(l|0)?Z:g+20|0)>>2]=A,!A)break n}else{if(c[h>>2]=A,A|0)break;c[5858]=c[5858]&~(1<<u);break n}while(!1);if(c[A+24>>2]=g,u=l+16|0,h=c[u>>2]|0,h|0&&(c[A+16>>2]=h,c[h+24>>2]=A),u=c[u+4>>2]|0,!u)break;c[A+20>>2]=u,c[u+24>>2]=A}while(!1);l=l+_|0,d=_+y|0}else d=y;if(l=l+4|0,c[l>>2]=c[l>>2]&-2,c[x+4>>2]=d|1,c[x+d>>2]=d,l=d>>>3,d>>>0<256){u=23468+(l<<1<<2)|0,A=c[5857]|0,l=1<<l,A&l?(A=u+8|0,l=c[A>>2]|0):(c[5857]=A|l,l=u,A=u+8|0),c[A>>2]=x,c[l+12>>2]=x,c[x+8>>2]=l,c[x+12>>2]=u;break}l=d>>>8;do if(!l)h=0;else{if(d>>>0>16777215){h=31;break}re=(l+1048320|0)>>>16&8,Z=l<<re,ne=(Z+520192|0)>>>16&4,Z=Z<<ne,h=(Z+245760|0)>>>16&2,h=14-(ne|re|h)+(Z<<h>>>15)|0,h=d>>>(h+7|0)&1|h<<1}while(!1);if(l=23732+(h<<2)|0,c[x+28>>2]=h,A=x+16|0,c[A+4>>2]=0,c[A>>2]=0,A=c[5858]|0,u=1<<h,!(A&u)){c[5858]=A|u,c[l>>2]=x,c[x+24>>2]=l,c[x+12>>2]=x,c[x+8>>2]=x;break}l=c[l>>2]|0;n:do if((c[l+4>>2]&-8|0)!=(d|0)){for(h=d<<((h|0)==31?0:25-(h>>>1)|0);u=l+16+(h>>>31<<2)|0,A=c[u>>2]|0,!!A;)if((c[A+4>>2]&-8|0)==(d|0)){l=A;break n}else h=h<<1,l=A;c[u>>2]=x,c[x+24>>2]=l,c[x+12>>2]=x,c[x+8>>2]=x;break t}while(!1);re=l+8|0,Z=c[re>>2]|0,c[Z+12>>2]=x,c[re>>2]=x,c[x+8>>2]=Z,c[x+12>>2]=l,c[x+24>>2]=0}while(!1);return Z=S+8|0,N=Se,Z|0}for(l=23876;A=c[l>>2]|0,!(A>>>0<=b>>>0&&(Z=A+(c[l+4>>2]|0)|0,Z>>>0>b>>>0));)l=c[l+8>>2]|0;d=Z+-47|0,A=d+8|0,A=d+(A&7|0?0-A&7:0)|0,d=b+16|0,A=A>>>0<d>>>0?b:A,l=A+8|0,u=_+-40|0,ne=g+8|0,ne=ne&7|0?0-ne&7:0,re=g+ne|0,ne=u-ne|0,c[5863]=re,c[5860]=ne,c[re+4>>2]=ne|1,c[g+u+4>>2]=40,c[5864]=c[5979],u=A+4|0,c[u>>2]=27,c[l>>2]=c[5969],c[l+4>>2]=c[5970],c[l+8>>2]=c[5971],c[l+12>>2]=c[5972],c[5969]=g,c[5970]=_,c[5972]=0,c[5971]=l,l=A+24|0;do re=l,l=l+4|0,c[l>>2]=7;while((re+8|0)>>>0<Z>>>0);if((A|0)!=(b|0)){if(g=A-b|0,c[u>>2]=c[u>>2]&-2,c[b+4>>2]=g|1,c[A>>2]=g,l=g>>>3,g>>>0<256){u=23468+(l<<1<<2)|0,A=c[5857]|0,l=1<<l,A&l?(A=u+8|0,l=c[A>>2]|0):(c[5857]=A|l,l=u,A=u+8|0),c[A>>2]=b,c[l+12>>2]=b,c[b+8>>2]=l,c[b+12>>2]=u;break}if(l=g>>>8,l?g>>>0>16777215?h=31:(re=(l+1048320|0)>>>16&8,Z=l<<re,ne=(Z+520192|0)>>>16&4,Z=Z<<ne,h=(Z+245760|0)>>>16&2,h=14-(ne|re|h)+(Z<<h>>>15)|0,h=g>>>(h+7|0)&1|h<<1):h=0,u=23732+(h<<2)|0,c[b+28>>2]=h,c[b+20>>2]=0,c[d>>2]=0,l=c[5858]|0,A=1<<h,!(l&A)){c[5858]=l|A,c[u>>2]=b,c[b+24>>2]=u,c[b+12>>2]=b,c[b+8>>2]=b;break}l=c[u>>2]|0;t:do if((c[l+4>>2]&-8|0)!=(g|0)){for(h=g<<((h|0)==31?0:25-(h>>>1)|0);u=l+16+(h>>>31<<2)|0,A=c[u>>2]|0,!!A;)if((c[A+4>>2]&-8|0)==(g|0)){l=A;break t}else h=h<<1,l=A;c[u>>2]=b,c[b+24>>2]=l,c[b+12>>2]=b,c[b+8>>2]=b;break e}while(!1);re=l+8|0,Z=c[re>>2]|0,c[Z+12>>2]=b,c[re>>2]=b,c[b+8>>2]=Z,c[b+12>>2]=l,c[b+24>>2]=0}}else Z=c[5861]|0,(Z|0)==0|g>>>0<Z>>>0&&(c[5861]=g),c[5969]=g,c[5970]=_,c[5972]=0,c[5866]=c[5975],c[5865]=-1,c[5870]=23468,c[5869]=23468,c[5872]=23476,c[5871]=23476,c[5874]=23484,c[5873]=23484,c[5876]=23492,c[5875]=23492,c[5878]=23500,c[5877]=23500,c[5880]=23508,c[5879]=23508,c[5882]=23516,c[5881]=23516,c[5884]=23524,c[5883]=23524,c[5886]=23532,c[5885]=23532,c[5888]=23540,c[5887]=23540,c[5890]=23548,c[5889]=23548,c[5892]=23556,c[5891]=23556,c[5894]=23564,c[5893]=23564,c[5896]=23572,c[5895]=23572,c[5898]=23580,c[5897]=23580,c[5900]=23588,c[5899]=23588,c[5902]=23596,c[5901]=23596,c[5904]=23604,c[5903]=23604,c[5906]=23612,c[5905]=23612,c[5908]=23620,c[5907]=23620,c[5910]=23628,c[5909]=23628,c[5912]=23636,c[5911]=23636,c[5914]=23644,c[5913]=23644,c[5916]=23652,c[5915]=23652,c[5918]=23660,c[5917]=23660,c[5920]=23668,c[5919]=23668,c[5922]=23676,c[5921]=23676,c[5924]=23684,c[5923]=23684,c[5926]=23692,c[5925]=23692,c[5928]=23700,c[5927]=23700,c[5930]=23708,c[5929]=23708,c[5932]=23716,c[5931]=23716,Z=_+-40|0,ne=g+8|0,ne=ne&7|0?0-ne&7:0,re=g+ne|0,ne=Z-ne|0,c[5863]=re,c[5860]=ne,c[re+4>>2]=ne|1,c[g+Z+4>>2]=40,c[5864]=c[5979];while(!1);if(l=c[5860]|0,l>>>0>O>>>0)return ne=l-O|0,c[5860]=ne,Z=c[5863]|0,re=Z+O|0,c[5863]=re,c[re+4>>2]=ne|1,c[Z+4>>2]=O|3,Z=Z+8|0,N=Se,Z|0}return Z=wE()|0,c[Z>>2]=12,Z=0,N=Se,Z|0}function Qe(A){A=A|0;var l=0,u=0,h=0,d=0,g=0,_=0,y=0,b=0;if(A){u=A+-8|0,d=c[5861]|0,A=c[A+-4>>2]|0,l=A&-8,b=u+l|0;do if(A&1)y=u,_=u;else{if(h=c[u>>2]|0,!(A&3)||(_=u+(0-h)|0,g=h+l|0,_>>>0<d>>>0))return;if((c[5862]|0)==(_|0)){if(A=b+4|0,l=c[A>>2]|0,(l&3|0)!=3){y=_,l=g;break}c[5859]=g,c[A>>2]=l&-2,c[_+4>>2]=g|1,c[_+g>>2]=g;return}if(u=h>>>3,h>>>0<256)if(A=c[_+8>>2]|0,l=c[_+12>>2]|0,(l|0)==(A|0)){c[5857]=c[5857]&~(1<<u),y=_,l=g;break}else{c[A+12>>2]=l,c[l+8>>2]=A,y=_,l=g;break}d=c[_+24>>2]|0,A=c[_+12>>2]|0;do if((A|0)==(_|0)){if(l=_+16|0,u=l+4|0,A=c[u>>2]|0,A)l=u;else if(A=c[l>>2]|0,!A){A=0;break}for(;;)if(h=A+20|0,u=c[h>>2]|0,u)A=u,l=h;else if(h=A+16|0,u=c[h>>2]|0,u)A=u,l=h;else break;c[l>>2]=0}else y=c[_+8>>2]|0,c[y+12>>2]=A,c[A+8>>2]=y;while(!1);if(d){if(l=c[_+28>>2]|0,u=23732+(l<<2)|0,(c[u>>2]|0)==(_|0)){if(c[u>>2]=A,!A){c[5858]=c[5858]&~(1<<l),y=_,l=g;break}}else if(y=d+16|0,c[((c[y>>2]|0)==(_|0)?y:d+20|0)>>2]=A,!A){y=_,l=g;break}c[A+24>>2]=d,l=_+16|0,u=c[l>>2]|0,u|0&&(c[A+16>>2]=u,c[u+24>>2]=A),l=c[l+4>>2]|0,l?(c[A+20>>2]=l,c[l+24>>2]=A,y=_,l=g):(y=_,l=g)}else y=_,l=g}while(!1);if(!(_>>>0>=b>>>0)&&(A=b+4|0,h=c[A>>2]|0,!!(h&1))){if(h&2)c[A>>2]=h&-2,c[y+4>>2]=l|1,c[_+l>>2]=l,d=l;else{if((c[5863]|0)==(b|0)){if(b=(c[5860]|0)+l|0,c[5860]=b,c[5863]=y,c[y+4>>2]=b|1,(y|0)!=(c[5862]|0))return;c[5862]=0,c[5859]=0;return}if((c[5862]|0)==(b|0)){b=(c[5859]|0)+l|0,c[5859]=b,c[5862]=_,c[y+4>>2]=b|1,c[_+b>>2]=b;return}d=(h&-8)+l|0,u=h>>>3;do if(h>>>0<256)if(l=c[b+8>>2]|0,A=c[b+12>>2]|0,(A|0)==(l|0)){c[5857]=c[5857]&~(1<<u);break}else{c[l+12>>2]=A,c[A+8>>2]=l;break}else{g=c[b+24>>2]|0,A=c[b+12>>2]|0;do if((A|0)==(b|0)){if(l=b+16|0,u=l+4|0,A=c[u>>2]|0,A)l=u;else if(A=c[l>>2]|0,!A){u=0;break}for(;;)if(h=A+20|0,u=c[h>>2]|0,u)A=u,l=h;else if(h=A+16|0,u=c[h>>2]|0,u)A=u,l=h;else break;c[l>>2]=0,u=A}else u=c[b+8>>2]|0,c[u+12>>2]=A,c[A+8>>2]=u,u=A;while(!1);if(g|0){if(A=c[b+28>>2]|0,l=23732+(A<<2)|0,(c[l>>2]|0)==(b|0)){if(c[l>>2]=u,!u){c[5858]=c[5858]&~(1<<A);break}}else if(h=g+16|0,c[((c[h>>2]|0)==(b|0)?h:g+20|0)>>2]=u,!u)break;c[u+24>>2]=g,A=b+16|0,l=c[A>>2]|0,l|0&&(c[u+16>>2]=l,c[l+24>>2]=u),A=c[A+4>>2]|0,A|0&&(c[u+20>>2]=A,c[A+24>>2]=u)}}while(!1);if(c[y+4>>2]=d|1,c[_+d>>2]=d,(y|0)==(c[5862]|0)){c[5859]=d;return}}if(A=d>>>3,d>>>0<256){u=23468+(A<<1<<2)|0,l=c[5857]|0,A=1<<A,l&A?(l=u+8|0,A=c[l>>2]|0):(c[5857]=l|A,A=u,l=u+8|0),c[l>>2]=y,c[A+12>>2]=y,c[y+8>>2]=A,c[y+12>>2]=u;return}A=d>>>8,A?d>>>0>16777215?h=31:(_=(A+1048320|0)>>>16&8,b=A<<_,g=(b+520192|0)>>>16&4,b=b<<g,h=(b+245760|0)>>>16&2,h=14-(g|_|h)+(b<<h>>>15)|0,h=d>>>(h+7|0)&1|h<<1):h=0,A=23732+(h<<2)|0,c[y+28>>2]=h,c[y+20>>2]=0,c[y+16>>2]=0,l=c[5858]|0,u=1<<h;e:do if(!(l&u))c[5858]=l|u,c[A>>2]=y,c[y+24>>2]=A,c[y+12>>2]=y,c[y+8>>2]=y;else{A=c[A>>2]|0;t:do if((c[A+4>>2]&-8|0)!=(d|0)){for(h=d<<((h|0)==31?0:25-(h>>>1)|0);u=A+16+(h>>>31<<2)|0,l=c[u>>2]|0,!!l;)if((c[l+4>>2]&-8|0)==(d|0)){A=l;break t}else h=h<<1,A=l;c[u>>2]=y,c[y+24>>2]=A,c[y+12>>2]=y,c[y+8>>2]=y;break e}while(!1);_=A+8|0,b=c[_>>2]|0,c[b+12>>2]=y,c[_>>2]=y,c[y+8>>2]=b,c[y+12>>2]=A,c[y+24>>2]=0}while(!1);if(b=(c[5865]|0)+-1|0,c[5865]=b,!(b|0)){for(A=23884;A=c[A>>2]|0,A;)A=A+8|0;c[5865]=-1}}}}function kr(A,l){A=A|0,l=l|0;var u=0;return A?(u=zn(l,A)|0,(l|A)>>>0>65535&&(u=((u>>>0)/(A>>>0)|0|0)==(l|0)?u:-1)):u=0,A=Pr(u)|0,!A||!(c[A+-4>>2]&3)||is(A|0,0,u|0)|0,A|0}function st(A,l,u,h){return A=A|0,l=l|0,u=u|0,h=h|0,u=A+u>>>0,Xe(l+h+(u>>>0<A>>>0|0)>>>0|0),u|0|0}function pn(A,l,u,h){return A=A|0,l=l|0,u=u|0,h=h|0,h=l-h-(u>>>0>A>>>0|0)>>>0,Xe(h|0),A-u>>>0|0|0}function pm(A){return A=A|0,(A?31-(Qr(A^A-1)|0)|0:32)|0}function Qf(A,l,u,h,d){A=A|0,l=l|0,u=u|0,h=h|0,d=d|0;var g=0,_=0,y=0,b=0,x=0,S=0,O=0,z=0,j=0,V=0;if(S=A,b=l,x=b,_=u,z=h,y=z,!x)return g=(d|0)!=0,y?g?(c[d>>2]=A|0,c[d+4>>2]=l&0,z=0,d=0,Xe(z|0),d|0):(z=0,d=0,Xe(z|0),d|0):(g&&(c[d>>2]=(S>>>0)%(_>>>0),c[d+4>>2]=0),z=0,d=(S>>>0)/(_>>>0)>>>0,Xe(z|0),d|0);g=(y|0)==0;do if(_){if(!g){if(g=(Qr(y|0)|0)-(Qr(x|0)|0)|0,g>>>0<=31){O=g+1|0,y=31-g|0,l=g-31>>31,_=O,A=S>>>(O>>>0)&l|x<<y,l=x>>>(O>>>0)&l,g=0,y=S<<y;break}return d?(c[d>>2]=A|0,c[d+4>>2]=b|l&0,z=0,d=0,Xe(z|0),d|0):(z=0,d=0,Xe(z|0),d|0)}if(g=_-1|0,g&_|0){y=(Qr(_|0)|0)+33-(Qr(x|0)|0)|0,V=64-y|0,O=32-y|0,b=O>>31,j=y-32|0,l=j>>31,_=y,A=O-1>>31&x>>>(j>>>0)|(x<<O|S>>>(y>>>0))&l,l=l&x>>>(y>>>0),g=S<<V&b,y=(x<<V|S>>>(j>>>0))&b|S<<O&y-33>>31;break}return d|0&&(c[d>>2]=g&S,c[d+4>>2]=0),(_|0)==1?(j=b|l&0,V=A|0|0,Xe(j|0),V|0):(V=pm(_|0)|0,j=x>>>(V>>>0)|0,V=x<<32-V|S>>>(V>>>0)|0,Xe(j|0),V|0)}else{if(g)return d|0&&(c[d>>2]=(x>>>0)%(_>>>0),c[d+4>>2]=0),j=0,V=(x>>>0)/(_>>>0)>>>0,Xe(j|0),V|0;if(!S)return d|0&&(c[d>>2]=0,c[d+4>>2]=(x>>>0)%(y>>>0)),j=0,V=(x>>>0)/(y>>>0)>>>0,Xe(j|0),V|0;if(g=y-1|0,!(g&y))return d|0&&(c[d>>2]=A|0,c[d+4>>2]=g&x|l&0),j=0,V=x>>>((pm(y|0)|0)>>>0),Xe(j|0),V|0;if(g=(Qr(y|0)|0)-(Qr(x|0)|0)|0,g>>>0<=30){l=g+1|0,y=31-g|0,_=l,A=x<<y|S>>>(l>>>0),l=x>>>(l>>>0),g=0,y=S<<y;break}return d?(c[d>>2]=A|0,c[d+4>>2]=b|l&0,j=0,V=0,Xe(j|0),V|0):(j=0,V=0,Xe(j|0),V|0)}while(!1);if(!_)x=y,b=0,y=0;else{O=u|0|0,S=z|h&0,x=st(O|0,S|0,-1,-1)|0,u=F()|0,b=y,y=0;do h=b,b=g>>>31|b<<1,g=y|g<<1,h=A<<1|h>>>31|0,z=A>>>31|l<<1|0,pn(x|0,u|0,h|0,z|0)|0,V=F()|0,j=V>>31|((V|0)<0?-1:0)<<1,y=j&1,A=pn(h|0,z|0,j&O|0,(((V|0)<0?-1:0)>>31|((V|0)<0?-1:0)<<1)&S|0)|0,l=F()|0,_=_-1|0;while(_|0);x=b,b=0}return _=0,d|0&&(c[d>>2]=A,c[d+4>>2]=l),j=(g|0)>>>31|(x|_)<<1|(_<<1|g>>>31)&0|b,V=(g<<1|0)&-2|y,Xe(j|0),V|0}function rs(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0;return x=l>>31|((l|0)<0?-1:0)<<1,b=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,g=h>>31|((h|0)<0?-1:0)<<1,d=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,y=pn(x^A|0,b^l|0,x|0,b|0)|0,_=F()|0,A=g^x,l=d^b,pn((Qf(y,_,pn(g^u|0,d^h|0,g|0,d|0)|0,F()|0,0)|0)^A|0,(F()|0)^l|0,A|0,l|0)|0}function xE(A,l){A=A|0,l=l|0;var u=0,h=0,d=0,g=0;return g=A&65535,d=l&65535,u=zn(d,g)|0,h=A>>>16,A=(u>>>16)+(zn(d,h)|0)|0,d=l>>>16,l=zn(d,g)|0,Xe((A>>>16)+(zn(d,h)|0)+(((A&65535)+l|0)>>>16)|0),A+l<<16|u&65535|0|0}function gn(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0;return d=A,g=u,u=xE(d,g)|0,A=F()|0,Xe((zn(l,g)|0)+(zn(h,d)|0)+A|A&0|0),u|0|0|0}function sA(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0,_=0,y=0,b=0,x=0;return d=N,N=N+16|0,y=d|0,_=l>>31|((l|0)<0?-1:0)<<1,g=((l|0)<0?-1:0)>>31|((l|0)<0?-1:0)<<1,x=h>>31|((h|0)<0?-1:0)<<1,b=((h|0)<0?-1:0)>>31|((h|0)<0?-1:0)<<1,A=pn(_^A|0,g^l|0,_|0,g|0)|0,l=F()|0,Qf(A,l,pn(x^u|0,b^h|0,x|0,b|0)|0,F()|0,y)|0,h=pn(c[y>>2]^_|0,c[y+4>>2]^g|0,_|0,g|0)|0,u=F()|0,N=d,Xe(u|0),h|0}function $s(A,l,u,h){A=A|0,l=l|0,u=u|0,h=h|0;var d=0,g=0;return g=N,N=N+16|0,d=g|0,Qf(A,l,u,h,d)|0,N=g,Xe(c[d+4>>2]|0),c[d>>2]|0|0}function gm(A,l,u){return A=A|0,l=l|0,u=u|0,(u|0)<32?(Xe(l>>u|0),A>>>u|(l&(1<<u)-1)<<32-u):(Xe(((l|0)<0?-1:0)|0),l>>u-32|0)}function de(A,l,u){return A=A|0,l=l|0,u=u|0,(u|0)<32?(Xe(l>>>u|0),A>>>u|(l&(1<<u)-1)<<32-u):(Xe(0),l>>>u-32|0)}function xe(A,l,u){return A=A|0,l=l|0,u=u|0,(u|0)<32?(Xe(l<<u|(A&(1<<u)-1<<32-u)>>>32-u|0),A<<u):(Xe(A<<u-32|0),0)}function mm(A,l){return A=+A,l=+l,A!=A?+l:l!=l?+A:+Mg(+A,+l)}function Yf(A,l){return A=+A,l=+l,A!=A?+l:l!=l?+A:+Jl(+A,+l)}function oA(A){return A=+A,A>=0?+ze(A+.5):+Cr(A-.5)}function aA(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0;if((u|0)>=8192)return Dx(A|0,l|0,u|0)|0,A|0;if(g=A|0,d=A+u|0,(A&3)==(l&3)){for(;A&3;){if(!u)return g|0;ge[A>>0]=ge[l>>0]|0,A=A+1|0,l=l+1|0,u=u-1|0}for(u=d&-4|0,h=u-64|0;(A|0)<=(h|0);)c[A>>2]=c[l>>2],c[A+4>>2]=c[l+4>>2],c[A+8>>2]=c[l+8>>2],c[A+12>>2]=c[l+12>>2],c[A+16>>2]=c[l+16>>2],c[A+20>>2]=c[l+20>>2],c[A+24>>2]=c[l+24>>2],c[A+28>>2]=c[l+28>>2],c[A+32>>2]=c[l+32>>2],c[A+36>>2]=c[l+36>>2],c[A+40>>2]=c[l+40>>2],c[A+44>>2]=c[l+44>>2],c[A+48>>2]=c[l+48>>2],c[A+52>>2]=c[l+52>>2],c[A+56>>2]=c[l+56>>2],c[A+60>>2]=c[l+60>>2],A=A+64|0,l=l+64|0;for(;(A|0)<(u|0);)c[A>>2]=c[l>>2],A=A+4|0,l=l+4|0}else for(u=d-4|0;(A|0)<(u|0);)ge[A>>0]=ge[l>>0]|0,ge[A+1>>0]=ge[l+1>>0]|0,ge[A+2>>0]=ge[l+2>>0]|0,ge[A+3>>0]=ge[l+3>>0]|0,A=A+4|0,l=l+4|0;for(;(A|0)<(d|0);)ge[A>>0]=ge[l>>0]|0,A=A+1|0,l=l+1|0;return g|0}function is(A,l,u){A=A|0,l=l|0,u=u|0;var h=0,d=0,g=0,_=0;if(g=A+u|0,l=l&255,(u|0)>=67){for(;A&3;)ge[A>>0]=l,A=A+1|0;for(h=g&-4|0,_=l|l<<8|l<<16|l<<24,d=h-64|0;(A|0)<=(d|0);)c[A>>2]=_,c[A+4>>2]=_,c[A+8>>2]=_,c[A+12>>2]=_,c[A+16>>2]=_,c[A+20>>2]=_,c[A+24>>2]=_,c[A+28>>2]=_,c[A+32>>2]=_,c[A+36>>2]=_,c[A+40>>2]=_,c[A+44>>2]=_,c[A+48>>2]=_,c[A+52>>2]=_,c[A+56>>2]=_,c[A+60>>2]=_,A=A+64|0;for(;(A|0)<(h|0);)c[A>>2]=_,A=A+4|0}for(;(A|0)<(g|0);)ge[A>>0]=l,A=A+1|0;return g-u|0}function _m(A){return A=+A,A>=0?+ze(A+.5):+Cr(A-.5)}function gi(A){A=A|0;var l=0,u=0,h=0;return h=Ox()|0,u=c[Oe>>2]|0,l=u+A|0,(A|0)>0&(l|0)<(u|0)|(l|0)<0?(Fx(l|0)|0,Ng(12),-1):(l|0)>(h|0)&&!(Bx(l|0)|0)?(Ng(12),-1):(c[Oe>>2]=l,u|0)}return{___divdi3:rs,___muldi3:gn,___remdi3:sA,___uremdi3:$s,_areNeighborCells:AT,_bitshift64Ashr:gm,_bitshift64Lshr:de,_bitshift64Shl:xe,_calloc:kr,_cellAreaKm2:WT,_cellAreaM2:$T,_cellAreaRads2:Xf,_cellToBoundary:pa,_cellToCenterChild:TT,_cellToChildPos:NT,_cellToChildren:bT,_cellToChildrenSize:iA,_cellToLatLng:da,_cellToLocalIj:qT,_cellToParent:Vf,_cellToVertex:er,_cellToVertexes:pE,_cellsToDirectedEdge:cT,_cellsToLinkedMultiPolygon:Yx,_childPosToCell:OT,_compactCells:ET,_destroyLinkedMultiPolygon:im,_directedEdgeToBoundary:rA,_directedEdgeToCells:dT,_edgeLengthKm:XT,_edgeLengthM:QT,_edgeLengthRads:HT,_emscripten_replace_memory:Lx,_free:Qe,_getBaseCellNumber:Gg,_getDirectedEdgeDestination:fT,_getDirectedEdgeOrigin:uT,_getHexagonAreaAvgKm2:UT,_getHexagonAreaAvgM2:VT,_getHexagonEdgeLengthAvgKm:zT,_getHexagonEdgeLengthAvgM:jT,_getIcosahedronFaces:em,_getNumCells:Hf,_getPentagons:$f,_getRes0Cells:Jx,_getResolution:wT,_greatCircleDistanceKm:ma,_greatCircleDistanceM:BT,_greatCircleDistanceRads:DT,_gridDisk:Og,_gridDiskDistances:Dg,_gridDistance:JT,_gridPathCells:tE,_gridPathCellsSize:eE,_gridRingUnsafe:$x,_i64Add:st,_i64Subtract:pn,_isPentagon:Tt,_isResClassIII:PT,_isValidCell:Uf,_isValidDirectedEdge:hT,_isValidVertex:mE,_latLngToCell:Jg,_llvm_maxnum_f64:mm,_llvm_minnum_f64:Yf,_llvm_round_f64:oA,_localIjToCell:GT,_malloc:Pr,_maxFaceCount:IT,_maxGridDiskSize:Wx,_maxPolygonToCellsSize:Hx,_memcpy:aA,_memset:is,_originToDirectedEdges:pT,_pentagonCount:MT,_polygonToCells:Xx,_readInt64AsDoubleFromPointer:uE,_res0CellCount:Gx,_round:_m,_sbrk:gi,_sizeOfCellBoundary:oE,_sizeOfCoordIJ:cE,_sizeOfGeoLoop:aE,_sizeOfGeoPolygon:lE,_sizeOfH3Index:iE,_sizeOfLatLng:sE,_sizeOfLinkedGeoPolygon:AE,_uncompactCells:ST,_uncompactCellsSize:CT,_vertexToLatLng:gE,establishStackSpace:jx,stackAlloc:Ux,stackRestore:zx,stackSave:Vx}}(Pf,kf,ke);e.___divdi3=pe.___divdi3,e.___muldi3=pe.___muldi3,e.___remdi3=pe.___remdi3,e.___uremdi3=pe.___uremdi3,e._areNeighborCells=pe._areNeighborCells,e._bitshift64Ashr=pe._bitshift64Ashr,e._bitshift64Lshr=pe._bitshift64Lshr,e._bitshift64Shl=pe._bitshift64Shl,e._calloc=pe._calloc,e._cellAreaKm2=pe._cellAreaKm2,e._cellAreaM2=pe._cellAreaM2,e._cellAreaRads2=pe._cellAreaRads2,e._cellToBoundary=pe._cellToBoundary,e._cellToCenterChild=pe._cellToCenterChild,e._cellToChildPos=pe._cellToChildPos,e._cellToChildren=pe._cellToChildren,e._cellToChildrenSize=pe._cellToChildrenSize,e._cellToLatLng=pe._cellToLatLng,e._cellToLocalIj=pe._cellToLocalIj,e._cellToParent=pe._cellToParent,e._cellToVertex=pe._cellToVertex,e._cellToVertexes=pe._cellToVertexes,e._cellsToDirectedEdge=pe._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=pe._cellsToLinkedMultiPolygon,e._childPosToCell=pe._childPosToCell,e._compactCells=pe._compactCells,e._destroyLinkedMultiPolygon=pe._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=pe._directedEdgeToBoundary,e._directedEdgeToCells=pe._directedEdgeToCells,e._edgeLengthKm=pe._edgeLengthKm,e._edgeLengthM=pe._edgeLengthM,e._edgeLengthRads=pe._edgeLengthRads;var Rf=e._emscripten_replace_memory=pe._emscripten_replace_memory;e._free=pe._free,e._getBaseCellNumber=pe._getBaseCellNumber,e._getDirectedEdgeDestination=pe._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=pe._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=pe._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=pe._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=pe._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=pe._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=pe._getIcosahedronFaces,e._getNumCells=pe._getNumCells,e._getPentagons=pe._getPentagons,e._getRes0Cells=pe._getRes0Cells,e._getResolution=pe._getResolution,e._greatCircleDistanceKm=pe._greatCircleDistanceKm,e._greatCircleDistanceM=pe._greatCircleDistanceM,e._greatCircleDistanceRads=pe._greatCircleDistanceRads,e._gridDisk=pe._gridDisk,e._gridDiskDistances=pe._gridDiskDistances,e._gridDistance=pe._gridDistance,e._gridPathCells=pe._gridPathCells,e._gridPathCellsSize=pe._gridPathCellsSize,e._gridRingUnsafe=pe._gridRingUnsafe,e._i64Add=pe._i64Add,e._i64Subtract=pe._i64Subtract,e._isPentagon=pe._isPentagon,e._isResClassIII=pe._isResClassIII,e._isValidCell=pe._isValidCell,e._isValidDirectedEdge=pe._isValidDirectedEdge,e._isValidVertex=pe._isValidVertex,e._latLngToCell=pe._latLngToCell,e._llvm_maxnum_f64=pe._llvm_maxnum_f64,e._llvm_minnum_f64=pe._llvm_minnum_f64,e._llvm_round_f64=pe._llvm_round_f64,e._localIjToCell=pe._localIjToCell,e._malloc=pe._malloc,e._maxFaceCount=pe._maxFaceCount,e._maxGridDiskSize=pe._maxGridDiskSize,e._maxPolygonToCellsSize=pe._maxPolygonToCellsSize,e._memcpy=pe._memcpy,e._memset=pe._memset,e._originToDirectedEdges=pe._originToDirectedEdges,e._pentagonCount=pe._pentagonCount,e._polygonToCells=pe._polygonToCells,e._readInt64AsDoubleFromPointer=pe._readInt64AsDoubleFromPointer,e._res0CellCount=pe._res0CellCount,e._round=pe._round,e._sbrk=pe._sbrk,e._sizeOfCellBoundary=pe._sizeOfCellBoundary,e._sizeOfCoordIJ=pe._sizeOfCoordIJ,e._sizeOfGeoLoop=pe._sizeOfGeoLoop,e._sizeOfGeoPolygon=pe._sizeOfGeoPolygon,e._sizeOfH3Index=pe._sizeOfH3Index,e._sizeOfLatLng=pe._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=pe._sizeOfLinkedGeoPolygon,e._uncompactCells=pe._uncompactCells,e._uncompactCellsSize=pe._uncompactCellsSize,e._vertexToLatLng=pe._vertexToLatLng,e.establishStackSpace=pe.establishStackSpace;var Aa=e.stackAlloc=pe.stackAlloc,ql=e.stackRestore=pe.stackRestore,Gl=e.stackSave=pe.stackSave;if(e.asm=pe,e.cwrap=C,e.setValue=T,e.getValue=E,fr){Yl(fr)||(fr=s(fr));{_f();var Vs=function(H){H.byteLength&&(H=new Uint8Array(H)),Ve.set(H,w),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,yf()},ca=function(){o(fr,Vs,function(){throw"could not load memory initializer "+fr})},ua=la(fr);if(ua)Vs(ua.buffer);else if(e.memoryInitializerRequest){var fa=function(){var H=e.memoryInitializerRequest,ee=H.response;if(H.status!==200&&H.status!==0){var oe=la(e.memoryInitializerRequestURL);if(oe)ee=oe.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+H.status+", retrying "+fr),ca();return}}Vs(ee)};e.memoryInitializerRequest.response?setTimeout(fa,0):e.memoryInitializerRequest.addEventListener("load",fa)}else ca()}}var X;Gi=function H(){X||ce(),X||(Gi=H)};function ce(H){if(Xr>0||(sn(),Xr>0))return;function ee(){X||(X=!0,!I&&(Hr(),ff(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),hf()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),ee()},1)):ee()}e.run=ce;function Ee(H){throw e.onAbort&&e.onAbort(H),H+="",a(H),f(H),I=!0,"abort("+H+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=Ee,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return ce(),t}(typeof jt=="object"?jt:{}),tt="number",He=tt,Ma=tt,Ke=tt,Ze=tt,wn=tt,Be=tt,nU=[["sizeOfH3Index",tt],["sizeOfLatLng",tt],["sizeOfCellBoundary",tt],["sizeOfGeoLoop",tt],["sizeOfGeoPolygon",tt],["sizeOfLinkedGeoPolygon",tt],["sizeOfCoordIJ",tt],["readInt64AsDoubleFromPointer",tt],["isValidCell",Ma,[Ke,Ze]],["latLngToCell",He,[tt,tt,wn,Be]],["cellToLatLng",He,[Ke,Ze,Be]],["cellToBoundary",He,[Ke,Ze,Be]],["maxGridDiskSize",He,[tt,Be]],["gridDisk",He,[Ke,Ze,tt,Be]],["gridDiskDistances",He,[Ke,Ze,tt,Be,Be]],["gridRingUnsafe",He,[Ke,Ze,tt,Be]],["maxPolygonToCellsSize",He,[Be,wn,tt,Be]],["polygonToCells",He,[Be,wn,tt,Be]],["cellsToLinkedMultiPolygon",He,[Be,tt,Be]],["destroyLinkedMultiPolygon",null,[Be]],["compactCells",He,[Be,Be,tt,tt]],["uncompactCells",He,[Be,tt,tt,Be,tt,wn]],["uncompactCellsSize",He,[Be,tt,tt,wn,Be]],["isPentagon",Ma,[Ke,Ze]],["isResClassIII",Ma,[Ke,Ze]],["getBaseCellNumber",tt,[Ke,Ze]],["getResolution",tt,[Ke,Ze]],["maxFaceCount",He,[Ke,Ze,Be]],["getIcosahedronFaces",He,[Ke,Ze,Be]],["cellToParent",He,[Ke,Ze,wn,Be]],["cellToChildren",He,[Ke,Ze,wn,Be]],["cellToCenterChild",He,[Ke,Ze,wn,Be]],["cellToChildrenSize",He,[Ke,Ze,wn,Be]],["cellToChildPos",He,[Ke,Ze,wn,Be]],["childPosToCell",He,[tt,tt,Ke,Ze,wn,Be]],["areNeighborCells",He,[Ke,Ze,Ke,Ze,Be]],["cellsToDirectedEdge",He,[Ke,Ze,Ke,Ze,Be]],["getDirectedEdgeOrigin",He,[Ke,Ze,Be]],["getDirectedEdgeDestination",He,[Ke,Ze,Be]],["isValidDirectedEdge",Ma,[Ke,Ze]],["directedEdgeToCells",He,[Ke,Ze,Be]],["originToDirectedEdges",He,[Ke,Ze,Be]],["directedEdgeToBoundary",He,[Ke,Ze,Be]],["gridDistance",He,[Ke,Ze,Ke,Ze,Be]],["gridPathCells",He,[Ke,Ze,Ke,Ze,Be]],["gridPathCellsSize",He,[Ke,Ze,Ke,Ze,Be]],["cellToLocalIj",He,[Ke,Ze,Ke,Ze,tt,Be]],["localIjToCell",He,[Ke,Ze,Be,tt,Be]],["getHexagonAreaAvgM2",He,[wn,Be]],["getHexagonAreaAvgKm2",He,[wn,Be]],["getHexagonEdgeLengthAvgM",He,[wn,Be]],["getHexagonEdgeLengthAvgKm",He,[wn,Be]],["greatCircleDistanceM",tt,[Be,Be]],["greatCircleDistanceKm",tt,[Be,Be]],["greatCircleDistanceRads",tt,[Be,Be]],["cellAreaM2",He,[Ke,Ze,Be]],["cellAreaKm2",He,[Ke,Ze,Be]],["cellAreaRads2",He,[Ke,Ze,Be]],["edgeLengthM",He,[Ke,Ze,Be]],["edgeLengthKm",He,[Ke,Ze,Be]],["edgeLengthRads",He,[Ke,Ze,Be]],["getNumCells",He,[wn,Be]],["getRes0Cells",He,[Be]],["res0CellCount",tt],["getPentagons",He,[tt,Be]],["pentagonCount",tt],["cellToVertex",He,[Ke,Ze,tt,Be]],["cellToVertexes",He,[Ke,Ze,Be]],["vertexToLatLng",He,[Ke,Ze,Be]],["isValidVertex",Ma,[Ke,Ze]]],rU=0,iU=1,sU=2,oU=3,Tx=4,aU=5,lU=6,AU=7,cU=8,uU=9,fU=10,hU=11,dU=12,pU=13,gU=14,mU=15,fn={};fn[rU]="Success";fn[iU]="The operation failed but a more specific error is not available";fn[sU]="Argument was outside of acceptable range";fn[oU]="Latitude or longitude arguments were outside of acceptable range";fn[Tx]="Resolution argument was outside of acceptable range";fn[aU]="Cell argument was not valid";fn[lU]="Directed edge argument was not valid";fn[AU]="Undirected edge argument was not valid";fn[cU]="Vertex argument was not valid";fn[uU]="Pentagon distortion was encountered";fn[fU]="Duplicate input";fn[hU]="Cell arguments were not neighbors";fn[dU]="Cell arguments had incompatible resolutions";fn[pU]="Memory allocation failed";fn[gU]="Bounds of provided memory were insufficient";fn[mU]="Mode or flags argument was not valid";var Ex=1e3,_U=1001,Sx=1002,cf={};cf[Ex]="Unknown unit";cf[_U]="Array length out of bounds";cf[Sx]="Got unexpected null value for H3 index";var yU="Unknown error";function Cx(t,e,n){var r=n&&"value"in n,i=new Error((t[e]||yU)+" (code: "+e+(r?", value: "+n.value:"")+")");return i.code=e,i}function Px(t,e){var n=arguments.length===2?{value:e}:{};return Cx(fn,t,n)}function kx(t,e){var n=arguments.length===2?{value:e}:{};return Cx(cf,t,n)}function Zo(t){if(t!==0)throw Px(t)}var Jt={};nU.forEach(function(e){Jt[e[0]]=jt.cwrap.apply(jt,e)});var vo=16,vU=4,Is=8,wU=8,Kd=Jt.sizeOfH3Index(),Rx=Jt.sizeOfLatLng(),bU=Jt.sizeOfCellBoundary();Jt.sizeOfGeoPolygon();Jt.sizeOfGeoLoop();Jt.sizeOfLinkedGeoPolygon();Jt.sizeOfCoordIJ();var gy={m:"m",m2:"m2",km:"km",km2:"km2",rads:"rads",rads2:"rads2"};function xU(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw Px(Tx,t);return t}function TU(t){if(!t)throw kx(Sx);return t}var EU=/[^0-9a-fA-F]/;function Ms(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||EU.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),vo),n=parseInt(t.substring(t.length-8),vo);return[n,e]}function my(t){if(t>=0)return t.toString(vo);t=t&2147483647;var e=Ix(8,t.toString(vo)),n=(parseInt(e[0],vo)+8).toString(vo);return e=n+e.substring(1),e}function SU(t,e){return my(e)+Ix(8,my(t))}function Ix(t,e){for(var n=t-e.length,r="",i=0;i<n;i++)r+="0";return r=r+e,r}function CU(t,e){e===void 0&&(e=0);var n=jt.getValue(t+Kd*e,"i32"),r=jt.getValue(t+Kd*e+vU,"i32");return r?SU(n,r):null}function PU(t,e){return e===void 0&&(e=0),jt.getValue(t+Is*e,"double")}function kU(t){return Jt.readInt64AsDoubleFromPointer(t)}function pu(t){return UU(jt.getValue(t,"double"))}function Mx(t){return[pu(t),pu(t+Is)]}function RU(t){return[pu(t+Is),pu(t)]}function IU(t,e,n){for(var r=jt.getValue(t,"i32"),i=t+Is,s=[],o=e?RU:Mx,a=0;a<r*2;a+=2)s.push(o(i+Is*a));return n&&s.push(s[0]),s}function MU(t){var e=Ms(t),n=e[0],r=e[1];return!!Jt.isValidCell(n,r)}function NU(t){var e=Ms(t),n=e[0],r=e[1];return!!Jt.isPentagon(n,r)}function OU(t){var e=Ms(t),n=e[0],r=e[1];return Jt.isValidCell(n,r)?Jt.getResolution(n,r):-1}function DU(t,e,n){var r=jt._malloc(Rx);jt.HEAPF64.set([t,e].map(LU),r/Is);var i=jt._malloc(Kd);try{return Zo(Jt.latLngToCell(r,n,i)),TU(CU(i))}finally{jt._free(i),jt._free(r)}}function uf(t){var e=jt._malloc(Rx),n=Ms(t),r=n[0],i=n[1];try{return Zo(Jt.cellToLatLng(r,i,e)),Mx(e)}finally{jt._free(e)}}function Zd(t,e){var n=jt._malloc(bU),r=Ms(t),i=r[0],s=r[1];try{return Zo(Jt.cellToBoundary(i,s,n)),IU(n,e,e)}finally{jt._free(n)}}function BU(t,e){var n=Ms(t),r=n[0],i=n[1],s=Ms(e),o=s[0],a=s[1],f=jt._malloc(wU);try{return Zo(Jt.gridDistance(r,i,o,a,f)),kU(f)}finally{jt._free(f)}}function FU(t,e){xU(t);var n=jt._malloc(Is);try{switch(e){case gy.m:Zo(Jt.getHexagonEdgeLengthAvgM(t,n));break;case gy.km:Zo(Jt.getHexagonEdgeLengthAvgKm(t,n));break;default:throw kx(Ex,e)}return PU(n)}finally{jt._free(n)}}function LU(t){return t*Math.PI/180}function UU(t){return t*180/Math.PI}function Nx(t,e){e=e===void 0?t[0][0]:e;for(const n of t){const r=n[0]-e;r>180?n[0]-=360:r<-180&&(n[0]+=360)}}function VU(t,e,n){const[r,i]=uf(t),s=e.length;Nx(e,i);const o=e[0]===e[s-1]?s-1:s;for(let a=0;a<o;a++)e[a][0]=zo(i,e[a][0],n),e[a][1]=zo(r,e[a][1],n)}function zU(t,e,n){const r=t(e,n),[i,s]=uf(r);return[s,i]}function _y(t,e=1){const n=Zd(t,!0);return e!==1?VU(t,n,e):Nx(n),n}function jU(t){const e=new Float64Array(t.length*2);let n=0;for(const r of t)e[n++]=r[0],e[n++]=r[1];return e}const WU=10;function $U(t,e){let n;return t==null?n=e:typeof t=="object"?n={...t,coverage:e}:n={getHexagon:t,coverage:e},n}const HU={...lf.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:t=>t.hexagon},extruded:!0};class ia extends Hl{initializeState(){ia._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:e}){return this._shouldUseHighPrecision()?e.propsOrDataChanged:e.somethingChanged}updateState({props:e,changeFlags:n}){if(e.highPrecision!==!0&&(n.dataChanged||n.updateTriggersChanged&&n.updateTriggersChanged.getHexagon)){const r=this._calculateH3DataProps();this.setState(r)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let e=-1,n=!1,r=!1;const{iterable:i,objectInfo:s}=ra(this.props.data);for(const o of i){s.index++;const a=this.props.getHexagon(o,s),f=OU(a);if(e<0){if(e=f,!this.props.highPrecision)break}else if(e!==f){r=!0;break}if(NU(a)){n=!0;break}}return{resolution:e,edgeLengthKM:e>=0?FU(e,"km"):0,hasMultipleRes:r,hasPentagon:n}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){const{resolution:e,hasPentagon:n,hasMultipleRes:r}=this.state,{viewport:i}=this.context;return!!(i!=null&&i.resolution)||r||n||e>=0&&e<=5}return this.props.highPrecision}_updateVertices(e){if(this._shouldUseHighPrecision())return;const{resolution:n,edgeLengthKM:r,centerHex:i}=this.state;if(n<0)return;const s=this.props.centerHexagon||DU(e.latitude,e.longitude,n);if(i===s)return;if(i)try{if(BU(i,s)*r<WU)return}catch{}const{unitsPerMeter:o}=e.distanceScales;let a=_y(s);const[f,p]=uf(s),[m,v]=e.projectFlat([p,f]);a=a.map(w=>{const T=e.projectFlat(w);return[(T[0]-m)/o[0],(T[1]-v)/o[1]]}),this.setState({centerHex:s,vertices:a})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){const{elevationScale:e,material:n,coverage:r,extruded:i,wireframe:s,stroked:o,filled:a,lineWidthUnits:f,lineWidthScale:p,lineWidthMinPixels:m,lineWidthMaxPixels:v,getFillColor:w,getElevation:T,getLineColor:E,getLineWidth:I,transitions:U,updateTriggers:R}=this.props;return{elevationScale:e,extruded:i,coverage:r,wireframe:s,stroked:o,filled:a,lineWidthUnits:f,lineWidthScale:p,lineWidthMinPixels:m,lineWidthMaxPixels:v,material:n,getElevation:T,getFillColor:w,getLineColor:E,getLineWidth:I,transitions:U,updateTriggers:{getFillColor:R.getFillColor,getElevation:R.getElevation,getLineColor:R.getLineColor,getLineWidth:R.getLineWidth}}}_renderPolygonLayer(){const{data:e,getHexagon:n,updateTriggers:r,coverage:i}=this.props,s=this.getSubLayerClass("hexagon-cell-hifi",lf),o=this._getForwardProps();return o.updateTriggers.getPolygon=$U(r.getHexagon,i),new s(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:e,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(a,f)=>{const p=n(a,f);return jU(_y(p,i))}})}_renderColumnLayer(){const{data:e,getHexagon:n,updateTriggers:r}=this.props,i=this.getSubLayerClass("hexagon-cell",Sg),s=this._getForwardProps();return s.updateTriggers.getPosition=r.getHexagon,new i(s,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:s.updateTriggers}),{data:e,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:zU.bind(null,n)})}}ia.defaultProps=HU;ia.layerName="H3HexagonLayer";ia._checkH3Lib=()=>{};const XU={latitude:39.8283,longitude:-98.5795,zoom:3},QU=()=>{var Aa,ql,Gl,Vs,ca,ua,fa;const[t,e]=le.useState([]),[n,r]=le.useState(XU),[i,s]=le.useState(null),[o,a]=le.useState(null),[f,p]=le.useState(!1),[m,v]=le.useState(0),[w,T]=le.useState(!1),[E,I]=le.useState(null),[U,R]=le.useState(!1),[P,C]=le.useState([]),[D,$]=le.useState([]),[q,fe]=le.useState(!1),[ae,he]=le.useState("https://basemaps.cartocdn.com/gl/positron-gl-style/style.json"),[ye,ke]=le.useState(!1),[Le,Ve]=le.useState(!1),[Ae,Re]=le.useState(null),[At,it]=le.useState({}),[Te,Fe]=le.useState(!0),[be,rt]=le.useState(null),[qe,hn]=le.useState(null),[Sr,Us]=le.useState(null),kt=le.useRef(null),[sn,Hr]=le.useState(!1),ff={Light:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",Dark:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",City:"mapbox://styles/mapbox/streets-v12",Satellite:"mapbox://styles/mapbox/satellite-streets-v12"};zE.useEffect(()=>{if(E!=null&&E.properties){const X=Object.keys(E.properties);$(X),(P.length===0||!P.some(ce=>X.includes(ce)))&&C(X.slice(0,5))}},[E]);const hf=X=>{C(ce=>ce.includes(X)?ce.filter(Ee=>Ee!==X):[...ce,X])},sa=le.useCallback(X=>{switch(X.type){case"Point":return[X.coordinates];case"LineString":return X.coordinates;case"Polygon":return X.coordinates.flat();case"MultiPoint":return X.coordinates;case"MultiLineString":return X.coordinates.flat();case"MultiPolygon":return X.coordinates.flat(2);case"GeometryCollection":return X.geometries.flatMap(sa);default:return[]}},[]),df=le.useCallback(X=>{const ce=X.features.flatMap(ee=>sa(ee.geometry));if(ce.length===0)return null;const Ee=ce.map(ee=>ee[1]),H=ce.map(ee=>ee[0]);return{minLat:Math.min(...Ee),maxLat:Math.max(...Ee),minLng:Math.min(...H),maxLng:Math.max(...H)}},[sa]),Ql=X=>{const ce=["latitude","lat","y"],Ee=["longitude","lng","long","lon","x"];let H=X.find(oe=>ce.some(ge=>oe.toLowerCase().trim()===ge.toLowerCase())),ee=X.find(oe=>Ee.some(ge=>oe.toLowerCase().trim()===ge.toLowerCase()));return(!H||!ee)&&(H=X.find(oe=>ce.some(ge=>oe.toLowerCase().trim().startsWith(ge.toLowerCase()+"_"))),ee=X.find(oe=>Ee.some(ge=>oe.toLowerCase().trim().startsWith(ge.toLowerCase()+"_")))),H&&ee?{lat:H,lng:ee}:null},pf=X=>{const ce=["hex_id","h3_index","h3","hexagon"],Ee=X.find(H=>ce.some(ee=>H.toLowerCase().trim()===ee.toLowerCase()));return Ee||X.find(H=>ce.some(ee=>H.toLowerCase().includes(ee.toLowerCase())))||null},gf=X=>{try{return MU(X)}catch{return!1}},mf=le.useCallback((X,ce,Ee,H,ee,oe,ge,c,k)=>{const we=[];let Oe=0,ze=0;const Me=Math.min(ce+c,X.length);for(let Ie=ce;Ie<Me;Ie++){const Ue=X[Ie];if(!Ue.trim())continue;const bt=Ue.split(",").map(Nt=>Nt.trim()),Sn=parseFloat(bt[oe]),On=parseFloat(bt[ge]);if(isNaN(Sn)||isNaN(On)||Sn<-90||Sn>90||On<-180||On>180){ze++;continue}const Gn={};Ee.forEach((Nt,Cr)=>{H.has(Nt)&&(Gn[Nt]=bt[Cr])}),we.push({position:[On,Sn],properties:Gn}),Oe++}const je=X.length-1,Mt=(Me-1)/je*100;return k(Math.min(Mt,100)),{data:we,validPoints:Oe,invalidPoints:ze,endIndex:Me}},[]),Xr=X=>{var H;const ce=(H=X.target.files)==null?void 0:H[0];if(!ce){rt(null);return}hn(null),rt(null);const Ee=new FileReader;Ee.onload=ee=>{var oe;try{const c=((oe=ee.target)==null?void 0:oe.result).split(/\r?\n/).map(Ie=>Ie.trim()).filter(Ie=>Ie.length>0);if(c.length<2)throw new Error("CSV file is empty or has no data rows");const k=c[0].split(",").map(Ie=>Ie.trim()),we=c.slice(1,11).map(Ie=>{const Ue=new Array(k.length).fill("");let bt="",Sn=!1,On=0;for(let Gn=0;Gn<Ie.length;Gn++){const Nt=Ie[Gn];Nt==='"'?Sn=!Sn:Nt===","&&!Sn?(On<k.length&&(Ue[On]=bt.trim()),bt="",On++):bt+=Nt}return On<k.length&&(Ue[On]=bt.trim()),Ue}),Oe=pf(k),ze=Oe?k.indexOf(Oe):-1;let Me=!1;if(ze!==-1){const Ie=we[0][ze];Me=gf(Ie)}const je=new Set;if(!Me){const Ie=Ql(k);Ie&&(je.add(Ie.lat),je.add(Ie.lng))}const Mt=new Set(k);rt({headers:k,rows:we,selectedColumns:Mt,coordinateColumns:je,isH3Data:Me,h3Column:Oe||void 0})}catch(ge){console.error("Error parsing CSV:",ge),alert(ge instanceof Error?ge.message:"Error parsing CSV file"),kt.current&&(kt.current.value=""),rt(null)}},Ee.readAsText(ce)},Gi=X=>{if(!be||be.coordinateColumns.has(X))return;const ce=new Set(be.selectedColumns);ce.has(X)?ce.delete(X):ce.add(X),rt({...be,selectedColumns:ce})},_f=()=>{be&&rt({...be,selectedColumns:new Set(be.headers)})},yf=()=>{be&&rt({...be,selectedColumns:new Set(be.coordinateColumns)})},fr=()=>{var Ee,H;if(!((H=(Ee=kt.current)==null?void 0:Ee.files)!=null&&H[0])||!be)return;const X=kt.current.files[0];p(!0),v(0);const ce=new FileReader;ce.onload=ee=>{var oe;try{const c=((oe=ee.target)==null?void 0:oe.result).split(/\r?\n/).map(we=>we.trim()).filter(we=>we.length>0),k=c[0].split(",").map(we=>we.trim());if(be.isH3Data&&be.h3Column){const we=k.indexOf(be.h3Column),Oe=c.slice(1).map(Me=>{const je=Me.split(",").map(Ue=>Ue.trim()),Mt=je[we],Ie={};return k.forEach((Ue,bt)=>{be.selectedColumns.has(Ue)&&bt!==we&&(Ie[Ue]=je[bt])}),{hex:Mt,properties:Ie}}),ze={id:t.length,name:X.name,visible:!0,data:Oe,color:"#ff0000",opacity:.7,type:"h3"};if(e([...t,ze]),Oe.length>0){const Me=Oe[0].hex,[je,Mt]=uf(Me);r({latitude:je,longitude:Mt,zoom:11})}}else{const we=Ql(k);if(!we)throw new Error("Could not detect latitude and longitude columns");const Oe=k.indexOf(we.lat),ze=k.indexOf(we.lng),Me=1e4;let je=1,Mt=[],Ie={minLat:1/0,maxLat:-1/0,minLng:1/0,maxLng:-1/0};for(;je<c.length;){const{data:zn,validPoints:Jl,invalidPoints:Mg,endIndex:Qr}=mf(c,je,k,be.selectedColumns,we,Oe,ze,Me,v);zn.forEach(Xe=>{Ie.minLat=Math.min(Ie.minLat,Xe.position[1]),Ie.maxLat=Math.max(Ie.maxLat,Xe.position[1]),Ie.minLng=Math.min(Ie.minLng,Xe.position[0]),Ie.maxLng=Math.max(Ie.maxLng,Xe.position[0])}),Mt=Mt.concat(zn),je=Qr}if(Mt.length===0)throw new Error("No valid data points found in CSV");const Ue=(Ie.minLat+Ie.maxLat)/2,bt=(Ie.minLng+Ie.maxLng)/2,Sn=Ie.maxLat-Ie.minLat,On=Ie.maxLng-Ie.minLng,Gn=Math.max(Sn,On),Nt=Math.min(20,Math.max(3,-Math.log2(Gn*2.5))),Cr={id:t.length,name:X.name,visible:!0,data:Mt,color:"#ff0000",opacity:.7,type:"point",columns:we,pointSize:5};e([...t,Cr]),r({latitude:Ue,longitude:bt,zoom:Nt})}}catch(ge){console.error("Error processing CSV:",ge),alert(ge instanceof Error?ge.message:"Error processing CSV file")}finally{p(!1),v(100),rt(null),kt.current&&(kt.current.value="")}},ce.readAsText(X)},oa=X=>{var H;const ce=(H=X.target.files)==null?void 0:H[0];if(!ce)return;kt.current&&(kt.current.files=X.target.files);const Ee=new FileReader;Ee.onload=ee=>{var oe;try{const ge=JSON.parse((oe=ee.target)==null?void 0:oe.result),c=new Set;ge.features.forEach(k=>{k.properties&&Object.keys(k.properties).forEach(we=>c.add(we))}),hn({properties:Array.from(c),features:ge.features.slice(0,10),selectedProperties:new Set(c)})}catch(ge){console.error("Error parsing GeoJSON:",ge),alert(ge instanceof Error?ge.message:"Error parsing GeoJSON file")}},Ee.readAsText(ce)},Yl=()=>{qe&&hn({...qe,selectedProperties:new Set(qe.properties)})},fi=()=>{qe&&hn({...qe,selectedProperties:new Set})},aa=X=>{if(!qe)return;const ce=new Set(qe.selectedProperties);ce.has(X)?ce.delete(X):ce.add(X),hn({...qe,selectedProperties:ce})},vf=()=>{var Ee,H;if(!((H=(Ee=kt.current)==null?void 0:Ee.files)!=null&&H[0])||!qe)return;const X=kt.current.files[0];p(!0),v(0);const ce=new FileReader;ce.onload=ee=>{var oe;try{const ge=JSON.parse((oe=ee.target)==null?void 0:oe.result),c={...ge,features:ge.features.map(Oe=>({...Oe,properties:Oe.properties?Object.fromEntries(Object.entries(Oe.properties).filter(([ze])=>qe.selectedProperties.has(ze))):{}}))},k={id:t.length,name:X.name,visible:!0,data:c,color:"#ff0000",opacity:.7,type:"geojson"};e([...t,k]);const we=df(c);if(we){const Oe=(we.minLat+we.maxLat)/2,ze=(we.minLng+we.maxLng)/2,Me=we.maxLat-we.minLat,je=we.maxLng-we.minLng,Mt=Math.max(Me,je),Ie=Math.min(20,Math.max(3,-Math.log2(Mt*2.5)));r({latitude:Oe,longitude:ze,zoom:Ie})}console.log("Successfully added GeoJSON layer with selected properties")}catch(ge){console.error("Error processing GeoJSON:",ge),alert(ge instanceof Error?ge.message:"Error processing GeoJSON file")}finally{p(!1),v(100),hn(null),kt.current&&(kt.current.value="")}},ce.onprogress=ee=>{if(ee.lengthComputable){const oe=ee.loaded/ee.total*100;v(oe)}},ce.readAsText(X)},wf=X=>{e(t.map(ce=>ce.id===X?{...ce,visible:!ce.visible}:ce))},Kl=X=>{e(t.filter(ce=>ce.id!==X)),I(null),C([]),it(ce=>{const Ee={...ce};return delete Ee[X],Ee}),Ae===X&&Re(null)},bf=(X,ce)=>{e(t.map(Ee=>Ee.id===X?{...Ee,color:ce}:Ee))},xf=(X,ce)=>{e(t.map(Ee=>Ee.id===X?{...Ee,opacity:ce}:Ee))},Tf=(X,ce)=>{e(t.map(Ee=>Ee.id===X?{...Ee,pointSize:ce}:Ee))},Ef=X=>{const ce=parseInt(X.slice(1,3),16),Ee=parseInt(X.slice(3,5),16),H=parseInt(X.slice(5,7),16);return[ce,Ee,H]},Sf=X=>{e(t.map(ce=>ce.id===X?{...ce,isExpanded:!ce.isExpanded}:ce))},Zl=(X,ce)=>!X||!ce||X.geometry.type!==ce.geometry.type?!1:X.geometry.type==="Point"&&ce.geometry.type==="Point"||X.geometry.type==="Polygon"&&ce.geometry.type==="Polygon"?JSON.stringify(X.geometry.coordinates)===JSON.stringify(ce.geometry.coordinates):JSON.stringify(X.properties)===JSON.stringify(ce.properties),Cf=(X,ce,Ee)=>{it(H=>({...H,[X]:[...H[X]||[],{fn:ce,info:Ee}]}))},la=(X,ce)=>{it(Ee=>{var H;return{...Ee,[X]:((H=Ee[X])==null?void 0:H.filter((ee,oe)=>oe!==ce))||[]}})},Pf=()=>t.filter(X=>X.visible).map(X=>{var ge,c;const[ce,Ee,H]=Ef(X.color);if(X.type==="h3")return new ia({id:`h3-layer-${X.id}`,data:X.data,pickable:!0,wireframe:!0,filled:!0,extruded:!1,getHexagon:k=>k.hex,getFillColor:[ce,Ee,H,Math.round(X.opacity*255)],getLineColor:[255,255,255],lineWidthMinPixels:1,opacity:X.opacity,onClick:k=>{if(k.object){const we=Zd(k.object.hex),Oe={type:"Feature",geometry:{type:"Polygon",coordinates:[we]},properties:k.object.properties};sn&&(E==null?void 0:E.geometry.type)==="Polygon"&&JSON.stringify(E.geometry.coordinates)===JSON.stringify([we])?(Hr(!1),I(null)):(I(Oe),Hr(!0))}},onHover:k=>{if(!sn&&k.object){const we={type:"Feature",geometry:{type:"Polygon",coordinates:[Zd(k.object.hex)]},properties:k.object.properties};I(we)}else sn||I(null)}});if(X.type==="point"){const k=X.data,we=((ge=At[X.id])==null?void 0:ge.length)>0?k.filter(Oe=>At[X.id].every(ze=>ze.fn(Oe))):k;return new nf({id:`point-layer-${X.id}`,data:we,getPosition:Oe=>Oe.position,getFillColor:[ce,Ee,H,Math.round(X.opacity*255)],getRadius:Oe=>E&&E.geometry.type==="Point"&&JSON.stringify(E.geometry.coordinates)===JSON.stringify(Oe.position)?(X.pointSize||5)*2:X.pointSize||5,radiusScale:1,radiusUnits:"pixels",radiusMinPixels:1,radiusMaxPixels:20,pickable:!0,updateTriggers:{getRadius:[E,X.pointSize]},onClick:Oe=>{if(Oe.object){const ze={type:"Feature",geometry:{type:"Point",coordinates:Oe.object.position},properties:Oe.object.properties};sn&&(E==null?void 0:E.geometry.type)==="Point"&&JSON.stringify(E.geometry.coordinates)===JSON.stringify(Oe.object.position)?(Hr(!1),I(null)):(I(ze),Hr(!0))}},onHover:Oe=>{if(!sn&&Oe.object){const ze={type:"Feature",geometry:{type:"Point",coordinates:Oe.object.position},properties:Oe.object.properties};I(ze)}else sn||I(null)}})}const ee=X.data,oe={...ee,features:((c=At[X.id])==null?void 0:c.length)>0?ee.features.filter(k=>At[X.id].every(we=>we.fn(k))):ee.features};return new Ig({id:`geojson-layer-${X.id}`,data:oe,filled:!0,stroked:!0,lineWidthUnits:"pixels",lineWidthMinPixels:1,getFillColor:k=>E&&Zl(k,E)?[ce,Ee,H,Math.round(X.opacity*255)]:[ce,Ee,H,Math.round(X.opacity*128)],getLineColor:[ce,Ee,H,255],pickable:!0,updateTriggers:{getFillColor:[X.color,X.opacity,E],lineWidthMinPixels:[E]},onClick:k=>{k.object&&(sn&&Zl(k.object,E)?(Hr(!1),I(null)):(I(k.object),Hr(!0)))},onHover:k=>{!sn&&k.object?I(k.object):sn||I(null)}})}),kf=()=>{const X={version:"1.0.0",viewState:n,basemap:ae,layers:t.map(ee=>{var oe,ge,c;return{name:ee.name,type:ee.type,visible:ee.visible,color:ee.color,opacity:ee.opacity,pointSize:ee.pointSize,columns:ee.columns,data:ee.data,filters:(oe=At[ee.id])==null?void 0:oe.map(k=>k.info),selectedProperties:ee.type==="geojson"?Object.keys(((ge=ee.data.features[0])==null?void 0:ge.properties)||{}):Object.keys(((c=ee.data[0])==null?void 0:c.properties)||{})}})},ce=new Blob([JSON.stringify(X,null,2)],{type:"application/json"}),Ee=URL.createObjectURL(ce),H=document.createElement("a");H.href=Ee,H.download="map-configuration.json",document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(Ee)},pe=X=>{var Ee;const ce=(Ee=X.target.files)==null?void 0:Ee[0];ce&&Rf(ce).then(()=>{X.target&&(X.target.value="")})},Rf=async X=>{try{const ce=await X.text(),Ee=JSON.parse(ce);if(!Ee.version)throw new Error("Invalid configuration file");e([]),it({}),I(null),C([]),r(Ee.viewState),he(Ee.basemap);const H={};Ee.layers.forEach((oe,ge)=>{oe.filters&&oe.filters.length>0&&(H[ge]=oe.filters.map(c=>({fn:k=>{var Oe;const we=(Oe=k.properties)==null?void 0:Oe[c.column];if(c.type==="numeric"){const ze=parseFloat(we);if(c.value.type==="range")return ze>=c.value.min&&ze<=c.value.max;if(c.value.type==="comparison"){const Me=parseFloat(String(c.value.value));switch(c.value.operator){case"<":return ze<Me;case"<=":return ze<=Me;case">":return ze>Me;case">=":return ze>=Me;case"=":return ze===Me;default:return!0}}}else if(c.type==="text"){const ze=String(we).toLowerCase();if(c.value.type==="multiple")return c.value.values.some(Me=>ze.includes(Me.toLowerCase()));if(c.value.type==="comparison"){const Me=String(c.value.value).toLowerCase();switch(c.value.operator){case"=":return ze===Me;case"<":return ze<Me;case"<=":return ze<=Me;case">":return ze>Me;case">=":return ze>=Me;default:return!0}}}return!0},info:c})))}),it(H);const ee=Ee.layers.map((oe,ge)=>{let c=oe.data;return H[ge]&&(oe.type==="geojson"?c={...oe.data,features:oe.data.features.filter(k=>H[ge].every(we=>we.fn(k)))}:oe.type==="point"?c=oe.data.filter(k=>H[ge].every(we=>we.fn(k))):oe.type==="h3"&&(c=oe.data.filter(k=>H[ge].every(we=>we.fn({properties:k.properties}))))),{id:ge,name:oe.name,type:oe.type,visible:oe.visible,color:oe.color,opacity:oe.opacity,pointSize:oe.pointSize,columns:oe.columns,data:c,isExpanded:!1}});e(ee)}catch(ce){console.error("Error importing configuration:",ce),alert("Error importing configuration file")}};return W.jsxs("div",{className:"fixed inset-0",children:[W.jsx("div",{className:"absolute top-4 left-4 z-10",children:W.jsxs("div",{className:"bg-white rounded-lg shadow-lg",children:[W.jsx("button",{onClick:()=>fe(!q),className:"w-full p-3 flex items-center justify-center hover:bg-gray-50 rounded-lg transition-colors",children:W.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:W.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),q&&W.jsx("div",{className:"p-4 border-t border-gray-200",children:W.jsxs("div",{className:"space-y-4",children:[W.jsxs("div",{children:[W.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-left",children:"Upload GeoJSON"}),W.jsx("input",{type:"file",accept:".json,.geojson",onChange:oa,onClick:X=>{X.target.value=""},disabled:f,className:`block w-full text-sm text-gray-500
                      file:mr-4 file:py-2 file:px-4
                      file:rounded-md file:border-0
                      file:text-sm file:font-semibold
                      file:bg-blue-50 file:text-blue-700
                      hover:file:bg-blue-100
                      disabled:opacity-50 disabled:cursor-not-allowed`},"geojson-input")]}),W.jsxs("div",{children:[W.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-left",children:"Upload CSV"}),W.jsx("input",{type:"file",accept:".csv",ref:kt,onChange:Xr,onClick:X=>{X.target.value=""},disabled:f,className:`block w-full text-sm text-gray-500
                      file:mr-4 file:py-2 file:px-4
                      file:rounded-md file:border-0
                      file:text-sm file:font-semibold
                      file:bg-blue-50 file:text-blue-700
                      hover:file:bg-blue-100
                      disabled:opacity-50 disabled:cursor-not-allowed`},"csv-input"),W.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1 text-left",children:[W.jsx("p",{children:"Supports two types of CSV files:"}),W.jsx("p",{children:"1. Point data with coordinate columns:"}),W.jsxs("ul",{className:"list-disc list-inside ml-2",children:[W.jsx("li",{children:"Latitude (lat/latitude/y)"}),W.jsx("li",{children:"Longitude (lng/long/longitude/x)"})]}),W.jsx("p",{children:"2. H3 hexagon data with index column:"}),W.jsx("ul",{className:"list-disc list-inside ml-2",children:W.jsx("li",{children:"H3 index (hex_id/h3_index/h3/hexagon)"})})]})]}),W.jsxs("div",{children:[W.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-left",children:"Import Map Configuration"}),W.jsx("input",{type:"file",accept:".json",onChange:pe,onClick:X=>{X.target.value=""},disabled:f,className:`block w-full text-sm text-gray-500
                      file:mr-4 file:py-2 file:px-4
                      file:rounded-md file:border-0
                      file:text-sm file:font-semibold
                      file:bg-blue-50 file:text-blue-700
                      hover:file:bg-blue-100
                      disabled:opacity-50 disabled:cursor-not-allowed`},"config-input"),W.jsxs("div",{className:"mt-2 text-xs text-gray-500 space-y-1 text-left",children:[W.jsx("p",{children:"Accepts only JSON configuration files previously exported from this tool."}),W.jsx("p",{children:"Configuration includes:"}),W.jsxs("ul",{className:"list-disc list-inside ml-2",children:[W.jsx("li",{children:"Layer settings and data"}),W.jsx("li",{children:"Map view state"}),W.jsx("li",{children:"Basemap selection"}),W.jsx("li",{children:"Filter configurations"})]})]})]}),W.jsx("button",{onClick:kf,disabled:t.length===0,className:"w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Export Current Configuration"})]})})]})}),f&&W.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:W.jsx("div",{className:"bg-white rounded-lg px-8 py-4",children:W.jsxs("p",{className:"text-lg font-medium text-gray-700",children:["Processing... ",Math.round(m),"%"]})})}),E&&W.jsxs("div",{className:"absolute top-4 right-4 z-10 bg-white rounded-lg shadow-lg p-4 max-w-md",children:[W.jsxs("div",{className:"flex justify-between items-center mb-2",children:[W.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["Feature Properties ",sn&&"(Locked)"]}),W.jsxs("div",{className:"flex items-center space-x-2",children:[W.jsx("button",{onClick:()=>R(!U),className:"text-gray-500 hover:text-gray-700",title:"Select columns to display",children:W.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:W.jsx("path",{fillRule:"evenodd",d:"M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z",clipRule:"evenodd"})})}),W.jsx("button",{onClick:()=>{I(null),Hr(!1)},className:"text-gray-500 hover:text-gray-700",children:W.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:W.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})]}),U&&W.jsxs("div",{className:"mb-4 p-2 bg-gray-50 rounded",children:[W.jsx("h4",{className:"text-xs font-medium text-gray-700 mb-2",children:"Select columns to display:"}),W.jsx("div",{className:"space-y-1 max-h-40 overflow-y-auto",children:D.map(X=>W.jsxs("label",{className:"flex items-center space-x-2",children:[W.jsx("input",{type:"checkbox",checked:P.includes(X),onChange:()=>hf(X),className:"h-3 w-3 text-blue-600 rounded border-gray-300"}),W.jsx("span",{className:"text-xs text-gray-600",children:X})]},X))})]}),W.jsx("div",{className:"text-sm text-gray-600 text-left",children:Object.entries(E.properties||{}).filter(([X])=>P.includes(X)).map(([X,ce])=>W.jsxs("div",{className:"mb-1",children:[W.jsxs("span",{className:"font-medium",children:[X,":"]})," ",String(ce)]},X))})]}),W.jsx("div",{className:"absolute bottom-4 left-4 z-10",children:W.jsx("div",{className:"flex flex-col space-y-2",children:W.jsx("button",{onClick:()=>Fe(!Te),className:"bg-white p-2 rounded-lg shadow-lg hover:bg-gray-50 transition-colors",title:Te?"Hide Layers":"Show Layers",children:W.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:W.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})})})}),Te&&W.jsxs("div",{className:"absolute bottom-16 left-4 z-10 bg-white rounded-lg shadow-lg p-4 max-w-md",children:[W.jsx("h3",{className:"text-sm font-medium text-gray-900 mb-2",children:"Layers"}),W.jsx("div",{className:"space-y-4",children:t.map(X=>W.jsxs("div",{className:"bg-white rounded-md border border-gray-200 overflow-hidden",children:[W.jsxs("div",{className:"flex items-center justify-between p-2",children:[W.jsxs("div",{className:"flex items-center space-x-2",children:[W.jsx("input",{type:"checkbox",checked:X.visible,onChange:()=>wf(X.id),className:"h-4 w-4 text-blue-600 rounded border-gray-300"}),W.jsx("span",{className:"text-sm text-gray-700 truncate max-w-[150px]",children:X.name})]}),W.jsxs("div",{className:"flex items-center space-x-2",children:[W.jsx("button",{onClick:()=>Sf(X.id),className:"text-gray-500 hover:text-gray-700",title:"Symbology",children:W.jsx(JL,{className:"h-5 w-5"})}),W.jsx("button",{onClick:()=>Re(X.id),className:"text-gray-500 hover:text-gray-700",title:"Filter",children:W.jsx(qL,{className:"h-5 w-5"})}),W.jsx("button",{onClick:()=>Kl(X.id),className:"text-red-600 hover:text-red-800",title:"Remove Layer",children:W.jsx(Ro,{className:"h-5 w-5"})})]})]}),X.isExpanded&&W.jsxs("div",{className:"border-t border-gray-200 p-2 space-y-2 bg-gray-50",children:[W.jsxs("div",{className:"flex items-center justify-between space-x-2",children:[W.jsx("span",{className:"text-xs text-gray-500",children:"Color"}),W.jsx("input",{type:"color",value:X.color,onChange:ce=>bf(X.id,ce.target.value),className:"h-6 w-6 rounded cursor-pointer"})]}),W.jsxs("div",{className:"space-y-1",children:[W.jsxs("div",{className:"flex items-center justify-between",children:[W.jsx("span",{className:"text-xs text-gray-500",children:"Opacity"}),W.jsxs("span",{className:"text-xs text-gray-600",children:[Math.round(X.opacity*100),"%"]})]}),W.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:X.opacity,onChange:ce=>xf(X.id,parseFloat(ce.target.value)),className:"w-full"})]}),X.type==="point"&&W.jsxs("div",{className:"space-y-1",children:[W.jsxs("div",{className:"flex items-center justify-between",children:[W.jsx("span",{className:"text-xs text-gray-500",children:"Point Size"}),W.jsxs("span",{className:"text-xs text-gray-600",children:[X.pointSize||5,"px"]})]}),W.jsx("input",{type:"range",min:"1",max:"20",step:"1",value:X.pointSize||5,onChange:ce=>{const Ee=parseInt(ce.target.value);Tf(X.id,Ee)},className:"w-full"})]})]})]},X.id))})]}),W.jsx(tU,{isOpen:Ae!==null,onClose:()=>Re(null),data:((Aa=t.find(X=>X.id===Ae))==null?void 0:Aa.type)==="point"?(ql=t.find(X=>X.id===Ae))==null?void 0:ql.data:((Gl=t.find(X=>X.id===Ae))==null?void 0:Gl.type)==="h3"?(Vs=t.find(X=>X.id===Ae))==null?void 0:Vs.data.map(X=>X.properties):((ca=t.find(X=>X.id===Ae))==null?void 0:ca.data.features)||[],onApplyFilter:(X,ce)=>{if(Ae!==null){const Ee=t.find(H=>H.id===Ae);Ee&&Cf(Ae,ee=>Ee.type==="h3"?X(ee.properties):X(ee),ce)}Re(null)},activeFilters:Ae!==null?((ua=At[Ae])==null?void 0:ua.map(X=>X.info))||[]:[],onRemoveFilter:X=>Ae!==null&&la(Ae,X),layerType:(fa=t.find(X=>X.id===Ae))==null?void 0:fa.type}),W.jsxs(xB,{style:{width:"100%",height:"100%"},viewState:n,onViewStateChange:({viewState:X})=>{"latitude"in X&&"longitude"in X&&"zoom"in X&&r(X)},controller:!0,layers:Pf(),children:[W.jsx(KL,{mapStyle:ae,mapboxAccessToken:"pk.eyJ1IjoiYm9ic2E1MTQiLCJhIjoiY2ltdjlwam1kMDJvZXZsbTQzNTh4bnYyayJ9.sbQPpPj6oitbLEgXhHAkEg"}),W.jsx("div",{className:"absolute bottom-16 right-4 z-10",children:W.jsxs("div",{className:"relative",children:[W.jsxs("button",{onClick:()=>ke(!ye),className:"bg-white px-3 py-2 rounded-lg shadow-lg text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2",children:[W.jsx("span",{children:"Base Map"}),W.jsx("svg",{className:`h-4 w-4 transform transition-transform ${ye?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:W.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),ye&&W.jsx("div",{className:"absolute bottom-full right-0 mb-2 bg-white rounded-lg shadow-lg py-2 min-w-[120px]",children:Object.entries(ff).map(([X,ce])=>W.jsx("button",{onClick:()=>{he(ce),ke(!1)},className:`w-full px-4 py-2 text-left text-sm hover:bg-gray-50 ${ae===ce?"text-blue-600 font-medium":"text-gray-700"}`,children:X},X))})]})}),W.jsxs("div",{className:"absolute bottom-5 right-4 z-10 flex items-center space-x-2 text-sm text-gray-600",children:[W.jsx("span",{children:"Boyang Sa"}),W.jsx("a",{href:"https://www.boyangsa.com",target:"_blank",rel:"noopener noreferrer",className:"text-gray-600 hover:text-gray-900",title:"Personal Website",children:W.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:W.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"})})}),W.jsx("a",{href:"https://github.com/bobsa514",target:"_blank",rel:"noopener noreferrer",className:"text-gray-600 hover:text-gray-900",title:"GitHub Profile",children:W.jsx("svg",{className:"h-5 w-5",fill:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:W.jsx("path",{fillRule:"evenodd",d:"M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.91-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z",clipRule:"evenodd"})})})]})]}),be&&W.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:W.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-[90vw] w-[1000px] max-h-[90vh] overflow-hidden flex flex-col",children:[W.jsxs("div",{className:"flex justify-between items-center mb-4",children:[W.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Preview CSV Data"}),W.jsx("button",{onClick:()=>rt(null),className:"text-gray-500 hover:text-gray-700",children:W.jsx(Ro,{className:"h-6 w-6"})})]}),W.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[W.jsxs("div",{className:"flex items-center space-x-2",children:[W.jsx("button",{onClick:_f,className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded",children:"Select All"}),W.jsx("button",{onClick:yf,className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded",children:"Deselect All"})]}),W.jsxs("div",{className:"text-sm text-gray-500",children:[be.selectedColumns.size," of ",be.headers.length," columns selected"]})]}),W.jsx("div",{className:"flex-1 overflow-auto",children:W.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[W.jsx("thead",{className:"bg-gray-50 sticky top-0",children:W.jsxs("tr",{children:[W.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10",children:"Row"}),be.headers.map((X,ce)=>W.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:W.jsxs("div",{className:"flex flex-col space-y-2",children:[W.jsx("span",{children:X}),W.jsxs("label",{className:"flex items-center space-x-2",children:[W.jsx("input",{type:"checkbox",checked:be.selectedColumns.has(X),onChange:()=>Gi(X),disabled:be.coordinateColumns.has(X),className:`h-4 w-4 rounded border-gray-300 ${be.coordinateColumns.has(X)?"bg-blue-100 text-blue-600 cursor-not-allowed":"text-blue-600"}`}),W.jsx("span",{className:"text-xs font-normal",children:be.coordinateColumns.has(X)&&"(Required)"})]})]})},ce))]})}),W.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:be.rows.map((X,ce)=>W.jsxs("tr",{className:ce%2===0?"bg-white":"bg-gray-50",children:[W.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:ce+1}),X.map((Ee,H)=>W.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:Ee},H))]},ce))})]})}),W.jsxs("div",{className:"mt-4 flex justify-end space-x-3",children:[W.jsx("button",{onClick:()=>rt(null),className:"px-4 py-2 text-gray-700 hover:text-gray-900 font-medium",children:"Cancel"}),W.jsx("button",{onClick:fr,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700",disabled:be.selectedColumns.size===0,children:"Proceed with Selected Columns"})]})]})}),qe&&W.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:W.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-[90vw] w-[1000px] max-h-[90vh] overflow-hidden flex flex-col",children:[W.jsxs("div",{className:"flex justify-between items-center mb-4",children:[W.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Preview GeoJSON Data"}),W.jsx("button",{onClick:()=>hn(null),className:"text-gray-500 hover:text-gray-700",children:W.jsx(Ro,{className:"h-6 w-6"})})]}),W.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[W.jsxs("div",{className:"flex items-center space-x-2",children:[W.jsx("button",{onClick:Yl,className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded",children:"Select All"}),W.jsx("button",{onClick:fi,className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 text-gray-700 rounded",children:"Deselect All"})]}),W.jsxs("div",{className:"text-sm text-gray-500",children:[qe.selectedProperties.size," of ",qe.properties.length," properties selected"]})]}),W.jsx("div",{className:"flex-1 overflow-auto",children:W.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[W.jsx("thead",{className:"bg-gray-50 sticky top-0",children:W.jsxs("tr",{children:[W.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10",children:"Property"}),qe.features.slice(0,5).map((X,ce)=>W.jsxs("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:["Feature ",ce+1]},ce))]})}),W.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:qe.properties.map((X,ce)=>W.jsxs("tr",{className:ce%2===0?"bg-white":"bg-gray-50",children:[W.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:W.jsxs("div",{className:"flex items-center space-x-2",children:[W.jsx("input",{type:"checkbox",checked:qe.selectedProperties.has(X),onChange:()=>aa(X),className:"h-4 w-4 rounded border-gray-300 text-blue-600"}),W.jsx("span",{className:"text-sm text-gray-900",children:X})]})}),qe.features.slice(0,5).map((Ee,H)=>{var ee;return W.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:(ee=Ee.properties)==null?void 0:ee[X]},H)})]},ce))})]})}),W.jsxs("div",{className:"mt-4 flex justify-end space-x-3",children:[W.jsx("button",{onClick:()=>hn(null),className:"px-4 py-2 text-gray-700 hover:text-gray-900 font-medium",children:"Cancel"}),W.jsx("button",{onClick:vf,className:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700",disabled:qe.selectedProperties.size===0,children:"Proceed with Selected Properties"})]})]})})]})};function YU(){return W.jsx("div",{className:"w-screen h-screen overflow-hidden",children:W.jsx(QU,{})})}N3(document.getElementById("root")).render(W.jsx(le.StrictMode,{children:W.jsx(YU,{})}));export{ZU as c,vy as g};
//# sourceMappingURL=index-BFT8Fpda.js.map
